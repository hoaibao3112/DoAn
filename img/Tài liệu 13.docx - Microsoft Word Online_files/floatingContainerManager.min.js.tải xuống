(window.wordOnlineExpChunks=window.wordOnlineExpChunks||[]).push([[20],{1640:function(t,e,n){var o={"./af-ZA/canvas-contextual.json":[1097,25],"./am-ET/canvas-contextual.json":[1098,29],"./ar-SA/canvas-contextual.json":[1099,33],"./as-IN/canvas-contextual.json":[1100,37],"./az-Latn-AZ/canvas-contextual.json":[1101,41],"./be-BY/canvas-contextual.json":[1102,44],"./bg-BG/canvas-contextual.json":[1103,48],"./bn-BD/canvas-contextual.json":[1104,51],"./bn-IN/canvas-contextual.json":[1105,55],"./bs-Latn-BA/canvas-contextual.json":[1106,59],"./ca-ES/canvas-contextual.json":[1107,63],"./ca-Es-VALENCIA/canvas-contextual.json":[1108,67],"./chr-Cher-US/canvas-contextual.json":[1109,70],"./cs-CZ/canvas-contextual.json":[1110,74],"./cy-GB/canvas-contextual.json":[1111,78],"./da-DK/canvas-contextual.json":[1112,82],"./de-DE/canvas-contextual.json":[1113,86],"./el-GR/canvas-contextual.json":[1114,90],"./en-GB/canvas-contextual.json":[1115,94],"./en-US/canvas-contextual.json":[1116,97],"./es-ES/canvas-contextual.json":[1117,101],"./es-MX/canvas-contextual.json":[1118,105],"./et-EE/canvas-contextual.json":[1119,109],"./eu-ES/canvas-contextual.json":[1120,113],"./fa-IR/canvas-contextual.json":[1121,117],"./fi-FI/canvas-contextual.json":[1122,121],"./fil-PH/canvas-contextual.json":[1123,125],"./fr-CA/canvas-contextual.json":[1124,129],"./fr-FR/canvas-contextual.json":[1125,133],"./ga-IE/canvas-contextual.json":[1126,137],"./gd-gb/canvas-contextual.json":[1127,141],"./gl-ES/canvas-contextual.json":[1128,145],"./gu-IN/canvas-contextual.json":[1129,149],"./ha-Latn-NG/canvas-contextual.json":[1130,152],"./he-IL/canvas-contextual.json":[1131,156],"./hi-IN/canvas-contextual.json":[1132,160],"./hr-HR/canvas-contextual.json":[1133,164],"./hu-HU/canvas-contextual.json":[1134,168],"./hy-AM/canvas-contextual.json":[1135,172],"./id-ID/canvas-contextual.json":[1136,176],"./is-IS/canvas-contextual.json":[1137,180],"./it-IT/canvas-contextual.json":[1138,184],"./ja-JP/canvas-contextual.json":[1139,188],"./ka-GE/canvas-contextual.json":[1140,192],"./kk-KZ/canvas-contextual.json":[1141,196],"./km-KH/canvas-contextual.json":[1142,200],"./kn-IN/canvas-contextual.json":[1143,204],"./ko-KR/canvas-contextual.json":[1144,208],"./kok-IN/canvas-contextual.json":[1145,212],"./ky-KG/canvas-contextual.json":[1146,215],"./lb-LU/canvas-contextual.json":[1147,219],"./lo-LA/canvas-contextual.json":[1148,223],"./lt-LT/canvas-contextual.json":[1149,227],"./lv-LV/canvas-contextual.json":[1150,231],"./mi-NZ/canvas-contextual.json":[1151,235],"./mk-MK/canvas-contextual.json":[1152,239],"./ml-IN/canvas-contextual.json":[1153,243],"./mn-MN/canvas-contextual.json":[1154,246],"./mr-IN/canvas-contextual.json":[1155,250],"./ms-MY/canvas-contextual.json":[1156,254],"./mt-MT/canvas-contextual.json":[1157,258],"./nb-NO/canvas-contextual.json":[1158,262],"./ne-NP/canvas-contextual.json":[1159,266],"./nl-NL/canvas-contextual.json":[1160,270],"./nn-NO/canvas-contextual.json":[1161,274],"./or-IN/canvas-contextual.json":[1162,278],"./pa-IN/canvas-contextual.json":[1163,282],"./pl-PL/canvas-contextual.json":[1164,286],"./prs-AF/canvas-contextual.json":[1165,289],"./pt-BR/canvas-contextual.json":[1166,293],"./pt-PT/canvas-contextual.json":[1167,297],"./qps-ploc/canvas-contextual.json":[1168,300],"./qps-ploca/canvas-contextual.json":[1169,303],"./qps-plocm/canvas-contextual.json":[1170,306],"./quz-PE/canvas-contextual.json":[1171,310],"./ro-RO/canvas-contextual.json":[1172,314],"./ru-RU/canvas-contextual.json":[1173,318],"./sd-Arab-PK/canvas-contextual.json":[1174,321],"./si-LK/canvas-contextual.json":[1175,324],"./sk-SK/canvas-contextual.json":[1176,328],"./sl-SI/canvas-contextual.json":[1177,332],"./sq-AL/canvas-contextual.json":[1178,336],"./sr-Cyrl-BA/canvas-contextual.json":[1179,340],"./sr-Cyrl-RS/canvas-contextual.json":[1180,344],"./sr-Latn-RS/canvas-contextual.json":[1181,348],"./sv-SE/canvas-contextual.json":[1182,352],"./sw-KE/canvas-contextual.json":[1183,355],"./ta-IN/canvas-contextual.json":[1184,359],"./te-IN/canvas-contextual.json":[1185,363],"./th-TH/canvas-contextual.json":[1186,367],"./tk-TM/canvas-contextual.json":[1187,370],"./tr-TR/canvas-contextual.json":[1188,374],"./tt-RU/canvas-contextual.json":[1189,378],"./ug-CN/canvas-contextual.json":[1190,382],"./uk-UA/canvas-contextual.json":[1191,386],"./ur-PK/canvas-contextual.json":[1192,390],"./uz-Latn-UZ/canvas-contextual.json":[1193,394],"./vi-VN/canvas-contextual.json":[1194,398],"./zh-CN/canvas-contextual.json":[1195,402],"./zh-TW/canvas-contextual.json":[1196,406]};function i(t){if(!n.o(o,t))return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=o[t],i=e[0];return n.e(e[1]).then((function(){return n.t(i,3)}))}i.keys=function(){return Object.keys(o)},i.id=1640,t.exports=i},2879:function(t,e,n){"use strict";n.r(e);var o,i=n(78),r=n(5);!function(t){t[t.CommentThread=0]="CommentThread",t[t.TrackedChange=1]="TrackedChange"}(o||(o={}));var a,s,c;function d(t){switch(t){case o.CommentThread:return i.b.CommentThread;case o.TrackedChange:return i.b.TrackedChange;default:return i.b.CommentThread}}!function(t){t[t.msoulscat_Wac_Telemetry=383]="msoulscat_Wac_Telemetry"}(a||(a={})),function(t){t[t.Error=10]="Error",t[t.Warning=15]="Warning",t[t.Info=50]="Info",t[t.Verbose=100]="Verbose",t[t.Spam=200]="Spam"}(s||(s={})),function(t){t[t.containerVirtualizationEnabled=0]="containerVirtualizationEnabled"}(c||(c={}));var l,u=function(){function t(t,e,n){void 0===n&&(n=0),this.disableRepositioningAnimation=!1,this.positionFixed=!1,this.anchorLeft=0,this.shouldUpdatePositions=!1,this.aggregateHeight=0,this.possibleTopForNextContainer=0,this.renderMode=i.e.Integrated,this.constructContainerId=t,this.ulsLogger=e,this.activeContainerAnchorLeft=n}return t.prototype.getAggregateHeight=function(){return this.aggregateHeight},t.prototype.calculateNewPositions=function(t,e,n){this.disableRepositioningAnimation=!!n&&!!n.disableRepositioningAnimation,this.positionFixed=!!n&&!!n.positionFixed,this.shouldUpdatePositions=!n||!1!==n.shouldUpdatePositions;var o=t[0];if(this.anchorLeft=o&&o.anchorLeft?o.anchorLeft:0,n&&n.activeContainerInfo){var i=n.activeContainerInfo;this.updateContainerPositionsAroundActiveContainer(t,e,i)}else{var r=n?n.topOfFirstContainer:void 0;this.setRestPositionOfContainers(t,e,r)}},t.prototype.updateContainersPositions=function(t,e,n){this.calculateNewPositions(t,e,n)},t.prototype.updateContainerPositionsAroundActiveContainer=function(t,e,n){var o=e[n.containerId];if(o){var i=o.floatingContainerRef,c=this.shouldUpdatePositions&&i?i.height():o.position.height;this.shouldUpdatePositions&&i&&(i.anchorPoint().y!==o.anchorTop||i.anchorPoint().x!==this.activeContainerAnchorLeft)&&i.updateContainerPosition({anchorPoint:{x:this.activeContainerAnchorLeft,y:o.anchorTop},disableRepositioningAnimation:this.disableRepositioningAnimation,positionFixed:this.positionFixed}),this.updateFloatingContainerPositionInCache(e,n.containerId,Object(r.__assign)(Object(r.__assign)({},o.position),{x:this.activeContainerAnchorLeft,y:o.anchorTop})),this.updateContainerPositionsAboveActiveContainer(t,e,o.anchorTop,n.containerPositionIndex-1),this.possibleTopForNextContainer=this.getBottomPositionOfContainer(o,o.anchorTop,c),this.updateContainerPositionsDownwards(t,e,n.containerPositionIndex+1),this.aggregateHeight=n.containerPositionIndex===t.length-1?c+o.anchorTop:this.aggregateHeight}else this.ulsLogger.sendTraceTag(595358743,a.msoulscat_Wac_Telemetry,s.Error,"Floating container info does not exist for the active container Id: ".concat(n.containerId))},t.prototype.updateContainerPositionsDownwards=function(t,e,n,o){void 0===n&&(n=0),void 0===o&&(o=!1);for(var i={},r=n;r<t.length;r+=1){if((a=t[r])&&a.contentId){if(!(s=this.getFloatingContainerInfo(a,e)))continue;i[a.contentId]=this.shouldUpdatePositions&&s.floatingContainerRef?s.floatingContainerRef.height():s.position.height}}for(r=n;r<t.length;r+=1){var a,s=this.getFloatingContainerInfo(t[r],e),c=(a=t[r])&&a.contentId;if(void 0===s||!c)return;var d=this.updateFloatingContainerPosition(t[r],e,i[c]);if(r===t.length-1&&s&&(this.aggregateHeight=i[c]+s.position.y),o&&d)return}},t.prototype.updateContainerPositionsAboveActiveContainer=function(t,e,n,o){var i=t[0]?t[0].anchorTop:void 0;this.setRestPositionOfContainers(t.slice(0,o+1),e,i);for(var a=n,s=o;s>=0;s-=1){var c=this.getFloatingContainerInfo(t[s],e);if(void 0===c||this.getBottomPositionOfContainer(c)<=a)return;var d=c.floatingContainerRef,l=a-(this.shouldUpdatePositions&&d?d.height():c.position.height)-10;this.shouldUpdatePositions&&d&&d.updateContainerPosition({anchorPoint:{x:this.anchorLeft,y:l},disableRepositioningAnimation:this.disableRepositioningAnimation,positionFixed:this.positionFixed}),this.updateFloatingContainerPositionInCache(e,this.getContainerId(t[s]),Object(r.__assign)(Object(r.__assign)({},c.position),{x:this.anchorLeft,y:l})),a=l}},t.prototype.setRestPositionOfContainers=function(t,e,n){var o;if(t.length>0){var i=this.getFloatingContainerInfo(t[0],e);if(void 0===i)return;var r=null===(o=i.floatingContainerRef)||void 0===o?void 0:o.anchorPoint().y,a=this.shouldUpdatePositions&&void 0!==r&&!this.positionFixed?r:i.position.y;this.possibleTopForNextContainer=null!=n?n:Math.max(i.anchorTop,a),this.updateContainerPositionsDownwards(t,e,0)}},t.prototype.getFloatingContainerInfo=function(t,e){return e[this.getContainerId(t)]},t.prototype.getContainerId=function(t){var e=t.contentId;return this.constructContainerId({contentId:e,contentType:d(t.containerContentType),renderMode:this.renderMode})},t.prototype.updateFloatingContainerPosition=function(t,e,n){var o=this.getFloatingContainerInfo(t,e);if(void 0===o)return!1;var i=this.shouldUpdatePositions&&o.floatingContainerRef?o.floatingContainerRef.anchorPoint().y:o.position.y,a=Math.max(this.possibleTopForNextContainer,o.anchorTop);return a!==i&&(this.shouldUpdatePositions&&o.floatingContainerRef&&o.floatingContainerRef.updateContainerPosition({anchorPoint:{x:this.anchorLeft,y:a},disableRepositioningAnimation:this.disableRepositioningAnimation,positionFixed:this.positionFixed}),this.updateFloatingContainerPositionInCache(e,this.getContainerId(t),Object(r.__assign)(Object(r.__assign)({},o.position),{x:this.anchorLeft,y:a}))),this.possibleTopForNextContainer=this.getBottomPositionOfContainer(o,a,n),a===i},t.prototype.getBottomPositionOfContainer=function(t,e,n){void 0===e&&(e=void 0),void 0===n&&(n=void 0);var o,i,r=t.floatingContainerRef,a=null==r?void 0:r.anchorPoint().y;return this.shouldUpdatePositions&&r&&void 0!==a?(o=a,i=r.height()):(o=t.position.y,i=t.position.height),(null!=e?e:o)+(null!=n?n:i)+10},t.prototype.updateFloatingContainerPositionInCache=function(t,e,n){t[e].position=n},t}(),p=n(2766),h=function(){function t(t){this.eventSink=t}return t.prototype.unsubscribe=function(){this.eventSink.unsubscribe(this)},t}(),C=function(){function t(){this.handlers=[]}return t.prototype.subscribe=function(t){var e=new h(this);return this.handlers.push({subscription:e,handler:t}),e},t.prototype.unsubscribe=function(t){this.handlers=this.handlers.filter((function(e){return e.subscription!==t}))},t.prototype.trigger=function(t){this.handlers.forEach((function(e){return e.handler(t,e.subscription)}))},t}(),f=function(){function t(t){this.onContainerShouldBeCreated=new C,this.motionDuration=p.b.duration4,this.posUpdateAnimationsInProgress=!1,this.containerVirtualizationEnabled=!1,t&&(this.containerVirtualizationEnabled=!!t.containerVirtualizationEnabled)}return t.prototype.updateContainersVisibility=function(t,e,n,o,i){var r=this;if(void 0===n&&(n=!1),void 0===i&&(i=!1),e.height>0){var a={viewportTop:e.y-e.height/2,viewportBottom:e.y+1.5*e.height,containerIdToInfoMap:t,activeContainerId:o};if(!i&&!this.posUpdateAnimationsInProgress)return void this.handleContainerVirtualization(n,a);this.posUpdateAnimationsInProgress=!0,this.showContainersComingIntoViewport(a),setTimeout((function(){r.updatePositions(a,n),window.clearTimeout(r.hideContainersTimeout),r.hideContainersTimeout=window.setTimeout((function(){r.hideContainersOutsideViewport(a),r.posUpdateAnimationsInProgress=!1}),parseInt(r.motionDuration,10))}),0)}},t.prototype.handleContainerVirtualization=function(t,e){var n=this;Object.keys(e.containerIdToInfoMap).forEach((function(o){var i=n.extractContainerInfo(o,e);n.updateContainerVisibility(i,e.activeContainerId===o),n.updateContainerPosition(i,t)}))},t.prototype.showContainersComingIntoViewport=function(t){var e=this;Object.keys(t.containerIdToInfoMap).forEach((function(n){var o=e.extractContainerInfo(n,t);e.updateContainerVisibility(o,t.activeContainerId===n)}))},t.prototype.hideContainersOutsideViewport=function(t){var e=this;Object.keys(t.containerIdToInfoMap).forEach((function(n){var o=e.extractContainerInfo(n,t);e.updateContainerVisibility(o,t.activeContainerId===n)}))},t.prototype.updatePositions=function(t,e){var n=this;Object.keys(t.containerIdToInfoMap).forEach((function(o){var i=n.extractContainerInfo(o,t);n.updateContainerPosition(i,e)}))},t.prototype.updateContainerVisibility=function(t,e){if(t.containerRef&&t.containerElement){var n=t.isContainerInViewport||e;t.containerElement.style.display=n?"block":"none",this.containerVirtualizationEnabled&&t.containerRef.updateContainerVirtualization(!n)}},t.prototype.updateContainerPosition=function(t,e){var n=t.containerElement;n&&(n.style.top="".concat(t.containerPosition.y,"px"),n.style.left="".concat(t.containerPosition.x,"px"),n.style.transitionDuration=e?"0ms":this.motionDuration)},t.prototype.extractContainerInfo=function(t,e){var n,o=e.containerIdToInfoMap[t],i=o.floatingContainerRef,r=o.position,a={containerElement:void 0,isContainerInViewport:r.y+r.height>=e.viewportTop&&r.y<=e.viewportBottom,containerRef:void 0,containerPosition:r};return i&&(a.containerRef=i,a.containerElement=null===(n=document.getElementById(i.parentDivId()))||void 0===n?void 0:n.querySelector("[id ^= 'floatingContainerView']")),a},t}(),g=n(17),v=n(2513),I=n(241),m=n(4),y=n(30),b=n(45);!function(t){t[t.Enablement=1]="Enablement",t[t.Focus=2]="Focus",t[t.Hover=3]="Hover",t[t.Resize=4]="Resize",t[t.Visibility=5]="Visibility"}(l||(l={}));var T,x=n(192);function P(t,e){return{type:t,payload:e}}!function(t){t.ChangeRenderedContentIdentifierType="CHANGE_RENDERED_CONTENT_IDENTIFIER",t.EmptyActionType="",t.RemoveVisibilityAnimationType="REMOVE_VISIBILITY_ANIMATION",t.RepositionType="REPOSITION_FLOATING_CONTAINER",t.SetContentType="SET_CONTENT",t.UpdateContainerVirtualizationType="UPDATE_FLOATING_CONTAINER_VIRTUALIZATION",t.UpdateContainerVisibilityType="UPDATE_FLOATING_CONTAINER_VISIBILITY",t.UpdateContentMaxDimensionsType="UPDATE_CONTENT_MAX_DIMENSIONS",t.UpdateContentSetItemDetailsType="UPDATE_CONTENT_SET_ITEM_DETAILS"}(T||(T={}));var A={anchorPoint:{x:0,y:0}};function R(t,e){var n;return void 0===e&&(e=A),{anchorPoint:e.anchorPoint,contentIdentifier:t,disableRepositioningAnimation:!1,isVisible:!1,isVirtualized:!1,maxDimensions:e.maxDimensions||{},positionFixed:!1,useVisibilityAnimation:!1,accessibilityMetadata:null!==(n=e.accessibilityMetadata)&&void 0!==n?n:{}}}var F={contentId:"",contentType:i.b.Empty};function E(t,e){switch(void 0===t&&(t=R(F)),void 0===e&&(e=P(T.EmptyActionType,{})),e.type){case T.ChangeRenderedContentIdentifierType:return function(t,e){if(t.contentIdentifier.contentId===e.payload.newContentIdentifier.contentId&&t.contentIdentifier.contentType===e.payload.newContentIdentifier.contentType)return t;return Object(r.__assign)(Object(r.__assign)({},t),{contentIdentifier:e.payload.newContentIdentifier})}(t,e);case T.RemoveVisibilityAnimationType:return function(t){return Object(r.__assign)(Object(r.__assign)({},t),{useVisibilityAnimation:!1})}(t);case T.RepositionType:return function(t,e){if(t.anchorPoint.x===e.payload.anchorPoint.x&&t.anchorPoint.y===e.payload.anchorPoint.y&&t.disableRepositioningAnimation===e.payload.disableRepositioningAnimation&&t.positionFixed===e.payload.positionFixed)return t;return Object(r.__assign)(Object(r.__assign)({},t),{anchorPoint:e.payload.anchorPoint,disableRepositioningAnimation:e.payload.disableRepositioningAnimation,positionFixed:e.payload.positionFixed})}(t,e);case T.SetContentType:return function(t,e){return Object(r.__assign)(Object(r.__assign)({},t),{content:e.payload.content,isVisible:!!e.payload.content&&t.isVisible})}(t,e);case T.UpdateContentMaxDimensionsType:return function(t,e){if(t.maxDimensions.height===e.payload.maxDimensions.height&&t.maxDimensions.width===e.payload.maxDimensions.width)return t;return Object(r.__assign)(Object(r.__assign)({},t),{maxDimensions:e.payload.maxDimensions})}(t,e);case T.UpdateContentSetItemDetailsType:return function(t,e){var n,o=null===(n=t.accessibilityMetadata)||void 0===n?void 0:n.setItem,i=e.payload.setItemDetails;if(o===i)return t;if(o&&i&&o.positionInSet===i.positionInSet&&o.setSize===i.setSize&&o.level===i.level)return t;return Object(r.__assign)(Object(r.__assign)({},t),{accessibilityMetadata:Object(r.__assign)(Object(r.__assign)({},t.accessibilityMetadata),{setItem:i})})}(t,e);case T.UpdateContainerVisibilityType:return function(t,e){return Object(r.__assign)(Object(r.__assign)({},t),{isVisible:e.payload.isVisible,useVisibilityAnimation:e.payload.useVisibilityAnimation})}(t,e);case T.UpdateContainerVirtualizationType:return function(t,e){return Object(r.__assign)(Object(r.__assign)({},t),{isVirtualized:e.payload.isVirtualized})}(t,e);default:return t}}function S(t){return P(T.SetContentType,{content:t})}var j=function(t){return t.isVirtualized},O=n(50),w=n(802),_=Object(O.bb)({from:{opacity:0,visibility:"visible"},to:{opacity:1}}),D=Object(O.bb)({from:{opacity:1,visibility:"visible"},to:{opacity:0,visibility:"hidden"}}),k=Object(w.c)((function(t,e,n,o){return{floatingContainerView:Object(O.eb)({animationName:e?t?_:D:void 0,animationDuration:"".concat(300,"ms"),animationTimingFunction:p.c.decelerate,background:"transparent",position:o?"fixed":"absolute",transitionDuration:t&&!n?p.b.duration4:"0s",transitionProperty:"top, left",transitionTimingFunction:p.c.decelerate,visibility:t?"visible":"hidden"})}}));var M=n(2801),U=n(639);function V(t){return"floatingContainerView".concat(t.contentId,"Type").concat(t.contentType)}var N=function(t){function e(e){var n=t.call(this,e)||this;return n.handleResizeUpdates=function(t){t.forEach((function(t){n.props.onContainerStateChanged.trigger({stateChangeType:l.Resize,contentIdentifier:n.props.contentIdentifier,contentRect:t.contentRect})}))},n.triggerVisibilityUpdateNotification=function(){n.props.onContainerStateChanged.trigger({stateChangeType:l.Visibility,contentIdentifier:n.props.contentIdentifier,isVisible:n.props.isVisible})},n.getHostedResource=function(t){return{id:t}},n.onFocusChange=function(t,e){var o=t.relatedTarget||document.activeElement;n.parentDivRef&&o instanceof HTMLElement&&n.parentDivRef.contains(o)||n.props.onContainerStateChanged.trigger({stateChangeType:l.Focus,contentIdentifier:n.props.contentIdentifier,isFocused:e})},n.onFocusOut=function(t){n.onFocusChange(t,!1)},n.onFocusIn=function(t){n.onFocusChange(t,!0)},n.onMouseEnter=function(){n.props.onContainerStateChanged.trigger({stateChangeType:l.Hover,contentIdentifier:n.props.contentIdentifier,isHovered:!0})},n.onMouseLeave=function(){n.props.onContainerStateChanged.trigger({stateChangeType:l.Hover,contentIdentifier:n.props.contentIdentifier,isHovered:!1})},n.setContentRef=function(t){n.contentRef=t},n.setParentDivRef=function(t){t!==n.parentDivRef&&(n.parentDivRef&&(n.resizeObserver.unobserve(n.parentDivRef),n.parentDivRef.removeEventListener("focusin",n.onFocusIn,!0),n.parentDivRef.removeEventListener("focusout",n.onFocusOut,!0)),t&&(n.resizeObserver.observe(t),t.addEventListener("focusin",n.onFocusIn,!0),t.addEventListener("focusout",n.onFocusOut,!0))),n.parentDivRef=t},n.contentRef=void 0,n.parentDivRef=void 0,n.resizeObserver=new U.a((function(t){window.requestAnimationFrame((function(){n.handleResizeUpdates(t)}))})),n.setContentRef=n.setContentRef.bind(n),n.setParentDivRef=n.setParentDivRef.bind(n),n.getHostedResource=Object(M.a)(n.getHostedResource.bind(n)),n}return Object(r.__extends)(e,t),e.prototype.componentDidMount=function(){this.triggerVisibilityUpdateNotification()},e.prototype.componentDidUpdate=function(t){var e=this,n=!1;t.isVisible!==this.props.isVisible&&(this.props.useVisibilityAnimation&&!this.props.isVisible?n=!0:this.triggerVisibilityUpdateNotification()),this.props.useVisibilityAnimation&&setTimeout((function(){n&&e.triggerVisibilityUpdateNotification(),e.props.removeVisibilityAnimation()}),300)},e.prototype.height=function(){return this.parentDivRef?this.parentDivRef.clientHeight:0},e.prototype.width=function(){return this.parentDivRef?this.parentDivRef.clientWidth:0},e.prototype.setFocus=function(){this.contentRef&&this.contentRef.focus()},e.prototype.render=function(){if(!this.props.anchorPoint||void 0===this.props.anchorPoint.x||void 0===this.props.anchorPoint.y||!this.props.content)return null;var t=k(this.props.isVisible,this.props.useVisibilityAnimation,this.props.disableRepositioningAnimation,this.props.positionFixed),e=this.props.content;return m.createElement("div",{key:V(this.props.contentIdentifier),id:V(this.props.contentIdentifier),ref:this.setParentDivRef,className:t.floatingContainerView,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,style:{left:this.props.anchorPoint.x,top:this.props.anchorPoint.y}},m.createElement(e,{componentRef:this.setContentRef,resource:this.getHostedResource(this.props.contentIdentifier.contentId),maximumDimensions:this.props.maxDimensions,isVirtualized:this.props.isVirtualized,accessibilityMetadata:this.props.accessibilityMetadata}))},e}(m.Component);var L,z=Object(b.connect)((function(t){return{accessibilityMetadata:t.accessibilityMetadata,anchorPoint:t.anchorPoint,content:t.content,contentIdentifier:t.contentIdentifier,disableRepositioningAnimation:t.disableRepositioningAnimation,isVisible:t.isVisible,isVirtualized:t.isVirtualized,maxDimensions:t.maxDimensions,positionFixed:t.positionFixed,useVisibilityAnimation:t.useVisibilityAnimation}}),(function(t,e){return{removeVisibilityAnimation:function(){t(P(T.RemoveVisibilityAnimationType,{}))}}}),void 0,{forwardRef:!0})(N),H=function(){function t(t,e,n,o){var i;this.onContainerStateChanged=new C,this.floatingContainerRef=void 0,this.extensionUpdatedEventSubscription=void 0,this.unsubscribeStoreListener=function(){},this.canShow=!1,!1===o.isDraftContainer&&(this.floatingContainerCreationActivity=Object(g.k)().createActivityObject("FloatingContainerCreation",Object(g.l)(g.g.GlobalAPI),Object(g.j)())),this.store=(i=R(n,o))?Object(x.createStore)(E,i):Object(x.createStore)(E),this.extensionProvider=e,this.setContentFromExtension(),this.parentDiv=document.createElement("div"),this.parentDiv.id=o.containerId||Object(v.a)(),t.appendChild(this.parentDiv),this.observeStore=this.observeStore.bind(this),this.onUpdatedEventHandler=this.onUpdatedEventHandler.bind(this),this.setFloatingContainerRef=this.setFloatingContainerRef.bind(this),this.observeStore(n),this.render()}return t.prototype.anchorPoint=function(){return this.store.getState().anchorPoint},t.prototype.contentIdentifier=function(){return this.store.getState().contentIdentifier},t.prototype.height=function(){return this.floatingContainerRef?this.floatingContainerRef.height():0},t.prototype.width=function(){return this.floatingContainerRef?this.floatingContainerRef.width():0},t.prototype.parentDivId=function(){return this.parentDiv.id},t.prototype.observeStore=function(t){var e=this;if(Object(i.i)(this.extensionProvider)){var n=t;this.unsubscribeStoreListener=this.store.subscribe((function(){var t=e.contentIdentifier();n.contentId===t.contentId&&n.contentType===t.contentType||(n=t,e.removeExtensionUpdatedEventSubscription(),e.setContentFromExtension())}))}},t.prototype.setContentFromExtension=function(){var t=this,e=void 0;if(Object(i.i)(this.extensionProvider)){if(e=this.extensionProvider.getExtension(this.contentIdentifier().contentId),this.extensionUpdatedEventSubscription||(this.extensionUpdatedEventSubscription=e.onUpdated.subscribe((function(e){t.onUpdatedEventHandler()}))),e.priority===i.d.Disabled)return this.canShow=!1,void this.store.dispatch(S(void 0))}else e=this.extensionProvider.getExtension();this.canShow=!0,Object(I.d)().getComponent(e.componentKey).then((function(e){t.store.dispatch(S(e.component)),t.floatingContainerCreationActivity&&(t.floatingContainerCreationActivity.successTag(593872975),t.floatingContainerCreationActivity=void 0)})).catch((function(t){Object(g.k)().assertConditionTag(!1,"Error when registering component in setContentFromExtension ".concat(t),595632583)}))},t.prototype.render=function(){var t={onContainerStateChanged:this.onContainerStateChanged};y.render(m.createElement(b.Provider,{store:this.store},m.createElement(z,Object(r.__assign)({ref:this.setFloatingContainerRef},t))),this.parentDiv)},t.prototype.updateContainerPosition=function(t){var e,n,o;this.store.dispatch((e=t.anchorPoint,n=!!t.disableRepositioningAnimation,o=!!t.positionFixed,P(T.RepositionType,{anchorPoint:e,disableRepositioningAnimation:n,positionFixed:o})))},t.prototype.updateMaximumDimensions=function(t){this.store.dispatch(function(t){return P(T.UpdateContentMaxDimensionsType,{maxDimensions:t})}(t))},t.prototype.updateSetItemDetails=function(t){this.store.dispatch(function(t){return P(T.UpdateContentSetItemDetailsType,{setItemDetails:t})}(t))},t.prototype.updateContainerVirtualization=function(t){t&&!j(this.store.getState())?this.store.dispatch(P(T.UpdateContainerVirtualizationType,{isVirtualized:!0})):j(this.store.getState())&&this.store.dispatch(P(T.UpdateContainerVirtualizationType,{isVirtualized:!1}))},t.prototype.showFloatingContainer=function(t){return!!this.canShow&&(this.store.dispatch(function(t){return P(T.UpdateContainerVisibilityType,{isVisible:!0,useVisibilityAnimation:t})}(!!t)),!0)},t.prototype.hideFloatingContainer=function(t){this.store.dispatch(function(t){return P(T.UpdateContainerVisibilityType,{isVisible:!1,useVisibilityAnimation:t})}(!!t))},t.prototype.destroyFloatingContainer=function(t){var e=this;this.unsubscribeStoreListener(),this.removeExtensionUpdatedEventSubscription(),this.hideFloatingContainer(t),t?setTimeout((function(){e.cleanupDomOnDestroy()}),300):this.cleanupDomOnDestroy()},t.prototype.cleanupDomOnDestroy=function(){y.unmountComponentAtNode(this.parentDiv),this.parentDiv.parentElement&&this.parentDiv.parentElement.removeChild(this.parentDiv)},t.prototype.isShowing=function(){return this.store.getState().isVisible},t.prototype.setFocus=function(){var t=this;this.floatingContainerRef?this.floatingContainerRef.setFocus():setTimeout((function(){var e;return null===(e=t.floatingContainerRef)||void 0===e?void 0:e.setFocus()}))},t.prototype.changeRenderedContentIdentifier=function(t){this.store.dispatch(function(t){return P(T.ChangeRenderedContentIdentifierType,{newContentIdentifier:t})}(t))},t.prototype.onUpdatedEventHandler=function(){var t=this.canShow;this.setContentFromExtension(),t!==this.canShow&&this.onContainerStateChanged.trigger({stateChangeType:l.Enablement,contentIdentifier:this.contentIdentifier(),isEnabled:this.canShow})},t.prototype.removeExtensionUpdatedEventSubscription=function(){this.extensionUpdatedEventSubscription&&(this.extensionUpdatedEventSubscription.unsubscribe(),this.extensionUpdatedEventSubscription=void 0)},t.prototype.setFloatingContainerRef=function(t){this.floatingContainerRef=null!=t?t:void 0},t}(),B=new(function(){function t(){}return t.prototype.createFloatingContainer=function(t,e,n,o){return new H(t,e,n,o)},t}()),W=n(2148);!function(t){t[t.DeselectionEnabled=0]="DeselectionEnabled",t[t.FloatingContainerVirtualizationEnabled=1]="FloatingContainerVirtualizationEnabled",t[t.ImproveJumpingFixEnabled=2]="ImproveJumpingFixEnabled",t[t.ShouldInitialize=3]="ShouldInitialize",t[t.ScrollingPerfImprovementEnabled=4]="ScrollingPerfImprovementEnabled",t[t.SynchronousContainerPositioningEnabled=5]="SynchronousContainerPositioningEnabled",t[t.TrackChangesInSidetrackEnabled=6]="TrackChangesInSidetrackEnabled",t[t.ContentNavigationApiEnabled=7]="ContentNavigationApiEnabled",t[t.ReturnToDraftFixEnabled=8]="ReturnToDraftFixEnabled",t[t.RibbonCommentFilteringEnabled=9]="RibbonCommentFilteringEnabled"}(L||(L={}));var G,Q=n(2476),q=n(2477),K=n(274),Z=n(2919);!function(t){t[t.Focus=0]="Focus"}(G||(G={}));var J=n(164);function Y(t){return"".concat(t.contentId,"_").concat(t.contentType,"_").concat(t.renderMode)}function X(t){switch(t){case i.b.CommentThread:return o.CommentThread;case i.b.TrackedChange:return o.TrackedChange;default:return o.CommentThread}}var $=function(t){var e=t.id,n=t.containerContent,o=t.componentRef,a=m.useState(n),s=a[0],c=a[1],d=m.useCallback((function(t){var e;switch(t.type){case"content":c(t.data);break;case"behavior":t.data.action===G.Focus&&(null===(e=p.current)||void 0===e||e.focus())}}),[]),l=yt.getTrackChangesStore(),u=yt.getFCContentNavigationAPI(),p=m.useRef(null),h=m.useCallback((function(){var t;null===(t=p.current)||void 0===t||t.focus()}),[]),C=m.useCallback((function(){return e}),[e]);m.useEffect((function(){return l.registerOnStoreUpdate(e,d),o&&o({focus:h,getInstanceId:C}),function(){l.removeFromStore(e)}}),[e,o,d,l,h,C]);var f=m.useMemo((function(){var t,e;return{definitionType:"TrackChangeDefinition",authorName:null!==(t=s.authorName)&&void 0!==t?t:"",authorColor:null!==(e=s.authorColor)&&void 0!==e?e:"",changeDescriptor:s.changeDescriptor,acceptDisabled:!!s.acceptDisabled,rejectDisabled:!!s.rejectDisabled,theme:s.theme}}),[s]),g=m.useMemo((function(){return l.cardStrings}),[l.cardStrings]),v=m.useMemo((function(){return l.getCardActionCallbacks(e)}),[e,l]),I=m.useMemo((function(){return{definition:f,strings:g,onAcceptHoverIn:v.onAcceptHoverIn,onRejectHoverIn:v.onRejectHoverIn,onAcceptHoverOut:v.onAcceptHoverOut,onRejectHoverOut:v.onRejectHoverOut,onAcceptClick:v.onAcceptClick,onRejectClick:v.onRejectClick,style:l.cardStyles}}),[f,g,v.onAcceptHoverIn,v.onRejectHoverIn,v.onAcceptHoverOut,v.onRejectHoverOut,v.onAcceptClick,v.onRejectClick,l]),y=m.useCallback((function(){v.onCardClick(),h()}),[v,h]),b=m.useCallback((function(){v.onCardHoverIn()}),[v]),T=m.useCallback((function(){v.onCardHoverOut()}),[v]),x=m.useCallback((function(t){var n,o="ArrowDown"===(n=t.key)||"Down"===n?J.d.Next:"ArrowUp"===n||"Up"===n?J.d.Previous:J.d.None;o!==J.d.None&&(null==u||u.selectNextOrPreviousContent({selectDirection:o,preventLooping:!1,reason:J.c.Keyboarding,restrictToCurrentContext:!0,from:{contentId:e,contentType:i.b.TrackedChange}}),t.preventDefault())}),[u,e]),P=m.useMemo((function(){var t,e=(null===(t=s.theme)||void 0===t?void 0:t.borderColor)?"1px solid ".concat(s.theme.borderColor):void 0;return Object(O.eb)({outline:"none",boxShadow:"0 0 2px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0,0,0,0.14)",borderRadius:"4px",":hover":{boxShadow:"0 0 2px rgba(0, 0, 0, 0.12), 0 4px 8px rgba(0,0,0,0.14)"},border:e,":focus":{boxShadow:"0 0 2px rgba(0, 0, 0, 0.12), 0 8px 16px rgba(0,0,0,0.14)"}})}),[s]);return m.createElement("div",{onClick:y,onMouseEnter:b,onMouseLeave:T,onKeyDown:x,tabIndex:0,ref:p,className:P},m.createElement(Z.a,Object(r.__assign)({},I)))},tt=function(t){var e,n,o=yt.getTrackChangesStore().getContainerContent(null===(e=t.resource)||void 0===e?void 0:e.id);return o?m.createElement($,{id:null===(n=t.resource)||void 0===n?void 0:n.id,containerContent:o,componentRef:t.componentRef}):null};var et=n(868),nt=n(1489),ot={width:0,height:0,x:0,y:0};function it(t){return void 0!==t.hasBeenRendered}var rt=function(){function t(t,e,n,o,r){var a=this;this.supportedContentTypes=[i.b.CommentThread,i.b.TrackedChange],this.getContentCardIndex=function(t,e){if(!a.containerIdToInfoMap[t])return a.ULS.sendTraceTag(595883362,Q.a.msoulscat_Wac_Telemetry,q.a.Error,"[getContentCardIndex]Container with id ".concat(t," does not exist.")),-1;var n=a.containerIdToInfoMap[t].anchorTop;n=e?Math.max(n,e):n;for(var o=a.getContentCardInsertionPoint(n),i=o;i<a.contentAnchorPositions.length;i+=1)if(a.checkIfContainerIdCorrespondsToGivenPosition(t,i))return i;for(i=0;i<o;i+=1)if(a.checkIfContainerIdCorrespondsToGivenPosition(t,i))return i;return-1},this.initializeExtensionProviderCollection=function(t){a.extensionProviderCollection=a.contentExtensionHostAPIGetter().getExtensions(a.supportedContentTypes,i.c),a.updateContentTypeToExtensionProviderMap(t),a.extensionProviderCollection.onUpdated.subscribe((function(){return a.updateContentTypeToExtensionProviderMap(t)}))},this.getContentCardInsertionPoint=function(t){for(var e,n=0,o=a.contentAnchorPositions.length;n<o;){e=n+Math.floor((o-n)/2),a.contentAnchorPositions[e].anchorTop<t-4?n=e+1:o=e}return n},this.getContainerStateChangedCallback=function(t,e){return function(n,o){switch(n.stateChangeType){case l.Resize:t(n,o);break;case l.Visibility:if(n.isVisible)if(!a.commentsTTVRReported)e===a.lastCommentVisibleID&&(Object(et.e)(et.d,{component:"canvas",subComponent:"floatingComments",state:nt.c}),Object(et.e)(et.d,{component:"canvas",subComponent:"floatingComments",state:nt.a}),a.commentsTTVRReported=!0)}}},this.renderFloatingContainerAtAnchorPosition=function(t){var e=a.containerIdToInfoMap[t];e&&e.floatingContainerRef&&e.floatingContainerRef.showFloatingContainer(!0)},this.updateContentTypeToExtensionProviderMap=function(t){a.contentTypeToExtensionProviderMap.clear(),void 0!==a.extensionProviderCollection?(a.areCommentExtensionProvidersDefinedOnce||(a.areCommentExtensionProvidersDefinedOnce=0!==a.extensionProviderCollection.providers.filter((function(t){return t.scope.contentType===i.b.CommentThread&&t.scope.renderMode===i.e.Integrated})).length),a.extensionProviderCollection.providers.forEach((function(t){t.scope.renderMode===i.e.Integrated&&a.contentTypeToExtensionProviderMap.set(t.scope.contentType,t)})),t()):a.ULS.sendTraceTag(595886287,Q.a.msoulscat_Wac_Telemetry,q.a.Error,"extensionProviderCollection should not be null")},this.contentExtensionHostAPIGetter=t,this.dhcContainerPanel=e,this.isCommentPaneOpen=!1,this.areCommentExtensionProvidersDefinedOnce=!1,this.viewportInfo=r||ot,this.containerIdToInfoMap={},this.contentAnchorPositions=[],this.contentTypeToExtensionProviderMap=new Map,this.floatingContainerFactory=n,this.ULS=o,this.processedContainersVisibleAtBoot=!1,this.isFirstCommentRenderDone=!1,this.lastCommentVisibleID="",this.commentsTTVRReported=!1}return t.prototype.addContentAnchorPosition=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=-1);var o=n>-1?n:this.getContentCardInsertionPoint(t.anchorTop)+e;return this.contentAnchorPositions.splice(o,0,t),o},t.prototype.getContainerIdToInfoMap=function(){return this.containerIdToInfoMap},t.prototype.getContentAnchorPositions=function(){return this.contentAnchorPositions},t.prototype.getContentAnchorPosition=function(t){var e=this.getContentCardIndex(t);if(e>-1)return this.contentAnchorPositions[e]},t.prototype.initializeAndRenderFloatingContainer=function(t,e,n,o,i){void 0===o&&(o=!0),void 0===i&&(i=!1);var r;return r=this.initializeFloatingContainerState(t,n,o,i),i&&this.renderFloatingContainerAtAnchorPosition(e),r},t.prototype.isContainerInViewPort=function(t){return t>this.viewportInfo.y-.5*this.viewportInfo.height&&t<this.viewportInfo.y+1.5*this.viewportInfo.height},t.prototype.removeContentAnchorPosition=function(t){var e=this.getContentCardIndex(t);return-1===e?(this.ULS.sendTraceTag(595736577,Q.a.msoulscat_Wac_Telemetry,q.a.Error,"[RemoveContentAnchorPosition]Content anchor position for id ".concat(t," does not exist.")),-1):(this.contentAnchorPositions.splice(e,1),e)},t.prototype.checkIfContainerIdCorrespondsToGivenPosition=function(t,e){return t===this.getContainerIdUsingPositionalIndex(e)},t.prototype.getContainerIdUsingPositionalIndex=function(t){var e=this.contentAnchorPositions[t];return Y({contentId:e.contentId,contentType:d(e.containerContentType),renderMode:i.e.Integrated})},t.prototype.createFloatingContainer=function(t,e,n,o){if(this.dhcContainerPanel)return this.floatingContainerFactory.createFloatingContainer(this.dhcContainerPanel,t,{contentId:e.contentId,contentType:d(e.containerContentType)},{anchorPoint:{x:0,y:n},isDraftContainer:o});this.ULS.sendTraceTag(595883361,Q.a.msoulscat_Wac_Telemetry,q.a.Error,"[createFloatingContainer]dhcContainerPanel is not yet set.")},t.prototype.initializeFloatingContainerState=function(t,e,n,o){if(t){var a=this.contentTypeToExtensionProviderMap.get(d(t.containerContentType));if(void 0===a)return this.ULS.sendTraceTag(595883363,Q.a.msoulscat_Wac_Telemetry,q.a.Error,"[initializeFCState]ExtensionProvider not found for contentType ".concat(t.containerContentType)),!1;var s=t.contentId;if(!s)return this.ULS.sendTraceTag(595883407,Q.a.msoulscat_Wac_Telemetry,q.a.Error,"[initializeFCState]ContentId is null or empty."),!1;var c=Y({contentId:s,contentType:d(t.containerContentType),renderMode:i.e.Integrated}),l=void 0;if(n){if(!(l=this.createFloatingContainer(a,{contentId:s,containerContentType:t.containerContentType},t.anchorTop,o)))return this.ULS.sendTraceTag(595886286,Q.a.msoulscat_Wac_Telemetry,q.a.Error,"[createFloatingContainer] Could not create fc for content id ".concat(s)),!1;l.onContainerStateChanged.subscribe(this.getContainerStateChangedCallback(e,c))}if(this.containerIdToInfoMap[c])this.containerIdToInfoMap[c].floatingContainerRef=l;else{var u=Object(r.__assign)(Object(r.__assign)({position:{height:0,width:0,x:0,y:t.anchorTop}},this.containerIdToInfoMap[c]),{anchorTop:t.anchorTop,floatingContainerRef:l,hasBeenRendered:!1});this.containerIdToInfoMap[c]=u}return!0}return!1},t}(),at=function(){function t(t,e,n,a,s,c,u,p){var h=this;this.floatingContainerPositioner=t,this.floatingContainerVirtualizer=e,this.store=n,this.featureSettings=c,this.trackChangesStore=p,this.isInitialActiveIdSet=!1,this.inFixedMode=!1,this.firstContainerBeingRendered=!0,this.fcManagerInitialized=!1,this.pauseContainerCreation=!1,this.containerDelayTimeMs=10,this.containerCreationQueue=[],this.isContainerQueueInProgress=!1,this.containerCreationTimers={},this.containerCreationEnqueueTimes={},this.stallDetectorTimeoutId=void 0,this.stallDetectorUsed=!1,this.queueStallDetectionTimeMs=1e3,this.draftContainerId="",this.ribbonCommentFilteringEnabled=!1,this.emitEvent=function(t,e){var n,r;if(h.store.isCommentPaneOpen||!h.store.dhcContainerPanel||!h.store.areCommentExtensionProvidersDefinedOnce)return h.store.ULS.sendTraceTag(538022540,Q.a.msoulscat_Wac_Telemetry,q.a.Warning,"FCM not handling the event. {\n          isCommentPaneOpen: ".concat(h.store.isCommentPaneOpen,",\n          dhcContainerPanelNotDefined: ").concat(!h.store.dhcContainerPanel,",\n          extensionProvidersNotDefined: ").concat(!h.store.areCommentExtensionProvidersDefinedOnce,"\n        }")),void(e&&e.viewportInfo&&(h.store.viewportInfo=e.viewportInfo));switch(t){case 0:if(e&&e.contentAnchorPosition){var a=e.contentAnchorPosition.contentId,s=e.noOfPrecedingThreadsOnSameLine?e.noOfPrecedingThreadsOnSameLine:0;if(!a)return void h.store.ULS.sendTraceTag(595903774,Q.a.msoulscat_Wac_Telemetry,q.a.Error,"[AddContainer]ContentId is null.");var c=Y({contentId:a,contentType:d(e.contentAnchorPosition.containerContentType),renderMode:i.e.Integrated}),l=h.store.getContainerIdToInfoMap()[c];if(void 0!==h.containerCreationTimers[c])return void h.store.ULS.sendTraceTag(509634193,Q.a.msoulscat_Wac_Telemetry,q.a.Warning,"[AddContainer]Container Creation in queue.");if(l&&l.floatingContainerRef)return void h.store.ULS.sendTraceTag(595097123,Q.a.msoulscat_Wac_Telemetry,q.a.Warning,"[AddContainer]Container already exists.");var u=h.store.initializeAndRenderFloatingContainer(e.contentAnchorPosition,c,h.onContainerResize,void 0,!0);if(h.draftContainerId=a,u){h.store.addContentAnchorPosition(e.contentAnchorPosition,s);var p={contentId:a,containerContentType:e.contentAnchorPosition.containerContentType};e.shouldSetFocus&&h.emitEvent(2,{containerContentDescriptor:p})}}break;case 1:if(e&&e.containerContentDescriptor){if(!e.containerContentDescriptor.contentId)return void h.store.ULS.sendTraceTag(595903775,Q.a.msoulscat_Wac_Telemetry,q.a.Error,"[DeleteContainer]ContentId is null.");c=Y({contentId:e.containerContentDescriptor.contentId,contentType:d(e.containerContentDescriptor.containerContentType),renderMode:i.e.Integrated});if(!(l=h.store.getContainerIdToInfoMap()[c]))return void h.store.ULS.sendTraceTag(595723333,Q.a.msoulscat_Wac_Telemetry,q.a.Error,"[DeleteContainer]Container info for id ".concat(c," does not exist."));var C=l.position.y,f=h.deleteContainer(c,!!e.animateOutOnDeletion);if(-1===f)return;h.store.activeContainerId&&h.store.activeContainerId!==c?h.positionFloatingContainers(h.store.getContentAnchorPositions(),void 0,h.store.activeContainerId):h.positionFloatingContainers(h.store.getContentAnchorPositions().slice(f),C)}break;case 2:if(e&&e.containerContentDescriptor){if(!e.containerContentDescriptor.contentId)return void h.store.ULS.sendTraceTag(595903777,Q.a.msoulscat_Wac_Telemetry,q.a.Error,"[FocusContainer]ContentId is null.");var g=Y({contentId:e.containerContentDescriptor.contentId,contentType:d(e.containerContentDescriptor.containerContentType),renderMode:i.e.Integrated});if(!h.store.getContainerIdToInfoMap()[g])return h.store.ULS.sendTraceTag(595903778,Q.a.msoulscat_Wac_Telemetry,q.a.Error,"[FocusContainer]Container with id ".concat(g," does not exist")),void h.setInitialActiveContainerIdV2(e.containerContentDescriptor,null);h.store.activeContainerId!==g&&(h.clearSelection(!0),h.positionFloatingContainers(h.store.getContentAnchorPositions(),void 0,g,void 0,!0));var v=h.store.getContainerIdToInfoMap()[g].floatingContainerRef;e.shouldSetFocus&&v&&v.setFocus(),h.store.activeContainerId=g}break;case 3:if(e&&e.contentAnchorPositions){if(e.containerContentByType&&e.containerContentByType[o.TrackedChange])for(var I=e.containerContentByType[o.TrackedChange],m=0,y=Object.entries(I);m<y.length;m++){var b=y[m],T=b[0],x=b[1];h.trackChangesStore.addOrUpdateStore(T,x)}h.processContentAnchorPositionsInView(e.contentAnchorPositions)}break;case 4:e&&e.viewportInfo&&(h.store.viewportInfo=e.viewportInfo,h.featureSettings.SynchronousContainerPositioningEnabled||h.positionFloatingContainers());break;case 5:if(e&&e.infoToReplaceContent){var P=e.infoToReplaceContent.currentContentId,A=e.infoToReplaceContent.newContentId;if(!P||!A)return void h.store.ULS.sendTraceTag(595855174,Q.a.msoulscat_Wac_Telemetry,q.a.Error,"[ReplaceContainerContent]".concat(P?"NewContentId":"CurrentContentId"," is null."));var R=Y({contentId:P,contentType:d(e.infoToReplaceContent.containerContentType),renderMode:i.e.Integrated});if(!(l=h.store.getContainerIdToInfoMap()[R]))return void h.store.ULS.sendTraceTag(595855175,Q.a.msoulscat_Wac_Telemetry,q.a.Error,"[ReplaceContainerContent]ContainerInfo for id ".concat(R," does not exist"));if(!l.floatingContainerRef)return void h.store.ULS.sendTraceTag(595855176,Q.a.msoulscat_Wac_Telemetry,q.a.Error,"[ReplaceContainerContent]FloatingContainerRef with id ".concat(R," does not exist"));l.floatingContainerRef.changeRenderedContentIdentifier({contentId:A,contentType:d(e.infoToReplaceContent.containerContentType)}),h.replacementContentId=A;var F=Y({contentId:A,contentType:d(e.infoToReplaceContent.containerContentType),renderMode:i.e.Integrated}),E=h.store.getContentCardIndex(R);if(-1===E)return void h.store.ULS.sendTraceTag(595855178,Q.a.msoulscat_Wac_Telemetry,q.a.Error,"[ReplaceContainerContent]Positional index for content id ".concat(P," should not be negative"));h.store.activeContainerId=h.store.activeContainerId===R?F:h.store.activeContainerId,h.store.getContainerIdToInfoMap()[F]=l,delete h.store.getContainerIdToInfoMap()[R],h.store.getContentAnchorPositions()[E].contentId=A}break;case 6:h.positionFloatingContainers();break;case 7:h.ribbonCommentFilteringEnabled&&(null===(n=null==e?void 0:e.filteredContent)||void 0===n||n.includedContent.forEach((function(t){if(t.contentId){var e=Y({contentId:t.contentId,contentType:d(t.containerContentType),renderMode:i.e.Integrated}),n=h.store.getContainerIdToInfoMap()[e];n&&n.floatingContainerRef&&n.floatingContainerRef.showFloatingContainer(!0)}})),null===(r=null==e?void 0:e.filteredContent)||void 0===r||r.excludedContent.forEach((function(t){if(t.contentId){var e=Y({contentId:t.contentId,contentType:d(t.containerContentType),renderMode:i.e.Integrated}),n=h.store.getContainerIdToInfoMap()[e];n&&n.floatingContainerRef&&n.floatingContainerRef.hideFloatingContainer(!0)}})))}},this.getAreContainersEnabled=function(){return!h.store.isCommentPaneOpen&&h.store.areCommentExtensionProvidersDefinedOnce},this.getContentAnchorPosition=function(t){if(!t)return null;var e=Y({contentId:t,contentType:i.b.CommentThread,renderMode:i.e.Integrated}),n=h.store.getContentCardIndex(e);return-1!==n?h.store.getContentAnchorPositions()[n]:null},this.containerShouldBeCreatedEventHandler=function(t){var e=h.store.getContentCardIndex(t.containerId);h.store.initializeAndRenderFloatingContainer(h.store.getContentAnchorPositions()[e],t.containerId,h.onContainerResize)},this.updateCommentPaneState=function(){h.store.isCommentPaneOpen=!0,h.store.extensionProviderCollection&&(h.store.isCommentPaneOpen=0===h.store.extensionProviderCollection.providers.filter((function(t){return t.scope.contentType===i.b.CommentThread&&t.scope.renderMode===i.e.Integrated})).length),h.onCommentPaneStateChange()},this.onContainerResize=function(t){if(!h.store.isCommentPaneOpen&&t.stateChangeType===l.Resize&&0!==t.contentRect.height){var e=t.contentIdentifier,n=Y({contentId:e.contentId,contentType:e.contentType,renderMode:i.e.Integrated}),o=h.store.getContainerIdToInfoMap()[n];if(o){var r=o.position.height!==t.contentRect.height;if(h.isInitialActiveIdSet&&h.store.activeContainerId===n&&o.floatingContainerRef&&(h.onInitialActiveContainerRender?(h.onInitialActiveContainerRender(),h.onInitialActiveContainerRender=void 0):o.floatingContainerRef.setFocus()),r){if(o.position.height=t.contentRect.height,o.position.width=t.contentRect.width,h.firstContainerBeingRendered){var a=window.performance&&window.performance.now?window.performance.now():Date.now();h.store.ULS.sendTraceTag(595718473,Q.a.msoulscat_Wac_Telemetry,q.a.Info,a.toString()),wacBoot.WacSkeletalBoot.isSkeletalDeepLink()&&(Box4.FastViewExtensions.setDeepLinkComplete(),document.body.classList.remove("Deeplink"),Box4.FastViewExtensions.dismiss(),wacBoot.WacSkeletalBoot.setComponentReady("SkeletalPage")),h.firstContainerBeingRendered=!1}var s=void 0!==h.containerCreationTimers[n];if(h.featureSettings.DeselectionEnabled?h.positionContainersOnResize(n,o,s):h.positionFloatingContainers(h.store.getContentAnchorPositions(),void 0,h.store.activeContainerId,s),e.contentId&&e.contentId===h.draftContainerId){var c=h.store.isContainerInViewPort(o.anchorTop);h.store.ULS.sendTraceTag(553747984,Q.a.msoulscat_Wac_Telemetry,q.a.Info,"[ContainerResize] Draft Container created with id: ".concat(e.contentId," created and in viewport ").concat(c))}h.isInitialActiveIdSet&&h.store.activeContainerId===n&&o.floatingContainerRef&&(h.isInitialActiveIdSet=!1),o.floatingContainerRef&&o.floatingContainerRef.showFloatingContainer(s),t.contentIdentifier.contentId===h.replacementContentId&&(h.replacementContentId=void 0),s&&(delete h.containerCreationTimers[n],void 0!==h.stallDetectorUsed&&(window.clearTimeout(h.stallDetectorTimeoutId),h.stallDetectorTimeoutId=void 0,h.processContainerQueue()))}}else h.store.ULS.sendTraceTag(595646153,Q.a.msoulscat_Wac_Telemetry,q.a.Error,"[ContainerResize] ContainerInfo does not exist, id: ".concat(n,", size: ").concat(t.contentRect.height))}},this.paneClosedCallback=a,this.paneOpenedCallback=s,this.destroyAllContainersCallback=u,this.ribbonCommentFilteringEnabled=c.RibbonCommentFilteringEnabled,c.ShouldInitialize&&this.initialize(),c.TrackChangesInSidetrackEnabled&&(Object(I.d)().registerComponent("TrackedChange",tt),function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(e){return t={priority:i.d.Primary,renderMode:i.e.Integrated,instanceId:K.a,componentDimensions:void 0},[2,Object(i.g)().registerExtension(i.b.TrackedChange,"TrackedChange",t)]}))}))}().catch((function(t){h.store.ULS.sendTraceTag(538022360,Q.a.msoulscat_Wac_Telemetry,q.a.Warning,"Failed to register TrackChange extension: ".concat(t))})))}return t.prototype.initialize=function(){this.fcManagerInitialized||(this.store.initializeExtensionProviderCollection(this.updateCommentPaneState),this.floatingContainerVirtualizer.onContainerShouldBeCreated.subscribe(this.containerShouldBeCreatedEventHandler),this.fcManagerInitialized=!0)},t.prototype.enterFixedPositionMode=function(){this.inFixedMode=!0},t.prototype.exitFixedPositionMode=function(){this.inFixedMode=!1},t.prototype.setFirstCommentRenderDone=function(){this.store.isFirstCommentRenderDone=!0},t.prototype.setContainerCreationPauseState=function(t){this.pauseContainerCreation=t,t&&(this.containerCreationEnqueueTimes={},this.isContainerQueueInProgress=!1)},t.prototype.clearSelection=function(t){if(void 0===t&&(t=!1),this.store.activeContainerId){var e=this.store.getContainerIdToInfoMap()[this.store.activeContainerId];if(this.store.activeContainerId=void 0,!e)return;if(e.position.x=0,t)return;this.positionFloatingContainers()}},t.prototype.setInitialActiveContainerId=function(t){this.isInitialActiveIdSet=!0,this.clearSelection(),t&&t.contentId&&(this.store.activeContainerId=Y({contentId:t.contentId,contentType:d(t.containerContentType),renderMode:i.e.Integrated}))},t.prototype.setInitialActiveContainerIdV2=function(t,e){this.isInitialActiveIdSet=!0,this.clearSelection(),t&&t.contentId&&(this.store.activeContainerId=Y({contentId:t.contentId,contentType:d(t.containerContentType),renderMode:i.e.Integrated}),e&&(this.onInitialActiveContainerRender=e))},t.prototype.insertContentAnchorPosition=function(t,e,n){var o=n&&Math.abs(t.anchorTop-e)<=4?this.store.getContentCardIndex(n)+1:-1;this.store.addContentAnchorPosition(t,0,o)},t.prototype.processContentAnchorPositionsInView=function(t){var e=this,n=!1,o=void 0,r=void 0,a=0;if(t.forEach((function(s,c){if(s){var l=s.contentId;if(!l)return void e.store.ULS.sendTraceTag(595903808,Q.a.msoulscat_Wac_Telemetry,q.a.Error,"[processContentAnchorPosition]ContentId is null.");var u=Y({contentId:l,contentType:d(s.containerContentType),renderMode:i.e.Integrated}),p=t.length;e.trackLastCommentRenderedInViewport(s,c,u,p);var h=e.store.getContainerIdToInfoMap()[u];if(!h){var C=e.store.initializeAndRenderFloatingContainer(s,u,e.onContainerResize,!1);return C&&!e.containerCreationQueue.includes(u)&&(e.containerCreationQueue.push(u),e.containerCreationEnqueueTimes[u]=Date.now()),void(C&&(e.insertContentAnchorPosition(s,a,o),o=u,a=s.anchorTop))}var f=e.store.getContentCardIndex(u,s.anchorTop);if(-1===f)return void e.store.ULS.sendTraceTag(595883392,Q.a.msoulscat_Wac_Telemetry,q.a.Error,"[processContentAnchorPosition]Container was supposed to be found.");var g=e.store.getContentAnchorPositions()[f],v=void 0!==r&&h.position.y>=r.position.y&&h.position.y<=r.position.y+r.position.height,I=Math.abs(g.anchorTop-s.anchorTop)>4;if(n=n||I||v,I){var m=Y({contentId:l,contentType:d(s.containerContentType),renderMode:i.e.Integrated});e.store.removeContentAnchorPosition(m),e.insertContentAnchorPosition(s,a,o)}o=u,a=s.anchorTop,h.anchorTop=s.anchorTop,r=h}})),this.updateProcessedContainersVisibleAtBootState(),!this.featureSettings.TrackChangesInSidetrackEnabled&&this.isContainerQueueInProgress||this.processContainerQueue(),n||this.inFixedMode){var s=this.store.getContentAnchorPositions().length>0?this.store.getContentAnchorPositions()[0].anchorTop:void 0;this.positionFloatingContainers(this.store.getContentAnchorPositions(),s,this.store.activeContainerId)}},t.prototype.processContainerQueue=function(){var t=this;if(0===this.containerCreationQueue.length||this.pauseContainerCreation)this.isContainerQueueInProgress=!1;else{this.isContainerQueueInProgress=!0;var e=this.containerCreationQueue.shift(),n=this.store.getContentAnchorPosition(e);if(n)if(this.store.isContainerInViewPort(n.anchorTop)){if(!this.featureSettings.TrackChangesInSidetrackEnabled||!this.containerCreationTimers[e]){var o=window.setTimeout((function(){t.containerCreationTimers[e]&&(t.containerCreationTimers[e].creationStarted=!0),t.createContainer(n,e),t.setupStallDetector(e)}),this.containerDelayTimeMs);this.containerCreationTimers[e]={timer:o,creationStarted:!1}}}else this.deleteContainer(e),this.processContainerQueue();else this.featureSettings.TrackChangesInSidetrackEnabled&&this.processContainerQueue()}},t.prototype.trackLastCommentRenderedInViewport=function(t,e,n,o){this.store.processedContainersVisibleAtBoot||(this.store.isContainerInViewPort(t.anchorTop)?this.store.lastCommentVisibleID=n:0===e&&Object(et.e)(et.d,{component:"canvas",subComponent:"floatingComments",state:"unused"})),e!==o-1||this.store.processedContainersVisibleAtBoot||(this.store.processedContainersVisibleAtBoot=!0)},t.prototype.updateProcessedContainersVisibleAtBootState=function(){this.store.isFirstCommentRenderDone&&!this.store.processedContainersVisibleAtBoot&&(this.store.processedContainersVisibleAtBoot=!0,Object(et.e)(et.d,{component:"canvas",subComponent:"floatingComments",state:"unused"}))},t.prototype.setupStallDetector=function(t){var e=this;this.stallDetectorUsed=!1,!(this.featureSettings.TrackChangesInSidetrackEnabled&&void 0!==this.stallDetectorTimeoutId)&&(this.stallDetectorTimeoutId=window.setTimeout((function(){e.stallDetectorUsed=!0,e.processContainerQueue(),e.store.ULS.sendTraceTag(593281990,Q.a.msoulscat_Wac_Telemetry,q.a.Warning,"[CommentCreationQueueStallDetector]: Container ".concat(t," creation resize call not received or took too long"))}),this.queueStallDetectionTimeMs))},t.prototype.createContainer=function(t,e){if(this.store.initializeAndRenderFloatingContainer(t,e,this.onContainerResize,!0)){if(this.containerCreationEnqueueTimes[e]){var n=Date.now();this.store.ULS.sendTraceTag(593891910,Q.a.msoulscat_Wac_Telemetry,q.a.Info,"[DelayCreationPerfMetric]TimeToCreateCommentFromEnqueue:".concat(n-this.containerCreationEnqueueTimes[e])),delete this.containerCreationEnqueueTimes[e]}}else this.deleteContainer(e),this.processContainerQueue()},t.prototype.onCommentPaneStateChange=function(){this.store.isCommentPaneOpen?(this.store.areCommentExtensionProvidersDefinedOnce&&this.destroyAllContainers(),this.paneOpenedCallback&&this.paneOpenedCallback()):this.paneClosedCallback&&this.paneClosedCallback()},t.prototype.deleteContainer=function(t,e){var n;void 0===e&&(e=!1);var o=this.store.removeContentAnchorPosition(t);if(-1===o)return-1;var i=this.store.getContainerIdToInfoMap()[t].floatingContainerRef;return i&&(i.destroyFloatingContainer(e),this.featureSettings.TrackChangesInSidetrackEnabled||(clearTimeout(null===(n=this.containerCreationTimers[t])||void 0===n?void 0:n.timer),delete this.containerCreationTimers[t],this.removeFromCreationQueue(t))),this.featureSettings.TrackChangesInSidetrackEnabled&&(void 0!==this.containerCreationTimers[t]&&(this.containerCreationTimers[t].creationStarted?(clearTimeout(this.stallDetectorTimeoutId),this.stallDetectorTimeoutId=void 0):clearTimeout(this.containerCreationTimers[t].timer),delete this.containerCreationTimers[t]),this.removeFromCreationQueue(t)),delete this.store.getContainerIdToInfoMap()[t],delete this.containerCreationEnqueueTimes[t],o},t.prototype.destroyAllContainers=function(){var t=this,e=Object.keys(this.store.getContainerIdToInfoMap());e.length>0&&this.destroyAllContainersCallback&&this.destroyAllContainersCallback(),e.forEach((function(e){t.deleteContainer(e)})),this.isContainerQueueInProgress=!1,this.containerCreationEnqueueTimes={},this.containerCreationTimers={},this.containerCreationQueue=[]},t.prototype.positionFloatingContainers=function(t,e,n,o,i){if(void 0===o&&(o=!1),void 0===i&&(i=!1),t&&t.length>0){var r=n?{containerId:n,containerPositionIndex:this.store.getContentCardIndex(n)}:void 0;this.floatingContainerPositioner.calculateNewPositions(t,this.store.getContainerIdToInfoMap(),{activeContainerInfo:r,disableRepositioningAnimation:o||this.inFixedMode,topOfFirstContainer:e,shouldUpdatePositions:!1})}var a=n;a=null!=a?a:this.store.activeContainerId,this.floatingContainerVirtualizer.updateContainersVisibility(this.store.getContainerIdToInfoMap(),this.store.viewportInfo,o||this.inFixedMode||void 0!==this.replacementContentId,this.isInitialActiveIdSet?void 0:a,i)},t.prototype.positionContainersOnResize=function(t,e,n){var o=this.store.getContentCardIndex(t),i=this.store.activeContainerId?this.store.getContentCardIndex(this.store.activeContainerId):void 0;void 0!==i&&i>=o?this.positionFloatingContainers(this.store.getContentAnchorPositions(),void 0,this.store.activeContainerId,n):(o-=!(it(e)&&e.hasBeenRendered)&&o>0?1:0,this.positionFloatingContainers(this.store.getContentAnchorPositions().slice(o),void 0,void 0,n));it(e)&&(e.hasBeenRendered=!0)},t.prototype.removeFromCreationQueue=function(t){var e=this.containerCreationQueue.indexOf(t);e>-1&&this.containerCreationQueue.splice(e,1)},t}(),st=n(638),ct=function(){function t(t){var e,n;this.wordContentNavigationApi=t,this.directionTranslation=((e={})[st.a.None]=0,e[st.a.Previous]=2,e[st.a.Next]=1,e),this.navReasonTranslation=((n={})[J.c.HostAction]=2,n[J.c.Keyboarding]=1,n)}return t.prototype.bringContentIntoView=function(t){this.wordContentNavigationApi.bringContentIntoView({contentIdentifier:{contentId:t.contentIdentifier.contentId,containerContentType:X(t.contentIdentifier.contentType)}})},t.prototype.moveFocus=function(t){var e,n;this.wordContentNavigationApi.moveFocus({resource:{contentId:null===(e=t.resource)||void 0===e?void 0:e.contentId,containerContentType:X(null===(n=t.resource)||void 0===n?void 0:n.contentType)}})},t.prototype.selectNextOrPreviousContent=function(t){this.wordContentNavigationApi.selectNextOrPreviousContent({selectDirection:this.directionTranslation[t.selectDirection],reason:this.navReasonTranslation[t.reason],preventLooping:t.preventLooping,restrictToCurrentContext:t.restrictToCurrentContext,from:t.from&&{contentId:t.from.contentId,containerContentType:X(t.from.contentType)}})},t}(),dt=function(){function t(t){this.stringLoader=t,this.trackChangeInfoById=new Map,this.storeUpdateHandlers=new Map,this.updateVersion=0,this.styles={minWidth:238,maxWidth:238,borderRadius:4}}return Object.defineProperty(t.prototype,"cardStyles",{get:function(){return this.styles},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cardStrings",{get:function(){var t;return null!==(t=this.strings)&&void 0!==t?t:{regularHeading:"Accept or reject suggestion?",acceptHoveredHeading:"Accept Suggestion",rejectHoveredHeading:"Reject Suggestion"}},enumerable:!1,configurable:!0}),t.prototype.loadStrings=function(t){var e=this;void 0===t&&(t="en-US"),this.stringLoader.loadStrings(t).then((function(t){e.strings={regularHeading:t.TrackChangeCardAcceptOrRejectSuggestionLabel,acceptHoveredHeading:t.TrackChangeCardAcceptSuggestionLabel,rejectHoveredHeading:t.TrackChangeCardRejectSuggestionLabel}})).catch((function(t){}))},t.prototype.registerOnStoreUpdate=function(t,e){this.storeUpdateHandlers.set(t,e)},t.prototype.addOrUpdateStore=function(t,e){this.trackChangeInfoById.set(t,e);var n=this.storeUpdateHandlers.get(t);n&&n({type:"content",data:e})},t.prototype.removeFromStore=function(t){this.trackChangeInfoById.delete(t),this.storeUpdateHandlers.delete(t)},t.prototype.reloadStore=function(){this.updateVersion++},t.prototype.registerTrackChangeCardActionExecuter=function(t){this.trackChangeCardActionExecuter=t},t.prototype.getCardActionCallbacks=function(t){return{onAcceptClick:this.createActionCallback("AcceptClick",t),onRejectClick:this.createActionCallback("RejectClick",t),onAcceptHoverIn:this.createActionCallback("AcceptMouseOver",t),onAcceptHoverOut:this.createActionCallback("AcceptMouseOut",t),onRejectHoverIn:this.createActionCallback("RejectMouseOver",t),onRejectHoverOut:this.createActionCallback("RejectMouseOut",t),onCardHoverIn:this.createActionCallback("CardMouseOver",t),onCardHoverOut:this.createActionCallback("CardMouseOut",t),onCardClick:this.createActionCallback("CardClick",t)}},t.prototype.getContainerContent=function(t){return this.trackChangeInfoById.get(t)},t.prototype.clearStore=function(){this.trackChangeInfoById.clear(),this.storeUpdateHandlers.clear()},t.prototype.focusTrackChangeCard=function(t){var e=this.storeUpdateHandlers.get(t);e&&e({type:"behavior",data:{action:G.Focus}})},t.prototype.createActionCallback=function(t,e){var n=this;return function(){n.trackChangeCardActionExecuter&&n.trackChangeCardActionExecuter(t,n.updateVersion,e)}},t}(),lt=n(505),ut=n(456),pt=n(467),ht=n(965),Ct=function(){function t(){}return t.prototype.loadStrings=function(t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e=this;return Object(r.__generator)(this,(function(o){return[2,n(1640)("./".concat(t,"/canvas-contextual.json")).then((function(t){return Object(r.__awaiter)(e,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return[2,t]}))}))})).catch((function(t){return ht.CanvasContextual}))]}))}))},t}(),ft=n(169),gt=n(2800),vt=n(161),It=function(t,e,n,o){return n?function(t,e,n,o){var i=0,r=0,a=0,s=new Set,c=[];for(;i<t.length&&r<e.length;)t[i].contentId===e[r].contentId?(i++,r++,a++):n.has(t[i].contentId)?o.has(e[r].contentId)?s.has(e[r].contentId)?(s.delete(e[r].contentId),c.push({type:"Insert",index:a,content:e[r]}),a++,r++):(s.add(t[i].contentId),c.push({type:"Remove",index:a}),i++):(c.push({type:"Insert",index:a,content:e[r]}),r++,a++):(c.push({type:"Remove",index:a}),i++);for(;r<e.length;)c.push({type:"Insert",content:e[r],index:a}),a++,r++;for(;i<t.length;)c.push({type:"Remove",index:a}),i++;return c}(t,e,o,n):[{type:"Reload",fullContent:e,reason:ft.d.DivergentChange}]};var mt=function(){function t(t){this.wordFilterAPI=t,this.activeFilteredRange=void 0,this.filteredContentMap=new Map,this.filterMap=new Map,this.idsInFilter=new Map,this.onFilteredRangeUpdated=new vt.EventImpl((function(){})),this.onActiveFilterUpdated=new vt.EventImpl((function(){})),this.onUserFilterManagerEvent=new vt.EventImpl((function(){})),t.registerOnContentChangeCallback(this.onContentChanged.bind(this)),t.registerOnRibbonFilterChangeCallback(this.onRibbonFilterChanged.bind(this))}return t.prototype.updateFilterForFilteredRangeId=function(t,e){if(this.filterMap.has(t)){var n=this.updateOrder(t,e);n.length>0&&this.onFilteredRangeUpdated.trigger({filterId:t,payload:{changes:n}})}},t.prototype.getExistingFilteredRange=function(t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,n;return Object(r.__generator)(this,(function(o){return e=this.filterMap.get(t),n=this.filteredContentMap.get(t),e&&n?[2,{content:n,filter:e.filter,filterId:t,supportsFilterUpdates:e.supportsFilterUpdates}]:[2]}))}))},t.prototype.setActiveFilteredRange=function(t){var e,n;this.activeFilteredRange=t,t&&(null===(n=(e=this.wordFilterAPI).updateCurrentFilteredContent)||void 0===n||n.call(e,this.idsInFilter.get(t)))},t.prototype.getActiveFilteredRangeId=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.activeFilteredRange]}))}))},t.prototype.getFilteredRange=function(t){var e,n,o;return Object(r.__awaiter)(this,void 0,void 0,(function(){var i;return Object(r.__generator)(this,(function(r){return i=Object(gt.a)(),this.updateOrder(i,t.hostFilter),this.filteredContentMap.size>1&&(null===(n=(e=this.wordFilterAPI).triggerFilterSurvey)||void 0===n||n.call(e)),[2,{filterId:i,content:null!==(o=this.filteredContentMap.get(i))&&void 0!==o?o:[],supportsFilterUpdates:t.supportsFilterUpdates,filter:t.hostFilter}]}))}))},t.prototype.teardownFilteredRange=function(t){this.filteredContentMap.delete(t),this.filterMap.delete(t)},t.prototype.getCapabilities=function(){return Promise.resolve({supportedContentTypes:i.b.CommentThread,supportsMentionToMeFilter:!0})},t.prototype.getHostSpecificLabels=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,{}]}))}))},t.prototype.getFilterUsers=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,[]]}))}))},t.prototype.updateOrder=function(t,e){var n,i,r,a,s,c=this,l=new Set,u=null!==(n=this.filteredContentMap.get(t))&&void 0!==n?n:[],p=null!==(r=null===(i=this.wordFilterAPI)||void 0===i?void 0:i.getAllContent().filter((function(t){if((null==t?void 0:t.contentId)&&(null==t?void 0:t.containerContentType)===o.CommentThread){var n=t.contentId;return!!c.includeCommentInOrder(e,t)&&(!l.has(n)&&(l.add(n),!0))}return!1})).map((function(t){var e;return{contentId:null!==(e=t.contentId)&&void 0!==e?e:"",contentType:d(t.containerContentType)}})))&&void 0!==r?r:[];this.filteredContentMap.set(t,p),this.filterMap.set(t,{filter:e,supportsFilterUpdates:!0});var h=this.idsInFilter.get(t);return this.idsInFilter.set(t,l),this.activeFilteredRange===t&&(null===(s=(a=this.wordFilterAPI).updateCurrentFilteredContent)||void 0===s||s.call(a,l)),It(u,p,h,l)},t.prototype.onContentChanged=function(){var t=this;this.filterMap.forEach((function(e,n){t.updateFilterForFilteredRangeId(n,e.filter)}))},t.prototype.includeCommentInOrder=function(t,e){var n,o;if(t.CommentThread){if(e.contentId&&(null===(o=(n=this.wordFilterAPI).isDraftContent)||void 0===o?void 0:o.call(n,e.contentId)))return!0;if(t.CommentThread.resolutionStatus===ft.a.ResolvedOnly&&this.wordFilterAPI.isContentActive(e))return!1;if(t.CommentThread.resolutionStatus===ft.a.ActiveOnly&&!this.wordFilterAPI.isContentActive(e))return!1}return!(t.mentionsToCurrentUser&&!this.wordFilterAPI.isCurrentUserMentioned(e))},t.prototype.onRibbonFilterChanged=function(t){this.createOrUpdateFilter(t)},t.prototype.createOrUpdateFilter=function(t){var e={mentionsToCurrentUser:t.mentionsToCurrentUser||!1,CommentThread:{resolutionStatus:t.resolutionStatus||0}};this.activeFilteredRange&&!this.onlyDefaultFilterExists()?this.updateFilter(e):this.createFilter(e)},t.prototype.updateFilter=function(t){var e=this;this.activeFilteredRange&&(this.updateFilterForFilteredRangeId(this.activeFilteredRange,t),this.getExistingFilteredRange(this.activeFilteredRange).then((function(n){if(n){var o=n.filterId;e.onFilteredRangeUpdated.trigger({filterId:o,payload:{changes:[{type:"FilterUpdate",updatedFilter:t}]}})}})).catch((function(t){console.error("Comment Filter Update failed: ".concat(t))})))},t.prototype.createFilter=function(t){var e=this;this.getFilteredRange({contentTypes:[i.b.CommentThread],hostFilter:t,supportsFilterUpdates:!0}).then((function(t){e.setActiveFilteredRange(t.filterId)})).catch((function(t){return console.error("Error creating filter: ".concat(t))}))},t.prototype.onlyDefaultFilterExists=function(){return 1===this.filterMap.size},t}(),yt=new(function(){function t(){var t=new Ct;this.trackChangesStore=new dt(t)}return t.prototype.getFCManagerInstance=function(t){if(void 0===this.floatingContainerManagerInstance){if(!t)throw new Error("Floating Container Manager creation arguments are missing!");t.ulsLogger&&W.a.setLogger(t.ulsLogger);var e={DeselectionEnabled:!!(c=t.featureGates).deselectionEnabled,FloatingContainerVirtualizationEnabled:!!c.floatingContainerVirtualizationEnabled,ImproveJumpingFixEnabled:!!c.improveJumpingFixEnabled,ShouldInitialize:!1!==c.shouldInitialize,ScrollingPerfImprovementEnabled:!!c.scrollingPerfImprovementEnabled,SynchronousContainerPositioningEnabled:!!c.synchronousContainerPositioningEnabled,TrackChangesInSidetrackEnabled:!!c.trackChangeInSidetrackEnabled,ContentNavigationApiEnabled:!!c.contentNavigationApiEnabled,ReturnToDraftFixEnabled:!!c.returnToDraftFixEnabled,RibbonCommentFilteringEnabled:!!c.ribbonCommentFilteringEnabled};t.featureGateApiSettings&&Object(lt.c)({appSettings:t.featureGateApiSettings,mapping:ut.a});var n=t.isRtl?1:-1,o=t.canvasAndFcHostOffset?n*(t.canvasAndFcHostOffset-1):0,r=new u(Y,W.a,o),a=new f({containerVirtualizationEnabled:e.FloatingContainerVirtualizationEnabled}),s=new rt(i.g,t.containerPanel,B,W.a,t.viewportInfo);t.telemetryDetails&&Object(g.m)(pt.a,t.telemetryDetails),this.trackChangesStore.loadStrings(t.uiCulture),this.floatingContainerManagerInstance=new at(r,a,s,t.paneClosedCallback,t.paneOpenedCallback,e,t.destroyAllContainersCallback,this.trackChangesStore),e.ContentNavigationApiEnabled&&t.sidetrackContentNavigationApi&&this.registerContentNavigationApi(t.sidetrackContentNavigationApi),e.ContentNavigationApiEnabled&&t.contentFilterAPI&&this.registerContentFilteredRangeHostApi(t.contentFilterAPI)}var c;return this.floatingContainerManagerInstance},t.prototype.getTrackChangesStoreApi=function(){return this.trackChangesStore},t.prototype.getFCContentNavigationAPI=function(){return this.floatingContainerContentNavigationAPI},t.prototype.getTrackChangesStore=function(){return this.trackChangesStore},t.prototype.registerContentNavigationApi=function(t){Object(J.h)(this.initializeAndGetContentNavigationAPI(t),K.a)},t.prototype.initializeAndGetContentNavigationAPI=function(t){return this.floatingContainerContentNavigationAPI||(this.floatingContainerContentNavigationAPI=new ct(t)),this.floatingContainerContentNavigationAPI},t.prototype.registerContentFilteredRangeHostApi=function(t){Object(ft.g)(K.a,this.initializeAndGetContentFilteredRangeHostApi(t))},t.prototype.initializeAndGetContentFilteredRangeHostApi=function(t){return this.contentFilteredRangeHostAPI||(this.contentFilteredRangeHostAPI=new mt(t)),this.contentFilteredRangeHostAPI},t}()),bt=yt;n.d(e,"FactoryGlobal",(function(){return bt}))}}]);
//# sourceMappingURL=floatingContainerManager.min.js.map