'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[8],{1423:function(I,J,d){d.r(J);d.d(J,"RtcUtils",function(){return l});I=d(0);var m=d(8),f=d(29),a=d(1493);class l{static TLb(w,z=a.a.CVb){let x;try{x=f.c(w)}catch(u){throw w=String.format("Failed to JSON-serialize payload : {0}",u),m.ULS.sendTraceTag(508396173,500,10,w),Error.argument("payload",w);}if(x.length>z)throw w=String.format("Payload exceeds maximum length: {0} > {1}.",x.length,z),m.ULS.sendTraceTag(508396171,
500,10,w),Error.argument("payload",w);return x}static deserialize(w,z,x){if(!w)return null;if(Object.getType(w)!==String){var u=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}].",z,Object.getType(w).getName(),x);m.ULS.sendTraceTag(508396170,500,10,u);return null}u=null;try{u=f.a(w)}catch(v){w=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}].",z,v,x),m.ULS.sendTraceTag(508396168,
500,10,w)}return u}static Bma(w){if(!w)return"";if("string"===typeof w)return w.toString();try{return f.c(w)}catch(z){return w.toString()}}static vBf(w){let z,x,u;z=0;u=x=null;if(!w)return{x6c:z,y6c:x,wk:u};try{const v=w.source;v&&Object.getType(v)===String&&(u=v);const D=w.context;D&&(w=D,z=w.status?w.status:0,x=w.statusText?w.statusText:null)}catch(v){}return{x6c:z,y6c:x,wk:u}}}Object(I.a)(l,"RtcUtils",null,[])},1468:function(I,J,d){d.r(J);I=d(0);var m=d(8),f=d(109),a=d(81),l;(function(u){u[u.SendNotification=
0]="SendNotification";u[u.SendPersistentState=1]="SendPersistentState";u[u.FindSession=2]="FindSession";u[u.Last=3]="Last"})(l||(l={}));Object(I.b)("ApiType",l);var w;(function(u){u[u.AttemptCount=0]="AttemptCount";u[u.SuccessCount=1]="SuccessCount";u[u.DropCount=2]="DropCount";u[u.FailedCount=3]="FailedCount";u[u.LatencyOverThresholdCount=4]="LatencyOverThresholdCount";u[u.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount";u[u.ThrottledCount=6]="ThrottledCount";u[u.Last=7]="Last"})(w||(w=
{}));Object(I.b)("EventCountType",w);var z=d(1611);d.d(J,"FrequentLoggingMetrics",function(){return x});class x{constructor(u){this.nWc=this.D0c=null;this.Tcd=this.o1c=0;this.Qk=null;this.bLc=this.YFb=0;this.If=u;this.lUf();this.MDb=this.DHc=this.gGb=!1;this.f3a=0}get jBf(){return this.MDb}MDg(u){this.bLc=u;window.setInterval(Object(f.a)(this,this.eVb,"logMetricsBatchAndReset"),u);this.YFb=(new Date).getTime()}Ws(u,v){this.oAg(u)&&!this.DHc||this.jBf||!window.navigator.onLine||this.If.gta||(this.Qk[u][v]++,
this.gGb=!0)}lUf(){this.Qk=Array(3);for(let u=0;3>u;u++){this.Qk[u]=Array(7);for(let v=0;7>v;v++)this.Qk[u][v]=0}}ulf(){const u={};for(let v=0;3>v;v++)for(let D=0;7>D;D++)this.R0f(v,D)&&(u[l[v]+w[D]]=this.Qk[v][D]);u.FSDomain=this.D0c;u.ConnectionDomain=this.nWc;u.FSRetryInterval=this.o1c;u.MaxPayloadSize=this.Tcd;u.LogNumber=this.f3a;1===this.f3a&&(u.FSLatencies=z.a.instance.JIf(),u.ConLatencies=z.a.instance.fHf());return u}R0f(u,v){return 2===u&&3!==v&&0!==v?!1:!0}oAg(u){return 2===u?!1:!0}eVb(){if(this.gGb){this.f3a++;
if((new Date).getTime()-this.YFb<5E3+this.bLc){var u=a.a.toJSON(this.ulf());m.ULS.sendTraceTag(50644352,500,15,u)}this.YFb=(new Date).getTime();for(u=0;3>u;u++)for(let v=0;7>v;v++)this.Qk[u][v]=0;this.gGb=!1}}b7f(){this.DHc=!0}static get instance(){return x._instance}static create(u){x.instance||(x._instance=new x(u));return x.instance}}x._instance=null;Object(I.a)(x,"FrequentLoggingMetrics",null,[1781])},1493:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);class m{}m.Ucd=31E3;m.CVb=8E3;Object(I.a)(m,
"RealtimeChannelStaticConstants",null,[])},1611:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);class m{constructor(){this.pQc=!1;this.GGa=null;this.uFc=0;this.VDb=this.TXc(6);this.v1a=this.TXc(6);this.jda=this.apa=0;this.Xp=()=>new Date}get KEg(){return this.pQc}TXc(f){f=Array(f);for(let a=0;a<f.length;a++)f[a]=0;return f}JIf(){return this.VDb.toString()}fHf(){return this.v1a.toString()}NDg(){this.GGa=this.Xp()}dNa(f,a,l=!1){this.KEg||(l&&(this.pQc=!0),l=this.Xp(),0===f&&5<this.apa||1===f&&
5<this.jda||(this.uFc<f?(1===this.apa%2&&(this.VDb[this.apa]=-1,this.apa++),this.uFc=f,1===a&&(this.v1a[this.jda]=-1,this.jda++),this.v1a[this.jda]=this.R0b(l),this.jda++):0===f?(this.VDb[this.apa]=this.R0b(l),this.apa++):(this.v1a[this.jda]=this.R0b(l),this.jda++)))}R0b(f){const a=f.getTime()-this.GGa.getTime();this.GGa=f;return a}static get instance(){m._instance||(m._instance=new m);return m._instance}static set instance(f){m._instance=f}}m._instance=null;Object(I.a)(m,"LatencyMetrics",null,[])},
1655:function(I,J,d){I=d(0);class m{constructor(){this.kEc=this.wCb=!1;this.callback=null}Nvb(a){this.callback=a;this.$rd()}Hcd(a){this.wCb||(this.wCb=!0,this.eNe=a,this.$rd())}$rd(){this.wCb&&this.callback&&!this.kEc&&(this.kEc=!0,this.callback(this.eNe))}}Object(I.a)(m,"CompletionTask",null,[]);d.d(J,"a",function(){return f});class f{constructor(){this.BLc=new m;this.zLc=new m}Ubb(a){this.BLc.Nvb(a)}Tbb(a){this.zLc.Nvb(a)}SLa(a){this.BLc.Hcd(a)}S7(a){this.zLc.Hcd(a)}uVb(){this.SLa(2);this.S7(2)}}
Object(I.a)(f,"MessageStatus",null,[1807])},1735:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);class m extends Sys.EventArgs{constructor(f,a,l,w){super();this.type=f;this.jA=a;this.Fvf=l;this.Nna=w}}Object(I.a)(m,"SendUpdateNotificationEventArgs",Sys.EventArgs,[])},1736:function(I,J,d){d.r(J);d.d(J,"MaxOutstandingThrottler",function(){return a});I=d(0);var m=d(86);J=d(1737);var f=d(1655);class a extends J.a{constructor(l,w=""){super(l,w);this.Mta=this.U8=0;this.sa=new m.a;this.opa=!1;this.E1a=
this.w1a=this.iJb=0;this.Mwg=()=>{this.opa=!1;if(this.fta){const z=this.V4a,x=this.hqa;this.hIa(!1);this.CNa(z,x)}};this.Ueg=()=>{++this.E1a;this.E1a>Math.floor(this.Mta/2)&&(this.E1a=-1E9,this.sa.raiseEvent("TMUDM"))};this.u3a=0;this.JQ=[];this.clearTimeout=a.xNb}add(l){this.ppa||this.init(a.BYc,a.zYc);this.dea++;const w=new f.a;this.fta?this.aeb(l,w):this.u3a<this.Mta?this.CNa(l,w):(this.aeb(l,w),this.opa=!1);return w}CNa(l,w){l=this.qPc(l);const z=this.setTimeout(this.Ueg,this.U8);++this.u3a;Array.add(this.JQ,
z);const x=this.w1a;l.Ubb(u=>{w.SLa(u)});l.Tbb(u=>{this.w1a===x&&(this.Teg(x,z),w.S7(u))})}Teg(l,w){this.w1a===l&&(--this.u3a,this.clearTimeout(w),Array.remove(this.JQ,w),this.fta&&this.Lwg())}Lwg(){this.fta&&!this.opa&&(this.iJb=this.setTimeout(this.Mwg,0),this.opa=!0)}D5a(l){this.sa.addHandler("TMUDM",l)}Mkd(l){this.sa.removeHandler("TMUDM",l)}reset(){this.dea=this.bHa=this.EFa=this.E1a=0;++this.w1a;for(const l of this.JQ)this.clearTimeout(l);this.u3a=0;this.JQ=[];this.hIa(!0);this.opa&&(this.clearTimeout(this.iJb),
this.iJb=0,this.opa=!1)}init(l,w){this.ppa||(this.U8=l,this.Mta=w,this.ppa=!0)}static createInstance(l,w=""){return new a(l,w)}static xNb(l){window.clearTimeout(l)}}a.BYc=15E3;a.zYc=5;Object(I.a)(a,"MaxOutstandingThrottler",J.a,[1806,1805])},1737:function(I,J,d){d.d(J,"a",function(){return f});I=d(0);var m=d(8);class f{constructor(a,l=""){this.EFa=this.bHa=0;this.cFb=!1;this.hqa=this.V4a=null;this.ppa=!1;this.qPc=a;this.mrd=l;this.setTimeout=f.zNb;this.dea=this.bHa=this.EFa=0}OYb(){0<this.dea&&0<
this.EFa&&m.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.mrd,this.EFa,this.dea);0<this.dea&&0<this.bHa&&m.ULS.sendTraceTag(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.mrd,this.bHa,this.dea)}get fta(){return this.cFb}aeb(a,l){this.bHa++;this.hIa(!0);this.cFb=!0;this.V4a=a;this.hqa=l}hIa(a){this.cFb=!1;this.hqa&&a&&(this.EFa++,this.hqa.uVb());this.hqa=this.V4a=null}static zNb(a,l){return window.setTimeout(a,l)}}Object(I.a)(f,
"ThrottlerBase",null,[])},1738:function(I,J,d){d.r(J);d.d(J,"MaxRateThrottler",function(){return f});I=d(0);J=d(1737);var m=d(1655);class f extends J.a{constructor(a,l=""){super(a,l);this.Rta=0;this.Kwg=()=>{if(this.fta){const w=this.V4a,z=this.hqa;this.hIa(!1);this.CNa(w,z)}};this.gGa=(new Date(0)).getTime();this.currentTime=()=>(new Date).getTime()}init(a){this.ppa||(this.Rta=a,this.ppa=!0)}add(a){this.ppa||this.init(f.xYc);this.dea++;const l=this.currentTime(),w=new m.a;this.gGa>l&&(this.gGa=l);
this.fta?(this.hIa(!0),this.aeb(a,w)):this.gGa+this.Rta<=l?this.CNa(a,w):(this.aeb(a,w),this.setTimeout(this.Kwg,this.gGa+this.Rta-l));return w}CNa(a,l){this.gGa=this.currentTime();a=this.qPc(a);a.Ubb(w=>{l.SLa(w)});a.Tbb(w=>{l.S7(w)})}static createInstance(a,l=""){return new f(a,l)}}f.xYc=200;Object(I.a)(f,"MaxRateThrottler",J.a,[1804,1805])},1739:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);class m{constructor(){this.Presence=null;this.TimeStamp=0}}Object(I.a)(m,"PresenceDataEntryForClients",
null,[])},1740:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);class m{}m.SZb="rr";m.Sug="rd";m.Pug="rbp";m.i_b="sa";Object(I.a)(m,"RtcReconnectParams",null,[])},1741:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);class m{constructor(f,a,l,w){this.Y7f=f;this.U8=a;this.q7f=l;this.$Of=w}}Object(I.a)(m,"ThrottlerManagerSettings",null,[])},1792:function(I,J,d){I=d(0);var m=d(1923),f=d(1928),a=d(1924),l=d(1927),w=d(1926),z=d(1922),x=d(1925);class u extends Sys.EventArgs{constructor(){super()}}
Object(I.a)(u,"GotCompletePersistentStateWithMetadataEventArgs",Sys.EventArgs,[]);class v extends Sys.EventArgs{constructor(O,U,X,V,Q,T){super();this.Rva=O;this.XTa=U;this.dqf=X;this.R_c=Q;this.XLb=V;this.nz=T}}Object(I.a)(v,"RefreshAllPersistentStateEventArgs",Sys.EventArgs,[]);class D extends Sys.EventArgs{constructor(O){super();this.hubConnection=O}}Object(I.a)(D,"RefreshProxyEventArgs",Sys.EventArgs,[]);class y extends Sys.EventArgs{constructor(O,U){super();this.afa=O;this.errorMessage=U}}Object(I.a)(y,
"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class H extends Sys.EventArgs{constructor(O,U,X){super();this.type=O;this.JI=U;this.Nna=X}}Object(I.a)(H,"SendPersistentStateEventArgs",Sys.EventArgs,[]);var F=d(1735);class G extends Sys.EventArgs{constructor(){super()}}Object(I.a)(G,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class K extends Sys.EventArgs{constructor(O){super();this.pnb=O}}Object(I.a)(K,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class R extends Sys.EventArgs{constructor(O,
U){super();this.type=O;this.tLg=U}}Object(I.a)(R,"UpdatePersistentStateRequestEventArgs",Sys.EventArgs,[]);var E=d(86);d.d(J,"a",function(){return N});class N{constructor(){this.sa=new E.a}kog(O,U){this.sa.raiseEvent("CSC",new m.a(O,U))}Bog(O){this.sa.raiseEvent("RP",new D(O))}Ncb(O){this.sa.raiseEvent("RC",O)}Cog(){this.sa.raiseEvent("RMID")}Aog(O,U,X,V,Q,T){this.sa.raiseEvent("RPS",new v(O,U,X,V,Q,T))}rjd(O,U){this.sa.raiseEvent("UPSR",new R(O,U))}ljd(O,U){this.sa.raiseEvent("PU",new z.a(O,U))}tog(O){this.sa.raiseEvent("MPU",
new a.a(O))}AYb(O,U,X,V){this.sa.raiseEvent("SUN",new F.a(O,U,X,V))}Eog(O,U){this.sa.raiseEvent("UNR",new x.a(O,U))}pjd(O,U,X){this.sa.raiseEvent("SP",new H(O,U,X))}Bse(O,U){this.sa.raiseEvent("PSU",new w.a(O,U))}xog(O){this.sa.raiseEvent("PSC",new l.a(O))}rog(O){this.sa.raiseEvent("IPSC",new l.a(O))}Fog(O){this.sa.raiseEvent("UPSC",new K(O))}Dog(O,U){this.sa.raiseEvent("SPC",new G(O,U))}njd(O,U){this.sa.raiseEvent("RCF",new y(O,U))}pog(O){this.sa.raiseEvent("CPSWM",new u(O))}Dse(O,U){this.sa.raiseEvent("UCI",
new f.a(O,U))}QZ(O){this.sa.addHandler("CSC",O)}qDa(O){this.sa.removeHandler("CSC",O)}Fff(O){this.sa.addHandler("RP",O)}Org(O){this.sa.removeHandler("RP",O)}Eff(O){this.sa.addHandler("RC",O)}Nrg(O){this.sa.removeHandler("RC",O)}Gff(O){this.sa.addHandler("RMID",O)}Dff(O){this.sa.addHandler("RPS",O)}Mrg(O){this.sa.removeHandler("RPS",O)}Rff(O){this.sa.addHandler("UPSR",O)}Wrg(O){this.sa.removeHandler("UPSR",O)}wya(O){this.sa.addHandler("PU",O)}GZa(O){this.sa.removeHandler("PU",O)}eff(O){this.sa.addHandler("IPU",
O)}Brg(O){this.sa.removeHandler("IPU",O)}Pff(O){this.sa.addHandler("UCI",O)}Urg(O){this.sa.removeHandler("UCI",O)}Jff(O){this.sa.addHandler("SUN",O)}Srg(O){this.sa.removeHandler("SUN",O)}fff(O){this.sa.addHandler("IUNR",O)}Crg(O){this.sa.removeHandler("IUNR",O)}AO(O){this.sa.addHandler("UNR",O)}sDa(O){this.sa.removeHandler("UNR",O)}bmb(O){this.sa.addHandler("PSU",O)}mxb(O){this.sa.removeHandler("PSU",O)}dff(O){this.sa.addHandler("IPSU",O)}Arg(O){this.sa.removeHandler("IPSU",O)}amb(O){this.sa.addHandler("PSC",
O)}lxb(O){this.sa.removeHandler("PSC",O)}cff(O){this.sa.addHandler("IPSC",O)}zrg(O){this.sa.removeHandler("IPSC",O)}Qff(O){this.sa.addHandler("UPSC",O)}Vrg(O){this.sa.removeHandler("UPSC",O)}Iff(O){this.sa.addHandler("SP",O)}Rrg(O){this.sa.removeHandler("SP",O)}Kff(O){this.sa.addHandler("SPC",O)}Trg(O){this.sa.removeHandler("SPC",O)}static getInstance(){return N._instance||(N._instance=new N)}}N._instance=null;Object(I.a)(N,"RtcEventHub",null,[1572])},1807:function(I,J,d){d.r(J);I=d(0);var m=d(8),
f=d(342),a=d(48),l=d(71);class w{constructor(x){this.messageId=x;this.Nwg=(new Date).getTime();this.yUb=new l.a}}Object(I.a)(w,"MessageLatencyDetails",null,[]);d.d(J,"ClientToClientMessageTelemetry",function(){return z});class z{constructor(x,u,v){this.fT=null;this.ZFb=this.nIb=0;this.sendMessage=()=>{if(this.TGa){const D=a.a.create().toString();this.fT=new w(D);this.ze.AYb(16,D,!1,new f.a);window.setTimeout(()=>{this.y5f(D)},this.ZFb)}};this.Xog=(D,y)=>{16===y.type?this.ze.AYb(17,y.jA,!1,new f.a):
17===y.type&&this.TGa&&y.jA&&this.processMessage(y.jA)};this.Oe=u;this.CLc=v;this.TGa=!1;this.ze=x;this.ze.AO(this.Xog)}start(){if(this.CLc&&!this.TGa){const x=this.Oe.mmd;this.ZFb=this.Oe.imd;x<=this.ZFb?(m.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",this.Oe.mmd,this.Oe.imd),this.CLc=!1):(this.TGa=!0,this.nIb=window.setInterval(this.sendMessage,
x))}}y5f(x){this.fT&&this.fT.messageId===x&&(0<this.fT.yUb.count?(x=this.fT.yUb.toArray().join(","),m.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",x)):m.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),this.fT=null)}stop(){this.nIb&&(window.clearInterval(this.nIb),this.TGa=!1)}processMessage(x){x&&this.fT&&x.toString()===this.fT.messageId&&(x=(new Date).getTime()-this.fT.Nwg,this.fT.yUb.add(x))}static get instance(){return z._instance}static Xqb(x,u,v){return z.instance||
(z._instance=new z(x,u,v))}}z._instance=null;Object(I.a)(z,"ClientToClientMessageTelemetry",null,[])},1922:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);class m extends Sys.EventArgs{constructor(f,a){super();this.$ha=f;this.gZc=a}}Object(I.a)(m,"PresenceUpdatedEventArgs",Sys.EventArgs,[])},1923:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);class m extends Sys.EventArgs{constructor(f,a){super();this.newState=f;this.oldState=a}}Object(I.a)(m,"ChangedConnectionStateEventArgs",Sys.EventArgs,
[])},1924:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);class m extends Sys.EventArgs{constructor(f){super();this.JI=f}}Object(I.a)(m,"MyPresenceUpdatedEventArgs",Sys.EventArgs,[])},1925:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);class m extends Sys.EventArgs{constructor(f,a=null){super();this.Rk=f;this.JRk=a}get type(){return this.Rk}get jA(){return this.JRk}}Object(I.a)(m,"UpdateNotificationEventArgs",Sys.EventArgs,[])},1926:function(I,J,d){d.d(J,"a",function(){return m});I=
d(0);class m extends Sys.EventArgs{constructor(f,a){super();this.type=f;this.$ha=a}}Object(I.a)(m,"PersistentStateUpdateEventArgs",Sys.EventArgs,[])},1927:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);class m extends Sys.EventArgs{constructor(f){super();this.pnb=f}}Object(I.a)(m,"PersistentStateClearedEventArgs",Sys.EventArgs,[])},1928:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);class m extends Sys.EventArgs{constructor(f,a){super();this.X2h=f;this.Nna=a}}Object(I.a)(m,"ClientInfoEventArgs",
Sys.EventArgs,[])},1929:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);class m{constructor(f,a){this.status=f;this.Ypc=a}}Object(I.a)(m,"UserStatusInfo",null,[])},1930:function(I,J,d){d.r(J);d.d(J,"RealtimeChannelMetrics",function(){return w});I=d(0);var m=d(8),f=d(179),a=d(81),l=d(1423);class w{constructor(){this.lMc=this.mMc=this.nMc=this.iMc=this.hMc=this.jMc=this.sGa=this.vGb=0;this.rda=this.GFb=this.hGa=this.AFb=this.spa=this.xFb=this.D5=this.eGa=this.rpa=this.wFb=this.o2a=this.Xoa=null;
this.bGb=this.kGa=this.vPc=this.EEc=0;this.FLc=!1;this.Cjd=this.FYb;this.Fjd=this.IYb;this.Ejd=this.HYb;this.Hjd=this.KYb;this.Gjd=this.JYb;this.PYb=this.QYb;this.Scb=this.NYb;this.Pga=this.LYb;this.Bua=this.MYb;this.Djd=this.GYb;this.lCa=this.YVb;this.fYa=this.ZVb}FYb(){this.vGb++;this.wFb=new Date;this.Xoa||(this.Xoa=new Date)}IYb(){this.sGa++;this.D5=new Date;this.o2a||(this.o2a=this.D5);this.hGa=this.D5;this.Rpf()}HYb(){this.jMc++;this.xFb=new Date}KYb(){this.hMc++;this.rpa=new Date}JYb(){this.iMc++;
this.eGa=new Date}NYb(){this.spa=new Date;this.nMc++}MYb(){this.rda||(this.rda=new Date);this.mMc++}LYb(){this.AFb=new Date;this.lMc++}QYb(){!this.FLc&&this.vGb&&(m.ULS.sendTraceTag(39321871,500,15,a.a.toJSON(this.Vof())),this.FLc=!0)}GYb(z){const {x6c:x,y6c:u,wk:v}=l.RtcUtils.vBf(z);x&&x!==f.a.qz&&(m.ULS.sendTraceTag(40157596,500,15,a.a.toJSON({["HttpErrorCode"]:x,["HttpErrorStatus"]:u,["Exception"]:v})),f.a.Mce(x)&&this.EEc++,f.a.qfe(x)&&this.vPc++)}YVb(){this.GFb=new Date}ZVb(){this.rpa=this.hGa=
new Date}Vof(){return{["numberOfConnectionAttempts"]:this.vGb,["numberOfSuccessfulConnections"]:this.sGa,["numberOfFailedConnections"]:this.jMc,["numberOfDisconnectedConnections"]:this.hMc,["numberOfExplicitDisconnectedConnections"]:this.iMc,["numberOfSentMessages"]:this.nMc,["numberOfReceivedMessages"]:this.mMc,["numberOfLostMessages"]:this.lMc,["firstConnectionAttempt"]:this.Xoa?this.Xoa:null,["firstMessageReceived"]:this.rda?this.rda:null,["firstConnectionSuccess"]:this.o2a?this.o2a:null,["lastConnectionAttempt"]:this.wFb?
this.wFb:null,["lastConnectionSuccess"]:this.D5?this.D5:null,["lastConnectionFailure"]:this.xFb?this.xFb:null,["lastMessageSent"]:this.spa?this.spa:null,["lastMessageLost"]:this.AFb?this.AFb:null,["lastDisconnect"]:this.rpa?this.rpa:null,["lastExplicitDisconnect"]:this.eGa?this.eGa:null,["lastTimeOnline"]:this.hGa?this.hGa:null,["lastTimeOffline"]:this.GFb?this.GFb:null,["maxDisconnectedTimeMs"]:this.kGa,["maxExplicitDisconnectedTimeMs"]:this.bGb,["clientConnectionErrors"]:this.EEc,["serverConnectionErrors"]:this.vPc}}Rpf(){this.Xoa&&
1===this.sGa&&(this.kGa=Math.max(this.kGa,this.D5.getTime()-this.Xoa.getTime()));this.rpa&&1<this.sGa&&(this.kGa=Math.max(this.kGa,this.D5.getTime()-this.rpa.getTime()));this.eGa&&1<this.sGa&&(this.bGb=Math.max(this.bGb,this.D5.getTime()-this.eGa.getTime()))}static createInstance(z){w._instance||(w._instance=new w,m.ULS.sendTraceTag(39321870,500,50,"RealtimeChannelMetrics initialized for client {0}",z));return w._instance}}w._instance=null;Object(I.a)(w,"RealtimeChannelMetrics",null,[1789,250])},
1931:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);var m;(function(f){f[f.c7h=0]="contentUpdate";f[f.p_p=1]="editorsTableUpdate";f[f.OOb=2]="fileNameUpdate";f[f.cHp=3]="wetContentUpdate";f[f.rhq=4]="persistedContentUpdate";f[f.dtl=5]="clientRtcReconnectRequest";f[f.xjq=6]="replicationTelemetry";f[f.r8p=7]="lockUpdate";f[f.VWp=8]="collabServiceContentUpdate";f[f.Kpq=9]="trackChangeSettingUpdate";f[f.Nkq=10]="saveTargetUpdate";f[f.Oqq=11]="uploadToOcsUpdate";f[f.s7p=12]="labelUpdate";f[f.W2m=
13]="hostNotificationSubscriptionStatus";f[f.eoq=14]="subscribeOrExtend";f[f.u_p=15]="elapsedBootTelemetry";f[f.b3h=16]="clientToClientTelemetryMessage";f[f.a3h=17]="clientToClientResponseMessage";f[f.erq=18]="verifyNotificationPipeline";f[f.P4p=19]="hostNotificationHeartbeat";f[f.nlq=20]="secondaryMetadataUpdate";f[f.last=21]="last"})(m||(m={}));Object(I.b)("UpdateNotificationType",m)},1932:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);var m;(function(f){f[f.unspecified=0]="unspecified";
f[f.word=1]="word";f[f.u3l=2]="excel";f[f.buj=3]="powerPoint";f[f.test=4]="test";f[f.wacFrontEnd=5]="wacFrontEnd";f[f.$oj=6]="oneNote";f[f.jGp=7]="visio";f[f.ofq=8]="officeMobile";f[f.YXp=9]="cosmosDBChangefeed";f[f.last=10]="last"})(m||(m={}));Object(I.b)("RtcClientAppName",m)},2023:function(I,J,d){d.r(J);I=d(0);var m=d(8),f=d(109),a=d(342),l=d(897),w=d(95),z=d(2),x=d(1929),u=d(46),v=d(1611);class D{constructor(pa,Oa){this.data=pa;this.timeStamp=Oa}}Object(I.a)(D,"PresenceData",null,[]);class y{constructor(pa){this.X5=
!1;this.cHa=0;this.BCb=!1;this.I5f=()=>{m.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",this.Ck)};this.setTimeout=y.zNb;this.clearTimeout=y.xNb;this.V5f=this.I5f;this.Ck=pa}Bdg(){this.X5||(this.cHa=this.setTimeout(()=>{this.X5=!1;this.jcd()},8E3),this.X5=!0,this.BCb=!1)}Ndg(){this.MT()}bgg(){this.jcd()}jcd(){this.MT();this.BCb||(this.BCb=!0,this.V5f())}MT(){this.X5&&this.clearTimeout(this.cHa);this.cHa=0;this.X5=!1}static zNb(pa,Oa){return window.setTimeout(pa,
Oa)}static xNb(pa){window.clearTimeout(pa)}}Object(I.a)(y,"ConnectedUsageKpiLogger",null,[1796]);class H{constructor(){this.Cjd=this.FYb;this.Fjd=this.IYb;this.Ejd=this.HYb;this.Hjd=this.KYb;this.Gjd=this.JYb;this.PYb=this.QYb;this.Scb=this.NYb;this.Pga=this.LYb;this.Bua=this.MYb;this.Djd=this.GYb;this.lCa=this.YVb;this.fYa=this.ZVb}FYb(){}IYb(){}HYb(){}KYb(){}JYb(){}NYb(){}MYb(){}LYb(){}QYb(){}GYb(){}YVb(){}ZVb(){}}Object(I.a)(H,"NoopRealtimeChannelMetrics",null,[1789,250]);class F{}F.WOa="presenceUpdated";
F.updateNotification="updateNotification";F.bhd="persistentStateCleared";F.updatePersistentState="persistentStateUpdated";Object(I.a)(F,"RtcClientMethodNames",null,[]);class G{}G.ISf="realtimeChannelHub";G.WOa="UpdatePresence";G.oC="SendUpdateNotification";G.JPb="GetCompletePersistentStateWithMetadata";G.updatePersistentState="UpdatePersistentState";G.c9="UpdateClientInfo";Object(I.a)(G,"RtcHubMethodNames",null,[]);class K{constructor(pa){this.Tp=pa}dqg(pa){this.Tp.on(F.WOa,pa)}kqg(pa){this.Tp.on(F.updateNotification,
pa)}cqg(pa){this.Tp.on(F.updatePersistentState,pa)}bqg(pa){this.Tp.on(F.bhd,pa)}HJg(pa){this.Tp.off(F.WOa,pa)}KJg(pa){this.Tp.off(F.updateNotification,pa)}GJg(pa){this.Tp.off(F.updatePersistentState,pa)}FJg(pa){this.Tp.off(F.bhd,pa)}WOa(pa){return this.Tp.invoke(G.WOa,pa)}c9(pa){return this.Tp.invoke(G.c9,pa)}oC(pa,Oa){return this.Tp.invoke(G.oC,pa,Oa)}JPb(pa){return this.Tp.invoke(G.JPb,pa)}updatePersistentState(pa,Oa){return this.Tp.invoke(G.updatePersistentState,pa,Oa)}}Object(I.a)(K,"RealtimeChannelProxy",
null,[1793,1794,1795]);var R=d(1493);class E{constructor(){this.VBb=this.JDc=!1;this.UBb=0;this.pCb=this.yIb=this.xIb=this.LBb=!1;this.WDb=0;this.NOc=!1;this.MOc=this.LOc=0;this.YHb=!1;this.bIb=this.$Hb=this.cIb=this.ZHb=0;this.aIb=!1}get ijf(){return this.VBb}get hjf(){return this.UBb}get UQh(){return this.LBb}get JAg(){return this.xIb}get KAg(){return this.yIb}get oof(){return this.pCb}get e8a(){return this.WDb}get Uug(){return this.NOc}get hmd(){return this.LOc}get Tug(){return this.MOc}get Qug(){return this.YHb}get Rug(){return this.ZHb}get mmd(){return this.cIb}get imd(){return this.$Hb}get kmd(){return this.bIb}get jmd(){return this.aIb}static createInstance(pa){return pa?
Object.assign(new E,{JDc:pa.$("AwayStatusManagerIsEnabled"),VBb:pa.$("AwayStatusOneMinuteTimeoutIsEnabled"),UBb:pa.jc("AwayCoauthorThresholdMs",9E5),LBb:pa.$("RtcAllowCrossDomainAccessEnabled"),xIb:pa.$("ShouldLogOnContentNotification"),yIb:pa.$("ShouldLogOnHostSubscriptionNotification"),pCb:pa.$("RtcClientMetricsEnabled"),WDb:pa.jc("RtcFindSessionRequestTimeoutInMS",6E4),NOc:pa.$("RtcJsClientFrequentlyLogsMetrics"),LOc:pa.jc("RtcJsClientFrequentMetricsLatencyThresholdInMS",1E3),MOc:pa.jc("RtcJsClientFrequentMetricsLogIntervalInMS",
3E5),YHb:pa.$("RtcClientMessageTelemetryEnabled"),ZHb:pa.jc("RtcClientMessageTelemetrySampleSize",5),cIb:pa.jc("RtcSendTelemetryMessageIntervalInMS",3E5),$Hb:pa.jc("RtcLogClientMessageMetricsTimeOutInMs",2E4),bIb:pa.jc("RtcMaxPayloadSizeInCharactersOverride",R.a.CVb),aIb:pa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RTCLogSignalrHeartBeatMessages",!1)}):Object.assign(new E,{JDc:!1,VBb:!1,UBb:9E5,LBb:!1,xIb:!1,yIb:!0,pCb:!1,WDb:9E4,YHb:!1,ZHb:5,cIb:3E5,$Hb:2E4,bIb:R.a.CVb,aIb:!1})}}Object(I.a)(E,
"RealtimeChannelSettings",null,[1792]);var N=d(1792),O=d(80),U=d(152);class X{constructor(pa){this.cea=null;this.hV=0;this.Zea=!1;this.ze=pa;this.ze.QZ(Object(f.a)(this,this.bK,"onConnectionStateChanged"))}bK(pa,Oa){this.hV=Oa.newState}Lfd(){m.ULS.sendTraceTag(18637070,500,15,"Too many undelivered messages. Restarting RTC connection.");this.ze.Ncb()}VTf(pa){this.cea.init(pa)}}Object(I.a)(X,"ARtcMessageHandler",null,[]);var V=d(507),Q=d(1739),T=d(81);class ba{constructor(pa,Oa=""){this.mIb=pa;this.lZ=
Oa}send(){return this.mIb()}get messageId(){return this.lZ}}Object(I.a)(ba,"MessageHandler",null,[1808]);var W=d(1655);class aa extends Sys.EventArgs{constructor(pa,Oa,Ra,fb){super();this.pZb=pa;this.reconnectDelay=Oa;this.reason=Ra;this.i_b=fb}}Object(I.a)(aa,"RefreshConnectionReconnectArgs",Sys.EventArgs,[]);var Y=d(1735);class da{constructor(){this.OIb=this.ki=null}get Ri(){return this.ki?this.OIb?this.OIb.getTime()-this.ki.getTime():(new Date).getTime()-this.ki.getTime():0}start(){this.ki=new Date}stop(){this.OIb=
new Date}}Object(I.a)(da,"SimpleStopwatch",null,[]);var ka=d(1740),qa=d(1931),ua=d(552),Pa=d(612),Ja=d(613);class Ca extends X{constructor(pa,Oa,Ra,fb,qb,mb,eb,bb,Wa,Za){super(eb);this.Tp=null;this.XKc=this.YKc=!1;this.lZ=0;this.hHb=new U.a;this.LYe=Ca.tHf();this.UGb=z.AFrameworkApplication.J.jb("OwningFeatureCrewForRtcNotificationKpis");this.Oe=pa;this.gMc=this.fMc=0;this.cea=Oa;this.cea.D5a(Object(f.a)(this,this.Lfd,"onTooManyUndeliveredMessages"));this._clientId=Ra;this.w4e=qb;this.ze.Fff(Object(f.a)(this,
this.Cfd,"onRefreshProxyRequired"));this.ze.Dff(Object(f.a)(this,this.Bfd,"onRefreshAllPersistentStateRequest"));this.ze.Jff(Object(f.a)(this,this.oC,"sendUpdateNotification"));this.ze.eff(Object(f.a)(this,this.kfd,"onInternalPresenceUpdated"));this.ze.fff(Object(f.a)(this,this.lfd,"onInternalUpdateNotificationReceived"));this.ze.dff(Object(f.a)(this,this.jfd,"onInternalPersistentStateUpdated"));this.ze.cff(Object(f.a)(this,this.ifd,"onInternalPersistentStateCleared"));this.ze.Iff(Object(f.a)(this,
this.JDa,"sendPersistentState"));this.ze.Pff(Object(f.a)(this,this.c9,"updateClientInfo"));this.ee=mb;this.Ck=fb;this.Qk=bb;this.Zv=Wa;this.lGa=Za;this.jia=Object(O.a)(String,z.AFrameworkApplication.sessionStartInfoSettings.Application)||""}Cfd(pa,Oa){this.Tp=this.w4e(Oa.hubConnection);this.cea.reset();this.Tp.dqg(Object(f.a)(this,this.SU,"onPresenceUpdated"));this.Tp.cqg(Object(f.a)(this,this.xga,"onPersistentStateUpdated"));this.Tp.bqg(Object(f.a)(this,this.wYa,"onPersistentStateCleared"));this.Tp.kqg(Object(f.a)(this,
this.dS,"onUpdateNotificationReceived"))}bK(pa,Oa){this.hV=Oa.newState;2===Oa.newState&&this.zwg()}zwg(){for(const pa of this.hHb)this.oC(null,new Y.a(pa.key,pa.value,!1,new a.a));this.hHb=new U.a}Bfd(pa,Oa){Oa.XLb();for(pa=0;3>pa;++pa)this.twg(pa,Oa)}twg(pa,Oa){try{this.Tp.JPb(pa).done(Ra=>{Oa.Rva(Oa.XTa,"GetCompletePresenceSuccess")&&(Oa.dqf.bgg(),m.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}] of type [{1}]",this.Ck,pa),this.ze.Cog(),this.ufg(pa,Ra),this.ze.pog(Ra),
Oa.R_c.tb(pa)&&this.ze.pjd(pa,Oa.R_c.K(pa),new a.a))}).fail(Ra=>{const {RtcUtils:fb}=d(1423);Oa.Rva(Oa.XTa,"GetCompletePresenceFail")&&(m.ULS.sendTraceTag(3249541,500,15,"Failed to retrieve complete session state : {0} for [{1}] of type [{2}]",fb.Bma(Ra),this.Ck,pa),this.ze.Ncb())}).always(()=>{Oa.nz&&Oa.nz.stop()})}catch(Ra){m.ULS.sendTraceTag(595132428,500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",
Oa.XTa,Ra.message)}}JDa(pa,Oa){var {RtcUtils:Ra}=d(1423);pa=Oa.JI;let fb;const qb=Oa.Nna;this.Zv.Ws(1,0);try{fb=Ra.TLb(pa,this.lGa)}catch(eb){this.Zv.Ws(1,3);m.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",eb.message);qb.setException(eb);return}Ra=new w.a;Ra.W(this._clientId,Object.assign(new Q.a,{Presence:pa,TimeStamp:(new Date).getTime()}));this.ze.rjd(Oa.type,Ra);if(2!==this.hV)this.Qk.Pga(),this.Zv.Ws(1,2),qb.gg(null);else{var mb=
this.lZ.toString();++this.lZ;pa=new ba(()=>this.Awg(Oa.type,fb,mb),mb);pa=this.lrd(0,Oa.type).add(pa);pa.Ubb(eb=>{2===eb&&(this.Zv.Ws(1,6),this.XKc||2!==Oa.type||m.ULS.sendTraceTag(508651234,500,15,"First persistent state update of type LiveMeeting for [{0}] was throttled",this.Ck));qb.gg(null)});pa.Tbb(()=>{})}}Awg(pa,Oa,Ra){let fb=null;const qb=new da,mb=new W.a;m.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}] of type [{1}]",this.Ck,pa);if(2!==this.hV)return this.Qk.Pga(),this.Zv.Ws(1,
2),m.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}] of type [{1}]",this.Ck,pa),mb.uVb(),mb;this.ee&&20>this.fMc&&(fb=this.ee.Xf("WebServiceCall","Send Presence Message"),this.fMc++);qb.start();mb.SLa(1);try{this.Tp.updatePersistentState(pa,Oa).done(()=>{this.Qk.Scb();this.Zv.Ws(1,1);m.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}] of type [{2}]",Ra,this.Ck,pa);mb.S7(1);qb&&(qb.stop(),qb.Ri>this.Oe.hmd?this.Zv.Ws(1,
4):this.Zv.Ws(1,5))}).fail(eb=>{const {RtcUtils:bb}=d(1423);this.Zea||(this.Qk.Pga(),this.Zv.Ws(1,3),this.XKc||2!==pa||m.ULS.sendTraceTag(508651233,500,15,"First persistent state update of type LiveMeeting for [{0}] failed",this.Ck),m.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",Ra,bb.Bma(eb),this.Ck));mb.S7(2)}).always(()=>{fb&&fb.stop()})}catch(eb){m.ULS.sendTraceTag(593072906,500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",
eb.message),this.Zv.Ws(1,3),this.XKc||2!==pa||m.ULS.sendTraceTag(508651232,500,15,"First persistent state update of type LiveMeeting for [{0}] hit an exception",this.Ck),mb.S7(2)}return mb}c9(pa,Oa){({RtcUtils:pa}=d(1423));const Ra=Oa.X2h,fb=Oa.Nna;let qb;try{qb=pa.TLb(Ra,this.lGa)}catch(mb){m.ULS.sendTraceTag(544318999,500,10,"Exception thrown while trying to serialize clientInfo. Exception message: {0}",mb.message);fb.setException(mb);return}try{this.Tp.c9(qb).done(()=>{m.ULS.sendTraceTag(544319E3,
500,50,"Successfully delivered clientInfo.")}).fail(mb=>{const {RtcUtils:eb}=d(1423);this.Zea||m.ULS.sendTraceTag(544319001,500,15,"Server failed to process udpate clientInfo: {0}.",eb.Bma(mb));fb.gg(null)})}catch(mb){m.ULS.sendTraceTag(544319002,500,15,"Exception when invoking hub method UpdateClientInfo: error: {0}",mb.message),fb.gg(null)}}oC(pa,Oa){({RtcUtils:pa}=d(1423));const Ra=Oa.type,fb=Oa.jA,qb=Oa.Fvf,mb=Oa.Nna;let eb;this.Zv.Ws(0,0);try{eb=pa.TLb(fb,this.lGa)}catch(Wa){this.Zv.Ws(0,3);
m.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",Wa.message);mb.setException(Wa);return}if(2!==this.hV)qb?this.hHb.W(Ra,fb):(this.Qk.Pga(),this.Zv.Ws(0,2)),mb.gg(null);else{var bb=this.lZ.toString();++this.lZ;Oa=new ba(()=>this.Swg(Ra,eb,bb),bb);Oa=this.lrd(1,Ra).add(Oa);Oa.Ubb(Wa=>{2===Wa&&this.Zv.Ws(0,6);mb.gg(null)});Oa.Tbb(()=>{})}}Swg(pa,Oa,Ra){let fb=null;const qb=new da,mb=new W.a;m.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}] of type [{1}]",
this.Ck,pa);if(2!==this.hV)return this.Qk.Pga(),this.Zv.Ws(0,2),m.ULS.sendTraceTag(7934172,500,15,"Connection is lost - unable to send the message for [{0}]",this.Ck),mb.uVb(),mb;this.ee&&3===pa&&20>this.gMc&&(fb=this.ee.Xf("WebServiceCall","Send WetContent Update"),this.gMc++);qb.start();mb.SLa(1);this.Tp.oC(pa,Oa).done(()=>{this.Qk.Scb();this.Zv.Ws(0,1);m.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}] of type [{2}]",Ra,this.Ck,pa);mb.S7(1);qb&&
(qb.stop(),qb.Ri>this.Oe.hmd?this.Zv.Ws(0,4):this.Zv.Ws(0,5))}).fail(eb=>{const {RtcUtils:bb}=d(1423);this.Zea||(this.Qk.Pga(),this.Zv.Ws(0,3),m.ULS.sendTraceTag(3249507,500,15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",Ra,bb.Bma(eb),this.Ck));mb.S7(2)}).always(()=>{fb&&fb.stop()});return mb}zY(){this.Tp.HJg(Object(f.a)(this,this.SU,"onPresenceUpdated"));this.Tp.GJg(Object(f.a)(this,this.xga,"onPersistentStateUpdated"));this.Tp.FJg(Object(f.a)(this,this.wYa,
"onPersistentStateCleared"));this.Tp.KJg(Object(f.a)(this,this.dS,"onUpdateNotificationReceived"))}Zvf(){this.ntg();this.ze.qDa(Object(f.a)(this,this.bK,"onConnectionStateChanged"));this.ze.Org(Object(f.a)(this,this.Cfd,"onRefreshProxyRequired"));this.ze.Mrg(Object(f.a)(this,this.Bfd,"onRefreshAllPersistentStateRequest"));this.ze.Srg(Object(f.a)(this,this.oC,"sendUpdateNotification"));this.ze.Brg(Object(f.a)(this,this.kfd,"onInternalPresenceUpdated"));this.ze.Crg(Object(f.a)(this,this.lfd,"onInternalUpdateNotificationReceived"));
this.ze.Arg(Object(f.a)(this,this.jfd,"onInternalPersistentStateUpdated"));this.ze.zrg(Object(f.a)(this,this.ifd,"onInternalPersistentStateCleared"));this.ze.Rrg(Object(f.a)(this,this.JDa,"sendPersistentState"));this.ze.Urg(Object(f.a)(this,this.c9,"updateClientInfo"))}kfd(pa,Oa){this.SU(Oa.$ha,Oa.gZc)}SU(pa){this.Qk.Bua();this.xga(0,pa)}jfd(pa,Oa){this.xga(Oa.type,Oa.$ha)}ufg(pa,Oa){const Ra={};for(const fb in Oa)Ra[fb]=Oa[fb].Presence;this.wfd(pa,Ra,Oa)}xga(pa,Oa){this.Qk.Bua();this.wfd(pa,Oa)}wfd(pa,
Oa,Ra=null){var {RtcUtils:fb}=d(1423);if(m.ULS.k4(500,100))for(var qb in Oa);delete Oa[this._clientId];if(!T.a.isEmpty(Oa)){for(var mb in Oa)qb=mb,Oa[qb]=fb.deserialize(Oa[mb],"Presence",qb,!1,this.lGa);fb=new w.a;mb=(new Date).getTime();for(const eb in Oa){qb=Oa[eb];const bb=eb;let Wa;Ra?(Wa=Ra[bb],Wa.Presence=qb):Wa=Object.assign(new Q.a,{Presence:qb,TimeStamp:mb});fb.W(bb,Wa)}this.ze.rjd(pa,fb);switch(pa){case 0:this.YKc||(m.ULS.sendTraceTag(4539734,500,50,"Raising first presence update notification for [{0}]",
this.Ck),this.YKc=!0,z.AFrameworkApplication.fh&&z.AFrameworkApplication.fh.Ybj());this.ze.ljd(Oa,[]);break;case 2:this.XKc||(m.ULS.sendTraceTag(508867081,500,50,"Raising first live meeting update notification for [{0}]",this.Ck),this.XKc=!0);this.ze.Bse(pa,Oa);break;default:this.ze.Bse(pa,Oa)}}}ifd(pa,Oa){this.wYa(Oa.pnb)}wYa(pa){this.Qk.Bua();if(m.ULS.k4(500,100))for(let Oa=0;Oa<pa.length;++Oa);pa.length&&(this.ze.Fog(pa),this.ze.xog(pa),this.ze.ljd({},pa))}lfd(pa,Oa){this.dS(Oa.type,Oa.jA)}dS(pa,
Oa=null){this.Oe.JAg&&0===pa&&m.ULS.sendTraceTag(40128990,500,50,"Received ContentUpdate notification from the server");if(0===pa&&this.UGb&&0<this.UGb.length){var Ra=Object.assign(new ua.a,{topLevelKpiName:"ContentUpdateNotificationReceived",featureName:"RtcNotification",crewAlias:this.UGb,vetoPillar:"RealTimeCoauth"});(Ra=V.a.getInstance(Ra))&&Ra.logKpiUsage(this.LYe)}this.Oe.KAg&&13===pa&&m.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",
Oa||"<none>"));this.Qk.Bua();5===pa?(Oa=(pa=this.Eig(Oa))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",pa.reason,pa.reconnectDelay):"Received client reconnection request from the server without params.",m.ULS.sendTraceTag(18637071,500,50,Oa),this.ze.Ncb(pa)):(Oa=d(1423).RtcUtils.deserialize(Oa,String.format("UpdateNotification-{0}",qa.a[pa]),null,!1,this.lGa),this.ze.Eog(pa,Oa))}Eig(pa){try{if(!pa||""===pa)return null;const Oa=JSON.parse(pa);
return new aa(Oa[ka.a.SZb],Oa[ka.a.Pug],Oa[ka.a.Sug],Oa[ka.a.i_b])}catch(Oa){return m.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",Oa.message),null}}lrd(pa,Oa){return this.cea.WNf(this.XNf(pa,Oa))}XNf(pa,Oa){return pa+","+Oa}ntg(){this.cea.reset();this.cea.Mkd(Object(f.a)(this,this.Lfd,"onTooManyUndeliveredMessages"))}static tHf(){var pa=new Map;pa.set("SkipAria","True");pa=Object.assign(new Pa.a,{extendedProperties:pa});return Object.assign(new Ja.a,{kpiName:"ContentUpdateNotificationReceived",
kpiType:0,optionalProperties:pa,blockFutureEmissionDurationInMs:3E5})}}Object(I.a)(Ca,"RtcMessageHandler",X,[]);class ra{EXc(pa,Oa=""){const {MaxOutstandingThrottler:Ra}=d(1736);return Ra.createInstance(pa,Oa)}Gsf(pa,Oa=""){const {MaxRateThrottler:Ra}=d(1738);return Ra.createInstance(pa,Oa)}}Object(I.a)(ra,"ThrottlerFactory",null,[1791]);var Ea=d(86),xa=d(1741);class Ma{constructor(pa){this.Oe=null;this.vi=!1;this.sa=new Ea.a;this.dGb=new w.a;this.cGb=new w.a;this.jJb=pa;this.gpa=this.jJb.EXc(Oa=>
Oa.send(),"GlobalMaxOustandingThrottler");this.gpa.D5a(()=>{this.sa.raiseEvent("TMUDM")})}init(pa){this.vi||(this.Oe=pa,this.gpa.init(this.Oe.U8,this.Oe.$Of),this.vi=!0)}WNf(pa){var {MaxRateThrottler:Oa}=d(1738),{MaxOutstandingThrottler:Ra}=d(1736);this.vi||this.init(new xa.a(Oa.xYc,Ra.BYc,Ra.zYc,Ma.r7f));({value:Oa}=this.dGb.Ec(pa)).returnValue||(({value:Oa}=this.cGb.Ec(pa)).returnValue||(Oa="MaxOutstandingThrottler-"+pa,Oa=this.jJb.EXc(Object(f.a)(this.gpa,this.gpa.add,"add"),Oa),Oa.init(this.Oe.U8,
this.Oe.q7f),Oa.D5a(()=>{this.sa.raiseEvent("TMUDM")}),this.cGb.add(pa,Oa)),Ra="MaxRateThrottler-"+pa,Oa=this.jJb.Gsf(Object(f.a)(Oa,Oa.add,"add"),Ra),Oa.init(this.Oe.Y7f),this.dGb.add(pa,Oa));return Oa}reset(){for(const pa of this.dGb)pa.value.OYb();for(const pa of this.cGb)pa.value.OYb(),pa.value.reset();this.gpa.OYb();this.gpa.reset()}D5a(pa){this.sa.addHandler("TMUDM",pa)}Mkd(pa){this.sa.removeHandler("TMUDM",pa)}}Ma.r7f=1E3;Object(I.a)(Ma,"ThrottlerManager",null,[1790]);var ha=d(1932);const la=
(pa,Oa,Ra,fb,qb,mb,eb,bb,Wa=null,Za=null,Na=null,Db=null)=>{const nb=E.createInstance(z.AFrameworkApplication.J),Ta=z.AFrameworkApplication.buildVersion?z.AFrameworkApplication.buildVersion:"1.0",cb=Fa(pa,Oa,eb,Ta),sb=nb.oof?d(1930).RealtimeChannelMetrics.createInstance(cb):new H;var pb=d(1468).FrequentLoggingMetrics.create(qb);nb.Uug&&pb.MDg(nb.Tug);var tb="";tb=Wa&&""!==Wa?Wa:"/rtc2/";pb.D0c=u.a.nU(tb);const wb=tb+"signalr";Wa=tb+"findsession";const gc=G.ISf;tb=new ra;Na=Na||N.a.getInstance();m.ULS.shipAssertTag(508396228,
500,nb.kmd<=R.a.Ucd,"Client attempting to override max payload size beyond absolute limit");const vc=Math.min(nb.kmd,R.a.Ucd);pb.Tcd=vc;pb=new Ca(nb,new Ma(tb),pa,cb,Pc=>new K(Pc.createHubProxy(gc)),bb,Na,sb,pb,vc);Za||(Za=d(2025).FindSessionStrategy.createInstance(Oa,qb,Wa,bb,Ta,eb,pa,cb,Na,mb,fb,Db));Za.e8a=nb.e8a;Oa=new y(cb);Ra=Ra?Ra.split(","):null;pa=new (d(2023).RealtimeChannel)(pa,Ra,cb,bb,()=>$.hubConnection(wb),Za,pb,Oa,Na,sb,nb,qb);pa.init();return pa},Fa=(pa,Oa,Ra)=>String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",
pa,Ga(ha.a[Ra]),Ga("browser"),Oa),Ga=pa=>pa?pa.charAt(0).toLocaleUpperCase()+pa.substring(1,pa.length):pa;d.d(J,"RealtimeChannel",function(){return va});class va{constructor(pa,Oa,Ra,fb,qb,mb,eb,bb,Wa,Za,Na,Db){this.NIb=!1;this.CH=null;this.Py=new w.a;this.nwa=1;this.tia=null;this.fm=!1;this.w8b=(new Date(0)).getTime();this.Ykb=0;this.bqd=()=>{const nb=this.nwa;this.NIb=!1;this.Qk.Cjd();this.p9.xMf(this.bqf,this.Zed,Object(f.a)(this.C0,this.C0.VTf,"initThrottlerManager"),Object(f.a)(this,this.Rva,
"verifyConnectionToken"),nb)};this.Zed=(nb=null)=>{this.Qk.Ejd();let Ta=null;!nb||"documentsessiondeleted"!==(Ta=nb.toLowerCase())&&"documentsessionexpired"!==Ta?this.iJa():(m.ULS.sendTraceTag(508396225,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",this.Ck,nb),this.disconnect())};this.iJa=(nb,Ta=null)=>{m.ULS.sendTraceTag(508396224,500,50,"Disconnecting the connection [{0}]",this.CH);nb=(nb=2===this.lk||1===this.lk)&&
!this.C0.Zea;let cb=!0,sb=0;Ta&&Object.getType(Ta)!==Object.getType(Sys.EventArgs.Empty)&&Ta.pZb&&""!==Ta.pZb&&(nb=!0,this.p9.Xyg(Ta.pZb),cb=Ta.i_b,sb=Ta.reconnectDelay);nb&&this.bK(1,this.lk);++this.nwa;this.C0.zY();this.fEg(cb);this.p9.jxf();this.GXc();nb&&window.setTimeout(this.bqd,Math.min(sb,3E4))};this.Isd=()=>{let nb=null;const Ta=({correlationId:nb}=this.p9.S2c()).returnValue;this.tia.qs=Ta;m.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",
this.Ck,nb)};this.bqf=nb=>{const {FrequentLoggingMetrics:Ta}=d(1468);this.w8b=(new Date).getTime();let cb=null;this.tia.qs=({correlationId:cb}=this.p9.S2c()).returnValue;this.Oe.UQh&&(this.tia.url=nb,Ta.instance&&(Ta.instance.nWc=u.a.nU(nb)));let sb=null;this.ee&&(sb=this.ee.Xf("WebServiceCall","ConnectToServer"));m.ULS.sendTraceTag(3290048,500,50,"Connecting to server for client [{0}]",this.Ck);nb={};this.bRc&&(nb.transport=1===this.bRc.length?this.bRc[0]:this.bRc);nb.pingInterval=null;v.a.instance.dNa(1,
0);nb.waitForPageLoad=!1;this.tia.start(nb,null).done(pb=>{this.Qk.Fjd();v.a.instance.dNa(1,1,!0);m.ULS.sendTraceTag(508396195,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",pb.id,cb)}).fail(pb=>{m.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1},  ClientDetails: [{2}]",this.p9.iw,cb,this.Ck);this.Zed();this.Qk.Djd(pb);v.a.instance.dNa(1,1,!1);this.ze.njd(0,{["CorrelationId"]:cb,["ErrorDetails"]:pb,["ConnectionState"]:l.a[this.lk]})}).always(()=>
{const {FrequentLoggingMetrics:pb}=d(1468);sb&&sb.stop();pb.instance&&(pb.instance.MDb=!1)})};this.Ofd=(nb,Ta)=>{for(const cb of Ta.tLg)this.Py.tb(cb.key)||this.Py.W(cb.key,new U.a),nb=cb.value,this.Py.K(cb.key).W(Ta.type,new D(nb.Presence,new Date(nb.TimeStamp))),cb.key===this._clientId&&0===Ta.type&&this.ze.tog(nb.Presence)};this.Nfd=(nb,Ta)=>{for(const cb of Ta.pnb)this.Py.remove(cb)};this.XLb=()=>{let nb;const Ta=[];({value:nb}=this.Py.Ec(this._clientId)).returnValue&&this.Py.remove(this._clientId);
for(const cb of this.Py.keys)Array.add(Ta,cb);for(const cb of Ta)this.Py.remove(cb);nb&&this.Py.W(this._clientId,nb);this.ze.rog(Ta)};this._clientId=pa;this.bRc=Oa;this.lk=0;this.ee=fb;this.ACb=bb;this.o6e=eb;this.HIe=Wa;this.kNe=qb;this.p9=mb;this.Ck=Ra;this.Qk=Za;this.Oe=Na;this.If=Db;this.QPc=1>100*Math.random()}get Eba(){return this.p9.Eba}set Eba(pa){this.p9.Eba=pa}get C0(){return this.o6e}get ze(){return this.HIe}init(){this.ze.Eff(this.iJa);this.ze.Rff(this.Ofd);this.ze.Qff(this.Nfd);this.If.v5a(this.Qk);
z.AFrameworkApplication.fG(()=>{const {FrequentLoggingMetrics:pa}=d(1468);this.Qk.PYb();pa.instance&&pa.instance.eVb()});this.GXc();this.LUl();this.ze.Kff(this.Isd)}LUl(){try{const Ra=$.signalR;if(!Ra)throw Error.invalidOperation("Failed to retrieve Signalr object");const fb=Ra.version;if(!fb)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"===fb){var pa=Ra.transports;if(!pa)throw Error.invalidOperation("Failed to retrieve transports object");var Oa=pa.longPolling;
if(!Oa)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!Oa.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");Oa.supportsKeepAlive=this.rKl()}}catch(Ra){m.ULS.sendTraceTag(508396227,500,15,"Failed to disable longPolling KeepAlives: {0}",Ra.message)}}rKl(){return()=>!1}GXc(){const pa=++this.nwa;this.w8b=(new Date(0)).getTime();this.tia=this.kNe();this.ze.Bog(this.tia);this.tia.stateChanged(Oa=>{this.Cdg(Oa,pa)});
this.tia.connectionSlow(Object(f.a)(this,this.vne,"onSlowConnection"));this.tia.error(Object(f.a)(this,this.tne,"onSignalRError"));this.tia.log=Object(f.a)(this,this.une,"onSignalRLog")}Rva(pa,Oa){return pa!==this.nwa?(m.ULS.sendTraceTag(508396226,500,50,"ConnectionToken verification failed for {0}",Oa),!1):!0}connect(){2!==this.lk&&1!==this.lk&&(m.ULS.sendTraceTag(4539721,500,50,"Starting a new RTC connection for client [{0}]",this.Ck),this.ACb.Bdg(),v.a.instance.NDg(),this.bK(1,this.lk),this.bqd())}disconnect(){const {FrequentLoggingMetrics:pa}=
d(1468);0===this.lk?m.ULS.sendTraceTag(508396194,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.Ck):(this.Qk.Gjd(),pa.instance&&(pa.instance.MDb=!0),m.ULS.sendTraceTag(508396193,500,50,"Starting explicit disconnect for [{0}]",this.Ck),this.C0.Zea=!0,this.ACb.Ndg(),this.bK(0,this.lk),this.iJa(),this.C0.Zea=!1)}fEg(pa){const Oa=this.fmf(),Ra=this.tia,fb=this.CH,qb=()=>{if(this.NIb)m.ULS.sendTraceTag(508396191,500,15,"Stop connection was called twice, possibly on the same connection.");
else try{this.NIb=!0,Ra.stop(!0,pa)}catch(mb){m.ULS.sendTraceTag(508396192,500,15,"Stopping connection failed: {0}",mb.message)}};0<Oa?(m.ULS.sendTraceTag(508396190,500,50,"Waiting to stop connection [{0}]: [{1}] ms.",fb,Oa),window.setTimeout(qb,Oa)):(m.ULS.sendTraceTag(508396189,500,50,"Stopping connection [{0}].",fb),qb())}fmf(){let pa=0;0===this.tia.state&&(pa=this.w8b+va.Sak-(new Date).getTime(),0>pa&&(pa=0));return pa}get connectionState(){return this.lk}QZ(pa){this.ze.QZ(pa)}qDa(pa){this.ze.qDa(pa)}Bwg(pa){this.JDa(0,
pa)}JDa(pa,Oa){const Ra=new a.a;this.ze.pjd(pa,Oa,Ra);return Ra.task}wya(pa){this.ze.wya(pa)}GZa(pa){this.ze.GZa(pa)}bmb(pa){this.ze.bmb(pa)}mxb(pa){this.ze.mxb(pa)}amb(pa){this.ze.amb(pa)}lxb(pa){this.ze.lxb(pa)}elc(pa){return this.AOf(pa,0)}oqb(){return this.nqb(0)}nqb(pa){const Oa={};for(const Ra of this.Py)Ra.value.tb(pa)&&(Oa[Ra.key]=Ra.value.K(pa).data);return Oa}AOf(pa,Oa){return this.Py.tb(pa)&&this.Py.K(pa).tb(Oa)?this.Py.K(pa).K(Oa).data:null}NFf(){const pa=new U.a;if(!this.Py.tb(this._clientId))return pa;
for(const Oa of this.Py.K(this._clientId))pa.W(Oa.key,Oa.value.data);return pa}oC(pa,Oa=null,Ra=!1){const fb=new a.a;this.ze.AYb(pa,Oa,Ra,fb);return fb.task}AO(pa){this.ze.AO(pa)}sDa(pa){this.ze.sDa(pa)}LVa(pa){let Oa,Ra;return({value:Oa}=this.Py.Ec(pa)).returnValue&&({value:Ra}=Oa.Ec(0)).returnValue?new x.a(this.BOf(Ra),Ra.timeStamp):null}Zic(){const pa={};for(const Oa of this.Py)Oa.value.Ec(0).returnValue&&(pa[Oa.key]=this.LVa(Oa.key));return pa}c9(pa){const Oa=new a.a;this.ze.Dse(pa,Oa);return Oa.task}get clientId(){return this._clientId}get FCg(){return this.QPc}dispose(){var pa;
const {FrequentLoggingMetrics:Oa}=d(1468);if(!this.fm){if(null===(pa=z.AFrameworkApplication.J)||void 0===pa?0:pa.$("DetachRtcEventHandlerOnDispose"))this.Yvf(),this.C0.Zvf();this.C0.zY();this.If.cvc(this.Qk);this.Qk.PYb();Oa.instance&&Oa.instance.eVb();this.fm=!0}}Cdg(pa,Oa){this.Rva(Oa,"StateChangedSignalR")&&this.bK(this.QWc(pa.newState),this.QWc(pa.oldState))}bK(pa,Oa){var {FrequentLoggingMetrics:Ra}=d(1468),{ClientToClientMessageTelemetry:fb}=d(1807);if((1!==this.lk||0!==Oa||1!==pa)&&this.lk!==
Oa){const qb=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.lk,Oa,pa]));m.ULS.sendTraceTag(508396188,500,10,qb)}if(this.lk!==pa){switch(pa){case 2:Ra.instance&&Ra.instance.b7f();this.CH=this.tia.id;m.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.CH,this.Ck);this.R5f(this.tia);m.ULS.sendTraceTag(508396186,500,50,"Retrieving complete session state");Ra=null;
this.ee&&(Ra=this.ee.Xf("WebServiceCall","Receive First Presence"));fb=this.nwa;this.ze.Aog(Object(f.a)(this,this.Rva,"verifyConnectionToken"),fb,this.ACb,this.XLb,this.NFf(),Ra);this.Oe.Qug&&(Ra=100*Math.random()<=this.Oe.Rug,d(1807).ClientToClientMessageTelemetry.Xqb(this.ze,this.Oe,Ra).start());break;case 1:2===Oa&&m.ULS.sendTraceTag(508396185,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.CH);break;case 0:if(fb.instance&&fb.instance.stop(),this.C0.Zea)m.ULS.sendTraceTag(508396182,
500,50,"Connection [{0}] has been explicitly closed",this.CH);else{1===Oa&&(m.ULS.sendTraceTag(508396184,500,50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",this.CH),this.Qk.Hjd());2===Oa&&m.ULS.sendTraceTag(508396183,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this.CH);this.iJa();return}}this.lk=pa;
this.ze.kog(pa,Oa)}}Yvf(){this.ze.Nrg(this.iJa);this.ze.Wrg(this.Ofd);this.ze.Vrg(this.Nfd);this.ze.Trg(this.Isd)}R5f(pa){if(pa&&pa.transport&&pa.transport.name){pa=pa.transport.name;var Oa=pa.toLowerCase();"websockets"===Oa?m.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",pa,this.Ck):"serversentevents"===Oa?m.ULS.sendTraceTag(4290752,500,50,"Transport name - {0} for [{1}]",pa,this.Ck):"foreverframe"===Oa?m.ULS.sendTraceTag(4290753,500,50,"Transport name - {0} for [{1}]",pa,this.Ck):
"longpolling"===Oa?m.ULS.sendTraceTag(4290754,500,50,"Transport name - {0} for [{1}]",pa,this.Ck):"mocktransport"!==Oa&&m.ULS.sendTraceTag(508396180,500,15,"Unknown transport protocol encountered - '{0}'",pa)}else m.ULS.sendTraceTag(508396181,500,10,"Transport protocol name is missing")}vne(){if(this.Oe.jmd){const pa=u.a.vL(this.Eba,"mid");m.ULS.sendTraceTag(508396178,500,15,"Detected that the connection [{0}] is slow for target machine [{1}]",this.CH,pa)}else m.ULS.sendTraceTag(508396177,500,50,
"Detected that the connection [{0}] is slow",this.CH)}tne(){m.ULS.sendTraceTag(508396176,600,15,"SignalR ERROR for connection [{0}];",this.CH)}une(pa){pa=d(1423).RtcUtils.Bma(pa);if(this.Oe.jmd&&pa.startsWith("Keep alive timed out.")){const Oa=u.a.vL(this.Eba,"mid");m.ULS.sendTraceTag(508396175,500,15,"SignalR lib: {0}. Target Machine: {1}",pa,Oa)}else this.FCg&&2E3>this.Ykb&&!pa.startsWith("Invok")&&!pa.startsWith("Trigger")&&(m.ULS.sendTraceTag(508396174,500,50,"SignalR lib: {0}",pa),this.Ykb++)}QWc(pa){switch(pa){case 0:return 1;
case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",pa,"Unknown SignalR state");}}BOf(pa){return pa&&pa.timeStamp?(new Date).getTime()-pa.timeStamp.getTime()>(this.Oe.ijf?6E4:this.Oe.hjf)?2:1:1}static createInstance(pa,Oa,Ra,fb,qb,mb,eb,bb=null,Wa=null,Za=null,Na=null,Db=null,nb=null){return la(pa,Oa,Ra,nb,fb,qb,mb,eb,bb,Wa,Za,Db,Na)}}va.Sak=15E3;Object(I.a)(va,"RealtimeChannel",null,[1766,1555])},2025:function(I,J,d){d.r(J);I=d(0);var m=d(8),f=d(109),a=
d(71),l=d(897);class w{}w.Rta="throttling_messageDelay";w.vLa="enabled";w.U8="throttling_timeToWaitForResponse";w.Mta="throttling_maxNumberOfOutstandingMessages";w.V4c="throttling_globalMaxNumberOfOutstandingMessages";w.errorMessage="errorMessage";w.Epd="url";w.GP="queryString";w.iw="connectionString";w.zwc="netcore";Object(I.a)(w,"RtcFindSessionOutputFieldNameConstants",null,[]);var z=d(2),x=d(46),u=d(43),v=d(1277),D=d(81),y=d(16),H=d(118);class F{constructor(){this.W4c=this.Rcd=this.Scd=this.Vcd=
0;this.kab=!1;this.correlationId=this.iw=this.GP=this.oMb=this.errorMessage=null}get Ipf(){return this.oMb+"?"+this.GP}}Object(I.a)(F,"FindSessionResponse",null,[]);var G=d(603);class K{constructor(W,aa,Y,da,ka,qa){this.I5=null;this.y4e=W;W=String.format("{0}={1}",G.a.clientId,y.a.$i(da));W=String.format("{0}&{1}={2}",W,G.a.userSessionId,y.a.$i(ka));W=String.format("{0}&{1}={2}",W,G.a.hFe,y.a.$i(Y.toString()));W=String.format("{0}&{1}={2}",W,G.a.userType,y.a.$i("1"));W=String.format("{0}&{1}={2}",
W,G.a.nFe,y.a.$i(aa));W=String.format("{0}&{1}={2}",W,G.a.EVd,y.a.$i(K.$sl));(aa=K.S1c(Y,qa))&&(W=String.format("{0}&{1}",W,aa));this.lNe=W}Pjd(){this.I5=this.y4e()}generate(){this.I5&&""!==this.I5||(this.Pjd(),m.ULS.sendTraceTag(575784194,500,this.I5&&""!==this.I5?50:15,"Query signature delegate called for refresh returned: {0} ",this.I5));const W=String.format("{0}={1}",G.a.Mcb,y.a.$i(this.I5));return String.format("{0}&{1}",W,this.lNe)}static S1c(W,aa){return 4===W?String.format("{0}={1}",G.a.Dke,
"1"):aa?aa.COf():null}}K.$sl="1.0";Object(I.a)(K,"FindSessionQueryStringGenerator",null,[]);var R=d(1468),E=d(1611),N=d(1423),O=d(1741);class U{}U.KCf="FSType";Object(I.a)(U,"RtcFindSessionRequestHeaders",null,[]);class X{}X.Qog="polling";Object(I.a)(X,"RtcFindSessionTypes",null,[]);var V=d(1740);class Q{}Q.nMg="RTC-TokenProofkey";Q.$0f="RTC-IsWacJsBootFsRequest";Object(I.a)(Q,"RtcRequestHeaders",null,[]);var T=d(68);d.d(J,"FindSessionStrategy",function(){return ba});class ba{constructor(W,aa,Y,da,
ka,qa,ua,Pa,Ja,Ca,ra,Ea,xa=null){this.nKc=(new Date(0)).getTime();this.hLc=0;this.i3a=!1;this.wPc=null;this.YYb=36E5;this.Hoa=ba.o7c;this.LFa=0;this.aha=null;this.hV=0;this.Tua=this.oWc=null;this.E5e=[w.vLa,w.errorMessage,w.Epd,w.iw,w.GP,w.V4c,w.Mta,w.U8,w.Rta];this.D5e=[w.vLa,w.errorMessage];this.iw=this.Eba=null;this.zHc=new K(ra?ra:()=>z.AFrameworkApplication.rm,ka,qa,ua,W,aa);this.hFa=Ea;this.ee=da;this.If=aa;this.AHc=Y;this.Ck=Pa;this.ze=Ja;this.Nwa=xa;this.BHc=!1;this.e8a=9E4;Ca&&Ca.execute(Ma=>
{Ma.gTa(()=>{m.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",this.Ck);this.zHc.Pjd()})});2>=100*Math.random()&&(this.YYb=3E5);R.FrequentLoggingMetrics.instance&&(R.FrequentLoggingMetrics.instance.o1c=this.YYb)}Xyg(W){this.Tua=W}init(){this.ze.Gff(Object(f.a)(this,this.qtg,"resetGetMachineIdDelay"));this.ze.QZ(Object(f.a)(this,this.bK,"onConnectionStateChanged"))}bK(W,aa){this.hV=aa.newState;2===aa.newState&&(this.LFa=0)}S2c(){let W;W=this.aha.correlationId;
return{returnValue:String.format("{0}&{1}={2}",this.aha.GP,ba.LXd,y.a.$i(W)),correlationId:W}}xMf(W,aa,Y,da,ka){this.swg(()=>{da(ka,"GetMachineIdSuccess")&&(m.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",this.iw,this.Ck),W(this.wPc),Y(this.YNf()))},qa=>{da(ka,"GetMachineIdFailure")&&(m.ULS.sendTraceTag(4060129,500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.Ck),aa(qa))},da,ka)}jxf(){this.tVc();this.DTf()}swg(W,aa,Y,da){m.ULS.sendTraceTag(17956952,
500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",this.iw);if(this.iw)W();else{var ka=this.$lf();window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(W,aa,Y,da)},ka)}}sendFindSessionRequestToServerInternal(W,aa,Y,da){Y(da,"RequestMachineId")&&(this.nKc=(new Date).getTime(),Y=u.a.Je(),this.UPb(ka=>{const qa=u.a.Je();this.Hgd(ka);this.D_b();W();ka=u.a.Je()-qa;m.ULS.sendTraceTag(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",ka)},
ka=>{const qa=u.a.Je();this.tVc();R.FrequentLoggingMetrics.instance&&R.FrequentLoggingMetrics.instance.Ws(2,3);aa(ka);ka=u.a.Je()-qa;m.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",ka)},!1),Y=u.a.Je()-Y,m.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",Y))}DTf(){this.Hoa+=ba.wKf;this.Hoa=Math.min(this.Hoa,ba.n7f)}$lf(){var W=(new Date).getTime();W=this.nKc+this.Hoa-W;0>W&&(W=0);return W}Hgd(W){try{this.aha=W,this.Eba=W.Ipf,this.iw=W.iw,this.oWc=W.GP,this.wPc=
W.oMb}catch(aa){m.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",aa.toString())}}tVc(){this.iw=null;this.uVc()}D_b(){this.uVc();this.i3a=!0;this.hLc=window.setTimeout(Object(f.a)(this,this.Apg,"refreshMachineId"),this.YYb)}uVc(){this.i3a&&(window.clearTimeout(this.hLc),this.i3a=!1)}Apg(){this.i3a=!1;this.UPb(W=>{const aa=this.oWc!==W.GP,Y=this.iw!==W.iw,da=this.iw;this.Hgd(W);0!==this.hV&&(Y?(m.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",
da||"null",W.iw),this.ze.Ncb()):(this.ze.Dog(aa,Y),this.D_b()))},()=>{R.FrequentLoggingMetrics.instance&&R.FrequentLoggingMetrics.instance.Ws(2,3);this.D_b()},!0)}qtg(){this.Hoa=ba.o7c}YNf(){return new O.a(this.aha.Vcd,this.aha.Scd,this.aha.Rcd,this.aha.W4c)}uIg(W){if(Object.getType(W)!==Object)return null;for(let aa in W);return this.fsf(W)}fsf(W){if(!(w.vLa in W))return null;const aa=W[w.vLa];var Y=aa?this.E5e:this.D5e;for(const da of Y)if(!(da in W))return null;Y=Object.assign(new F,{kab:W[w.vLa],
errorMessage:W[w.errorMessage],correlationId:H.a.create().toString()});aa&&(Y.oMb=W[w.Epd],Y.GP=W[w.GP],Y.iw=W[w.iw],Y.W4c=W[w.V4c],Y.Rcd=W[w.Mta],Y.Scd=W[w.U8],Y.Vcd=W[w.Rta]);return Y}KIf(W,aa){m.ULS.sendTraceTag(50448152,500,50,"Using FindSessionUtils find session response");this.Nwa.Y2d.continueWith(()=>{this.Nwa.Y2d.result?(m.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),W(this.Nwa.Z2d)):(m.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),
aa(this.Nwa.Z2d))})}pld(W,aa,Y,da,ka=!1){return qa=>{E.a.instance.dNa(0,1);W&&W.stop();this.hFa=this.Tua=null;this.icd(qa.data,!0,aa);var ua=N.RtcUtils.deserialize(qa.data.Pe,"FindSession",null);if(ua)if(ua=this.uIg(ua)){if(ua.kab&&ua.GP&&ua.iw){m.ULS.sendTraceTag(4317446,500,50,"Successfully retrieved MachineId from server for [{0}]",this.Ck);this.f5f(qa.data);Y(ua);return}aa.FindSessionFailureReason="FindSessionInvalidResponse";aa.IsRtcEnabled=ua.kab;aa.IsQueryStringEmpty=!ua.GP;aa.IsConnectionStringEmpty=
!ua.iw;m.ULS.sendTraceTag(4290720,500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",this.Ck,ua.kab,!ua.GP,!ua.iw)}else aa.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",m.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.Ck);else aa.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",m.ULS.sendTraceTag(7372827,
500,10,"Could not deserialize response data for [{0}]",this.Ck);this.ojd(aa,ka);da(null)}}mld(W,aa,Y,da=!1){return ka=>{E.a.instance.dNa(0,1);W&&W.stop();this.hFa=this.Tua=null;this.icd(ka.data,!1,aa);let qa=null;var ua="unknown";let Pa="unknown";ka.data&&((ua=ka.data.wi)&&ba.uNa in ua&&(qa=ua[ba.uNa].toString()),ua=v.a[ka.data.status],Pa=ka.data.He.toString());aa.FindSessionFailureReason="FindSessionRequestFailed";aa.HttpErrorCode=Pa;aa.HttpErrorStatus=ua;aa[ba.uNa]=qa;m.ULS.sendTraceTag(4290721,
500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",ua,Pa,this.Ck,qa,da);this.ojd(aa,da);Y(Pa)}}UPb(W,aa,Y=!1){let da=null;m.ULS.sendTraceTag(4317445,500,50,"Getting MachineId from server for [{0}]",this.Ck);const ka={};var qa=this.zHc.generate();ka[T.a.q2]=H.a.create().toString();this.Tua&&""!==this.Tua?qa=String.format("{0}&{1}={2}",qa,V.a.SZb,this.Tua):this.hFa&&""!==this.hFa&&(qa=String.format("{0}&{1}={2}",qa,V.a.SZb,this.hFa),
ka[Q.nMg]="True",ka[Q.$0f]="True");qa=this.AHc+"?"+qa;Y&&(ka[U.KCf]=X.Qog);const ua={};ua.IsNetworkOfflineBeforeSendRequest=this.If.gta;ua.HasAvailableConnectionsBeforeSendRequest=this.If.E5c;ua.MaxConnectionsAllowed=this.If.BVb;ua.IsRefreshMachineId=Y;this.Nwa&&!this.BHc?(this.KIf(this.pld(null,ua,W,aa,Y),this.mld(null,ua,aa,Y)),this.BHc=!0):(this.ee&&(da=this.ee.Xf("WebServiceCall","GetMachineIdFromTheServer")),R.FrequentLoggingMetrics.instance&&R.FrequentLoggingMetrics.instance.Ws(2,0),0>this.If.x5a(qa,
1,null,ka,[ba.T6a,ba.uNa,ba.iMa,ba.RZb,ba.Hdd,ba.ved,ba.ued],1,this.pld(da,ua,W,aa,Y),this.mld(da,ua,aa,Y),null,!1,null,this.e8a,"3",null,!0)&&(5<this.LFa&&200>this.LFa&&m.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",this.LFa),window.setTimeout(()=>{this.LFa++;aa("-1")},1E3)))}icd(W,aa,Y){Y||(Y={});Y.IsNetworkOfflineAfterRequestComplete=this.If.gta;Y.IsRequestSucceeded=aa;W&&(Y.EnqueueTime=W.Tra,Y.InvokedTime=
W.jH,Y.CompletedTime=W.IO,W.wi&&(ba.T6a in W.wi&&(Y.CorrelationId=W.wi[ba.T6a]),ba.iMa in W.wi&&(Y[ba.iMa]=W.wi[ba.iMa])));m.ULS.sendTraceTag(38633565,500,aa?50:15,N.RtcUtils.Bma(Y))}ojd(W,aa){W||(W={});W.ConnectionState=l.a[this.hV];aa||this.ze.njd(1,W)}f5f(W){try{var aa=!1,Y=!1,da=W.wi,ka=x.a.nU(W.request.get_url());if(da&&ba.RZb in da){const Ca=da[ba.RZb].toString().toLocaleLowerCase();Y="true"===Ca;aa="false"===Ca}da=!1;const Ja=0<=ka.toLocaleLowerCase().indexOf("collab");Y&&!Ja?da=!0:aa&&Ja&&
(da=!0);if(da){aa={};aa.HostName=ka;aa.Status=v.a[W.status];aa.HttpStatus=W.He.toString();var qa=W.request.get_headers();for(let Ca in qa){var ua=qa[Ca];(ka=Ca)&&0<ka.length&&(Y=0,ua&&(Y=ua.toString().length),aa["r_"+ka]=Y)}if(W.wi){const Ca=new a.a;Ca.add(ba.T6a);Ca.add(ba.iMa);Ca.add(ba.uNa);Ca.add(ba.ved);Ca.add(ba.ued);Ca.add(ba.Hdd);ba.tef(aa,W.wi,Ca)}ba.oef(W.request.get_url(),aa);var Pa=D.a.toJSON(aa);m.ULS.sendTraceTag(559437006,500,15,Pa)}}catch(Ja){m.ULS.sendTraceTag(559437007,500,10,"DomainLandingIncorretDC exception[{0}]",
Ja.toString())}}static createInstance(W,aa,Y,da,ka,qa,ua,Pa,Ja,Ca,ra,Ea=null){return ba.zsf(W,aa,Y,da,ka,qa,ua,Pa,Ja,Ca,null,ra,Ea)}static zsf(W,aa,Y,da,ka,qa,ua,Pa,Ja,Ca,ra,Ea,xa=null){W=W||H.a.create().toString();W=new ba(W,aa,Y,da,ka,qa,ua,Pa,Ja,Ca,ra,Ea,xa);W.init();return W}static tef(W,aa,Y){for(let da of Y)da in aa&&(W[da]=aa[da])}static oef(W,aa){if(W){var Y=W.indexOf("?");if(-1!==Y)for(W=W.substr(Y+1).split("&"),Y=0;Y<W.length;++Y){var da=W[Y].split("=");if(2===da.length){const ka=da[0];
if(ka&&0<ka.length){let qa=0;if(da=da[1])qa=da.length;aa["q_"+ka]=qa}}}}}}ba.wKf=3E3;ba.n7f=3E5;ba.o7c=1E3;ba.T6a="X-CorrelationId";ba.LXd="corrid";ba.uNa="RtcErrorCode";ba.iMa="X-OfficeCluster";ba.RZb="X-NewEnv";ba.Hdd="X-MSEdge-Ref";ba.ued="X-OFFICEFD";ba.ved="X-OfficeFE";Object(I.a)(ba,"FindSessionStrategy",null,[1788])},2168:function(I,J,d){d.r(J);var m=d(2),f=d(0);class a{constructor(Aa,jb){this.Axa=null;this.Aga=()=>{a.TTh(this.Axa.pqb())&&(this.Axa.Xrg(this.Aga),this.bJk.IsRealCoauthSession=
!0)};this.uNc=Aa;this.bJk=jb}init(){this.uNc.continueWith(()=>{this.Axa=this.uNc.result;this.Axa.ycc(this.Aga)})}static TTh(Aa){let jb=null;for(const lc of Aa)if(lc)if(Aa=lc.isAnonymous||!lc.email?lc.clientId:lc.email.toUpperCase(),!jb)jb=Aa;else if(jb!==Aa)return!0;return!1}}Object(f.a)(a,"CoauthTelemetry",null,[783]);var l=d(8),w=d(342),z=d(80),x;(function(Aa){Aa[Aa.hVp=0]="badStatePreventedTelemetry";Aa[Aa.notImplemented=1]="notImplemented";Aa[Aa.njq=2]="renderHandled";Aa[Aa.ojq=3]="renderHandledWithVeto"})(x||
(x={}));Object(f.b)("CoauthorGalleryTelemetryEndResult",x);var u=d(85),v=d(81),D=d(138);class y{constructor(Aa,jb,lc,Nc,qd,Rd,Me,df,Cf){this.kzh=this.xbh=this.kF=null;this.Vne=()=>{this.Aga()};this.yeg=()=>{const sg=this.og.hv("AppInitStatus_interactivityReady");l.ULS.shipAssertTag(42259235,325,!!this.kOd);const lg=this.kOd-sg,Ia={};Ia.InteractiveTime=sg;Ia.ReactRenderComplete=this.kOd;Ia.HadTabSwitch=this.dCb();Ia.IsModernGallery=this.wRc;l.ULS.sendTraceTag(594883104,325,20,v.a.toJSON(Ia));this.wRc?
(l.ULS.sendTraceTag(42062997,325,15,lg.toString()),this.VMd.vV(this.EFp(lg)?3:2)):l.ULS.sendTraceTag(594883103,325,15,lg.toString())};this.k9=Aa;this.VMd=new w.a;this.Aa=lc;this.LMe=jb;this.Y0=Nc;this.og=qd;this.h3e=Rd;this.Zjb=Me;this.Vnk=df;this.Ikh=this.Ckh=!1;this.kOd=0;this.vbh=1;this.dCb=Cf;this.wRc=this.Aa.$("PeoplesWellExtraButtonInfoIsEnabled");this.jia=Object(z.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get OXj(){return this.VMd.task}init(){D.Task.WAA.call(null,
this.Zjb,this.LMe,this.h3e).continueWith(()=>{this.kF=this.Zjb.result;this.xbh=this.LMe.result;this.kzh=this.h3e.result;D.Task.WAA.call(null,this.LMe.result.Hec,this.h3e.result.G0j).continueWith(()=>{this.vbh=this.xbh.Hec.result;this.kOd=this.kzh.G0j.result;this.kF.ycc(this.Vne);this.kF.pqb().length&&this.Aga()})})}Aga(){this.Vnk(this.kF.pqb())?(this.kF.Xrg(this.Vne),this.tZn(this.Ckh)):this.VMd.vV(1);this.Ckh=!0}tZn(Aa){this.Ikh?this.OXj.continueWith(()=>{l.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",
x[this.OXj.result])}):(this.Ikh=!0,this.tjo(0===this.vbh&&!Aa))}tjo(Aa){Aa?this.Y0.Sk(4,this.yeg):this.VMd.vV(1)}EFp(Aa){const jb=Aa>this.Aa.jc("CoauthorGalleryTimeToRenderDurationMs",1E4);var lc="Word"===this.jia;const Nc="PowerPoint"===this.jia;if(this.dCb())return l.ULS.sendTraceTag(50455714,325,50,jb.toString()),!1;lc&&u.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",0,"wordcollabrel",null);jb&&(lc&&u.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded","CoauthorGalleryTimeToRenderDurationIsTooLong",
!1,!0,null),lc=m.AFrameworkApplication.J.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientCoauthorGalleryRenderLatencyQoSError"),Nc&&lc&&Aa<this.Aa.jc("CoauthorGalleryTimeToRenderCutoffThresholdMs",3E4)&&u.Health.instance.recordQosError("CoauthorGalleryTimeToRenderDurationIsTooLong",["CoauthGalleryExperienceDegraded"],!1,!0,!0,!1,null),l.ULS.sendTraceTag(42062998,325,15,Aa.toString()));return jb}}Object(f.a)(y,"CoauthorGalleryTelemetry",null,[782]);class H{constructor(Aa){this.kF=
null;this.Mxd={};this.dJd={};this.bJc=null;this.Aga=()=>{this.B8j()};this.Exl=(jb,lc)=>jb.tXa>lc.tXa?1:jb.tXa<lc.tXa?-1:0;this.Zjb=Aa}W7d(Aa){const jb=new w.a;this.init().continueWith(()=>{Aa in this.Mxd?jb.vV(this.Mxd[Aa]):this.dJd[Aa]=jb});return jb.task}init(){if(this.bJc)return this.bJc.task;this.bJc=new w.a;this.Zjb.continueWith(()=>{this.kF=this.Zjb.result;this.kF.ycc(this.Aga);this.B8j();this.bJc.gg(null)});return this.bJc.task}B8j(){const Aa=this.kF.pqb();Aa.sort(this.Exl);this.Mxd={};for(let jb=
0;jb<Aa.length&&Aa[jb]&&Aa[jb].tXa;jb++)this.ZYk(this.Mxd,Aa[jb].clientId,jb)}ZYk(Aa,jb,lc){Aa[jb]=lc;jb in this.dJd&&(this.dJd[jb].vV(lc),delete this.dJd[jb])}}Object(f.a)(H,"CoauthorPositionFinder",null,[781]);var F=d(604),G=d(280),K=d(524),R=d(71),E=d(118);class N{constructor(){this.jHa=null;this.eEc=Array(32)}xor(Aa){if(!Aa)throw Error.argumentNull("Guid argument cannot be null");const jb=new N,lc=new Sys.StringBuilder;for(let Nc=0;Nc<Aa.eEc.length;Nc++){const qd=this.eEc[Nc]^Aa.eEc[Nc];jb.eEc[Nc]=
qd;lc.append(qd.toString(16));7!==Nc&&11!==Nc&&15!==Nc&&19!==Nc||lc.append("-")}jb.jHa=E.a.Bf(lc.toString());return jb}toString(){return this.jHa.toString()}equals(Aa){if(!Aa)throw Error.argumentNull("Guid argument cannot be null");return this.jHa.equals(Aa.jHa)}static aqb(Aa){if(!Aa)throw Error.argumentNull("String input cannot be null");const jb=new N;jb.jHa=E.a.Bf(Aa);const lc=jb.jHa.toString();let Nc=0;for(let Rd=0;Rd<lc.length;Rd++){var qd=Aa.charAt(Rd);if(N.Aln(qd))qd=N.s0m(qd,Aa.charCodeAt(Rd)),
jb.eEc[Nc++]=qd;else if(!N.Xkn(qd))throw Error.argument("String contains characters not valid in Guids");}return jb}static Aln(Aa){return"0"<=Aa&&"9">=Aa||"A"<=Aa&&"F">=Aa||"a"<=Aa&&"f">=Aa}static Xkn(Aa){return"{"===Aa||"}"===Aa||"-"===Aa}static s0m(Aa,jb){if("0"<=Aa&&"9">=Aa)return jb-48;if("A"<=Aa&&"F">=Aa)return jb-65+10;if("a"<=Aa&&"f">=Aa)return jb-97+10;throw Error.argument("Char is not valid hex digit");}}Object(f.a)(N,"Guid",null,[]);class O{constructor(Aa,jb,lc,Nc){this.Axa=null;this.Qdh=
this.pvh=!1;this.ush=0;this.Aga=()=>{this.Sul(this.Axa.pqb())};this.uNc=Aa;this.L9e=jb;this.Aa=lc;this.f9b=Nc;this.nnk=m.AFrameworkApplication.J2b||m.AFrameworkApplication.Bta;this.Gth=new F.a(G.a.vh())}get muf(){return this.Aa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1)}init(){this.uNc.continueWith(()=>{this.Axa=this.uNc.result;this.Axa.ycc(this.Aga)})}Sul(Aa){var jb=0;const lc=new K.a(G.a.vh());for(const Nc of Aa)if(Nc&&Nc.isAnonymous){m.AFrameworkApplication.$c("70eb6120;2gfeb930");
if(lc.tb(Nc.userName))lc.K(Nc.userName).add(Nc.clientId);else{let qd;lc.add(Nc.userName,(qd=new R.a,qd.add(Nc.clientId),qd))}Nc.clientId!==this.f9b?(jb++,2<=jb&&!this.pvh&&this.dGn()):!this.Qdh&&this.muf&&"Guest"===Nc.userName&&(l.ULS.sendTraceTag(509726851,302,50,"User was assigned 'Guest' name"),this.Qdh=!0)}if(this.muf&&this.ush!==jb){l.ULS.sendTraceTag(512553562,302,50,"Total guests updated to: {0}",jb+(this.nnk?1:0));this.ush=jb;for(const Nc of lc.keys)2<=lc.K(Nc).count&&(Aa=this.Mqm(lc.K(Nc)),
this.Gth.contains(Aa)||(jb={},jb.guestsWithSameName=lc.K(Nc).count,jb.identifier=Aa,l.ULS.sendTraceTag(526394833,302,50,"Duplicate guest friendly name detected: {0}",jb),this.Gth.add(Aa)))}}dGn(){l.ULS.sendTraceTag(525112603,302,50,"Multiple guests simultaneously coauthoring");this.pvh=!0;this.muf&&this.L9e&&this.L9e.continueWith(()=>{window.setTimeout(()=>{this.L9e.result.logActivity("MultipleGuestsCoauthoring",null)},15E3)})}Mqm(Aa){if(!Aa||1>=Aa.count)return"";let jb=N.aqb(Aa.K(0));for(let lc=
1;lc<Aa.count;lc++)jb=jb.xor(N.aqb(Aa.K(lc)));return jb.toString()}}Object(f.a)(O,"GuestCoauthTelemetry",null,[]);var U=d(272);class X{constructor(){this.id=null;this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=!1}}Object(f.a)(X,"PL",null,[]);var V=d(29);class Q{constructor(){this.ct=this.vt=this.d=0}static XLj(Aa,jb,lc){const Nc=new Q;Nc.d=Aa;Nc.vt=jb;Nc.ct=lc;return V.c(Nc)}}Object(f.a)(Q,"VD",null,[]);var T=d(93);class ba{constructor(Aa,jb,lc,Nc,qd,Rd,Me,df,Cf){this.ki=0;this.ZDh=
!1;this._id=Aa;this.RFh=jb;this.qt=lc;this.p0e=Nc;this.y$e=qd;this.HJb=Rd;this.ZCb=Me;this.zqk=df;this.dCb=Cf;this.jia=Object(z.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}lBc(Aa){D.Task.WAA(this.RFh,this.p0e,this.y$e).continueWith(()=>{if(this.p0e.result<=this.y$e.result)Aa.vV(!1);else{this.ki=this.RFh.result;var jb=this.qt-this.ki,lc=new X;lc.id=this._id;lc.et=this.qt;lc.st=this.ki;lc.d=this.qt-this.ki;lc.mp=this.p0e.result;lc.tp=this.y$e.result;lc.ct=this.Tlm(this.zqk);
lc.vc=this.dCb();var Nc=V.c(lc),qd="Word"===this.jia,Rd="PowerPoint"===this.jia;l.ULS.sendTraceTag(42078597,302,15,Nc);if(qd){const Me=new Map;Me.set("data",Nc);u.Health.instance.recordKpiUsage("PresenceExperienceDegraded",0,"wordcollabrel",Me)}jb>this.HJb.value&&!this.ZDh&&!lc.vc&&(this.ZDh=!0,Aa.vV(!0),lc=Object.assign(new T.a,{inStaging:!0,extendedProperties:new Map}),lc.extendedProperties.set("data",Nc),qd&&u.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",
!1,!0,lc),jb<this.ZCb.value&&(l.ULS.sendTraceTag(42078598,302,15,Q.XLj(jb,this.HJb.value,this.ZCb.value)),jb=m.AFrameworkApplication.J.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientThumbnailPresenceRenderLatencyQoSError"),Rd&&jb&&(lc.inStaging=!1,u.Health.instance.recordQosError("PresenceRenderDurationIsTooLong",["PresenceExperienceDegraded"],!1,!0,!0,!1,lc))));Aa.task.isCompleted||Aa.vV(!1)}})}Tlm(Aa){switch(Aa){case 2:return"NonWac";case 0:return"Unknown";case 1:return"Wac";
default:return"Unknown"}}}Object(f.a)(ba,"PresenceLatencyActivityLogger",null,[]);class W{constructor(Aa,jb,lc){this.hah=this.tbh=this.qxd=this.Lxd=this.U3b=0;this._id=Aa;this.HJb=jb;this.ZCb=lc;this.jia=Object(z.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get CQh(){return this.U3b}set CQh(Aa){this.U3b=Aa;this.onf()}get G3h(){return this.Lxd}set G3h(Aa){this.Lxd=Aa;this.onf()}get x_h(){return this.qxd}set x_h(Aa){this.qxd=Aa;this.onf()}get H3h(){return 0!==this.tbh}get y_h(){return 0!==
this.hah}onf(){!this.H3h&&this.U3b&&this.Lxd&&(this.tbh=this.lBc(this.Lxd,"CoauthGalleryLightupDurationTooLong"));!this.y_h&&this.U3b&&this.qxd&&(this.hah=this.lBc(this.qxd,"CanvasPresenceLightupDurationTooLong"))}lBc(Aa,jb){const lc=Aa-this.U3b;var Nc=new X;Nc.id=this._id;Nc.et=Aa;Nc.st=this.U3b;Nc.d=lc;var qd=V.c(Nc);Aa="Word"===this.jia;Nc="CanvasPresenceLightupDurationTooLong"===jb?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";"CanvasPresenceLightupDurationTooLong"===jb?l.ULS.sendTraceTag(572289499,
302,15,qd):l.ULS.sendTraceTag(571524118,302,15,qd);if(Aa){var Rd=new Map;Rd.set("data",qd);u.Health.instance.recordKpiUsage(Nc,0,"wordcollabrel",Rd)}return lc>this.HJb.value?(Rd=Object.assign(new T.a,{inStaging:!0,extendedProperties:new Map}),Rd.extendedProperties.set("data",qd),qd=lc<this.ZCb.value,Rd.extendedProperties.set("cash",qd?"true":"false"),Aa&&u.Health.instance.recordKpiFailure(Nc,jb,!1,!0,Rd),l.ULS.sendTraceTag(572289500,302,15,Q.XLj(lc,this.HJb.value,this.ZCb.value)),qd?2:1):3}}Object(f.a)(W,
"PresenceLightupLatencyLogger",null,[]);class aa{constructor(Aa,jb,lc,Nc,qd,Rd,Me,df=null,Cf=null,sg=null){this.mAh={};this.KMe={};this.Xqh=new R.a;this.Xwd=this.cJc=this.kF=this.ei=null;this.QFh=this.PFh=0;this.v3n=(lg,Ia)=>{if(!this.i$g&&2===Ia.newState){var Zb=this.cAi();Zb.continueWith(()=>{var Qc=Zb.result;Qc=Date.now()-Qc;const ed={};ed.clientId=this.Sfj;ed.bootTime=Qc;this.i$g=!0;this.ei.oC(15,ed)})}};this.uXn=(lg,Ia)=>{if(15===Ia.type){lg=Date.now();Ia=Ia.jA;var Zb=Ia.bootTime;this.eKf(Ia.clientId).CQh=
lg-Zb}};this.Vne=()=>{this.Aga()};this.HJb=new U.a(()=>df.N2("PresenceBootLatencyThreshold",1E4));this.ZCb=new U.a(()=>df.N2("PresenceBootLatencyCutoffThreshold",6E4));this.ASk=new U.a(()=>df.N2("PresenceLightupLatencyThreshold",2E3));this.Hsk=new U.a(()=>df.N2("PresenceLightupLatencyCutoffThreshold",1E4));this.Y0=Nc;this.jJk=qd;this.wbh=Aa;this.OCh=jb;this.Zjb=lc;this.og=Rd;this.f9b=Cf;this.dCb=Me;this.Okh=sg;this.i$g=!1;this.init()}k_c(Aa,jb,lc=null,Nc=0){lc&&(l.ULS.shipAssertTag(42274970,302,!this.f9b||
this.f9b===lc,"_myClientId is already set and you are trying to update it to something different"),this.f9b=lc);const qd=new w.a;this.init().continueWith(()=>{this.f2n(Aa);this.I0l(qd,Aa,jb,Nc)})}get Sfj(){return this.f9b||"{"+m.AFrameworkApplication.userSessionId+"}"}init(){if(this.cJc)return this.cJc.task;this.cJc=new w.a;this.dCb()&&l.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session");this.wbh.continueWith(()=>{const Aa=this.wbh.result,jb=Aa.Hec,lc=Aa.ePn;lc.continueWith(()=>{jb.continueWith(()=>
{this.Okh&&this.Okh.addQosPillar("RealTimeCoauth");this.VDg(jb.result,lc.result);this.cJc.gg(null)})})});this.OCh.continueWith(()=>{this.ei=this.OCh.result;this.ei.QZ(this.v3n);this.ei.AO(this.uXn)});this.Zjb.continueWith(()=>{this.kF=this.Zjb.result;this.kF.ycc(this.Vne);0<this.kF.pqb().length&&this.Aga()});return this.cJc.task}cAi(){this.Xwd||(this.Xwd=new w.a,this.Y0.Sk(4,()=>{this.Xwd.vV(this.og.hv("AppInitStatus_interactivityReady"))}));return this.Xwd.task}Aga(){const Aa=Date.now();var jb=this.kF.pqb();
const lc=new R.a;for(const Nc of jb)this.Xqh.contains(Nc.clientId)||(this.Xqh.add(Nc.clientId),lc.add(Nc.clientId));if(0<lc.count)for(const Nc of lc)jb=this.eKf(Nc),jb.H3h||(jb.G3h=Aa)}f2n(Aa){Aa=this.eKf(Aa);Aa.y_h||(Aa.x_h=Date.now())}eKf(Aa){return Aa in this.KMe?this.KMe[Aa]:this.KMe[Aa]=new W(Aa,this.ASk,this.Hsk)}VDg(Aa,jb=0){this.PFh=Aa;this.QFh=jb?jb:(new Date).getTime()}I0l(Aa,jb,lc,Nc){lc=lc?lc.getTime():(new Date).getTime();jb in this.mAh?Aa.Una():(Nc=new ba(jb,this.YLm(),lc,this.W7d(this.Sfj),
this.W7d(jb),this.HJb,this.ZCb,Nc,this.dCb),this.mAh[jb]=Nc,Nc.lBc(Aa))}YLm(){return 1===this.PFh?D.Task.a7(this.QFh):this.cAi()}W7d(Aa){return this.jJk.W7d(Aa)}}Object(f.a)(aa,"PresenceBootTelemetry",null,[780]);var Y=d(127),da=d(178),ka=d(38),qa=d(169),ua=d(156),Pa=d(19),Ja=d(546);class Ca{get name(){return"Common.App.CoauthTelemetry"}wc(Aa){Aa.register(a,"Common.App.CoauthTelemetry.CoauthTelemetry").as("Common.App.CoauthTelemetry.ICoauthTelemetry").ha().Ud(()=>new a(Ja.a.sq(Aa.Ta("Common.IPeopleInfoProvider")),
m.AFrameworkApplication.fh));Aa.register(y,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as("Common.ICoauthorGalleryTelemetry").ha().Ud(()=>new y(m.AFrameworkApplication.va,Ja.a.sq(Aa.Ta("Common.ICoauthoringTelemeryInfoProvider")),m.AFrameworkApplication.J,Y.a.get_instance(),qa.a.instance,Ja.a.sq(Aa.Ta("Common.IPeoplesWell")),Ja.a.sq(Aa.Ta("Common.IPeopleInfoProvider")),a.TTh,()=>this.kXh()));Aa.register(aa,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as("Common.App.CoauthTelemetry.IPresenceBootTelemetry").ha().Ud(()=>
new aa(Ja.a.sq(Aa.Ta("Common.ICoauthoringTelemeryInfoProvider")),Ja.a.sq(Aa.Ta("Common.IRealtimeChannelBasic")),Ja.a.sq(Aa.Ta("Common.IPeopleInfoProvider")),Y.a.get_instance(),Aa.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"),qa.a.instance,()=>this.kXh(),m.AFrameworkApplication.J,null,u.Health.instance));Aa.register(H,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as("Common.App.CoauthTelemetry.ICoauthorPositionFinder").ha().Ud(()=>new H(Ja.a.sq(Aa.Ta("Common.IPeopleInfoProvider"))));
Aa.register(O,"Common.App.CoauthTelemetry.GuestCoauthTelemetry").ha().Ud(()=>new O(Ja.a.sq(Aa.Ta("Common.IPeopleInfoProvider")),Ja.a.sq(Aa.Ta("Common.ISystemInitiatedFeedback")),m.AFrameworkApplication.J,"{"+m.AFrameworkApplication.userSessionId+"}"))}init(){m.AFrameworkApplication.J.vp(()=>{Pa.a.instance.resolve("Common.App.CoauthTelemetry.CoauthTelemetry").init();Pa.a.instance.resolve("Common.App.CoauthTelemetry.GuestCoauthTelemetry").init();m.AFrameworkApplication.J.$("CoauthorGalleryTelemetryIsEnabled")&&
Pa.a.instance.resolve("Common.ICoauthorGalleryTelemetry").init();m.AFrameworkApplication.J.$("CashTelemetryIsEnabled")&&(Pa.a.instance.resolve("Common.App.CoauthTelemetry.IPresenceBootTelemetry"),Pa.a.instance.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"))})}dispose(){}kXh(){return ua.a.tLb&&qa.a.instance.HJ(ka.a.Btd)?0<qa.a.instance.hv(ka.a.Btd)[ka.a.Iak]:!1}static main(){da.a.instance.Mc(new Ca)}}Object(f.a)(Ca,"CoauthTelemetryPackage",null,[0,1]);class ra extends Sys.EventArgs{constructor(){super()}}
Object(f.a)(ra,"RtcHostNotificationEventArgs",Sys.EventArgs,[]);var Ea;(function(Aa){Aa[Aa.Meq=0]="notYetStarted";Aa[Aa.Chq=1]="polling";Aa[Aa.foq=2]="subscribed";Aa[Aa.UVh=3]="blocked";Aa[Aa.qhq=4]="permanentlyStopped"})(Ea||(Ea={}));Object(f.b)("RtcHostNotificationSubscriptionState",Ea);var xa=d(91),Ma=d(1308),ha=d(86);class la{constructor(Aa,jb,lc,Nc,qd,Rd,Me,df,Cf){this.ji=!1;this.Wda=this.b$b=this.Cja=this.i4a=null;this.Jwg=()=>{this.i4a=null;if(this.E1i){l.ULS.sendTraceTag(573100181,502,50,
"HostNotifications: Send event when connected.  Current state: {0}",Ea[this.Dyc]);let sg=null;this.m6e&&this.m6e.length&&(sg={},sg.etts=this.m6e);this.b$b.oC(14,sg,!0);this.NJj(this.XLk)}else this.dlb.event(3)};this.Gop=()=>{this.Cja=null;2===this.Dyc&&(this.dlb.event(1),l.ULS.shipAssertTag(573100185,502,!!this.i4a,"Missing task to ensure that we re-subscribe."))};this.Lma=()=>{this.PUm()};this.dS=(sg,lg)=>{if(13===lg.type&&(sg=lg.jA,l.ULS.sendTraceTag(573100183,502,50,"HostNotifications: Subscription status: {0}",
{["SerializableHostNotificationSubscription"]:sg,["DurationBeforeExpirationToResubscribeInSec"]:this.lLd}),lg=sg.cts,!this.Brp(lg))){if(sg.sb){var Ia=2;this.ZMo(sg.cts)}else Ia=1,this.nQc=la.JIe,this.Cja&&(this.Jb.wf(this.Cja),this.Cja=null);this.dlb.event(Ia);this.i4a?this.Jb.Z3(this.i4a,1E3*lg):this.NJj(lg)}};this.w4n=(sg,lg)=>{sg=lg.newState;const Ia=lg.jlg,Zb={};Zb.NewState=Ea[sg];Zb.PreviousState=Ea[Ia];Zb.PreviousStateHits=lg.klg;Zb.PreviousStateTransitionTime=lg.llg.toISOString();Zb.IsSubscribed=
this.g2i;this.nQc!==la.JIe&&(Zb.SubscriptionExpiringTime=this.nQc.toISOString());l.ULS.sendTraceTag(572346515,502,4===sg?15:50,"HostNotificationChanged: {0}",Zb);this.sa.raiseEvent("HN",new ra(Ia,sg))};this.nQc=la.JIe;this.sa=new ha.a;this.dlb=new Ma.a(0);this.dlb.Mff(this.w4n);this.XLk=Aa;this.lLd=jb;this.WLk=lc;this.m6e=Nc;this.Jb=qd;this.lf=Rd;Me.execute(sg=>{this.ji||(this.b$b=sg,this.b$b.AO(this.dS),this.start())});df.execute(sg=>{this.ji||(this.Wda=sg,sg.gTa(this.Lma))});this.hOd=Cf}get Dyc(){return this.dlb.currentState}get E1i(){return!this.lf||
this.lf.XBa}get g2i(){return 2===this.Dyc&&this.hOd()<this.nQc}start(){0!==this.Dyc?l.ULS.sendTraceTag(573100178,502,15,"HostNotifications: Tried starting poll when in state {0}",Ea[this.Dyc]):(this.dlb.event(1),this.Jwg(null))}NJj(Aa){this.i4a=xa.a.paa(1E3*Aa,this.Jwg,this.lLd,192,"RtcHostNotificationSubscribe");this.Jb.$b(this.i4a)}ZMo(Aa){Aa=1E3*(Aa+this.WLk);const jb=this.hOd().getTime()+Aa;this.nQc=new Date(jb);Aa-=this.lLd;this.Cja?this.Jb.Z3(this.Cja,Aa):(this.Cja=xa.a.paa(Aa,this.Gop,this.lLd/
2,194,"RtcHostNotificationTransitionToPolling"),this.Jb.$b(this.Cja))}PUm(){3===this.Dyc&&this.E1i&&(this.dlb.event(this.g2i?2:1),this.Jwg(null))}Brp(Aa){if(!isNaN(Aa)&&isFinite(Aa)&&0<Aa)return!1;this.cYj(!1);return!0}cYj(Aa){this.i4a&&(this.Jb.wf(this.i4a),this.i4a=null);this.Cja&&(this.Jb.wf(this.Cja),this.Cja=null);this.b$b&&(this.b$b.sDa(this.dS),this.b$b=null);this.Wda&&(this.Wda.mZb(this.Lma),this.Wda=null);Aa||this.dlb.event(4)}dispose(){this.ji||(this.ji=!0,this.cYj(!0),this.Cja&&(this.Jb.wf(this.Cja),
this.Cja=null))}}la.JIe=new Date(0);Object(f.a)(la,"RtcHostNotificationSubscriptionManager",null,[778,10]);var Fa=d(479);class Ga{constructor(){this.vi=this.ji=!1}get name(){return"RtcHostNotificationSubscription"}wc(Aa){Aa.register(la,"Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").as("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager").ha().Ud(()=>{const jb=m.AFrameworkApplication.J;return new la(jb.jc("RtcHostNotificationRetryIntervalIdeallyInSeconds",
1800),jb.jc("RtcHostNotificationRetryIntervalBufferInSeconds",120),jb.jc("RtcHostNotificationSubscriptionLostBufferInSeconds",60),this.EJm(jb),m.AFrameworkApplication.pc,Fa.SessionStatusManager.instance,Aa.Ta("Common.IRealtimeChannelBasic"),Aa.Ta("Common.ISessionExpirationManager"),()=>new Date)})}init(){m.AFrameworkApplication.J.vp(()=>{!this.ji&&m.AFrameworkApplication.J.$("RtcHostNotificationEnabled")&&(this.vi=!0,Pa.a.instance.resolve("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager"))})}dispose(){this.ji||
(this.ji=!0,this.vi&&Pa.a.instance.resolve("Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").dispose())}EJm(Aa){return Aa.my("RtcEventTypesToSubscribe")?Aa.hD("RtcEventTypesToSubscribe"):null}static main(){da.a.instance.Mc(new Ga)}}Object(f.a)(Ga,"RtcHostNotificationSubscriptionPackage",null,[0,1]);var va=d(489),pa=d(656);class Oa{constructor(Aa,jb,lc,Nc,qd,Rd,Me,df,Cf,sg,lg){this.clientId=Aa;this.SkypeChatThreadId=lc;this.chatThreadDiscoveryUri=Nc;this.inChat=qd;
this.localColbaltSessionId=jb;this.capabilities=Rd;this.email=Me;this.isReadOnly=df;this.userName=Cf;this.isAnonymous=sg;this.presenceStatus=lg}}Object(f.a)(Oa,"SerializablePresenceUserData",null,[]);class Ra extends va.a{constructor(Aa,jb,lc,Nc,qd=null,Rd=null,Me=null,df=null,Cf=null,sg=!1,lg=!1,Ia=!1,Zb=null){super(Aa,jb,lc,Nc,Rd,Me,df,Cf,sg,lg,Ia);this.WF=qd;this.presenceStatus=Zb}getData(){return new Oa(this.clientId,this.WF,this.XUc,this.chatThreadDiscoveryUri,this.inChat,this.capabilities.capabilities,
this.email,this.isReadOnly,this.userName,this.isAnonymous,this.presenceStatus)}X7d(Aa){return(Aa=Aa.value)?Aa.user:null}clone(){return new Ra(this.clientId,this.userName,this.color,this.capabilities.clone(),this.WF,this.XUc,this.email,this.client,this.chatThreadDiscoveryUri,this.isAnonymous,this.inChat,this.isReadOnly,this.presenceStatus)}static LMb(Aa){return Aa.clientId?new Ra(Aa.clientId,Aa.userName,null,new pa.a(void 0===Aa.capabilities?0:Aa.capabilities),Aa.localColbaltSessionId,Aa.SkypeChatThreadId,
Aa.email,null,Aa.chatThreadDiscoveryUri,Aa.isAnonymous,Aa.inChat,Aa.isReadOnly,Aa.presenceStatus):null}static W9h(Aa,jb,lc,Nc=null,qd=null,Rd=null,Me=null,df=null,Cf=!1,sg=!1,lg=!1,Ia=null){return Aa?new Ra(Aa,jb,null,new pa.a(void 0===lc?0:lc),Nc,qd,Rd,Me,df,lg,Cf,sg,Ia):null}}Object(f.a)(Ra,"PresenceUser",va.a,[1551,1552,745]);class fb extends Ra{constructor(){super();this.auc=this.M4f=null}aBm(){const Aa=m.AFrameworkApplication.userName,jb=m.AFrameworkApplication.J.jb("UserPrincipalName"),lc=this.M4f?
this.M4f.WF:null,Nc=m.AFrameworkApplication.J2b||m.AFrameworkApplication.Bta,qd=this.auc?this.auc.getStatus():null;return new Ra(this.clientId,Aa,this.color,this.capabilities,lc,this.XUc,jb,this.client,this.chatThreadDiscoveryUri,Nc,this.inChat,this.isReadOnly,qd)}}Object(f.a)(fb,"MyPresenceUser",Ra,[1553,745]);var qb=d(20),mb=d(66),eb=d(1033);class bb{constructor(Aa,jb,lc,Nc,qd){this.Oe=Aa;this._clientId=jb;this.Itk=qd;this.Gxk=lc||(()=>null);this.Hxk=Nc||(()=>null)}get id(){return this.Oe.id}get bQd(){return this.Oe.bQd}get fQd(){return this.Oe.fQd}get eQd(){return this.Oe.eQd}get dQd(){return this.Oe.dQd}get cQd(){return this.Oe.cQd}get hQd(){return this.Oe.hQd}get Qcf(){return this.Oe.Qcf}get ayc(){return this.Oe.ayc}get Nze(){return this.Oe.Nze}get fke(){return this.Oe.fke}get clientId(){return this._clientId}get elc(){return this.Gxk}get LVa(){return this.Hxk}get WVl(){return this.Itk}static createInstance(Aa,
jb,lc,Nc,qd=!1){return new bb(Aa,jb,lc,Nc,qd)}}Object(f.a)(bb,"PeoplesWellSettings",null,[]);var Wa=d(109),Za=d(574),Na=d(83),Db=d(207),nb=d(114),Ta=d(208),cb=d(228),sb=d(421),pb=d(348);class tb extends Ta.a{constructor(){super();this.JoinTimeInMS=0;this.IsAnonymous=!1;this.ImageUrl=null;this.CanJump=this.ActiveStatus=!1;this.Upn=null}get ControlType(){return 5}}Object(f.a)(tb,"PeopleButtonProps",Ta.a,[]);var wb=d(492),gc=d(16),vc=d(95);class Pc{constructor(Aa){this.Ctd=new vc.a;this.kuf=null;this.clientId=
Aa}o0o(Aa){this.Qyo();this.CTo(Aa);for(const jb of Aa)jb.clientId!==this.clientId&&this.JOh(jb)}get VLg(){const Aa=[];for(const jb of this.Ctd.values){const lc=this.GKj(jb);Array.add(Aa,lc)}return Aa}get Fvb(){return this.Ctd.count}Ref(Aa,jb){Aa=Aa.toUpperCase();let lc;({value:lc}=this.Ctd.Ec(Aa)).returnValue||(lc=[],this.Ctd.W(Aa,lc));Array.add(lc,jb)}Qyo(){this.Ctd=new vc.a}CTo(Aa){for(const jb of Aa)if(jb.clientId===this.clientId){this.kuf=jb;break}}}Object(f.a)(Pc,"UserTracker",null,[1905]);class ld extends Pc{constructor(Aa,
jb){super(Aa);this.Ixk=jb}JOh(Aa){Aa.isAnonymous||!Aa.email?this.Ref(Aa.clientId,Aa):this.kuf&&G.a.vh().equals(this.kuf.email,Aa.email)||this.Ref(Aa.email,Aa)}GKj(Aa){let jb=new Date(0),lc=0<Aa.length?Aa[0]:null;for(const Nc of Aa)(Aa=this.Ixk(Nc.clientId))&&jb.getTime()<Aa.Ypc.getTime()&&(jb=Aa.Ypc,lc=Nc);return lc}}Object(f.a)(ld,"UniqueUserTracker",Pc,[]);class Dc extends Pc{constructor(Aa){super(Aa)}JOh(Aa){this.Ref(Aa.clientId,Aa)}GKj(Aa){return Aa[0]}}Object(f.a)(Dc,"UserInstanceTracker",Pc,
[]);const ic=(Aa,jb,lc)=>lc?new ld(Aa,jb):new Dc(Aa);var mc=d(87),Rc=d(1273),rb=d(12);class Cb{constructor(Aa,jb=null,lc=null){this.kF=null;this.F$e=new w.a;this.vXn=(Nc,qd,Rd,Me,df)=>{this.F$e.vV(df.RenderTime);return 32};this.Oe=Aa;this.rpe=jb;lc&&lc.continueWith(()=>{this.kF=lc.result;this.kF.ycc(Object(Wa.a)(this,this.Aga,"onUsersUpdated"));this.Zse()});new va.a(this.settings.clientId,"Anonymous user","#cccccc",new pa.a(7));this.gYf=this.TXe=!0;this.DTe=this.g3e=!1;this.EEa=ic(this.settings.clientId,
this.settings.LVa,Aa.WVl)}get settings(){return this.Oe}get Wgn(){return m.AFrameworkApplication.J?m.AFrameworkApplication.J.$("ColorPresenceHashIsEnabled"):!1}get Sgn(){return m.AFrameworkApplication.J?m.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled"):!1}Tnm(){let Aa,jb,lc,Nc;var qd=this.Unm();this.EEa.Fvb?1===this.EEa.Fvb?(Aa=!0,jb=this.settings.ayc.cluster,lc=this.settings.ayc.KYd,Nc=this.EEa.VLg[0].color):(Aa=!0,jb=this.settings.fke.cluster,lc=this.settings.fke.KYd,Nc=""):(Aa=
!1,Nc=lc=jb="");const Rd=qd[0];qd=qd.slice(1);return{N7n:Rd,O7n:qd,J7n:Aa,Igq:jb,L7n:lc,K7n:Nc}}Unm(){if(2<=this.EEa.Fvb)return[String.format(CommonUIStrings.l_PeoplesWellStateNumberOfOtherPeopleEditingHere,this.EEa.Fvb)];if(1===this.EEa.Fvb){const Aa=this.EEa.VLg[0],jb=this.settings.LVa(Aa.clientId);return jb&&2===jb.status?[CommonUIStrings.l_PeoplesWellStateUserIsInactive,Aa.userName]:[Aa.isReadOnly?CommonUIStrings.l_PeoplesWellStateUserIsAlsoViewing:CommonUIStrings.l_PeoplesWellStateUserIsAlsoEditing,
Aa.userName]}return[CommonUIStrings.l_PeoplesWellStateYouAreAllByYourself]}PQm(Aa){return this.QQm(Aa)}ZZh(Aa,jb,lc){return jb?this.Hll(jb)?(Aa=this.settings.LVa(Aa))&&2===Aa.status?!1:!0:(lc&&l.ULS.sendTraceTag(4482394,325,50,"User has presence data but app can't use it"),!1):(lc&&l.ULS.sendTraceTag(4482393,325,50,"User does not have any presence data"),!1)}eMm(Aa){return Aa.isReadOnly?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOffline:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}QQm(Aa){var jb,
lc;if(!Aa.capabilities.vKa(1))return this.eMm(Aa);const Nc=Aa.isReadOnly,qd=this.settings.LVa(Aa.clientId);Aa=this.settings.elc(Aa.clientId);if(!qd)return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;switch(qd.status){case 1:if(!Aa)return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;if(m.AFrameworkApplication.J.isChangeGateEnabled("OfficeVSO:8350444_RealTimeViewPresenceState")){if(1!==(null===(lc=null===(jb=null===m.AFrameworkApplication||void 0===m.AFrameworkApplication?void 0:
m.AFrameworkApplication.ua)||void 0===jb?void 0:jb.Gb)||void 0===lc?void 0:lc.Mk)&&Nc)return CommonUIStrings.l_PeoplesWellUserStatusIsViewingOnline}else if(Nc)return CommonUIStrings.l_PeoplesWellUserStatusIsViewingOnline;return this.cCl(Aa)||CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;case 2:return CommonUIStrings.l_PeoplesWellUserStatusIsInactive;default:return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}}rwm(Aa){if(this.rpe.oad)return this.rpe.aNb(Aa.email,"O365",m.AFrameworkApplication.rm,
0)}CQm(Aa){Aa=this.settings.LVa(Aa.clientId);return!Aa||Aa&&1===Aa.status?!0:!1}FQm(Aa){var jb=String.format("buttonPeoplesWellUser-{0}",Aa.clientId),lc=Aa.clientId,Nc=this.PQm(Aa);const qd=Aa.userName,Rd=Aa.color;var Me=Object,df=Me.assign,Cf=new tb,sg=this.settings.hQd.toString(),lg=this.settings.Nze.cluster,Ia=this.settings.Nze.KYd,Zb=this.Qwi(),Qc=Aa.isAnonymous,ed;if(ed=[qd],ed.length){var Pd=new Sys.StringBuilder("STRARRY@");for(const hb of ed)Pd.append(hb?hb.length:0),Pd.append(","),Pd.append(hb),
Pd.append(",");ed=Pd.toString().slice(0,-1)}else ed=null;jb=df.call(Me,Cf,{Id:jb,Command:sg,LabelText:"{0}",Image32by32:lg,Image32by32Class:Ia,MenuItemId:lc,CommandValueId:lc,Alt:qd,DisplayMode:Zb,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word",Description:Nc,ImageBackColor:Rd,IsAnonymous:Qc,LabelTextUserGeneratedPlaceholderReplacements:ed,Upn:Aa.email});m.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled")&&this.rpe&&(lc=this.rwm(Aa),
Nc=this.CQm(Aa),jb.ImageUrl=lc,jb.ActiveStatus=Nc,jb.JoinTimeInMS=Aa.tXa,Aa=this.ZZh(Aa.clientId,this.settings.elc(Aa.clientId),!1),jb.CanJump=Aa,""===lc&&l.ULS.sendTraceTag(40969413,302,50,"ImageURL collection failed"));return jb}Eum(){return Object.assign(new Ta.a,{Id:"BasicChat",Command:"2288458806",LabelText:CommonUIStrings.l_StartGroupChat,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word"})}Qwi(){return this.Wgn?"Initials":"Menu32"}GQm(Aa){const jb=
[];for(const lc of Aa)Aa=this.FQm(lc),Array.add(jb,Aa);return jb}cde(){return 0<this.EEa.Fvb}Fmo(Aa){if(!this.TXe)return!0;this.gYf||(Aa[Rc.a.Visible]=!0);const {N7n:jb,O7n:lc,J7n:Nc,L7n:qd,K7n:Rd}=this.Tnm();Aa[Rc.a.LabelText]=jb;lc&&lc.length&&(Aa[Rc.a.LabelTextUserGeneratedPlaceholderReplacements]=lc);Aa[Rc.a.ImageIsVisible]=Nc;Aa[Rc.a.Image16by16Class]=qd;Aa[Rc.a.ImageBackColor]=Rd;this.TXe=!1;return!0}Qdo(Aa){if(0>=this.EEa.Fvb)return!1;var jb=this.pbp(this.EEa.VLg),lc=this.GQm(jb);jb=Object.assign(new sb.a,
{Id:"menuCoauthors",MaxWidth:"220px",MenuSectionList:[]});lc=Object.assign(new pb.a,{Id:"msCoauthors",ControlsId:"msCoauthorsControls",DisplayMode:this.Qwi(),ControlList:lc});m.AFrameworkApplication.J.$("WordEditorDisplayPeoplesWellLabelIsEnabled")&&this.rpe&&(lc.Title=CommonUIStrings.l_PeoplesWellFlyoutLabel,lc.TitleId="menuCoauthorsTitle",lc.Theme="Light");Array.add(jb.MenuSectionList,lc);m.AFrameworkApplication.J.$("DocChatIsEnabled")&&m.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled")&&
m.AFrameworkApplication.ua&&m.AFrameworkApplication.ua.Gb.Bs&&(lc=[],Array.add(lc,this.Eum()),lc=Object.assign(new pb.a,{Id:"msGroupChat",ControlsId:"msGroupChatControl",ControlList:lc}),Array.add(jb.MenuSectionList,lc));m.AFrameworkApplication.ua&&m.AFrameworkApplication.ua.Gb.Bs?Aa.MenuItems=jb:Aa.PopulationXML=cb.o(jb);return!0}SLg(Aa){l.ULS.sendTraceTag(4482395,325,50,"PeoplesWell: Received user button click");Aa=Aa.MenuItemId;if(!Aa)return!1;const jb=this.settings.elc(Aa);if(!this.ZZh(Aa,jb,
!0))return!1;this.Uwn(jb);return!0}kto(){const Aa=this.Ihm();this.EEa.o0o(Aa);this.gYf&&1<=this.EEa.Fvb&&(l.ULS.sendTraceTag(6092429,325,50,"PeoplesWell: User is no longer forever alone."),this.gYf=!1);this.TXe=!0}Aga(){this.DTe||(window.setTimeout(()=>{this.Zse();this.DTe=!1},3E3),this.DTe=!0)}Ihm(){let Aa;Aa=this.Hhm()||[];for(const jb of Aa)this.zLo(jb);return Aa}zLo(Aa){Aa.clientId||(Aa.clientId=E.a.create().toString());Aa.userName||(Aa.userName="Anonymous user");Aa.capabilities||(Aa.capabilities=
new pa.a);Aa.color||(Aa.color="#cccccc");Aa.tXa||(Aa.tXa=0)}pbp(Aa){const jb=[];Array.addRange(jb,Aa);jb.sort(Cb.t7n);return jb}Owo(){m.AFrameworkApplication.J.$("CoauthorGalleryTelemetryIsEnabled")&&!this.g3e&&(m.AFrameworkApplication.va.t_(rb.a.R3h)&&wb.a.isSharedUxGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DoNotRegisterCoauthorsRenderedMultiplTimes")||m.AFrameworkApplication.va.fb(rb.a.R3h,mc.a.frame,this.vXn,96));this.Pwo();this.g3e=!0;this.Zse()}get G0j(){return this.F$e.task}Zse(){if(!this.g3e&&
(this.F$e.vV((new Date).getTime()),l.ULS.sendTraceTag(42567504,325,50,"We are trying to render the coauthor gallery before we are ready to record the render time"),this.Sgn))return;this.kto();this.lto()}dispose(){this.kF&&(this.kF.Xrg(Object(Wa.a)(this,this.Aga,"onUsersUpdated")),this.kF=null)}static t7n(Aa,jb){return Aa.capabilities.vKa(1)&&jb.capabilities.vKa(1)||!Aa.capabilities.vKa(1)&&!jb.capabilities.vKa(1)?gc.a.localeCompare(Aa.userName,jb.userName):Aa.capabilities.vKa(1)?-1:1}}Object(f.a)(Cb,
"APeoplesWell",null,[1857,10]);var Kb=d(11);const $b=()=>!0;class ab extends Cb{constructor(Aa,jb,lc=null,Nc=null){super(Aa,lc,Nc);this.Jhn=(qd,Rd,Me,df,Cf)=>this.K9a(Me,Cf,()=>this.cde(),$b);this.Gmo=(qd,Rd,Me,df,Cf)=>this.K9a(Me,Cf,sg=>this.Fmo(sg),$b);this.Rdo=(qd,Rd,Me,df,Cf)=>this.K9a(Me,Cf,$b,sg=>this.Qdo(sg));this.Ovl=(qd,Rd,Me,df,Cf)=>this.K9a(Me,Cf,$b,$b);this.Nvl=(qd,Rd,Me,df,Cf)=>this.K9a(Me,Cf,$b,$b);this.CDp=(qd,Rd,Me,df,Cf)=>this.K9a(Me,Cf,$b,sg=>this.SLg(sg));this.tbo=(qd,Rd,Me,df,
Cf)=>this.K9a(Me,Cf,$b,()=>{this.Zse();return!0});this.ga=jb}K9a(Aa,jb,lc,Nc){let qd=!1;switch(Aa){case 1:qd=lc(jb);break;case 2:qd=Nc(jb)}return qd?32:8}Pwo(){this.ga.qa(this.settings.bQd,Kb.a.application,this.Jhn);this.ga.fb(this.settings.fQd,Kb.a.application,this.Gmo,96);this.ga.fb(this.settings.dQd,Kb.a.application,this.Ovl,96);this.ga.fb(this.settings.cQd,Kb.a.application,this.Nvl,96);this.ga.fb(this.settings.eQd,Kb.a.application,this.Rdo,96);this.ga.qa(this.settings.hQd,Kb.a.application,this.CDp);
this.ga.fb(this.settings.Qcf,Kb.a.application,this.tbo,96)}}Object(f.a)(ab,"ABox4PeoplesWell",Cb,[]);var ia=d(3),La=d(131),Mb=d(50),Ha=d(7),zb=d(26),ac=d(165);class nc{static isSupported(Aa){for(let jb=0;jb<nc.gZj.length;jb++)if(Aa===nc.gZj[jb])return!0;return!1}}nc.gZj=[1];Object(f.a)(nc,"RTTDataVersion",null,[]);var Gb=d(1610);const tc=Aa=>{if("number"!==typeof Aa.RK||"number"!==typeof Aa.DK)return!1;let jb,lc=!1,Nc=!1,qd=!1;switch(Aa.RK){case 0:Nc=jb=!0;break;case 1:qd=lc=Nc=jb=!0;break;case 2:if(null!=
Aa.PE&&"number"!==typeof Aa.PE)return!1;jb=!0;break;case 4:jb=!0;break;case 3:Nc=jb=!0;break;case 5:lc=jb=!0;break;default:return!1}return jb&&("number"!==typeof Aa.PS||"number"!==typeof Aa.TS)||Nc&&("object"!==typeof Aa.OS||!Aa.OS||!Gb.validateVersionedCpData(Aa.OS))||lc&&("number"!==typeof Aa.PE||"number"!==typeof Aa.TE)||qd&&("object"!==typeof Aa.OE||!Aa.OE||!Gb.validateVersionedCpData(Aa.OE))?!1:!0},Qb=Aa=>{let jb="";if("number"!==typeof Aa.I)return{returnValue:!1,Pla:"Invalid PacketId Type"};
if("number"!==typeof Aa.O)return{returnValue:!1,Pla:"Invalid Operation Type"};if("string"!==typeof Aa.A)return{returnValue:!1,Pla:"Invalid ClientId Type"};if("object"!==typeof Aa.AN)return{returnValue:!1,Pla:"Invalid Anchor Object Type"};if(!Aa.AN)return{returnValue:!1,Pla:"Null AnchorObject"};if(!tc(Aa.AN)){let lc;try{lc=V.c(Aa.AN)}catch(Nc){lc=String.format("Failed to JSON-serialize payload : {0}",Nc)}8E3<lc.length&&(lc=String.format("Payload exceeds maximum length: {0} > {1}, not logging",lc.length,
8E3));jb="Invalid AnchorObject: "+lc+", Client: "+Aa.C;return{returnValue:!1,Pla:jb}}return!Aa.O&&Aa.AN.RK?(jb="Invalid RangeKind:"+Aa.AN.RK+" for Caret",{returnValue:!1,Pla:jb}):2===Aa.O&&("number"!==typeof Aa.TF||"undefined"!==typeof Aa.TX&&"string"!==typeof Aa.TX||1!==Aa.AN.RK&&Aa.AN.RK)?{returnValue:!1,Pla:"Invalid TypingData"}:3!==Aa.O||"object"===typeof Aa.AP&&Aa.AP&&"number"===typeof Aa.AP.TFA&&"number"===typeof Aa.AP.PN&&"number"===typeof Aa.AP.TN&&2===Aa.AN.RK?6!==Aa.O||"object"===typeof Aa.MP&&
Aa.MP&&"number"===typeof Aa.MP.PM&&"number"===typeof Aa.MP.TM&&5===Aa.AN.RK?4!==Aa.O||"object"===typeof Aa.SP&&Aa.SP&&"number"===typeof Aa.SP.PA&&"number"===typeof Aa.SP.TA&&"number"===typeof Aa.SP.PB&&"number"===typeof Aa.SP.TBS&&3===Aa.AN.RK&&(Aa.AN.PS===Aa.SP.PA||Aa.AN.PS===Aa.SP.PB)?7!==Aa.O||"object"===typeof Aa.SPS&&Aa.SPS&&"string"===typeof Aa.SPS.SF&&"boolean"===typeof Aa.SPS.SL?null!=Aa.ISS&&"number"!==typeof Aa.ISS?{returnValue:!1,Pla:"invalid StrictlySequentialId"}:{returnValue:!0,Pla:jb}:
{returnValue:!1,Pla:"Invalid SymbolData"}:{returnValue:!1,Pla:"Invalid SplitParaData"}:{returnValue:!1,Pla:"Invalid RemoveParaData"}:{returnValue:!1,Pla:"Invalid AddParaData"}};var Yb=d(1562);class fc{constructor(Aa,jb=null,lc=null){this.y4=this.Xhg=this.OGg=null;null!=Aa&&(this.OGg=Aa);null!=jb&&(this.Xhg=jb);null!=lc&&(this.y4=lc)}}Object(f.a)(fc,"AddParaData",null,[]);class ib{constructor(Aa=null,jb=null){this.rzc=this.Whg=null;null!=Aa&&(this.Whg=Aa);null!=jb&&(this.rzc=jb)}}Object(f.a)(ib,"MergeRemoveParaData",
null,[]);class Jc{constructor(Aa,jb,lc,Nc,qd,Rd,Me=null,df=null,Cf=null,sg=null,lg=null,Ia=null,Zb=0,Qc=null){this.Jqd=this.text=this.w1b=this.M0b=this.qdd=this.hcc=this.foa=null;this.packetId=Aa;this.client=lc;this.operationType=Nc;this.clientId=jb.toLowerCase();this.yW=qd;this.version=Zb;Rd&&(this.foa=Rd);null!=Me&&(this.w1b=Me);void 0!==df&&null!==df&&(this.text=df);Cf&&(this.hcc=Cf);sg&&(this.qdd=sg);lg&&(this.M0b=lg);Ia&&(this.Jqd=Ia);this.strictlySequentialId=Qc}}Object(f.a)(Jc,"RTTData",null,
[]);class jd{constructor(Aa=null,jb=null,lc=null,Nc=null){this.NGg=this.Vhg=this.KGg=this.Uhg=null;null!=Aa&&(this.Uhg=Aa);null!=jb&&(this.KGg=jb);null!=lc&&(this.Vhg=lc);null!=Nc&&(this.NGg=Nc)}}Object(f.a)(jd,"SplitParaData",null,[]);class Wc{constructor(Aa=null,jb=null){this.pFg=this.oFg=null;Aa&&(this.oFg=Aa);null!=jb&&(this.pFg=jb)}}Object(f.a)(Wc,"SymbolData",null,[]);class Ad{constructor(Aa,jb=null,lc=null){null!=Aa&&(this.TFA=Aa);null!=jb&&(this.PN=jb);null!=lc&&(this.TN=lc)}}Object(f.a)(Ad,
"SerializableAddParaDataV1",null,[]);class Yd{constructor(Aa=null,jb=null){null!=Aa&&(this.PM=Aa);null!=jb&&(this.TM=jb)}}Object(f.a)(Yd,"SerializableMergeRemoveParaDataV1",null,[]);class ke{}Object(f.a)(ke,"SerializableRTTDataV1",null,[]);class bf{constructor(Aa=null,jb=null,lc=null,Nc=null){null!=Aa&&(this.PA=Aa);null!=jb&&(this.TA=jb);null!=lc&&(this.PB=lc);null!=Nc&&(this.TBS=Nc)}}Object(f.a)(bf,"SerializableSplitParaDataV1",null,[]);class od{constructor(Aa=null,jb=null){Aa&&(this.SF=Aa);null!=
jb&&(this.SL=jb)}}Object(f.a)(od,"SerializableSymbolDataV1",null,[]);const Vf=Aa=>{var jb;if(!({Pla:jb}=Qb(Aa)).returnValue)return l.ULS.sendTraceTag(9188759,302,15,"Failed to parse RTT packet, InvalidFieldInfo {0}",jb),null;let lc=jb=null,Nc=null,qd=null,Rd=null,Me=null,df=null,Cf=null;Aa.WD&&(jb=Aa.WD);null!=Aa.TF&&(lc=Aa.TF);void 0!==Aa.TX&&null!==Aa.TX&&(Nc=Aa.TX);Aa.AP&&(qd=new fc(Aa.AP.TFA,Aa.AP.PN,Aa.AP.TN));Aa.MP&&(Rd=new ib(Aa.MP.PM,Aa.MP.TM));Aa.SP&&(Me=new jd(Aa.SP.PA,Aa.SP.TA,Aa.SP.PB,
Aa.SP.TBS));Aa.SPS&&(df=new Wc(Aa.SPS.SF,Aa.SPS.SL));null!=Aa.ISS&&(Cf=Aa.ISS);return new Jc(Aa.I,Aa.A,Aa.C,Aa.O,Yb.a(Aa.AN),jb,lc,Nc,qd,Rd,Me,df,1,Cf)},ah=Aa=>{let jb=Aa;if("number"===typeof jb.V){if(1===jb.V)return Vf(Aa);l.ULS.sendTraceTag(9188758,302,15,"Unsupported Version");return null}let lc=0,Nc=null;for(let qd=0;qd<Aa.length;qd++)jb=Aa[qd],nc.isSupported(jb.V)&&jb.V>lc&&(lc=jb.V,Nc=Aa[qd]);return 1===lc?Vf(Nc):null},Bf=Aa=>{if(Aa){const jb=new ke;jb.I=Aa.packetId;jb.V=1;jb.A=Aa.clientId;
jb.C=Aa.client;jb.O=Aa.operationType;jb.AN=Yb.c(Aa.yW);Aa.foa&&(jb.WD=Aa.foa);null!=Aa.w1b&&(jb.TF=Aa.w1b);void 0!==Aa.text&&null!==Aa.text&&0<Aa.text.length&&(jb.TX=Aa.text);Aa.hcc&&(jb.AP=new Ad(Aa.hcc.OGg,Aa.hcc.Xhg,Aa.hcc.y4));Aa.qdd&&(jb.MP=new Yd(Aa.qdd.Whg,Aa.qdd.rzc));Aa.M0b&&(jb.SP=new bf(Aa.M0b.Uhg,Aa.M0b.KGg,Aa.M0b.Vhg,Aa.M0b.NGg));Aa.Jqd&&(jb.SPS=new od(Aa.Jqd.oFg,Aa.Jqd.pFg));jb.ISS=Aa.strictlySequentialId;Aa=jb}else Aa=null;return Aa};var Of=d(48);class Qf{constructor(Aa,jb,lc,Nc,qd,
Rd,Me,df,Cf){this.LocalCobaltSessionId=Aa;this.SkypeChatThreadId=jb;this.ChatThreadDiscoveryUri=lc;this.InChat=Nc;this.Capabilities=qd;this.Email=Rd;this.UserName=Me;this.IsAnonymous=df;this.PresenceStatus=Cf}}Object(f.a)(Qf,"SerializableWacData",null,[]);class Jg{constructor(){this.MMd=this.LMd=0}SBm(){this.MMd===Number.MAX_VALUE&&(this.MMd=0);this.MMd++;return this.MMd}RBm(){this.LMd===Number.MAX_VALUE&&(this.LMd=0);this.LMd++;return this.LMd}static get instance(){return Jg.EOk}}Jg.EOk=new Jg;Object(f.a)(Jg,
"StrictlySequentialIdGenerator",null,[210]);var jf=d(1464);class $i{constructor(Aa,jb,lc,Nc,qd,Rd,Me,df=0){this.txa=null;this.dryDeletion=0;this.nO=Aa;this.NRa=Rd;this.Ad=qd;this.WJb=Me;this.ed=jb;this.shapeId=df;this.JMa=lc;this.aca=Me.create(this,Nc,qd,Rd)}clone(){return new $i(this.nO,this.ed,this.JMa,this.aca.d3b,this.Ad,this.NRa,this.WJb,this.shapeId)}get paragraphId(){return this.txa?this.txa:this.nO.FQb(this.ed)}yfg(){this.txa||(this.txa=this.paragraphId,this.aca.yfg())}isValid(){return 0<=
this.aca.cp}getData(){const Aa=this.aca.d3b;return Aa?new jf.a(0,this.ed,this.JMa,Aa,null,null,null,0,this.shapeId):null}static LMb(Aa,jb,lc,Nc,qd){return jb?new $i(jb,parseInt(Aa.KYa),Aa.Neb,Aa.RU,lc,Nc,qd,Aa.shapeId):null}}Object(f.a)($i,"WordPresenceIp",null,[204,71,205]);class Vd{constructor(Aa,jb,lc){this.A_a=this.Zfa=this.oLc=!1;this.Rjb=Aa;this.H2a=lc;this.user=jb}get ip(){return this.H2a}get drc(){return this.oLc}set drc(Aa){(this.oLc=Aa)&&this.ip.yfg()}PMf(){const Aa=Jg.instance.RBm();return new Jc(this.Rjb,
this.user.clientId,1,0,this.ip?this.ip.getData():null,new Qf(this.user.WF,this.user.XUc,this.user.chatThreadDiscoveryUri,this.user.inChat,this.user.capabilities.capabilities,this.user.email,this.user.userName,this.user.isAnonymous,this.user.presenceStatus),void 0,void 0,void 0,void 0,void 0,void 0,void 0,Aa)}Pyi(){return this.user.clientId+(this.ip?this.ip.paragraphId.toString():Of.a.nil.toString())}isValid(){const Aa=!!this.user&&this.user.isValid(),jb=!this.ip||this.ip.isValid();return Aa&&jb}clone(){const Aa=
new Vd;Aa.Rjb=this.Rjb;Aa.oLc=this.oLc;Aa.user=this.user?this.user.clone():null;Aa.H2a=this.ip?this.ip.clone():null;Aa.Zfa=this.Zfa;Aa.A_a=this.A_a;return Aa}static jsf(Aa,jb,lc,Nc,qd){if(!Aa||!jb)return null;if(Aa.operationType)return l.ULS.sendTraceTag(7685324,302,15,"Presence packet is of unexpected operationType {0}",Aa.operationType),null;let Rd;Rd=void 0!==Aa.foa&&null!==Aa.foa?Ra.W9h(Aa.clientId,Aa.foa.UserName,Aa.foa.Capabilities,Aa.foa.LocalCobaltSessionId,Aa.foa.SkypeChatThreadId,Aa.foa.Email,
Aa.client,Aa.foa.ChatThreadDiscoveryUri,Aa.foa.InChat,!1,Aa.foa.IsAnonymous,Aa.foa.PresenceStatus):Ra.W9h(Aa.clientId,null,0,void 0,void 0,void 0,Aa.client);return new Vd(Aa.packetId,Rd,$i.LMb(Aa.yW,jb,lc,Nc,qd))}}Object(f.a)(Vd,"WordPresenceInfo",null,[208,71]);class eh extends ab{constructor(Aa,jb,lc,Nc,qd,Rd,Me,df,Cf,sg,lg,Ia,Zb,Qc){super(Aa,Rd,Qc,jb);this.Zpk=lc;this.gMk=Nc;this.yKk=qd;this.ib=Me;eh.Sy=df;this.nO=Cf;this.Ad=sg;this.NRa=lg;this.rcf=Ia;this.NPa=Zb}SLg(Aa){this.NPa.x4i(Aa.CommandValueId);
return super.SLg(Aa)}Uwn(Aa){let jb;({Ukg:jb}=this.$Zf(Aa)).returnValue&&(this.gMk(jb.ip.paragraphId,jb.ip.aca.cp),m.AFrameworkApplication.J.$("WordEditorMoveIpToUserLocationIsEnabled")&&(Aa=eh.GKm(jb),void 0!==Aa&&null!==Aa?(l.ULS.sendTraceTag(20764574,325,50,"Attempting to move IP to the editing location of the selected user"),this.ib.Kc(Aa),Na.FocusManager.lM()&&Na.FocusManager.instance().Gg(Db.AFrame.Do)):l.ULS.sendTraceTag(20764575,325,50,"IP will not be moved since the selection is either null or undefined")),
Aa=new xa.a(2,1,0,()=>{this.ga.Qb(ia.a.mze,2,jb)}),nb.a.instance.$b(Aa))}nEi(Aa){return Aa?(Aa=Vd.jsf(ah(Aa),this.nO,this.Ad,this.NRa,this.rcf.instance))&&Aa.isValid()&&Aa.ip?Aa:null:null}Hll(Aa){return this.wqn(Aa)?this.Yll(Aa)?!0:(l.ULS.sendTraceTag(41236613,325,50,"Cannot jump to user location because paragraph has not been loaded yet"),!1):(l.ULS.sendTraceTag(41236612,325,50,"Cannot jump to user location because presence is not valid"),!1)}wqn(Aa){return!!this.nEi(Aa)}$Zf(Aa){Aa=this.nEi(Aa);
return{returnValue:!!Aa,Ukg:Aa}}Yll(Aa){let jb;return({Ukg:jb}=this.$Zf(Aa)).returnValue?this.Zpk(jb.ip.paragraphId,jb.ip.aca.cp):!1}Hhm(){if(!this.kF)return[];const Aa=[];for(const jb of this.kF.pqb())jb.userName?Aa.push(jb):l.ULS.sendTraceTag(592229832,304,15,"The looked up RTC User has no name");return Aa}cCl(Aa){let jb;return({Ukg:jb}=this.$Zf(Aa)).returnValue&&jb.user&&jb.user.presenceStatus&&"0"!==jb.user.presenceStatus?String.format(WordEditorIntl.WordEditorStrings.l_PresenceStatusOnPage,jb.user.presenceStatus):
CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}lto(){this.yKk(this.settings.id)}static createInstance(Aa,jb,lc,Nc,qd,Rd,Me){const df=qb.StaticActiveAppFrame.za().kb,Cf=m.AFrameworkApplication.va,sg=Mb.a.instance,lg=Pa.a.instance.resolve("Box4.ICoauthCashTelemetry");return new eh(Aa,jb,Ia=>df.Qc.vj?df.Qc.vmf(Ia,!0):!1,(Ia,Zb)=>{df.Qc.vj&&df.Qc.c_b(Ia,Zb,!0,!0,!1,!1,Za.a.sbo)},()=>{La.a.EB.FJ.Wsd()},Cf,sg,df,lc,Nc,qd,Rd,lg,Me)}static GKm(Aa){const jb=eh.Sy.hd.ud.Eb(Aa.ip.paragraphId);if(void 0===
jb||null===jb)return l.ULS.sendTraceTag(20764576,325,15,"The node could not be obtained"),null;if(!Ha.ParagraphReader.Wb(jb))return l.ULS.sendTraceTag(20764577,325,15,"The obtained node is not a paragraph node"),null;Aa=zb.a.Uc(jb,Aa.ip.aca.cp);return new ac.Selection([Aa],!0)}}eh.Sy=null;Object(f.a)(eh,"WordEditorPeoplesWell",ab,[]);class rd{constructor(){this.iz=()=>{m.AFrameworkApplication.ssj?rd.Sua.gD().continueWith(this.Gfd):l.ULS.sendTraceTag(23196872,325,50,"PeoplesWell control is explicitly disabled. Skipping initialization attempt")};
this.Gfd=()=>{rd.ei=rd.Sua.gD().result;if(rd.ei){var Aa=()=>{const jb=qb.StaticActiveAppFrame.za().kb;return jb?jb.hd?jb.hd.ud:(l.ULS.sendTraceTag(23196876,325,15,"ActivePage is null"),null):(l.ULS.sendTraceTag(23196875,325,15,"Workspace is null"),null)};mb.a.OAa().continueWith(()=>{const jb=mb.a.OAa().result.Bj,lc=eb.a.FFm(m.AFrameworkApplication.Lr,m.AFrameworkApplication.Lr,m.AFrameworkApplication.Lr,m.AFrameworkApplication.Lr),Nc=bb.createInstance(lc,jb,Object(Wa.a)(rd.ei.ive,rd.ei.ive.elc,"getUserPresence"),
Object(Wa.a)(rd.ei.ive,rd.ei.ive.LVa,"getUserStatusInfo"),m.AFrameworkApplication.J.$("WordEditorPresenceDedupeMultipleCoauthorInstances"));Pa.a.instance.ia("RealtimePresenceUI.WordEditorPeoplesWell",()=>eh.createInstance(Nc,Ja.a.sq(rd.Z.Ta("Common.IPeopleInfoProvider")),rd.Z.Oa("WordEditor.ParagraphWordIdMapping"),rd.Z.Oa("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Aa,rd.Z.Ta("WordEditor.Presence.IWordPresenceCpFactory"),rd.Z.resolve("Common.App.People.IPeopleManager"))).as("Common.IPeoplesWell").ha();
rd._instance=Pa.a.instance.resolve("Common.IPeoplesWell");rd._instance.Owo();l.ULS.sendTraceTag(23196877,325,50,"PeoplesWellControl is fully initialized")})}else l.ULS.sendTraceTag(23196873,325,15,"Can't initialize the PeoplesWell control because can't get a handle to RtcProxy")}}get name(){return"WordEditor.PeoplesWellControl"}wc(Aa){rd.Z=Aa}init(){m.AFrameworkApplication.J.vp(this.iz)}dispose(){rd._instance&&(rd._instance.dispose(),rd._instance=null)}static get Sua(){return null!=rd.W2g?rd.W2g:
rd.W2g=Pa.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}}rd._instance=null;rd.Z=null;rd.ei=null;Object(f.a)(rd,"WordEditorPeoplesWellControlPackage",null,[0,1]);var Gc=d(105),Wd=d(262);class Ye{constructor(Aa,jb,lc,Nc,qd,Rd,Me,df,Cf=!1){this.jgb=null;this.TRe=!0;this.N3e=this.Zk=this.EKe=null;this.sa=new ha.a;this.Z6m=()=>{this.sO.result&&this.Qzh.result&&(this.Zk=this.sO.result,this.N3e=this.Qzh.result,this.Zk.wya(this.SU),this.EKe=new xa.a(2,2,this.M9g,this.zvp,88),Ye.Jb.$b(this.EKe))};
this.SU=(sg,lg)=>{(this.TRe||this.Opo(lg.$ha))&&Ye.Jb.Z3(this.EKe,0)};this.zvp=sg=>{var lg=this.Zk.Zic();if(lg){var Ia=new Date,Zb=!1;if(this.TRe){this.jgb=lg;this.TRe=!1;var Qc=this.jgb;for(var ed in Qc){lg=ed;var Pd=Qc[ed];Pd.Ypc<Ia&&(Ia=Pd.Ypc);2===Pd.status&&(Zb=!0,this.N3e.Ekd(lg))}Zb&&this.hyj();Ye.Jb.Z3(sg,this.dCi(Ia))}else{Pd=new R.a;ed=!1;var hb=this.jgb;for(Qc in hb){hb=Qc;if(!(hb in this.jgb)||this.HRa.clientId===hb)continue;var Id=this.jgb[hb];const he=lg[hb];if(Id&&he){Id=Id.status;
const Cd=he.status;2===Id&&1===Cd?(Pd.add(hb),l.ULS.sendTraceTag(38052609,392,50,hb+" returned from away")):1===Id&&2===Cd&&(ed=Zb=!0,this.N3e.Ekd(hb),l.ULS.sendTraceTag(38052610,392,50,hb+" went away"));1===Cd&&he.Ypc<Ia&&(Ia=he.Ypc)}}this.jgb=lg;Ye.Jb.Z3(sg,this.dCi(Ia));(0<Pd.count||Zb)&&this.hyj();0<Pd.count&&!this.IKk?(sg=this.bmm(Pd),this.gmp(sg)):sg=new R.a;(ed||0<sg.count)&&this.AJk(rb.a.RVd,2)}}};this.HRa=Aa;this.sO=jb;this.Qzh=lc;this.HNc=Nc;this.M9g=Rd;Ye.Jb=qd;this.AJk=Me;this.i$=df;this.IKk=
Cf;D.Task.WAA(jb,lc).continueWith(this.Z6m)}d3k(Aa){this.sa.addHandler("u",Aa)}hyj(){this.sa.raiseEvent("u",null,this)}Opo(Aa){for(const lc in Aa){var jb=this.HNc.X7d({key:lc,value:Aa[lc]});if(jb&&jb.clientId&&(jb=jb.clientId.toLowerCase(),(jb=this.jgb[jb]||this.jgb[jb.toUpperCase()])&&2===jb.status))return!0}return!1}gmp(Aa){if(Aa.count)for(const jb of Aa)Aa=this.i$.yka(String.format(CommonUIStrings.l_EditorsToastArriving,jb),!1),Aa.image=5,Aa.Gla="CoAuth_AuthorStatus_16x16x32",this.i$.Iz(Aa)}bmm(Aa){const jb=
this.Zk.oqb(),lc=new R.a;for(const Nc in jb){const qd={key:Nc,value:jb[Nc]};if(Aa.contains(qd.key)){const Rd=this.HNc.X7d(qd);Rd&&(lc.add(Rd.userName),Aa.remove(qd.key))}}lc.count||l.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found");return lc}dCi(Aa){const jb=new Date;return Math.max(Aa.getTime()+this.M9g-jb.getTime(),0)}}Ye.Jb=null;Object(f.a)(Ye,"AwayManager",null,[]);var yg=d(799);class yf{constructor(Aa=0){this.updates=Aa}get HRf(){return 0!==this.updates}vKa(Aa){return!!(this.updates&
Aa)}Kdb(Aa){this.updates|=Aa}toString(){if(this.vKa(0))return"none";const Aa=new R.a;this.vKa(1)&&Aa.add("user(s) joined");this.vKa(2)&&Aa.add("user(s) disconnected");this.vKa(4)&&Aa.add("user(s) updated");return Aa.toArray().join(", ")}}Object(f.a)(yf,"UserUpdateEvent",null,[]);var re=d(25);class Xe{constructor(Aa,jb,lc,Nc,qd=null){this.sa=new ha.a;this.wM=this.ei=null;this.svh=this.Tvh=this.fm=!1;this.Xq=new vc.a;this.qLg=()=>{if(this.ei){var Rd=!1,Me=this.ei.Zic();for(const Cf in Me){var df=Me[Cf];
const sg=Cf;this.users.tb(sg)&&(df=this.v2j(df),Rd=this.users.K(sg).cMb!==df||Rd,this.users.K(sg).cMb=df)}Rd&&(Rd=new yf(4),this.mwe(Rd))}};this.znj=(Rd,Me)=>{2===Me.newState&&(Rd=this.V7f(this.ei.oqb()),Rd.HRf&&this.mwe(Rd))};this.Wed=(Rd,Me)=>{Rd=new yf;var df=this.wM.H1c();l.ULS.sendTraceTag(561894485,302,50,"editorstablemanager coauthors count is {0}, editorstableupdate old count of coauthors is {1}, editorstableupdate new count of coauthors is {2}",df.length,Me.gVn,Me.ogj);const Cf=new vc.a;
for(var sg of df){df=sg.Id;const lg=this.ibi(df);this.pLg(Rd,lg);Cf.W(df,lg)}if((Me=Me.Q2f)&&0<Me.length)for(sg=0;sg<Me.length;sg++)l.ULS.sendTraceTag(562415168,302,50,"{0} users in coauth gallery. User leaving the editor table: {1}",this.users.count,Me.K(sg).Id),({value:df}=this.users.Ec(Me.K(sg).Id)).returnValue?df?(this.users.remove(Me.K(sg).Id),Rd.Kdb(2),Cf.W(Me.K(sg).Id,df)):l.ULS.sendTraceTag(561287839,302,50,"Empty entry in PIP users: {0}",Me.K(sg).Id):l.ULS.sendTraceTag(570426140,302,15,"Disconnected user not found: {0}",
Me.K(sg).Id);Me=this.ei.oqb();for(const lg in Me)sg=this.HNc.X7d({key:lg,value:Me[lg]}),Cf.W(sg.clientId,sg);for(const lg of this.users)Cf.tb(lg.value.clientId)||(l.ULS.sendTraceTag(561287840,302,15,"Coauth Gallery contains user not in Editors Table or RTC presence: {0}",lg.key),this.users.remove(lg.key),Rd.Kdb(2));Rd.HRf&&this.mwe(Rd)};this.Bnj=(Rd,Me)=>{Rd=this.V7f(Me.$ha);for(const df of Me.gZc)this.users.tb(df)&&(Rd.Kdb(2),this.users.K(df).cMb=2);Rd.HRf&&this.mwe(Rd)};Aa.continueWith(()=>{this.ei=
Aa.result;this.ei.wya(this.Bnj);this.ei.QZ(this.znj);this.qLg(null,null)});jb.continueWith(()=>{this.wM=jb.result;this.wM.Ylb(this.Wed)});qd&&qd.continueWith(()=>{qd.result.d3k(this.qLg);this.qLg(null,null)});this.YRa=lc;this.HNc=Nc}get users(){return this.Xq}ycc(Aa){this.sa.addHandler("UU",Aa)}Xrg(Aa){this.sa.removeHandler("UU",Aa)}v2j(Aa){return 1===Aa.status?0:1}pqb(){this.users.count||(this.Tvh||(re.b(42316242,302,50,"No users available at PeopleInfoProvider.GetAllUsers call"),this.Tvh=!0),this.reo());
const Aa=[];for(const jb of this.users)Array.add(Aa,jb.value);return Aa}reo(){if(this.ei){var Aa=this.ei.oqb();this.V7f(Aa)}if(this.wM){Aa=this.wM.H1c();for(const jb of Aa)jb.Id&&(Aa=this.ibi(jb.Id),this.pLg(new yf,Aa))}}d6f(Aa){({value:Aa}=this.users.Ec(Aa));return Aa}dispose(){this.fm||(this.ei&&(this.ei.GZa(this.Bnj),this.ei.qDa(this.znj)),this.wM&&this.wM.uDj(this.Wed),this.fm=!0)}V7f(Aa){const jb=new yf;if(!Aa)return jb;for(const Nc in Aa){var lc=this.HNc.X7d({key:Nc,value:Aa[Nc]});lc&&(lc=lc.clone(),
this.pLg(jb,lc))}return jb}pLg(Aa,jb){if(jb){var lc=jb.clientId,Nc=this.$Ho(jb);({value:jb}=this.users.Ec(lc)).returnValue?jb.equals(Nc)||(Aa.Kdb(4),this.users.W(lc,Nc)):(l.ULS.sendTraceTag(562415169,302,50,"{0} users in coauth gallery. User joining: {1}",this.users.count,lc),Aa.Kdb(1),this.users.W(lc,Nc))}}ibi(Aa){return this.users.tb(Aa)?this.users.K(Aa):va.a.jGl(Aa)}$Ho(Aa){if(!Aa||!Aa.clientId||!this.wM)return Aa;const jb=Aa.clone();jb.cMb=this.amm(Aa);if(Aa=this.wM.ojc(jb.clientId))jb.isReadOnly=
jb.isReadOnly||Aa.IsReadOnly?!0:!1,jb.userName=this.ZHo(jb,Aa),jb.capabilities=this.ANn(jb.capabilities,Aa.Capabilities),jb.email=jb.email||Aa.SIPAddress||Aa.EmailAddress,Aa.JoinCoauthTime&&(jb.tXa=Aa.JoinCoauthTime);jb.color=this.YRa.dlc(new yg.a(jb.email,void 0,jb.userName,void 0,jb.isAnonymous,jb.clientId),3);return jb}amm(Aa){if(!this.ei)return 2;if(Aa&&Aa.clientId){const jb=this.ei.Zic();if(Aa.clientId in jb)return this.v2j(jb[Aa.clientId])}return 2}zxl(Aa,jb){jb.Name&&Aa.userName&&jb.Name!==
Aa.userName&&!this.svh&&(this.svh=!0,re.b(42316243,302,15,"User names in EditorsTable and RTC don't match"))}ANn(Aa,jb){Aa=Aa||new pa.a;jb&&(jb.SupportsRealtimeChannel&&Aa.Kdb(1),jb.SupportsRename&&Aa.Kdb(2),jb.SupportsChat&&Aa.Kdb(4));return Aa}ZHo(Aa,jb){this.zxl(Aa,jb);return jb.Name||Aa.userName||(Aa.isAnonymous||jb.IsAnonymous?CommonUIStrings.l_GuestUserName:null)}mwe(Aa){l.ULS.sendTraceTag(42316245,302,100,"PeopleInfoProvider update detected: {0}",Aa.toString());this.sa.raiseEvent("UU")}}Object(f.a)(Xe,
"PeopleInfoProvider",null,[1892,10]);var dc;(function(Aa){Aa[Aa.JQn=0]="multipleBrowsersImageClassName";Aa[Aa.qbo=1]="peopleImageClassName";Aa[Aa.rbo=4]="peopleImageClusterPath";Aa[Aa.IQn=5]="multipleBrowserImageClusterPath";Aa[Aa.XRb=6]="imageDimension";Aa[Aa.rtl=8]="rtl";Aa[Aa.ihd=9]="pointerInputManager";Aa[Aa.UQ=10]="clickInputManager";Aa[Aa.vertical=11]="vertical";Aa[Aa.zIndex=12]="zIndex";Aa[Aa.wMb=13]="contextMenuInputManager";Aa[Aa.t5p=14]="imageDomElement";Aa[Aa.Tqq=15]="useIdleTooltip";
Aa[Aa.VFp=16]="viewportBoundsCallback";Aa[Aa.Q1p=17]="flipHorizontalDirection";Aa[Aa.L1p=18]="fixRemoveFadeOutElementCrash";Aa[Aa.b4m=19]="ignoreEventOnExpandedTooltip";Aa[Aa.ven=20]="ipWidthAdjustForFlyout"})(dc||(dc={}));Object(f.b)("PresenceTooltipSettingKeys",dc);class Ac{constructor(){this.wv={}}get(Aa,jb=null){Aa=dc[Aa];return"number"===typeof jb?(jb=this.wv[Aa])?Number.parseInvariant(jb.toString()):0:this.wv[Aa]}add(Aa,jb){this.wv[dc[Aa]]=jb}eTa(Aa,jb){dc[Aa]in this.wv||(this.wv[dc[Aa]]=jb)}remove(Aa){delete this.wv[dc[Aa]]}}
Object(f.a)(Ac,"PresenceTooltipSettings",null,[]);class dd extends ha.a{constructor(Aa){super();this._element=null;this.element=Aa}get element(){return this._element}set element(Aa){this._element=Aa}get visible(){return"visible"===this.element.style.visibility}set visible(Aa){this.element.style.visibility=Aa?"visible":"hidden"}get rtl(){return"rtl"===this.element.dir.toLowerCase()}set rtl(Aa){this.element.dir=Aa?"rtl":"ltr"}get zIndex(){return this.element.style.zIndex}set zIndex(Aa){this.element.style.zIndex=
String(Aa)}dispose(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element);this.element=null;super.dispose()}createElement(Aa){return this.element.ownerDocument.createElement(Aa)}Gna(){return!0}static wai(Aa){return"prControl"+(Aa?"Rtl":"")}}Object(f.a)(dd,"BasePresenceControl",ha.a,[10,1947]);class fd extends Sys.EventArgs{constructor(Aa,jb){super();this.type=Aa;this.Vo=jb}}fd.uX="InteractivityChanged";Object(f.a)(fd,"InteractivityChangedEventArgs",Sys.EventArgs,
[]);class Fd{static mpm(Aa){return Fd.npm(Aa)}static npm(Aa){const jb=document.createElementNS(Fd.XNg,"svg");jb.setAttribute("viewBox",String.format(Fd.uNl,Fd.xak,Fd.wak));jb.appendChild(Fd.UMm(Aa));return jb}static UMm(Aa){const jb=Fd.xak/Aa,lc=2*jb,Nc=Fd.wak/2;Aa=(Aa-12-8)*jb/2;const qd=document.createElementNS(Fd.XNg,"g");Sys.UI.DomElement.addCssClass(qd,Fd.tNl);for(let Rd=1;3>=Rd;Rd++)qd.appendChild(Fd.Llm(Rd,lc,Aa+(6*Rd-2)*jb,Nc));return qd}static Llm(Aa,jb,lc,Nc){const qd=document.createElementNS(Fd.XNg,
"circle");Sys.UI.DomElement.addCssClass(qd,String.format("{0}-{1}",Fd.Pql,Aa));qd.setAttribute("cx",String.format("{0}",lc));qd.setAttribute("cy",String.format("{0}",Nc));qd.setAttribute("r",String.format("{0}",jb));return qd}}Fd.XNg="http://www.w3.org/2000/svg";Fd.tNl="prDancingDots";Fd.Pql="prAnimateCircle";Fd.uNl="0 0 {0} {1}";Fd.wak=40;Fd.xak=120;Object(f.a)(Fd,"ModernPresenceTooltipDancingDots",null,[]);var cf=d(101),Bg=d(98),me=d(10),mf=d(74),ug=d(180),Bi=d(77);class Zf extends dd{constructor(Aa,
jb){super(Aa);this.DJh=this.$hb=this.sMe=this._img=this.aO=this.rx=this.$g=null;this.sSa=jb.get(8,!1);this.Ghb=jb.get(6,0);this.ZRk=jb.get(15,!1);this.Oe=jb;this.dhh=0;this.element=Aa;this.element.className=Zf.qDf;this._span=document.createElement("span");this.element.appendChild(this._span);this.iuk=Fd.mpm(jb.get(6,0));this.ME(jb);this._state=5}uKb(Aa){this.addHandler(fd.uX,Aa)}jZb(Aa){this.removeHandler(fd.uX,Aa)}get user(){return this.DJh}get state(){return this._state}dispose(){this.element&&
(this.$g.xc(me.a.click,this.element,Object(Wa.a)(this,this.onClick,"onClick")),this.$g.xc(me.a.XC,this.element,Object(Wa.a)(this,this.Gna,"stopPropagationAndPreventDefaultBehavior")),this.rx.xc(me.a.kt,this.element,Object(Wa.a)(this,this.yE,"onPointerDown")),this.rx.xc(me.a.qH,this.element,Object(Wa.a)(this,this.OL,"onPointerOut")),this.rx.xc(me.a.UL,this.element,Object(Wa.a)(this,this.cS,"onPointerOver")),this.aO.xc(this.element,Object(Wa.a)(this,this.Gna,"stopPropagationAndPreventDefaultBehavior")));
super.dispose()}ME(Aa){this.$g=Aa.get(10);this.$g.ub(me.a.click,this.element,Object(Wa.a)(this,this.onClick,"onClick"));this.$g.ub(me.a.XC,this.element,Object(Wa.a)(this,this.Gna,"stopPropagationAndPreventDefaultBehavior"));this.rx=Aa.get(9);this.rx.ub(me.a.UL,this.element,Object(Wa.a)(this,this.cS,"onPointerOver"));this.rx.ub(me.a.qH,this.element,Object(Wa.a)(this,this.OL,"onPointerOut"));this.rx.ub(me.a.kt,this.element,Object(Wa.a)(this,this.yE,"onPointerDown"));this.aO=Aa.get(13);this.aO.ub(this.element,
Object(Wa.a)(this,this.Gna,"stopPropagationAndPreventDefaultBehavior"))}hide(Aa=null,jb=0,lc=0){this.ZRk&&Aa?this.G8o(Aa,jb,lc):(3===this.state&&this.dCj(),this.visible=!1,this._state=5)}G8o(Aa,jb,lc=0){this.show(Aa,jb,15,4,void 0,lc)}OTj(Aa,jb,lc=!1,Nc=!1,qd=!1,Rd=0){this.show(Aa,jb,20,lc?2:Nc?1:0,qd,Rd)}b8o(Aa,jb,lc,Nc=!1,qd=0){this.show(Aa,jb,lc+20,3,Nc,qd)}show(Aa,jb,lc,Nc=3,qd=!1,Rd=0){!Aa||Nc===this.state&&this.c_m(jb,lc)||(this.yVk(Nc,qd,Rd),this.Pja(Aa,Nc,Rd),this._state=Nc,4===Rd||0===Rd&&
!this.sSa?this.element.style.left=jb+"px":this.element.style.right=jb+"px",this.element.style.top=lc+"px",this.visible=!0)}Pja(Aa,jb,lc){this.DJh=Aa;Bi.a.sF(this._span);ug.a.Csl(this._span);this._span.id="fly_"+Aa.clientId;this._span.style.backgroundColor=Aa.color;4!==jb?(this._span.style.height=this.Ghb+"px",this._span.style.lineHeight=this.Ghb+"px",ug.a.T_b(this._span,"border-radius",this.Ghb+"px")):4===lc||0===lc&&!this.sSa?this._span.style.left="0px":this._span.style.right="0px";2!==jb&&(4===
jb?Bi.a.Rx(this._span,""):1===jb?this._span.appendChild(this.iuk):(this._span.setAttribute("dir","auto"),lc=gc.a.Pwm(Aa.userName),(!Aa.isAnonymous||m.AFrameworkApplication.J.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1))&&lc||0!==jb?(Aa=Aa.userName,0===jb&&(Aa=lc,ug.a.T_b(this._span,"text-align","center")),Bi.a.Rx(this._span,Aa)):(this._img||(this._img=this.RDl()),this._span.appendChild(this._img),ug.a.T_b(this._span,"text-align","start"))))}onClick(Aa){if(0===
this.state)return this.raiseEvent(fd.uX,new fd(1,Aa)),!0;3===this.state&&l.ULS.sendTraceTag(50436114,302,50,"User clicked on presence pill.");return!1}OL(Aa){3===this.state&&this.raiseEvent(fd.uX,new fd(3,Aa));return!1}cS(Aa){3!==Aa.yg&&this.raiseEvent(fd.uX,new fd(2,Aa));return!1}yE(Aa){if(3!==Aa.yg)return!0;this.raiseEvent(fd.uX,new fd(4,Aa));return!1}RDl(){const Aa=document.createElement("img");Aa.src=cf.a.Dea("doughperson_white_glyph.svg");Aa.setAttribute("Unselectable","on");mf.a.Is(Aa,mf.a.Wh,
mf.a.xA);return Bg.createClusteredImageFromClusterWithImageClass(this.Ghb,this.Ghb,null,null,Zf.rbm,"",!1,"",this.element.ownerDocument,Aa)}yVk(Aa,jb=!1,lc=0){if(!this.F8c(this.state)||!this.F8c(Aa))switch(Sys.UI.DomElement.removeCssClass(this.element,this.sMe),this.state){case 4:3===Aa?this.q5a(Zf.rDf,Zf.xpi):this.F8c(Aa)&&this.q5a(Zf.pDf,Zf.xpi);break;case 3:4===Aa?this.q5a(Zf.uDf,Zf.wpi):this.F8c(Aa)&&(jb&&this.dCj(),this.q5a(Zf.pDf,Zf.wpi,jb?Zf.qbm:""));break;case 0:case 1:case 2:4===Aa?this.q5a(Zf.uDf,
Zf.sDf):3===Aa&&(jb&&this.LWk(),this.q5a(Zf.rDf,Zf.sDf,jb?Zf.ypi:"",3===lc?Zf.ubm:Zf.sbm));break;default:4===Aa?this.q5a(Zf.uDf):3===Aa?this.q5a(Zf.rDf):this.F8c(Aa)&&this.q5a(Zf.pDf)}}q5a(...Aa){this.sMe=Aa.join(" ");Sys.UI.DomElement.addCssClass(this.element,this.sMe)}LWk(){this.dhh=window.setTimeout(()=>{this.element&&(this.$hb=this.element.cloneNode(!0),this.element.parentNode.appendChild(this.$hb),this.element.style.zIndex="2",this.$hb.style.zIndex="1")},300)}dCj(){window.clearTimeout(this.dhh);
this.$hb&&(Sys.UI.DomElement.removeCssClass(this.$hb,Zf.sDf+" "+Zf.ypi),Sys.UI.DomElement.addCssClass(this.$hb,Zf.pbm),D.Task.delay(300).continueWith(()=>{this.element&&this.element.parentNode===this.$hb.parentNode&&this.element.parentNode.removeChild(this.$hb)}),ug.a.fvc(this.element,"z-index"))}F8c(Aa){return 0===Aa||1===Aa||2===Aa}c_m(Aa,jb){const lc=ug.a.y0(this.element.style.top);return ug.a.y0(this.element.style.left)===Aa&&lc===jb}Zsg(Aa){3===Aa&&ug.a.uea(this.element,"left")?(Aa=ug.a.y0(this.element.style.left),
ug.a.fvc(this.element,"left"),this.element.style.right=-1*Aa+"px"):4===Aa&&ug.a.uea(this.element,"right")&&(Aa=ug.a.y0(this.element.style.right),ug.a.fvc(this.element,"right"),this.element.style.left=-1*Aa+"px")}}Zf.qDf="prModernFlyout UIFont";Zf.uDf="flyoutIdle";Zf.rDf="flyoutExpanded";Zf.pDf="flyoutCollapsed";Zf.xpi="flyoutFromIdle";Zf.wpi="flyoutFromExpanded";Zf.sDf="flyoutFromCollapsed";Zf.ypi="flyoutStacked";Zf.qbm="flyoutFromStacked";Zf.pbm="flyoutFadeOut";Zf.rbm="cui-img-cont-float cui-img-20by20";
Zf.sbm="flyoutLtrDir";Zf.ubm="flyoutRtlDir";Object(f.a)(Zf,"ModernPresenceTooltipFlyoutControl",dd,[]);class zf{constructor(Aa,jb,lc=2,Nc=4){this.offsetTop=Aa;this.offsetLeft=jb;this.tak=lc;this.AOi=Nc}}Object(f.a)(zf,"FlyoutsPositioningInfo",null,[]);var xh=d(43);class Vj{constructor(Aa=!1,jb=!1){this.yBg=!1;this.Hm=Aa;this.YRe=jb;this.yBg=m.AFrameworkApplication.J.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.OfficeVSO:9192023_CalculateFlyoutDirectionsToHandleRTLScenarios")}cym(Aa,
jb,lc,Nc,qd){const Rd=qd.y,Me=qd.height;var df=this.$jm(Nc);const Cf=df+jb,sg=Aa*lc+2*(Aa-1);lc=null;1===Aa||this.tll(df,sg,Rd,Me)?Aa=new zf(0,0,2):(Aa=this.$Cf(Cf,sg,Rd,Me),Aa.offsetTop-=df);this.YRe?lc=new zf(0,0,void 0,this.Hm?4:3):(Nc=this.Zjm(Nc,qd),df=Math.max(0,qd.x),qd=qd.width,jb=Nc+jb,this.yBg?lc=this.yll(Nc,df,qd):this.ull(Nc,df,qd)?lc=new zf(0,0,void 0,this.Hm?3:4):this.vll(jb,df)&&(lc=new zf(0,0,void 0,this.Hm?4:3)),lc||(lc=this.bam(Nc,jb,df,qd)));return new zf(Aa.offsetTop,lc.offsetLeft,
Aa.tak,lc.AOi)}$jm(Aa){return xh.a.uGf(Aa)}Zjm(Aa,jb){return this.Hm?this.yBg?xh.a.tGf(Aa)-xh.a.Oti(Aa):jb.width-xh.a.tGf(Aa):xh.a.sGf(Aa)}tll(Aa,jb,lc,Nc){return Aa+jb<=lc+Nc}$Cf(Aa,jb,lc,Nc){let qd=1,Rd=Math.max(lc,Aa-jb);jb>Aa-lc&&(qd=2,Rd=jb<Nc?Nc-jb:lc);return new zf(Rd,0,qd)}yll(Aa,jb,lc){const Nc=this.wll(Aa,jb);Aa=this.xll(Aa,jb,lc);if(Nc||Aa)return new zf(0,0,void 0,this.Hm?Nc?3:4:Aa?4:3)}ull(Aa,jb,lc){return Aa+150<=jb+lc}vll(Aa,jb){return 150<=Aa-jb}xll(Aa,jb,lc){return Aa+150<=jb+lc}wll(Aa,
jb){return jb<=Aa-150}bam(Aa,jb,lc,Nc){Nc-jb>=Aa-lc?Aa=4:(jb=Aa,Aa=3);return new zf(0,jb,void 0,Aa)}}Object(f.a)(Vj,"ModernPresenceTooltipPositioner",null,[]);class Ui{constructor(Aa,jb,lc,Nc,qd,Rd,Me){this.sda=Aa;this._parent=jb;this.ybh=lc;this.Vqk=Nc;this.azk=qd;this.Hac=Rd;this.sSa=Me;this._element=document.createElement("div");this.element.className="prTouchTarget"}get element(){return this._element}update(Aa,jb){if(3!==Aa)if(5!==Aa&&this.sda&&this.sda.length){if(4===Aa){var lc=this.azk;var Nc=
(this.Hac-lc)/2;this.element.style.height=this.Hac+"px";this.element.style.width=this.Hac+"px";Aa=ug.a.y0(this.sda[0].element.style.top);jb=ug.a.y0(this.sSa?this.sda[0].element.style.right:this.sda[0].element.style.left)}else lc=this.ybh,Nc=(this.Hac-lc)/2,this.element.style.height=this.Hac+"px",this.element.style.width=this.emm()+2*Nc+"px",Aa=ug.a.y0(this.sda[this.sda.length-1].element.style.top),jb=this.ykl(this.sda[this.sda.length-1].element,lc,jb);ug.a.T_b(this.element,"border-radius",this.Hac+
"px");this.element.style.top=Aa-Nc-lc+"px";this.sSa?this.element.style.right=jb-Nc+"px":this.element.style.left=jb-Nc+"px";this.element.parentNode||this._parent.insertBefore(this.element,this._parent.firstChild)}else this.element.parentNode&&this.element.parentNode.removeChild(this.element)}ykl(Aa,jb,lc){return this.sSa&&!lc?ug.a.y0(Aa.style.right):this.sSa||lc?this.sSa&&lc?-ug.a.y0(Aa.style.left)-jb:-ug.a.y0(Aa.style.right)-jb:ug.a.y0(Aa.style.left)}emm(){return this.sda&&this.sda.length?this.ybh+
Math.min(this.sda.length-1,2)*this.Vqk:0}}Object(f.a)(Ui,"ModernPresenceTooltipTarget",null,[]);var Bb=d(151),Pb=d(182);class zc extends dd{constructor(Aa,jb,lc){super(Aa);this.f$b=this.cRa=this.imh=this.dEb=!1;this.Xq=[];this.sYa=(Nc,qd)=>{Nc=this.K1b;this.Adl()||2!==qd.type&&(4!==qd.type||3===Nc)?4===qd.type&&3===Nc?(this.cRa&&(this.cRa=!1),this.Sof()):3!==qd.type||3!==Nc||this.dEb||(1<this.l8a?(this.cRa=!0,D.Task.delay(250).continueWith(()=>{this.Iec(!0);this.cRa=!1})):this.Sof()):(this.cRa&&(this.cRa=
!1),3!==Nc&&(this.Wli(),3===qd.Vo.yg&&this.Sof(2E3)));this.raiseEvent(fd.uX,qd)};this.qsc=Nc=>{3===Nc.yg?this.sYa(this,new fd(4,Nc)):Nc.eventName===me.a.UL?this.sYa(this,new fd(2,Nc)):Nc.eventName===me.a.qH&&this.sYa(this,new fd(3,Nc));return!1};this.RCd={};this.Oe=lc;this.Hm=lc.get(8,!1);this.Wkh=lc.get(15,!1);this.atk=lc.get(12,0);this.Nmb=lc.get(6,0);this.Zkb=jb;this.$Jh=lc.get(16);this.YRe=lc.get(17,!1);this.dzk=lc.get(19,!1);this.qJk=lc.get(20,!1);this.DFd=0;this.kJk=new Vj(this.Hm,this.YRe);
this.cDc=this.swi();this.gHb=!1;this.M3b=[];this.PIc=[];this.element.id=zc.dqb();this.element.className=dd.wai(this.Hm);this.n7a&&(this.zIndex=this.n7a);this.rtl=this.Hm;this.Jxg(jb);this.L9=this.createElement("div");this.L9.className="prFlyoutContainer";this.element.appendChild(this.L9);this.sda=[];this.zib=new Ui(this.X6,this.element,this.Nmb,4,6,32,this.Hm);this.rx=lc.get(9);this.rx.ub(me.a.kt,this.zib.element,this.qsc);this.rx.ub(me.a.UL,this.zib.element,this.qsc);this.rx.ub(me.a.qH,this.zib.element,
this.qsc)}get kqe(){return Pb.a.clone(this.Xq)}get X6(){return this.sda}get n7a(){return this.atk}get l8a(){return this.X6?this.X6.length:0}get K1b(){return 0<this.l8a?this.X6[0].state:5}get PXf(){return 3===this.K1b&&!this.dEb}uKb(Aa){this.addHandler(fd.uX,Aa)}jZb(Aa){this.removeHandler(fd.uX,Aa)}dispose(){if(this.PXf)this.gHb=!0;else{if(this.X6)for(const Aa of this.X6)Aa.jZb(this.sYa),Gc.a.AD(Aa);this.sda=null;this.rx.xc(me.a.kt,this.zib.element,this.qsc);this.rx.xc(me.a.UL,this.zib.element,this.qsc);
this.rx.xc(me.a.qH,this.zib.element,this.qsc);super.dispose()}}Pxc(){this.Iec();this.visible=!0}opd(){this.visible=!0;this.Wli();this.dEb=!0}BBg(){this.opd()}hide(){this.JCj();this.R9a();this.zib.update(this.K1b,this.f$b)}Pja(Aa){const jb=this.K1b,lc=this.dEb;Aa.clientId||(Aa.clientId=(zc.iJc++).toString());if(Aa.clientId in this.RCd){var Nc=this.TOb(Aa.clientId);if(0<=Nc){Nc=this.Xq[Nc];if(Nc.color===Aa.color&&Nc.userName===Aa.userName)return;this.$cb(Aa.clientId)}}this.hide();Nc=new Zf(this.createElement("div"),
this.Oe);Nc.uKb(this.sYa);this.L9.insertBefore(Nc.element,this.L9.firstChild);this.RCd[Aa.clientId]=Nc;Array.add(this.Xq,Aa);Array.add(this.X6,Nc);this.y9j(jb,lc);this.visible=!0}$cb(Aa){if(this.PXf)Array.add(this.PIc,Aa);else{var jb=this.K1b,lc=this.dEb;this.hide();this.Dkd(Aa);this.y9j(jb,lc)}}cfj(Aa){const jb=this.TOb(Aa);if(!(0>=jb)){var lc=this.Xq[jb];Aa=this.RCd[Aa];Array.removeAt(this.Xq,jb);Array.insert(this.Xq,0,lc);Array.removeAt(this.X6,jb);Array.insert(this.X6,0,Aa);this.L9.removeChild(Aa.element);
this.L9.appendChild(Aa.element);this.Iec()}}y9j(Aa,jb){0>=this.Xq.length?this.hide():3===Aa&&jb?this.opd():this.Pxc()}FAf(Aa){if(this.PXf&&this.dzk)return!1;Aa=zc.fMf(Aa);if(this.L9!==Aa&&Bi.a.KWa(this.L9,Aa))return!0;for(const jb of this.X6)if(Bi.a.KWa(jb.element,Aa))return!0;return!1}position(Aa,jb){this.element.style.top=jb+"px";this.element.style.left=Aa+"px"}Iec(Aa=!1){if(!Aa||this.cRa){this.imh&&this.DPj(!0);var jb=Math.min(3,this.l8a)-1;Aa=0;var lc=1,Nc=0;this.f$b&&(Aa=this.cDc,lc=-1,Nc=-this.Nmb);
for(let qd=this.l8a-1;qd>jb;qd--)this.X6[qd].OTj(this.Xq[qd],-4*jb*lc+Nc,!0,!1,!0,Aa);for(;0<=jb;jb--)this.X6[jb].OTj(this.Xq[jb],-4*jb*lc+Nc,0<jb,Array.contains(this.M3b,this.Xq[jb].clientId),jb!==this.DFd,Aa);this.DFd=0;this.zib.update(0,this.f$b);this.zIndex=this.n7a;this.dEb=!1;this.JCj(0);this.gHb&&this.dispose()}}Wli(){this.imh&&this.DPj(!1);this.zIndex=this.n7a+1;const {offsetX:Aa,offsetY:jb,zOi:lc}=this.tWo();for(let Nc=0;Nc<this.l8a;Nc++)this.X6[Nc].b8o(this.Xq[Nc],Aa,jb+(this.Nmb+2)*Nc,
Nc!==this.DFd,lc)}R9a(){let Aa=0,jb=0;this.f$b&&(Aa=this.cDc,jb=-6);for(let lc=0;lc<this.l8a;lc++)this.X6[lc].hide(this.Xq[lc],jb,Aa);this.zIndex=this.n7a;this.visible=this.dEb=!1;this.gHb&&this.dispose()}Sof(Aa=0){Aa?(this.cRa=!0,D.Task.delay(Aa).continueWith(()=>{this.Wkh?this.U0m():this.Iec(!0);this.cRa=!1})):this.Wkh?this.hide():this.Iec()}U0m(){this.cRa&&this.hide()}Adl(){if(m.AFrameworkApplication.ua&&m.AFrameworkApplication.ua.Gb.PBa&&Bb.c()){const Aa=appChrome.selectors.getShyState();return Aa.isActive&&
0!==Aa.state}return!1}Jxg(Aa){this.element.style.width=Aa+"px";this.element.style.height=this.Nmb+"px"}Dkd(Aa){this.Gyo(Aa);Aa=this.TOb(Aa);if(!(0>Aa)){var jb=this.Xq[Aa];Array.removeAt(this.Xq,Aa);delete this.RCd[jb.clientId];jb=this.X6[Aa];this.L9.removeChild(jb.element);this.Oe.get(18,!1)&&jb.jZb(this.sYa);Array.removeAt(this.X6,Aa);jb.dispose()}}JCj(Aa=5){if(this.PIc.length){this.visible&&this.R9a();for(let jb=0;jb<this.PIc.length;jb++)this.Dkd(this.PIc[jb]);Array.clear(this.PIc);0>=this.Xq.length||
5===Aa?this.hide():0===Aa&&this.Pxc()}}TOb(Aa){for(let jb=0;jb<this.Xq.length;jb++)if(this.Xq[jb].clientId===Aa)return jb;return-1}Gyo(Aa){-1===this.TOb(Aa)?l.ULS.sendTraceTag(41706452,302,50,"Cannot remove active editor because client id is invalid"):Array.contains(this.M3b,Aa)&&(Array.remove(this.M3b,Aa),this.Xq[0].clientId===Aa&&0<this.M3b.length&&this.cfj(this.M3b[this.M3b.length-1]),this.Xq[0].clientId===Aa&&1===this.K1b&&this.Iec())}DPj(Aa){Aa?Sys.UI.DomElement.addCssClass(this.L9,"prBackgroundSelection"):
Sys.UI.DomElement.removeCssClass(this.L9,"prBackgroundSelection")}tWo(){let Aa,jb;jb=Aa=0;var lc=this.cDc;if(this.$Jh){const Nc=this.$Jh(this);if(!Nc)return{offsetX:Aa,offsetY:jb,zOi:lc};const qd=4===this.K1b;lc=this.kJk.cym(this.l8a,qd?6:this.Nmb,this.Nmb,this.element,Nc);jb=lc.offsetTop;this.DFd=this.Dwm(lc.tak,lc.offsetTop);lc=lc.AOi;lc!==this.cDc&&(this.Zsg(lc),this.element.dir=3===lc?"rtl":"ltr",this.cDc=lc);lc!==this.swi()?(Aa=this.qJk?-2:qd?-6:-this.Nmb,this.f$b=!0):this.f$b=!1}return{offsetX:Aa,
offsetY:jb,zOi:lc}}Dwm(Aa,jb){if(1===Aa)return this.l8a-1;Aa=Math.abs(jb);return 0<Aa?Aa/(this.Nmb+2):0}Zsg(Aa){for(let jb=0;jb<this.l8a;jb++)this.X6[jb].Zsg(Aa)}swi(){return this.Hm?3:4}static dqb(){return String.format("{0}-{1}","presencetooltip",zc.iJc++)}static fMf(Aa){return Aa.Lb.rawEvent.relatedTarget}}zc.iJc=0;Object(f.a)(zc,"ModernPresenceTooltipControl",dd,[1950,10]);var $c=d(303),Ae=d(305);class Gf{constructor(Aa){this.Oe=Aa;this.Oe.eTa(10,$c.a.instance);this.Oe.eTa(9,Wd.a.instance);this.Oe.eTa(6,
20);this.Oe.eTa(13,Ae.a.instance);this.Oe.eTa(17,!1)}Srf(Aa,jb=!1){this.Oe.eTa(15,jb);return new zc(Aa,20,this.Oe)}}Object(f.a)(Gf,"ModernPresenceTooltipFactory",null,[1949]);class jg extends dd{constructor(Aa,jb){super(Aa);this.Xq=null;this.sSa=jb.get(8,!1);this.Ghb=jb.get(6,0);this.element=Aa;this.element.className=jg.qDf;this._ul=this.createElement("ul");this.element.appendChild(this._ul);this.$g=jb.get(10);this.$g.ub(me.a.click,this.element,Object(Wa.a)(this,this.onClick,"onClick"));this.rx=jb.get(9);
this.rx.ub(me.a.qH,this.element,Object(Wa.a)(this,this.OL,"onPointerOut"));this.rx.ub(me.a.kt,this.element,Object(Wa.a)(this,this.Gna,"stopPropagationAndPreventDefaultBehavior"));this.aO=jb.get(13);this.aO.ub(this.element,Object(Wa.a)(this,this.Gna,"stopPropagationAndPreventDefaultBehavior"))}uKb(Aa){this.addHandler(fd.uX,Aa)}jZb(Aa){this.removeHandler(fd.uX,Aa)}get users(){return this.Xq}dispose(){this.element&&(this.$g.xc(me.a.click,this.element,Object(Wa.a)(this,this.onClick,"onClick")),this.rx.xc(me.a.kt,
this.element,Object(Wa.a)(this,this.Gna,"stopPropagationAndPreventDefaultBehavior")),this.rx.xc(me.a.qH,this.element,Object(Wa.a)(this,this.OL,"onPointerOut")),this.aO.xc(this.element,Object(Wa.a)(this,this.Gna,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}hide(){this.visible=!1}show(Aa,jb,lc){this.hide();!Aa||0>=Aa.length||(this.sSa?this.element.style.right=jb+"px":this.element.style.left=jb+"px",this.element.style.top=lc+"px",this.U_k(Aa),this.visible=!0)}U_k(Aa){this.Xq=Aa;Bi.a.sF(this._ul);
for(let jb=Aa.length-1;0<=jb;jb--)this.Pja(Aa[jb])}Pja(Aa){const jb=document.createElement("li");jb.style.backgroundColor=Aa.color;jb.style.height=this.Ghb+"px";jb.id="fly_"+Aa.clientId;jb.style.lineHeight=this.Ghb+"px";Bi.a.Rx(jb,Aa.userName);jb.setAttribute("dir","auto");this._ul.appendChild(jb)}onClick(){this.hide();return!1}OL(Aa){this.raiseEvent(fd.uX,new fd(3,Aa));return!1}}jg.qDf="prFlyout UIFont";Object(f.a)(jg,"PresenceTooltipFlyoutControl",dd,[]);class hi extends dd{constructor(Aa,jb,lc){super(Aa);
this._img=null;this.Xq=[];this.element.className="prGlyph";this.Oe=jb;this.N9b=this.Oe.get(9);this.rr=this.Oe.get(10);this.aO=this.Oe.get(13);this.D2m();this.Pja(lc);this.uWe=!1}get Ibb(){return this.Xq.length}get users(){return this.Xq}uKb(Aa){this.addHandler(fd.uX,Aa)}jZb(Aa){this.removeHandler(fd.uX,Aa)}dispose(){this.otp();super.dispose()}Pja(Aa){Array.add(this.Xq,Aa);2===this.Ibb?this.Zna(!0):1===this.Ibb?this.Zna(!1):this.Zna(this.uWe)}$cb(Aa){this.r8l(Aa)&&(1<this.Ibb&&this.Zna(!0),1===this.Ibb?
this.Zna(!1):1>this.Ibb&&this.hide())}show(){this.Zna(2<=this.Ibb);this.visible=!0}hide(){this.visible=!1}pwm(Aa){return Aa?this.Tui(0,5):this.Tui(1,4)}r8l(Aa){for(let jb=0;jb<this.Ibb;jb++)if(this.Xq[jb].clientId===Aa)return Aa=this.Xq[jb],Array.removeAt(this.Xq,jb),Aa;return null}Zna(Aa){this.uWe!==Aa&&(this._img&&this.element.removeChild(this._img),this._img=this.pwm(Aa),this.element.appendChild(this._img),this.uWe=Aa);this._img.childNodes[0].style.backgroundColor=this.Xq[this.Xq.length-1].color}Tui(Aa,
jb){const lc=this.Oe.get(6,0),Nc=this.Oe.get(14);return Bg.createClusteredImageFromClusterWithImageClass(lc,lc,this.Oe.get(Aa),this.Oe.get(jb),"cui-img-cont-float cui-img-16by16","",!1,"",this.element.ownerDocument,Nc?Nc.cloneNode(!0):null)}cS(Aa){3!==Aa.yg&&this.raiseEvent(fd.uX,new fd(2,Aa));return!1}onClick(Aa){this.raiseEvent(fd.uX,new fd(1,Aa));return!0}OL(Aa){3!==Aa.yg&&this.raiseEvent(fd.uX,new fd(3,Aa));return!1}otp(){this.element&&(this.N9b.xc(me.a.kt,this.element,Object(Wa.a)(this,this.Gna,
"stopPropagationAndPreventDefaultBehavior")),this.N9b.xc(me.a.UL,this.element,Object(Wa.a)(this,this.cS,"onPointerOver")),this.N9b.xc(me.a.qH,this.element,Object(Wa.a)(this,this.OL,"onPointerOut")),this.rr.xc(me.a.XC,this.element,Object(Wa.a)(this,this.Gna,"stopPropagationAndPreventDefaultBehavior")),this.rr.xc(me.a.click,this.element,Object(Wa.a)(this,this.onClick,"onClick")),this.aO.xc(this.element,Object(Wa.a)(this,this.Gna,"stopPropagationAndPreventDefaultBehavior")))}D2m(){this.element&&(this.N9b.ub(me.a.kt,
this.element,Object(Wa.a)(this,this.Gna,"stopPropagationAndPreventDefaultBehavior")),this.N9b.ub(me.a.UL,this.element,Object(Wa.a)(this,this.cS,"onPointerOver")),this.N9b.ub(me.a.qH,this.element,Object(Wa.a)(this,this.OL,"onPointerOut")),this.rr.ub(me.a.XC,this.element,Object(Wa.a)(this,this.Gna,"stopPropagationAndPreventDefaultBehavior")),this.rr.ub(me.a.click,this.element,Object(Wa.a)(this,this.onClick,"onClick")),this.aO.ub(this.element,Object(Wa.a)(this,this.Gna,"stopPropagationAndPreventDefaultBehavior")))}}
Object(f.a)(hi,"PresenceTooltipGlyph",dd,[]);class xj extends dd{constructor(Aa,jb,lc){super(Aa);this.Xq=[];this.IM=[];this.JRa=0;this.PPc=this.Y6b=!1;this.d8g=null;this.sYa=(Nc,qd)=>{var Rd=Object(z.a)(hi,Nc);Rd=Rd?this.Wni(Rd):-1;if(2===qd.type||1===qd.type&&-1!==Rd&&!this.dfa[Rd].visible)this.bqe(Nc);else if(1===qd.type)this.R9a(),this.Y6b=!1;else if(3===qd.type){if(this.FAf(qd.Vo))return;this.Y6b||this.R9a()}this.raiseEvent(fd.uX,qd)};this.SCd={};this.Oe=lc;this.Hm=lc.get(8,!1);this.qpa=lc.get(11,
!1);Aa=lc.get(12,0);this.XRb=lc.get(6,0);this.Zkb=jb;this.element.id=xj.dqb();this.element.className=dd.wai(this.Hm);Aa&&(this.zIndex=Aa);this.rtl=this.Hm;this.Jxg(jb);this.SFa=this.createElement("div");this.SFa.className=this.qpa?"prContainerV":"prContainerHr";this.element.appendChild(this.SFa);this.nih=Array(this.JRa);for(jb=0;jb<this.JRa;jb++)this.dfa[jb]=new jg(this.createElement("div"),this.Oe),this.dfa[jb].uKb(this.sYa),this.element.appendChild(this.dfa[jb].element)}get kqe(){return Pb.a.clone(this.Xq)}get dfa(){return this.nih}get WLh(){return this.d8g}get Wze(){return this.XRb+
2}get width(){return this.qpa?this.Wze:this.Zkb}get height(){return this.qpa?this.Zkb:this.Wze}uKb(Aa){this.addHandler(fd.uX,Aa)}jZb(Aa){this.removeHandler(fd.uX,Aa)}dispose(){if(this.dfa)for(const Aa of this.dfa)Aa.jZb(this.sYa),Gc.a.AD(Aa);Gc.a.cvg(this.IM);this.IM=this.nih=null;super.dispose()}Pxc(){this.R9a();this.OBg();this.visible=!0;this.Y6b=!1}opd(){!this.IM||1>this.IM.length||(this.R9a(),this.visible=!0,this.OBg(),this.bqe(this.IM[this.IM.length-1]),this.Y6b=!0)}BBg(){if(this.IM&&!(1>this.IM.length)){this.visible=
!0;this.OBg();var Aa=0;for(const jb of this.IM)this.bqe(jb,Aa++);this.Y6b=!1;this.PPc=!0}}hide(){this.visible=!1;this.R9a();for(let Aa=0;Aa<this.IM.length;Aa++)this.IM[Aa].hide();this.Y6b=!1}e1h(){if(!this.PPc)return!1;let Aa=0;for(const jb of this.dfa)jb.visible&&Aa++;return this.PPc=0<Aa&&(this.Xq.length<=this.JRa?Aa===this.Xq.length:Aa===this.JRa)}Pja(Aa){if(!(0>=this.JRa)){Aa.clientId||(Aa.clientId=(xj.iJc++).toString());if(Aa.clientId in this.SCd){var jb=this.TOb(Aa.clientId);if(0<=jb){jb=this.Xq[jb];
if(jb.color===Aa.color&&jb.userName===Aa.userName)return;this.$cb(Aa.clientId)}}jb=this.e1h();var lc=0;if(this.Xq.length<this.JRa){var Nc=new hi(this.createElement("div"),this.Oe,Aa);Nc.uKb(this.sYa);this.Hm&&!this.qpa&&0<this.Xq.length?this.SFa.insertBefore(Nc.element,this.SFa.firstChild):(this.SFa.appendChild(Nc.element),lc=this.IM.length);Array.add(this.IM,Nc)}else this.Hm&&!this.qpa?Nc=this.IM[0]:(lc=this.IM.length-1,Nc=this.IM[lc]),Nc.Pja(Aa);Nc.show();this.SCd[Aa.clientId]=Nc;Array.add(this.Xq,
Aa);this.d7j(Nc,lc);jb&&this.BBg()}}$cb(Aa){const jb=this.e1h();jb&&this.R9a();this.Dkd(Aa);this.Xq.length>=this.JRa&&this.IM.length<this.JRa&&this.Upo();0>=this.Xq.length?this.hide():jb&&this.BBg()}cfj(){}Dkd(Aa){var jb=this.TOb(Aa);0>jb||(Aa=this.Xq[jb],Array.removeAt(this.Xq,jb),jb=this.SCd[Aa.clientId],delete this.SCd[Aa.clientId],jb.$cb(Aa.clientId),this.d7j(jb),0>=jb.Ibb&&(this.SFa.removeChild(jb.element),Array.remove(this.IM,jb),jb.dispose()))}Upo(){var Aa=this.MDm();!Aa||1>=Aa.users.length||
(Aa=Array.clone(this.Xq),Aa.forEach(jb=>{this.Dkd(jb.clientId)}),Aa.forEach(jb=>{this.Pja(jb)}))}TOb(Aa){for(let jb=0;jb<this.Xq.length;jb++)if(this.Xq[jb].clientId===Aa)return jb;return-1}MDm(){return this.Hm&&!this.qpa?this.IM[0]:this.IM[this.IM.length-1]}position(Aa,jb){this.element.style.top=jb+"px";this.element.style.left=Aa+"px"}OBg(){for(let Aa=0;Aa<this.IM.length;Aa++)this.IM[Aa].show()}R9a(){for(let Aa=0;Aa<this.JRa;Aa++)this.dfa[Aa].hide();this.PPc=!1}bqe(Aa,jb=0){if(Aa)if(this.d8g=Aa,this.qpa){const lc=
this.XRb;if(1<Aa.users.length)this.dfa[jb].show(Aa.users,lc,this.height-this.XRb);else{const Nc=this.SFa.children.length;for(let qd=0;qd<this.SFa.children.length;qd++)Aa.element===this.SFa.children[qd]&&this.dfa[jb].show(Aa.users,lc,this.height-(Nc-qd)*this.Wze+2)}}else this.dfa[jb].show(Aa.users,this.width,0)}FAf(Aa){Aa=xj.fMf(Aa);let jb=!1;for(const lc of this.dfa)if(Bi.a.KWa(lc.element,Aa)){jb=!0;break}return this.SFa!==Aa&&Bi.a.KWa(this.SFa,Aa)||jb}d7j(Aa,jb=0){const lc=this.Fen(Aa);lc&&0>=Aa.Ibb?
this.dfa[jb].hide():lc?this.bqe(Aa):this.dfa[jb].hide()}Wni(Aa){let jb=0;for(const lc of this.IM){if(Aa===lc)return jb;jb++}return-1}Fen(Aa){const jb=this.Wni(Aa);return!!this.WLh&&Aa===this.WLh&&-1!==jb&&this.dfa[jb].visible}Jxg(Aa){this.JRa=Aa===this.XRb?1:Math.floor(Aa/this.Wze);this.qpa?(this.element.style.height=Aa+"px",this.element.style.width=this.XRb+"px"):(this.element.style.width=Aa+"px",this.element.style.height=this.XRb+"px")}static dqb(){return String.format("{0}-{1}","presencetooltip",
xj.iJc++)}static fMf(Aa){Aa=Aa.Lb.rawEvent;return Aa.relatedTarget||Aa.toElement}}xj.iJc=0;Object(f.a)(xj,"PresenceTooltipControl",dd,[1950,10]);class xg{constructor(Aa){this.Oe=Aa;this.Oe.eTa(10,$c.a.instance);this.Oe.eTa(9,Wd.a.instance);this.Oe.eTa(6,16);this.Oe.eTa(13,Ae.a.instance)}Srf(Aa){return new xj(Aa,16,this.Oe)}}Object(f.a)(xg,"PresenceTooltipFactory",null,[1949]);var fj=d(263),dg=d(128),Nf=d(54),pg=d(5),ye=d(111),qh=d(6),qg=d(130),dl=d(75),Jk=d(533),Ni=d(316),Wh=d(253);class gh extends Sys.EventArgs{constructor(Aa,
jb){super();this.paragraphId=Aa;this.Uzn=jb}}Object(f.a)(gh,"PresenceControlRenderedEventArgs",Sys.EventArgs,[]);class th extends dd{constructor(Aa,jb,lc,Nc,qd,Rd=null,Me=null){super(null);this.LCd=this.Yn=null;this.kbd=!1;this.Hva=0;this.oq=Aa;this.RQc=jb;this.rx=lc;this.Wj=Nc;this.NPa=qd;th.uEb=0;this.qRh=new vc.a;this.GGj=new vc.a;this.zZ=Rd;this.Aa=Me;this.awk=this.Aa.jc("PresenceIpRenderedFloodgateTimeLapseSec",30);this.jRk=this.Aa.jc("PresenceIpRenderedFloodgateTriggerThreshold",3);this.khb=
0}get tbb(){return m.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled")}E0k(Aa){this.addHandler("CR",Aa)}sDj(Aa){this.removeHandler("CR",Aa)}Ase(){this.raiseEvent("CR",new gh(this.oq.ip.paragraphId,this.kbd))}S8f(){if(Object(Wh.a)(zc,this.Yn)){const Aa=Object(z.a)(zc,this.Yn);th.uEb=0<th.uEb?th.uEb+1:Aa.n7a+1;Aa.zIndex=th.uEb;this.element.style.zIndex=String(th.uEb)}}eHo(){if(Object(Wh.a)(zc,this.Yn)){const Aa=Object(z.a)(zc,this.Yn);th.uEb=Aa.n7a;Aa.zIndex=Aa.n7a;this.element.style.zIndex=
String(Aa.n7a)}}L$i(){this.zZ&&!this.qpp()&&this.zZ.continueWith(()=>{this.zZ.result.logActivity("PresenceIpRendered","PresenceIpRenderedFloodgateEnabled",this.awk)&&this.khb++})}qpp(){return this.khb>=this.jRk}static d$i(){th.Yhh||(th.Yhh=!0,l.ULS.sendTraceTag(4006594,302,50,"First presence ip rendered on the page"))}static dqb(Aa){return th.U3m+Aa.Pyi()}}th.Iuj="data-presence-control";th.fqj="OverlayControlElementOwner";th.U3m="ipId_";th.Juj="WacPresence";th.H8n="PresenceIpPaddingDiv";th.Yhh=!1;
th.uEb=0;Object(f.a)(th,"APresenceControl",dd,[1588,10]);class li{constructor(){this.rotation=this.height=this.width=this.top=this.left=0;this.ceb=!1}}Object(f.a)(li,"PresenceImageControlStyle",null,[1587]);var rg=d(184);class jj extends th{constructor(Aa,jb,lc,Nc,qd,Rd=null,Me=null){super(Aa,jb,lc,Nc,qd,Rd,Me);this.OL=()=>{this.fej();return!1};this.Nne=df=>{this.Yn&&3===df.yg&&(2!==this.Hva?(this.S8f(),this.E0b()):this.fej());return!1}}$cb(Aa){this.Yn&&this.Yn.$cb(Aa)}jFe(){return this.Yn?this.Yn.kqe.length:
0}updatePosition(Aa){if(this.element&&this.element.parentNode){var jb=this.rzi(Aa);if(jb){var lc=Sys.UI.DomElement.getBounds(this.element.parentNode),Nc,qd;({left:lc,top:Nc,height:qd,width:jb}=this.uGm(jb,lc,this.element.parentNode,this.Wj.instance));this.element.style.top=Nc+"px";this.element.style.left=lc+"px";this.element.style.height=qd+"px";this.element.style.width=jb+"px";lc=this.xzi(Aa);ug.a.B8(this.element,lc);Aa=this.AJf(Aa,this.oq.ip.shapeId);this.hQj(lc,jb,this.isSelected(Aa),m.AFrameworkApplication.isRtl);
this.E0b()}}}B0(){this.element&&(Bi.a.xD(this.element),this.Yn.$cb(this.oq.user.clientId),this.Ase())}z5h(Aa,jb,lc,Nc){jb=new li;if(!Nc||!lc)return jb;lc=this.rzi(Aa);if(!lc)return jb;jb.top=lc.y;jb.left=lc.x;jb.height=lc.height;jb.width=lc.width;jb.rotation=this.cJm(Aa);jb.ceb=!0;return jb}mEj(Aa,jb,lc,Nc){th.d$i();this.LCd=Aa;if(Nc){const qd=this.AJf(Aa,this.oq.ip.shapeId);if(!qd)return;const Rd=!this.element;Rd&&this.Xrf(jb.ownerDocument,Aa);Rd||!this.element.parentNode?qd.appendChild(this.element):
this.element.parentNode!==qd&&(this.element.parentNode.removeChild(this.element),qd.appendChild(this.element));this.Yn.Pja(this.oq.user);this.element.style.borderColor=this.oq.user.color;this.element.id=th.dqb(this.oq);lc.ceb&&(this.element.style.height=lc.height+"px",this.element.style.top=lc.top+"px",this.element.style.left=lc.left+"px",this.element.style.width=lc.width+"px",ug.a.B8(this.element,lc.rotation),ug.a.B8(this.Yn.element,-1*lc.rotation),this.hQj(lc.rotation,lc.width,this.isSelected(qd),
m.AFrameworkApplication.isRtl),this.E0b())}this.kbd=!Nc;this.Ase()}cJm(Aa){return this.element&&this.element.parentNode&&this.GFi(ug.a.getTransform(this.element.parentNode))?this.GFi(ug.a.getTransform(this.element)):this.xzi(Aa)}GFi(Aa){return Aa&&-1<Aa.indexOf("deg")&&(Aa=parseInt(Aa.substring(Aa.indexOf("(")+1,Aa.indexOf("deg"))),!isNaN(Aa))?Aa:0}F6j(Aa){this.element.style.borderColor=this.oq.user.color;this.element.id=th.dqb(this.oq);this.updatePosition(Aa)}Xrf(Aa,jb){this.element=Aa.createElement("div");
this.element.setAttribute(th.Iuj,!0);dg.a.Cm(this.element,th.fqj,this);this.element.className=jj.tgo;(Aa=jb.Cb)&&Aa.RT&&(this.element.style.pointerEvents="none");this.element.dir=m.AFrameworkApplication.isRtl?"rtl":"ltr";this.Yn=this.RQc.Srf(this.createElement("div"),!0);this.Yn.Pja(this.oq.user);this.Yn.hide();this.rx.ub(me.a.qH,this.Yn.element,this.OL);this.rx.ub(me.a.kt,this.Yn.element,this.Nne);this.Yn.element.classList.add(th.Juj);this.element.appendChild(this.Yn.element)}uGm(Aa,jb,lc,Nc){let qd=
Aa.y,Rd=Aa.x,Me=Aa.height;Aa=Aa.width;(1<Math.abs(jb.width-lc.offsetWidth)||1<Math.abs(jb.height-lc.offsetHeight))&&Nc&&(qd=Math.round(qd/Nc.nl),Rd=Math.round(Rd/Nc.nl),Me=Math.round(Me/Nc.nl),Aa=Math.round(Aa/Nc.nl));return{left:Rd,top:qd,height:Me,width:Aa}}isSelected(Aa){return Aa.classList.contains(Ni.a.fgc)}hQj(Aa,jb,lc,Nc){this.Yn.element.style.left="auto";this.Yn.element.style.top="auto";this.Yn.element.style.right="auto";this.Yn.element.style.bottom="auto";lc=lc?Math.round(.5*jj.Gva)+jj.Ymp:
0;0<=Aa&&90>Aa||360===Aa?(this.Yn.element.style.top=-.5*jj.Gva-lc+"px",Nc?this.Yn.element.style.right=jb-.5*jj.Gva+"px":this.Yn.element.style.left=jb-.5*jj.Gva+"px"):90<=Aa&&180>Aa?(this.Yn.element.style.left=-.5*jj.Gva-lc+"px",Nc?this.Yn.element.style.bottom=-.5*jj.Gva+"px":this.Yn.element.style.top=-.5*jj.Gva+"px"):180<=Aa&&270>Aa?(this.Yn.element.style.bottom=-.5*jj.Gva-lc+"px",Nc?this.Yn.element.style.left=jb-.5*jj.Gva+"px":this.Yn.element.style.right=jb-.5*jj.Gva+"px"):(this.Yn.element.style.right=
-.5*jj.Gva-lc+"px",Nc?this.Yn.element.style.top=-.5*jj.Gva+"px":this.Yn.element.style.bottom=-.5*jj.Gva+"px")}Ti(Aa,jb){const lc=this.r6d(Aa,jb);return lc?lc.properties:(Aa=this.wzi(Aa,jb))?Aa.properties:null}AJf(Aa,jb){var lc=this.r6d(Aa,jb);return lc&&(lc=lc.BAa(Aa.Kh,Aa))?lc.element:(jb=this.wzi(Aa,jb))?Object(z.a)(Jk.a,jb).fg(Aa.Ic).htmlElement:null}r6d(Aa,jb){Aa=dl.i(Aa.Cb,5);for(const lc of Aa)if(lc.properties.getValue(pg.a.G7a)===jb)return lc;return null}wzi(Aa,jb){Aa=qh.a.eb(Aa.Cb);let lc=
Aa.Vb(6);for(;lc;){const Nc=lc.properties.getValue(pg.a.G7a);if(qg.a.Eq(lc)&&Nc===jb)return lc;lc=Aa.Kf(6)}return null}ewm(Aa){const jb=Nf.a.xf(qg.a.XB(Aa),0);Aa=Nf.a.xf(qg.a.fD(Aa),1);return{ioa:jb,n0m:Aa}}xzi(Aa){Aa=this.Ti(Aa,this.oq.ip.shapeId);return qg.a.K2(Aa)}rzi(Aa){var jb=this.oq.ip;if(!jb||!jb.shapeId)return null;var lc=this.Ti(Aa,jb.shapeId);const Nc=this.AJf(Aa,jb.shapeId);if(!lc||!Nc)return null;let qd=Aa=1,Rd;({ioa:jb,n0m:Rd}=this.ewm(lc));Object(rg.d)(lc)?(lc=qg.a.lsa(lc),Aa=Nf.a.xf(lc[ye.a.left],
0),qd=Nf.a.xf(lc[ye.a.top],1)):lc.hasProperty(pg.a.Jga)?(lc=lc.getValue(pg.a.Jga),Aa+=Nf.a.xf(lc[ye.a.left],0),qd+=Nf.a.xf(lc[ye.a.top],1)):(Aa+=0<Nc.offsetWidth?(Nc.offsetWidth-jb)/2:2,qd+=0<Nc.offsetHeight?(Nc.offsetHeight-Rd)/2:2);return new Sys.UI.Bounds(Math.round(Aa),Math.round(qd),Math.round(jb),Math.round(Rd))}fej(){this.Yn&&(this.Yn.Pxc(),this.Hva=1)}E0b(){for(const Aa of this.Yn.kqe)if(Aa.clientId===this.oq.user.clientId&&!Aa.equals(this.oq.user)){this.Yn.Pja(this.oq.user);break}if(this.oq.A_a||
2===this.Hva)this.Yn.opd(),this.oq.A_a=!1,this.oq.Zfa=!0,this.Hva=2;this.oq.Zfa&&1!==this.Hva||(this.Yn.Pxc(),this.oq.Zfa=!0,this.Hva=1)}}jj.tgo="WACImgPresenceHighlight";jj.Gva=20;jj.Ymp=6;Object(f.a)(jj,"PresenceImageControl",th,[]);var Jl=d(278);class Af{constructor(){this.height=this.top=this.left=this.qUi=0;this.ceb=!1;this.tw=this.Gh=null}}Object(f.a)(Af,"PresenceIpControlStyle",null,[1587]);var kl=d(61);class xi extends th{constructor(Aa,jb,lc,Nc,qd,Rd=null,Me=null,df=null){super(Aa,jb,lc,
Nc,qd,Rd,Me);this.YPc=this.I2a=this.gac=null;this.cS=Cf=>{!this.Yn||this.tbb&&!this.Yn.FAf(Cf)||(this.S8f(),this.Eve(Cf));this.F6j(this.LCd);return!1};this.OL=()=>{this.Yn&&this.vU();return!1};this.Nne=Cf=>{this.Yn&&3===Cf.yg&&(2!==this.Hva?(this.S8f(),this.Eve(Cf)):this.vU());return!1};this.kF=df}Xrf(Aa){this.element=Aa.createElement("div");this.element.setAttribute(th.Iuj,!0);dg.a.Cm(this.element,th.fqj,this);this.element.className=th.H8n;this.element.dir=m.AFrameworkApplication.isRtl?"rtl":"ltr";
this.rx.ub(me.a.UL,this.element,this.cS);this.tbb&&(this.rx.ub(me.a.qH,this.element,this.OL),this.rx.ub(me.a.kt,this.element,this.Nne));this.I2a=this.createElement("div");this.I2a.className=xi.ugo;this.tbb||(this.YPc=this.createElement("div"),this.YPc.className=xi.xgo,this.I2a.appendChild(this.YPc));this.Yn=this.RQc.Srf(this.createElement("div"),this.tbb);Aa=this.Aa.$("NoPresenceUserLookUpBeforeRender");this.kF&&!Aa&&(this.oq.user=this.kF.d6f(this.oq.user.clientId)||this.oq.user);this.Yn.Pja(this.oq.user);
this.Yn.hide();this.Yn.element.classList.add(this.tbb?th.Juj:xi.ibo);this.I2a.appendChild(this.Yn.element);this.element.appendChild(this.I2a)}JQl(){this.gac&&(nb.a.instance.wf(this.gac),this.gac=null)}E0b(Aa){for(var jb of this.Yn.kqe)if(jb.clientId===this.oq.user.clientId&&!jb.equals(this.oq.user)){this.Yn.Pja(this.oq.user);break}jb=!1;xi.nOl===this.oq.user.color?({value:jb}=this.qRh.Ec(this.oq.user.clientId,!1),jb||(this.qRh.W(this.oq.user.clientId,!0),l.ULS.sendTraceTag(17954772,302,50,'{ "ClientID" : "'+
this.oq.user.clientId+'" , "Event" : "RenderGrayPawn"}'))):({value:jb}=this.GGj.Ec(this.oq.user.clientId,!1),jb||(this.GGj.W(this.oq.user.clientId,!0),l.ULS.sendTraceTag(17954773,302,50,'{ "ClientID" : "'+this.oq.user.clientId+'" , "Event" : "RenderColoredPawn"}')));return Aa||this.oq.A_a||2===this.Hva?(this.L$i(),this.Yn.opd(),this.oq.A_a=!1,this.oq.Zfa=!0,this.Hva=2,xi.Blp):this.oq.Zfa&&1!==this.Hva?0:(this.L$i(),this.Yn.Pxc(),this.oq.Zfa=!0,this.Hva=1,xi.Alp)}Eve(Aa=null){this.JQl();const jb=this.E0b(!!Aa);
this.tbb&&Aa&&Aa.eventName===me.a.UL||this.PMo(jb)}vU(){this.Yn&&this.Hva&&(this.eHo(),this.Yn.hide(),this.Hva=0)}PMo(Aa){this.gac=new xa.a(2,1,Aa,()=>{this.gac=null;this.vU()},56);nb.a.instance.$b(this.gac)}updatePosition(Aa){if(this.element&&this.element.parentNode){var jb=this.hAi(Aa);if(jb){Aa=Sys.UI.DomElement.getBounds(this.element.parentNode);jb=new Sys.UI.Bounds(jb.x-Aa.x,jb.y-Aa.y,xi.uUi,jb.height);var lc;({left:Aa,top:jb,height:lc}=this.xGm(jb,Aa,this.element.parentNode,this.Wj.instance));
this.element.style.height=2*xi.etc+lc+"px";this.element.style.top=jb-xi.etc+"px";this.element.style.left=Aa-xi.etc+"px";this.I2a.style.height=Math.max(xi.Vdj,lc)+"px";this.Eve()}}}B0(){this.element&&(Bi.a.xD(this.element),this.Ase())}z5h(Aa,jb,lc,Nc,qd){const Rd=new Af;if(!Nc||!lc)return Rd;Nc=this.hAi(Aa);if(!Nc)return Rd;var Me=lc;lc=Aa;if(Aa.Ij){var df=Aa.ic;Me=Aa.Zf.Nkc(this.oq.ip.aca.cp);0>Me&&0==Me;Aa.ic.Ula?Bi.a.KWa(df.editingElement,Aa.Zf.uj.K(Me))||(lc=Object(kl.a)().Gd.jm(Aa.source),jb=
lc.Zf.uj.K(Me)):jb=lc.Zf.uj.K(Me);Me=jb.getBoundingClientRect()}Me=new Sys.UI.Bounds(Nc.x-Me.x,Nc.y-Me.y,xi.uUi,Nc.height);Aa=Me.y;Nc=Me.x;Me=Me.height;df=this.Wj.instance;qd&&df&&(qd=df.nl,Aa=Math.round(Aa/qd),Nc=Math.round(Nc/qd),Me=Math.round(Me/qd));Rd.top=Aa-xi.etc;Rd.left=Nc-xi.etc;Rd.height=2*xi.etc+Me;Rd.qUi=Math.max(xi.Vdj,Me);Rd.ceb=!0;Rd.Gh=jb;Rd.tw=lc;return Rd}mEj(Aa,jb,lc,Nc){th.d$i();this.LCd=Aa;Aa=lc.Gh;jb=lc.tw;if(Aa&&jb){if(Nc){const qd=!this.element;qd&&this.Xrf(Aa.ownerDocument);
qd||!this.element.parentNode?Aa.appendChild(this.element):this.element.parentNode!==Aa&&(this.element.parentNode.removeChild(this.element),Aa.appendChild(this.element));this.LCd=jb;Aa=this.oq.user.color;this.I2a.style.borderColor=Aa;this.tbb||(this.YPc.style.borderColor=Aa);this.element.id=th.dqb(this.oq);lc.ceb&&(this.element.style.height=lc.height+"px",this.element.style.top=lc.top+"px",this.element.style.left=lc.left+"px",this.I2a.style.height=lc.qUi+"px",this.Eve())}this.kbd=!Nc;this.Ase()}else l.ULS.sendTraceTag(520950942,
302,50,`Skip IpControl rendering due to paragraphElement is null:${!Aa} or paragraphViewElement is null:${!jb}`)}dispose(){this.element&&(this.B0(),this.rx.xc(me.a.UL,this.element,this.cS),this.tbb&&(this.rx.xc(me.a.qH,this.element,this.OL),this.rx.xc(me.a.kt,this.element,this.Nne)),Gc.a.AD(this.Yn),this.element=this.Yn=null);super.dispose()}F6j(Aa){const jb=this.oq.user.color;this.I2a.style.borderColor=jb;this.tbb||(this.YPc.style.borderColor=jb);this.element.id=th.dqb(this.oq);this.updatePosition(Aa)}xGm(Aa,
jb,lc,Nc){let qd=Aa.y,Rd=Aa.x;Aa=Aa.height;(1<Math.abs(jb.width-lc.offsetWidth)||1<Math.abs(jb.height-lc.offsetHeight))&&Nc&&(qd=Math.round(qd/Nc.nl),Rd=Math.round(Rd/Nc.nl),Aa=Math.round(Aa/Nc.nl));return{left:Rd,top:qd,height:Aa}}hAi(Aa){const jb=this.oq.ip;if(!jb)return null;let lc;try{const Nc=jb.aca.cp;lc=Jl.a.f2(Nc,Aa,0<Nc,!1,!1,!1)}catch(Nc){l.ULS.sendTraceTag(4301318,302,15,"Could not determine the bounds of IP: isYielding={0} message={1} stack={2}",nb.a.instance.Yz,Nc.message,Nc.stack),lc=
null}return lc}}xi.ibo="WacPawn";xi.uUi=2;xi.Alp=7E3;xi.Blp=2E3;xi.etc=5;xi.ugo="presenceIp";xi.xgo="PresenceSmallBox";xi.Vdj=10;xi.nOl="0xcccccc";Object(f.a)(xi,"PresenceIpControl",th,[]);class Eh{constructor(Aa,jb,lc,Nc,qd=null,Rd=null,Me=null){this.BFc={};this.zFc={};this.bbh={};this.RQc=Aa;this.rx=jb;this.St=lc;this.NPa=Nc;this.zZ=qd;this.Aa=Rd;this.kF=Me}get JMl(){return this.BFc}get Mbi(){return this.zFc}tGm(Aa){const jb=!!this.Aa&&this.Aa.$("PeoplesWellExtraButtonInfoIsEnabled");return Aa.ip.shapeId&&
jb?this.yGm(Aa):this.zGm(Aa)}yGm(Aa){const jb=Aa.ip.shapeId.toString();this.bbh[Aa.user.clientId]=jb;const lc=this.zFc[jb];return lc?(lc.oq=Aa,{returnValue:lc,gFe:!0}):{returnValue:this.zFc[jb]=new jj(Aa,this.RQc,this.rx,this.St,this.NPa,this.zZ,this.Aa),gFe:!1}}zGm(Aa){const jb=Aa.user.clientId,lc=this.BFc[jb];return lc&&lc.oq.user.equals(Aa.user)?(lc.oq=Aa,{returnValue:lc,gFe:!0}):{returnValue:this.BFc[jb]=new xi(Aa,this.RQc,this.rx,this.St,this.NPa,this.zZ,this.Aa,this.kF),gFe:!1}}iAi(Aa){return this.BFc[Aa]}awm(Aa){return(Aa=
this.zFc[this.bbh[Aa]])&&!Aa.jFe()?Aa:null}eWl(){var Aa=this.BFc;for(const jb in Aa)Aa[jb].dispose();Aa=this.zFc;for(const jb in Aa)Aa[jb].dispose()}}Object(f.a)(Eh,"PresenceControlProvider",null,[]);var Kj=d(629);class Vi{constructor(){this.Rjb=0}iCi(){this.Rjb++;this.Rjb===Number.MAX_VALUE&&(this.Rjb=1);return this.Rjb}static get instance(){return Vi.XMc}}Vi.XMc=new Vi;Object(f.a)(Vi,"PacketIdGenerator",null,[209]);class Qh{constructor(Aa,jb,lc){this.cNo=Aa;this.y5m=jb;this.l5i=lc}}Object(f.a)(Qh,
"SuccessfulInboundReplicationCallbackData",null,[]);class Mh{constructor(Aa,jb,lc,Nc,qd,Rd,Me){this.zKo=(df,Cf)=>{Cf.type||(df=this.em.wii>=this.muk,this.yQk&&df?(df=this.USe())?df.Zzf():l.ULS.sendTraceTag(19682513,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt."):this.bD())};this.A4n=df=>{if(df=Object(z.a)(Qh,df)){var Cf=df.y5m.Ri.toString(),sg=this.USe(),lg=sg.Pr,Ia="";lg!==df.l5i&&(l.ULS.sendTraceTag(19964236,500,50,"Time saved due to force inbound on update notification message = {0} ms",
df.cNo.toString()),Ia=this.xBm(sg,lg,df.l5i));l.ULS.sendTraceTag(19964237,500,50,"Revisions: {0}, InboundDuration: {1}",Ia,Cf)}else l.ULS.sendTraceTag(19964235,500,10,"The callback data was null")};this.xKo=Aa;this.USe=jb;this.em=lc;this.yQk=qd;this.muk=Rd;this.k8b=Nc;this.Ap=Me;this.xKo.AO(this.zKo)}bD(){const Aa=this.USe();if(!Aa)l.ULS.sendTraceTag(19682514,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt.");else if(!this.k8b()&&Aa.Oad){let jb=-1;null!=Aa&&(jb=
Aa.Jua());const lc=this.Ap.Xf("Task","ShoulderTapInboundReplicationTimer");Aa.bD(this.A4n,null,new Qh(jb,lc,Aa.Pr))}}xBm(Aa,jb,lc){const Nc=new Sys.StringBuilder;Aa=Aa.node.ud.store.getRevision(jb);if(!Aa)return l.ULS.sendTraceTag(19964238,500,10,"The revision we got from the last replicator revisionId was null - {0}",{["lastRevisionId"]:jb}),"";for(Nc.append(Aa.id.Gt);jb!==lc;){Nc.append(", ");Nc.append(jb.Gt);Aa=Aa.sm;if(!Aa)break;jb=Aa.id}return Nc.toString()}}Object(f.a)(Mh,"ContentNotificationManager",
null,[]);class Ch extends Mh{constructor(Aa,jb,lc,Nc,qd,Rd,Me){super(Aa,jb,lc,Nc,qd,Rd,Me)}static get Sua(){return null!=Ch.Y2g?Ch.Y2g:Ch.Y2g=Pa.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){if(qb.StaticActiveAppFrame.za()){var Aa=qb.StaticActiveAppFrame.za().kb;Aa&&(Aa.Qja(Ch.Hed),Aa=Aa.hd)&&(Ch.lT=Aa.Ag,Ch.lT&&mb.a.OAa().continueWith(Ch.pdg))}}static pdg(){Ch.Nxd=mb.a.OAa().result;Ch.Nxd&&Ch.Nxd.xm&&Ch.Sua.gD().continueWith(Ch.Gfd)}static Gfd(){Ch.ei=Ch.Sua.gD().result;if(Ch.ei){var Aa=
m.AFrameworkApplication.J,jb=Aa.$("Box4ThrottleInboundRequests");Aa=Aa.jc("Box4ThrottleInboundsAtUserCount",20);Ch.lT.Gkc=()=>Ch.ei.Eba;Ch.Kxd=Ch.Kxd||new Ch(Ch.ei,()=>Ch.lT,Ch.Nxd,()=>m.AFrameworkApplication.Yl,jb,Aa,qb.StaticActiveAppFrame.za().Vr);Ch.Kxd.bD()}}static Hed(Aa){Ch.Kxd||(Aa.bdb(Ch.Hed),Ch.init())}}Ch.Kxd=null;Ch.ei=null;Ch.lT=null;Ch.Nxd=null;Object(f.a)(Ch,"WordContentNotificationManager",Mh,[]);class Al{constructor(Aa,jb,lc,Nc,qd,Rd){this.Fyd=null;this.Ozh=Aa;this.Ad=lc;this.NRa=
Nc;this.oG=qd;this.ri=Rd;this.d3b=jb}clone(){return new Al(this.Ozh,this.d3b.clone(),this.Ad,this.NRa,this.oG,this.ri)}get cp(){if(null!=this.Fyd)return this.Fyd;var Aa=this.Ozh.paragraphId;if(Aa.equals(Of.a.nil))return 0;var jb=this.NRa();if(!jb)return 0;Aa=jb.Eb(Aa);if(!Aa)return l.ULS.sendTraceTag(7685326,302,15,"Paragraph Node is null so returning a CP with value 0"),0;jb=this.Ad.FMb(this.Ad.SYa(Aa.characterData,Aa.ra),this.d3b);if(this.oG){const lc=zb.a.Uc(Aa,jb);this.ri&&Aa.Nv&&(lc.Fb=this.ri.OKf(Aa,
jb,this.d3b.uIa));jb=this.oG.BIa(lc,!0)}return jb}yfg(){null==this.Fyd&&(this.Fyd=this.cp)}equals(Aa){return Aa?this.d3b.isEqual(Aa.d3b,!1):!1}}Object(f.a)(Al,"WordPresenceCp",null,[216,71,217]);class Rj{constructor(Aa,jb){this.oG=Aa;this.ri=jb}create(Aa,jb,lc,Nc){return new Al(Aa,jb,lc,Nc,this.oG,this.ri)}}Object(f.a)(Rj,"Factory",null,[203]);class qk extends Sys.EventArgs{constructor(Aa,jb,lc){super();this.paragraphId=Aa;this.JI=jb;this.eWf=lc}}Object(f.a)(qk,"ParagraphChangedEventArg",Sys.EventArgs,
[]);class eg{constructor(Aa){this.cp=Aa}equals(Aa){return Aa?this.cp===Aa.cp:!1}clone(){return new eg(this.cp)}}Object(f.a)(eg,"PresenceCp",null,[216,71]);class qf{constructor(Aa,jb,lc,Nc,qd){this.paragraphId=Aa;this.cp=jb;this.length=lc;this.shapeId=Nc;this.dryDeletion=qd}}Object(f.a)(qf,"SerializablePresenceIpData",null,[]);class kg{constructor(Aa,jb,lc,Nc=0,qd=0){this.txa=null;Aa&&(this.txa=Of.a.Bf(Aa));this.Nzh=new eg(jb);this.JMa=lc;this.nEh=Nc;this.Ifh=qd}get paragraphId(){return this.txa}get aca(){return this.Nzh}get shapeId(){return this.nEh}get dryDeletion(){return this.Ifh}isValid(){return 0<=
this.aca.cp&&!!this.paragraphId&&!this.paragraphId.equals(Of.a.nil)}getData(){return new qf(this.paragraphId.toString(),this.aca.cp,this.JMa,this.shapeId,this.dryDeletion)}clone(){const Aa=new kg;Aa.txa=this.paragraphId;Aa.Nzh=this.aca?this.aca.clone():null;Aa.JMa=this.JMa;Aa.nEh=this.shapeId;Aa.Ifh=this.dryDeletion;return Aa}static LMb(Aa){return Aa.paragraphId&&void 0!==Aa.cp&&null!==Aa.cp&&void 0!==Aa.length&&null!==Aa.length?new kg(Aa.paragraphId,Aa.cp,Aa.length,void 0,Aa.dryDeletion):null}}Object(f.a)(kg,
"PresenceIp",null,[204,71]);class Wi{constructor(Aa,jb){this.ip=Aa;this.user=jb}}Object(f.a)(Wi,"SerializablePresenceData",null,[]);class ql{constructor(Aa,jb){this.A_a=this.Zfa=this.drc=!1;this.H2a=jb;this.user=Aa}get ip(){return this.H2a}PMf(){return new Wi(this.ip?this.ip.getData():null,this.user.getData())}Pyi(){return this.user.clientId+(this.H2a?this.H2a.paragraphId.toString():Of.a.nil.toString())}isValid(){const Aa=!!this.user&&this.user.isValid(),jb=!this.ip||this.ip.isValid();return Aa&&
jb}clone(){const Aa=new ql;Aa.user=this.user?this.user.clone():null;Aa.H2a=this.H2a?this.H2a.clone():null;Aa.Zfa=this.Zfa;Aa.drc=this.drc;Aa.A_a=this.A_a;return Aa}static LMb(Aa){return Aa?new ql(Ra.LMb(Aa.user),Aa.ip?kg.LMb(Aa.ip):null):null}}Object(f.a)(ql,"PresenceInfo",null,[208,71]);class hg extends ha.a{constructor(){super();this.gNc={};this.p1a={};this.Thh=!1}get N9n(){return this.gNc}get z_i(){return!!m.AFrameworkApplication.J&&m.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled")}QPh(Aa){this.addHandler("PPC",
Aa)}WDj(Aa){this.removeHandler("PPC",Aa)}X3c(Aa){return Aa.ip.paragraphId.toString()}nef(Aa,jb=!1){this.Thh||(this.Thh=!0,l.ULS.sendTraceTag(4289312,302,50,"First presence added to data manager"));var lc=({vgo:Nc}=this.Yun(Aa)).returnValue;if(Nc&&!jb)(lc=this.p1a[Aa.user.clientId])&&0<=lc.length&&(lc[lc.length-1].ip.JMa=Aa.ip.JMa);else{lc||this.OCj(Aa.user.clientId);this.z_i&&lc&&this.qyp(Aa);jb=this.X3c(Aa);var Nc=Aa.user.clientId;var qd=this.gNc[jb]||[],Rd=this.p1a[Nc]||[];Rd.length>=hg.Gcj&&(Rd=
Rd.splice(-hg.mUn,hg.Gcj));lc||qd.push(Nc);Rd.push(Aa);this.gNc[jb]=qd;this.p1a[Nc]=Rd;Aa.ip.paragraphId.equals(Of.a.nil)||this.vog(Aa.ip.paragraphId,Aa,!0)}}Yun(Aa){var jb=this.p1a[Aa.user.clientId];const lc=!jb||0>=jb.length?null:jb[jb.length-1],Nc=!!lc&&this.X3c(lc)===this.X3c(Aa);jb=Nc&&lc.ip.aca.equals(Aa.ip.aca)&&lc.user.equals(Aa.user);this.z_i&&jb&&lc.ip.shapeId&&Aa.ip.shapeId&&lc.ip.shapeId!==Aa.ip.shapeId&&(jb=!1);return{returnValue:Nc,vgo:jb}}qyp(Aa){const jb=this.WMl(Aa);jb&&jb.ip.shapeId&&
(Aa.ip.shapeId&&Aa.ip.shapeId===jb.ip.shapeId||this.vog(jb.ip.paragraphId,jb,!1))}WMl(Aa){Aa=this.p1a[Aa.user.clientId];return!Aa||0>=Aa.length?null:Aa[Aa.length-1]}OCj(Aa){const jb=this.p1a[Aa];if(jb&&0<jb.length){const lc=jb[0].ip.paragraphId,Nc=this.X3c(jb[0]);delete this.p1a[Aa];this.pAo(Nc,Aa);lc.equals(Of.a.nil)||this.vog(lc,jb[0],!1)}}Mui(Aa){return this.gNc[Aa]}L1c(Aa,jb,lc,Nc=!1){const qd=[],Rd=this.Mui(Aa);if(!Rd)return qd;for(let Me=0;Me<Rd.length;Me++){const df=Rd[Me],Cf=this.p1a[df];
let sg=!1;for(let lg=Cf.length-1;0<=lg;lg--){const Ia=Cf[lg];if(Nc){if(Ia.Zfa&&Ia.ip.paragraphId.equals(Of.a.Bf(Aa))){sg=!0;qd.push(Ia);break}}else if(Object(Wh.a)(ql,Ia)?Ia.ip.JMa===jb:Ia.ip.JMa===lc){sg=!0;Ia.drc=!0;qd.push(Ia);this.p1a[df]=Cf.splice(lg,Cf.length);break}}!sg&&0<Cf.length&&Cf[0].drc&&Cf[0].ip.paragraphId.equals(Of.a.Bf(Aa))&&qd.push(Cf[0])}return qd}yhm(Aa){if(!Aa||!Aa.Qa||!Aa.Qa.node)return null;Aa=this.L1c(Aa.Qa.node.id.toString(),0,0,!0);Aa=this.UQm(Aa);Aa.sort((jb,lc)=>{if(!(jb&&
jb.userName&&lc&&lc.userName))return l.ULS.sendTraceTag(542165082,302,15,"Missing presence user info for user in PresenceInfos"),0});return Aa}UQm(Aa){if(!Aa||!Aa.length)return[];const jb=[],lc=new F.a(G.a.vh());for(let Nc=0;Nc<Aa.length;Nc++){const qd=Aa[Nc].user;qd.isAnonymous&&lc.contains(qd.clientId)||!qd.isAnonymous&&qd.email&&lc.contains(qd.email)||(jb.push(qd),lc.add(qd.isAnonymous?qd.clientId:qd.email))}return jb}vog(Aa,jb,lc){this.raiseEvent("PPC",new qk(Aa,jb,lc))}pAo(Aa,jb){Array.remove(this.gNc[Aa],
jb)}}hg.Gcj=10;hg.mUn=2;Object(f.a)(hg,"PresenceDataManager",ha.a,[1561]);class Km extends hg{constructor(Aa){super();this.IH=Aa}nef(Aa,jb=!1){super.nef(Aa,jb)}X3c(Aa){return Aa.ip.ed.toString()}Mui(Aa){Aa=this.IH.Eb(Of.a.Bf(Aa));if(!Aa)return null;Aa=Aa.ka(pg.a.ed,0);return this.N9n[Aa.toString()]}}Object(f.a)(Km,"WordPresenceDataManager",hg,[]);var zg=d(1388),Kd=d(1282),Cg=d(1922),wl=d(37),Kl=d(1293);class ae{constructor(Aa,jb,lc,Nc,qd,Rd,Me,df,Cf,sg,lg,Ia,Zb,Qc,ed,Pd,hb,Id,he,Cd,Wg,cd,If,Rf){this.QSa=
Array(5);this.cbf=this._started=this.l7e=!1;this.K3e=null;this.nAh=new F.a(G.a.vh());this.RId={};this.wXe=!1;this.u9n=()=>{if(!this.cbf&&!this.Fl.vw){var ih=new xa.a(0,1,20,()=>{const mh=new R.a;var Wk=this.ckb.JMl;for(var na in Wk){const db=Wk[na];db.kbd&&mh.add(db.oq.ip.paragraphId)}if(this.gle){Wk=this.ckb.Mbi;for(const db in Wk)na=Wk[db],na.kbd&&!mh.contains(na.oq.ip.paragraphId)&&mh.add(na.oq.ip.paragraphId)}this.Qsi(mh);this.cbf=!1},72);this.Jb.$b(ih);this.cbf=!0}};this.Okj=()=>{this.l7e&&(this.pwg(),
this.l7e=!1)};this.c8=(ih,mh)=>{this.LLj(mh.Rm.currentSelection)};this.SU=(ih,mh)=>{ih=mh.$ha;for(var Wk in ih){const na=ih[Wk];this.Aa.$("CashTelemetryIsEnabled")&&this.k_c(na,new Date,null);na.ip?this.fef(na):this.Ekd(na.user.clientId)}mh=mh.gZc;for(Wk=0;Wk<mh.length;++Wk)this.uRl(mh[Wk]);this.Qte()};this.zfg=(ih,mh)=>{mh.paragraphId?this.mAp(mh.paragraphId.toString(),mh.Uzn,this.RId):l.ULS.shipAssertTag(8758481,302,!1,"null paraid")};this.Kuj=(ih,mh)=>{mh.paragraphId&&(ih=this.AK.Eb(mh.paragraphId))&&
((Object(Wh.a)(ql,mh.JI)?this.KSe(ih):this.LSe(ih))===mh.JI.ip.JMa&&this.WMo(mh.paragraphId),this.gle&&this.wgo(mh))};this.Tp=Aa;this.ib=Nc;this.kF=qd;this.oHb=Rd;this.Fl=Cf;this.kuk=sg;this.ckb=lg;this.AK=lc;this.KSe=Zb;this.LSe=Qc;this.mmk=Me;this.nuk=df;this.HRa=ed;this.Zr=Pd;this.Rc=hb;this.Jb=Id;this.EHh=cd;this.rKk=Rf;this.L3e=Cd;this.Aa=Wg;this.uId=jb;ae.xJd=new vc.a;for(Aa=0;Aa<this.uId.length;Aa++)this.uId[Aa].Ewo(this);this.oHb.QPh(this.Kuj);this.Tp.wya(this.SU);If&&this.Fl.g6(this.u9n);
this.Tp.ite(this)}get gle(){return!!this.Aa&&this.Aa.$("PeoplesWellExtraButtonInfoIsEnabled")}Qte(Aa=!1){this.EHh&&!Aa||this.iEj()}iEj(){const Aa=new R.a,jb=this.RId;for(const lc in jb)Aa.add(Of.a.Bf(lc));this.Qsi(Aa);this.RId={}}pwg(){this.ib.gb&&this.LLj(this.ib.gb.currentSelection,!0)}LLj(Aa,jb=!1){this.rKk||(this.AK.Mm.ima||jb?Aa?(jb=this.oJl(Aa))?this.Tp.Cwg(jb):(this.Tp.Cwg(null),l.ULS.sendTraceTag(4281418,302,50,"Not supported selection context {0}",Aa.Qa.contextId)):this.Tp.Cwg(null):this.l7e=
!0)}oJl(Aa){if(!this.gle||!Aa.cub)if(Aa=wl.a.vk(Aa,!0,!1),!wl.a.ym(Aa))return null;return this.HXh(Aa)}HXh(Aa){const jb=Aa.Qa.cpBegin,lc=Aa.Qa.node.id;Aa=this.KSe(Aa.Qa.node);return new kg(lc.toString(),jb,Aa)}k_c(Aa,jb,lc){if(this.L3e)if(Aa&&Aa.user&&Aa.user.clientId){var Nc=Aa.user.clientId;this.nAh.contains(Nc)||(this.K3e?(this.K3e.k_c(Nc,jb,null,ae.mJm(lc||Aa.user.client)),this.nAh.add(Nc)):this.L3e.continueWith(()=>{this.K3e=this.L3e.result;this.k_c(Aa,jb,lc)}))}else l.ULS.sendTraceTag(42262876,
302,15,"invalid presence")}vGm(Aa){const jb=new R.a;for(let lc=0;lc<Aa.length;lc++)jb.add(this.LQm(Aa[lc]));return jb}fef(Aa){var jb=null;Aa&&Aa.user&&(jb=Aa.user.client);Aa=Aa.clone();Aa.user=this.kF.d6f(Aa.user.clientId)||Aa.user;this.Aa.$("CashTelemetryIsEnabled")&&this.k_c(Aa,new Date,jb);Aa.isValid()&&!Aa.user.pN()&&(jb=Aa.user.clientId,ae.xJd.tb(jb)||this.uLi(jb),this.bAp(jb),Aa.user.userName=CommonUIStrings.l_AnonymousUserName);this.oHb.nef(Aa,!1)}bAp(Aa){const {value:jb}=ae.xJd.Ec(Aa,!1);
jb||(ae.xJd.W(Aa,!0),l.ULS.sendTraceTag(17954774,302,50,'{ "ClientID" : "'+Aa+'" , "Event" : "CreateAnonymousGrayPawn"}'))}uLi(){}Ekd(Aa){this.oHb.OCj(Aa)}uRl(Aa){this.Ekd(Aa);const jb=this.ckb.iAi(Aa);jb&&(jb.sDj(this.zfg),jb.dispose());this.gle&&(Aa=this.ckb.awm(Aa))&&(Aa.sDj(this.zfg),Aa.dispose())}nkc(Aa){if(12!==Aa.type)return new R.a;Aa=this.oHb.L1c(Aa.id.toString(),this.KSe(Aa),this.LSe(Aa));return 0>=Aa.length?new R.a:this.vGm(Aa)}mAp(Aa,jb,lc){!jb&&Aa in lc&&delete lc[Aa]}dispose(){this.stop();
this.oHb.WDj(this.Kuj);this.Tp.GZa(this.SU);this.Tp.IJg(this);for(let Aa=0;Aa<this.uId.length;Aa++)this.uId[Aa].iup(this);Gc.a.cvg([this.mmk,this.nuk,this.Tp]);this.ckb.eWl()}LQm(Aa){let jb=!1;Aa=({gFe:jb}=this.ckb.tGm(Aa)).returnValue;jb||Aa.E0k(this.zfg);return Aa}rJi(Aa){Aa=this.AK.Eb(Aa);if(!Aa)return this.QSa[0]||(l.ULS.sendTraceTag(4281420,302,50,"Could not find the node in object space"),this.QSa[0]=!0),null;if(!Ha.ParagraphReader.Wb(Aa))return this.QSa[1]||(l.ULS.sendTraceTag(4281421,302,
50,"Not a paragraph node"),this.QSa[1]=!0),null;if(!Aa.fg(this.Fl.Ic))return this.QSa[2]||(l.ULS.sendTraceTag(4281422,302,50,"No ViewElement found for this node"),this.QSa[2]=!0),null;if(!Aa.anchor)return this.QSa[3]||(l.ULS.sendTraceTag(4281423,302,50,"node is not anchored"),this.QSa[3]=!0),null;this.QSa[4]||(l.ULS.sendTraceTag(4564931,302,50,"Valid paragraph node found for rendering ip"),this.QSa[4]=!0);return Aa}uCj(Aa){Aa=this.oHb.L1c(Aa.toString(),-1,-1,!0);if(!Pb.a.Qf(Aa))for(const jb of Aa)(Aa=
this.ckb.iAi(jb.user.clientId))&&Aa.element&&Aa.B0()}Qsi(Aa){if(Aa.count){var jb=new R.a;for(var lc of Aa)(Aa=this.rJi(lc))?jb.add(Aa):this.uCj(lc);if(jb.count){lc=this.Rc.Lc(2);try{lc.set(this.Zr);for(const Nc of jb)this.Rgi(Nc)}finally{lc&&lc.dispose()}}}}Rgi(Aa){Aa.AL(this.Fl.Ic,32,!0);Aa.AL(this.kuk,32,!0)}WMo(Aa){this.RId[Aa.toString()]=null;this.EHh&&!this.wXe&&(Aa=new xa.a(0,1,200,()=>{this.wXe=!1;this.iEj()},70),this.Jb.$b(Aa),this.wXe=!0)}wgo(Aa){if(Aa.JI.ip.shapeId&&!Aa.eWf){var jb=this.ckb.Mbi[Aa.JI.ip.shapeId.toString()];
jb&&jb.$cb(Aa.JI.user.clientId)}}stop(){this._started&&(this._started=!1,this.ib.gna(this.c8),Kl.a.instance.RDj(this.Okj))}start(){if(!this._started){this._started=!0;this.ib.AB(this.c8);Kl.a.instance.mRd(this.Okj);var Aa=this.Tp.oqb();delete Aa[this.HRa.clientId];this.SU(null,new Cg.a(Aa,[]));this.pwg()}}mze(Aa){if(Aa&&Aa.isValid()&&Aa.ip){var jb=this.oHb.L1c(Aa.ip.paragraphId.toString(),-1,-1),lc=!1,Nc=null;for(let qd=0;qd<jb.length;qd++)if(Nc=jb[qd],Nc.user.clientId===Aa.user.clientId){lc=Nc.A_a=
!0;break}if(lc)if(jb=Nc.ip.paragraphId,Aa=this.rJi(jb)){jb=this.Rc.Lc(2);try{jb.Ab(Aa),this.Rgi(Aa)}finally{jb&&jb.dispose()}}else this.uCj(jb)}}static mJm(Aa){return Aa?Aa?1===Aa?1:2===Aa?2:0:2:0}}ae.xJd=null;Object(f.a)(ae,"PresenceManager",null,[1557,10,169,1558,1559,1560]);class pd{constructor(Aa,jb,lc,Nc){this.D5b=null;this._started=this.YVe=!1;this.EJb=null;this.xYa=(qd,Rd)=>{if(!m.AFrameworkApplication.Yl&&(qd=this.J7j(Rd.Rm),this.D5b&&qd)){qd=this.COe.L1c(this.D5b.toString(),-1,-1,!0);for(Rd=
0;Rd<qd.length;Rd++)this.EJb[qd[Rd].user.clientId]=qd[Rd];0>=qd.length||(qd=this.FFl(qd),this.Qp.sendNotification(qd,!0))}};this.Dmj=(qd,Rd)=>{this.ib.gb&&!m.AFrameworkApplication.Yl&&this.YVe&&this.D5b&&this.D5b.equals(Rd.paragraphId)&&(qd=null,!Rd.eWf||Rd.JI.user.clientId in this.EJb?Rd.eWf||(qd=this.fai(Rd.JI.user.userName,!1),delete this.EJb[Rd.JI.user.clientId]):(qd=this.fai(Rd.JI.user.userName,!0),this.EJb[Rd.JI.user.clientId]=Rd.JI),qd&&this.Qp.sendNotification(qd,!0))};this.ei=Nc;this.ib=
jb;this.COe=Aa;this.Qp=lc;this.ei.ite(this)}start(){this._started||(this._started=!0,this.EJb={},this.COe.QPh(this.Dmj),this.ib.AB(this.xYa),this.J7j(this.ib.gb))}stop(){this._started&&(this._started=!1,this.EJb=null,this.COe.WDj(this.Dmj),this.ib.gna(this.xYa))}FFl(Aa){if(1===Aa.length)return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphSingle,Aa[0].user.userName);const jb=[],lc=Aa.length;for(let Nc=0;Nc<lc;Nc++)jb.push(Aa[Nc].user.userName);return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphMany,
jb.join(Box4Intl.Box4Strings.l_DisplayNameSeparator))}fai(Aa,jb){return String.format(jb?Box4Intl.Box4Strings.l_UserJoiningParagraph:Box4Intl.Box4Strings.l_UserLeavingParagraph,Aa)}dispose(){this.ei.IJg(this);this.stop()}J7j(Aa){if(!Aa)return!1;Aa=Aa.currentSelection;if(!Aa)return!1;Aa=Aa.Qa;if(!Aa)return!1;this.YVe=wl.a.mf(Aa);Aa=Aa.node.id;if(Aa.equals(this.D5b)||!this.YVe)return!1;this.D5b=Aa;this.EJb={};return!0}}Object(f.a)(pd,"PresenceAccessibilityManager",null,[10,169]);class el{constructor(Aa,
jb){this._started=!1;this.wM=null;this.SDd=!1;this.Wed=()=>{this._started&&this.wLj()};this.ei=Aa;jb&&(this.wM=jb,this.wM.Ylb(this.Wed));this.ei.ite(this)}start(){this._started||(this._started=!0,this.wM?this.wLj():this.ei.oC(1,this.K9h()))}wLj(){const Aa=this.SDd;(this.SDd=!!this.wM.gz)&&!Aa&&this.ei.oC(1,this.K9h())}K9h(){const Aa={};Aa.Id="{"+m.AFrameworkApplication.userSessionId.toUpperCase()+"}";Aa.HQ=!1;Aa.NT=1;Aa.WEB=!0;return Aa}stop(){this._started&&(this._started=this.SDd=!1)}dispose(){this.ei.IJg(this);
this.wM&&this.wM.uDj(this.Wed)}}Object(f.a)(el,"EditorsTableNotifier",null,[10,169]);var Yg=d(346),rh=d(18);class Mf extends ae{constructor(Aa,jb,lc,Nc,qd,Rd,Me,df,Cf,sg,lg,Ia,Zb,Qc,ed,Pd,hb,Id,he,Cd,Wg,cd,If,Rf,ih,mh,Wk,na,db,Ob,Sb){super(Aa,jb,lc,Nc,qd,Rd,Me,df,Cf,sg,lg,Zb,Qc,ed,Pd,he,Cd,Wg,cd,If,Rf,ih,mh,db);this.em=null;this.VZl=qc=>{const Ic=!!this.em.hA.ojc(qc);l.ULS.sendTraceTag(579179741,302,50,"ClientId:{0} isPresentAfterPoll:{1}",qc,Ic)};this.UZl=(qc,Ic)=>{l.ULS.sendTraceTag(579179742,302,
15,"EditorsReplicator failed with {0} when looking for ClientId {1}",Ic,qc)};this.Lma=()=>{if(2===Mf.ei.connectionState&&!Fa.SessionStatusManager.instance.hba){const qc={};qc.qs=m.AFrameworkApplication.rootQuerySignature;Mf.ei.c9(qc)}};Ia.fb(rh.a.s9o,Kb.a.application,Mf.aZk,64);Ia.fb(rh.a.crg,Kb.a.application,Mf.crg,64);Ia.fb(rh.a.Png,Kb.a.application,Mf.Png,96);Ia.fb(ia.a.mze,Kb.a.application,Mf.r9o,64);this.nO=hb;this.Ad=Id;this.WJb=Wk;this.HRa.auc=na;this.HRa.auc.G2k(Mf.Emj);Ob.continueWith(()=>
{this.em=Ob.result});l.ULS.sendTraceTag(4006600,302,50,"WordPresenceManager Initialized");(this.K1=Sb)&&this.K1.execute(qc=>{qc.gTa(this.Lma)})}tkc(Aa){if(!Aa||!Aa.anchor)return null;for(Aa=Aa.anchor.Gr;Aa;Aa=Aa.eC)if(Aa.kLa)return Aa.ht.node;return null}HXh(Aa){var jb=null;jb=m.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled");var lc=Aa.Qa.cpBegin,Nc=Aa.Qa.node;jb&&qg.a.Eq(Nc)&&(Nc=this.tkc(Nc));if(!Nc)return l.ULS.sendTraceTag(51242309,302,15,"selectedNode is null"),null;Nc=this.LSe(Nc);
const qd=Aa.Qa.node.ka(pg.a.ed,0);if(!this.nO)return l.ULS.sendTraceTag(35997152,302,15,"paragraphWordIdMapping is null"),null;var Rd=this.nO.value.FQb(qd);const Me=Mf.IH.Eb(Rd);if(!Me)return l.ULS.sendTraceTag(16791249,302,15,"Can't find pid "+Rd),null;lc=this.Ad.EBc(this.Ad.SYa(Me.characterData,Me.ra),lc);lc.uIa=-1===Aa.Qa.Fb?0:Aa.Qa.Fb;Rd=0;jb&&Aa.cub&&(Rd=this.ZKm(Aa));return jb=new $i(this.nO.value,qd,Nc,lc,this.Ad,()=>Mf.IH,this.WJb,Rd)}ZKm(Aa){const jb=qg.a.eKa(Aa.Qa);return jb?jb.properties.ka(pg.a.G7a,
0):Aa.Qa.node.properties.ka(pg.a.G7a,0)}uLi(Aa){this.em&&this.em.Mra&&this.em.Mra.bD(this.VZl,this.UZl,Aa)}dispose(){this.K1&&this.K1.execute(Aa=>{Aa.mZb(this.Lma)});super.dispose()}static get Iw(){return Pa.a.instance.resolve("Common.Utils.IAriaNotifier")}static gD(){return Mf.jJc.task}static get_instance(){return Mf.wJd.task}static AGm(){return Mf.Pzh.task}static get Sua(){return null!=Mf.X2g?Mf.X2g:Mf.X2g=Pa.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){Mf.wJd||(Mf.wJd=new w.a);
Mf.eih&&(l.ULS.sendTraceTag(4256585,302,50,"WordPresenceManager Init"),Mf.eih=!1);if(qb.StaticActiveAppFrame.za()){var Aa=qb.StaticActiveAppFrame.za().kb;Aa?(Aa.Qja(Mf.Hed),Mf.bNc=Aa.Qc,Aa.hta()?(Mf.SQa=Aa.hd.Ag,Mf.SQa?(Mf.IH=Aa.hd.ud,Mf.IH?Mf.Sua.gD().continueWith(Mf.w3n):l.ULS.sendTraceTag(4006599,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to content ObjectSpace of the app")):l.ULS.sendTraceTag(4252228,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to the GraphSpaceReplicator object")):
l.ULS.sendTraceTag(4006598,302,50,"PageView doesn't seem to have been initialized yet. Will try again once we know it's initialized")):l.ULS.sendTraceTag(4006597,302,15,"Can't initialize the WordPresenceManager because workspace is not initialized")}else l.ULS.sendTraceTag(4006596,302,15,"Can't initialize the WordPresenceManager because active AppFrame is not initialized")}static w3n(){Mf.ei=Mf.Sua.gD().result;if(Mf.ei){var Aa=[Mf.bNc.igd,Mf.bNc.Ie.igd],jb=Mb.a.instance,lc=Pa.a.instance.resolve("Box4.Presence.WordPresenceDataManager"),
Nc=new pd(lc,jb,Mf.Iw,Mf.ei),qd=m.AFrameworkApplication.J.$("DoNotAddToEditorsTableOnFrameIsEnabled")?mb.a.xd().hA:null;qd=new el(Mf.ei,qd);var Rd=Pa.a.instance.nf("WordEditor.IParagraphWordIdMapping"),Me=Pa.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),df=Pa.a.instance.resolve("Common.IPeopleInfoProvider");Mf._instance=new Mf(Mf.ei,Aa,Mf.IH,jb,df,lc,Nc,qd,Mf.bNc,Mf.bNc.Ie.Ic,Pa.a.instance.resolve("Box4.Presence.PresenceControlProvider"),m.AFrameworkApplication.va,
Mf.SQa,Ha.ParagraphReader.textLength,Ha.ParagraphReader.Nra,Pa.a.instance.resolve("Box4.Presence.MyPresenceUser"),Rd,Me,La.a.jf.Tl,new Yg.a,nb.a.instance,zg.a.get_instance(),Ja.a.sq(Pa.a.instance.Ta("Common.App.CoauthTelemetry.IPresenceBootTelemetry")),m.AFrameworkApplication.J,m.AFrameworkApplication.J.$("Box4ThrottleAndBatchPresenceRendering"),m.AFrameworkApplication.J.$("Box4DoNotRenderPresenceOutOfView"),Pa.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),Pa.a.instance.resolve("Common.IPresenceStatusProvider"),
!La.a.wt&&!La.a.fn,mb.a.OAa(),Pa.a.instance.Ta("Common.ISessionExpirationManager"));l.ULS.sendTraceTag(23196878,302,50,"WordPresenceManager instance created");Mf.wJd.gg(Mf._instance);Mf.jJc.gg(Mf._instance);Mf.Pzh.gg(Mf._instance);Aa=Pa.a.instance;Aa.ia("WordEditor.Presence.WordPresenceManager",()=>Mf._instance).as("Common.IPresenceRemover").as("Common.IPresenceSender").ha();Aa.resolve("WordEditor.Presence.WordPresenceManager")}else l.ULS.sendTraceTag(4203468,302,15,"Can't initialize the WordPresenceManager because can't get a handle to RtcProxy")}static Hed(Aa){Mf._instance||
(l.ULS.sendTraceTag(4006601,302,50,"WordPresenceManager.OnAppIsInteractive: Trying to initialize again"),(Aa=Object(z.a)(180,Aa))&&Aa.bdb(Mf.Hed),Mf.init())}static Emj(){Mf._instance.pwg()}static aZk(Aa,jb,lc,Nc,qd){lc=qd.split(",");if(!lc||3!==lc.length)return 8;Aa=lc[0].trim();jb=lc[1].trim();lc=Number.parseInvariant(lc[2].trim());Aa=new ql(new Ra(Aa),new kg(jb,lc,-1));if(!Mf.jJc.task.isCompleted)return 8;jb=Mf.gD().result;jb.fef(Aa);jb.Qte();return 32}static crg(Aa,jb,lc,Nc,qd){if(!Mf.jJc.task.isCompleted)return 8;
Aa=Mf.gD().result;Aa.Ekd(qd);Aa.Qte();return 32}static r9o(Aa,jb,lc,Nc,qd){if(!Mf.jJc.task.isCompleted)return 8;Aa=Mf.gD().result;if(!Aa)return 8;Aa.mze(qd);return 32}static Png(Aa,jb,lc,Nc,qd){if(1===lc)return 32;if(!Mf.Sua.gD().isCompleted)return 8;Aa=Mf.Sua.gD().result;if(!Aa)return l.ULS.sendTraceTag(4301136,302,10,"rtcProxy is null when trying to display RTC connection status"),8;qd[Kd.a.Value]=2===Aa.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnected:1===Aa.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnecting:
"";return 32}}Mf._instance=null;Mf.eih=!0;Mf.wJd=new w.a;Mf.jJc=new w.a;Mf.Pzh=new w.a;Mf.IH=null;Mf.bNc=null;Mf.SQa=null;Mf.ei=null;Object(f.a)(Mf,"WordPresenceManager",ae,[]);class mi{constructor(Aa,jb){this.gcb=Aa;this.dgn=jb;this.sa=new ha.a}G2k(Aa){this.sa.addHandler("X",Aa)}HCo(Aa){this.sa.removeHandler("X",Aa)}getStatus(){return this.dgn?this.gcb.cDi().toString():"0"}}Object(f.a)(mi,"WordPresenceStatusProvider",null,[202]);class Ag{constructor(Aa,jb,lc,Nc){this.ei=null;this.Xhh=this.h_e=!1;
this.x3n=()=>{this.sO.isCompleted&&this.sO.result?(this.ei=this.sO.result,this.ei.wya(this.SU),l.ULS.sendTraceTag(5604372,302,50,"Presence Update Monitor is ready.")):l.ULS.sendTraceTag(5604373,302,15,"RtcTask did not complete successfully. No monitoring")};this.SU=(qd,Rd)=>{qd=Rd.$ha;for(const Me in qd)if(Rd=qd[Me],!this.h_e&&Rd.user.WF&&Rd.user.WF!==this.HH.WF){l.ULS.sendTraceTag(5604375,302,15,"Presence received from different local cobalt session Mine:{0} Theirs:{1}",this.HH.WF,Rd.user.WF);this.h_e=
!0;break}this.h_e&&this.ei.GZa(this.SU);this.Xhh||(l.ULS.sendTraceTag(5604374,302,50,"First presence received"),this.Xhh=!0)};this.em=Aa;this.HH=jb;this.sO=lc;lc.continueWith(this.x3n);this.mFk=Nc;this.mFk.M4f=this.HH}}Object(f.a)(Ag,"WordPresenceUpdateMonitor",null,[]);var Hf=d(431),Pg=d(2023),bk=d(1376),Sj=d(224),gj=d(1926),Yi=d(1927),Bl=d(1792);class Ll{constructor(Aa,jb,lc,Nc,qd,Rd,Me){this.sa=new ha.a;this.Noh=this.Lqh=this.vYe=this.Dth=!1;this.ibf=this.aPd=0;this.mbc=null;this.HRa=Rd;this.HRa.clientId=
Aa.clientId;this.Zk=Aa;this.fda=jb;this.Dda=Nc;this.nwk=qd;this.Jb=lc;this.Bhb=new Sj.a;this.eq=Me;this.fda&&this.fda.continueWith(()=>{this.fda.Zo||this.fda.Yi||this.fda.result.ROh(Object(Wa.a)(this,this.Oij,"onAmIAloneChanged"))})}get connectionState(){return this.Zk.connectionState}wya(Aa){this.sa.addHandler("PU",Aa)}GZa(Aa){this.sa.removeHandler("PU",Aa)}QZ(Aa){this.sa.addHandler("CSC",Aa)}qDa(Aa){this.sa.removeHandler("CSC",Aa)}bmb(Aa){this.sa.addHandler("PSU",Aa)}mxb(Aa){this.sa.removeHandler("PSU",
Aa)}amb(Aa){this.sa.addHandler("PSC",Aa)}lxb(Aa){this.sa.removeHandler("PSC",Aa)}Bwg(){}get clientId(){return this.Zk.clientId}AO(Aa){this.sa.addHandler("UN",Aa)}sDa(Aa){this.sa.removeHandler("UN",Aa)}p7m(){this.mbc=Array(12);for(let Aa=0;12>Aa;Aa++)this.mbc[Aa]=0;this.Lqh=this.eq?this.eq.$("UpdateNotificationTaskExperimentIsEnabled"):!0;m.AFrameworkApplication.fG(()=>{this.NHn()})}init(){this.Zk.QZ(Object(Wa.a)(this,this.bK,"onConnectionStateChanged"));this.Zk.wya(Object(Wa.a)(this,this.SU,"onPresenceUpdated"));
this.Zk.bmb(Object(Wa.a)(this,this.xga,"onPersistentStateUpdated"));this.Zk.amb(Object(Wa.a)(this,this.wYa,"onPersistentStateCleared"));this.Zk.AO(Object(Wa.a)(this,this.dS,"onUpdateNotificationReceived"));this.O5h();this.p7m()}ite(Aa){this.Bhb.contains(Aa,(jb,lc)=>jb===lc)||(this.Bhb.add(Aa),2===this.connectionState&&Aa.start())}IJg(Aa){for(let jb=0;jb<this.Bhb.length;jb++)if(this.Bhb.K(jb)===Aa){this.Bhb.fI(jb);break}}connect(){this.vYe||this.Zk.connect()}disconnect(){this.Zk.disconnect()}get ive(){return this.Zk}Fei(Aa){return ql.LMb(Aa)}$wg(Aa,
jb){return(new ql(Aa,jb)).PMf()}Cwg(Aa){Aa&&Aa.isValid()&&!this.Dda()?this.Zk.Bwg(this.$wg(this.HRa.aBm(),Aa)):D.Task.a7(null)}JDa(Aa,jb){return this.Zk.JDa(Aa,jb)}nqb(Aa){return this.Zk.nqb(Aa)}Zic(){return this.Zk.Zic()}oC(Aa,jb,lc=!1){return this.Zk.oC(Aa,jb,lc)}oqb(){return this.A9h(this.Zk.oqb())}c9(Aa){const jb=new w.a;Bl.a.getInstance().Dse(Aa,jb);return jb.task}get Eba(){return this.Zk.Eba}bK(Aa,jb){2===jb.newState&&this.Bhb.forEach(lc=>{lc.start();return!0});jb.newState||this.eq.$("SendRTCMessagesWhileDisconnectedIsEnabled")&&
!this.vYe||this.Bhb.forEach(lc=>{lc.stop();return!0});this.sa.raiseEvent("CSC",jb)}bDf(Aa){return Aa.toLowerCase()}SU(Aa,jb){if(!this.Dda()){Aa=this.A9h(jb.$ha);jb=this.C9h(jb.gZc);var lc=new Cg.a(Aa,jb);jb=new xa.a(0,1,0,()=>{this.sa.raiseEvent("PU",lc)},57);this.Jb.$b(jb)}}A9h(Aa){const jb={};for(const Nc in Aa){var lc=Nc;const qd=this.Fei(Aa[Nc]);qd&&qd.isValid()?jb[this.bDf(lc)]=qd:l.ULS.sendTraceTag(562661590,302,50,"No Valid User {0}",lc)}return jb}C9h(Aa){const jb=Array(Aa.length);for(let lc=
0;lc<Aa.length;lc++)jb[lc]=this.bDf(Aa[lc]);return jb}xga(Aa,jb){if(!this.Dda()){var lc={};Aa=jb.$ha;for(var Nc in Aa)lc[this.bDf(Nc)]=Aa[Nc];Nc=new xa.a(0,1,0,()=>{this.sa.raiseEvent("PSU",new gj.a(jb.type,lc))},80);this.Jb.$b(Nc)}}wYa(Aa,jb){if(!this.Dda()){Aa=this.C9h(jb.pnb);var lc=new Yi.a(Aa);Aa=new xa.a(0,1,0,()=>{this.sa.raiseEvent("PSC",lc)},81);this.Jb.$b(Aa)}}dS(Aa,jb){this.Lqh?this.Qoj(jb):(Aa=new xa.a(0,1,0,()=>{this.Qoj(jb)},58),this.Jb.$b(Aa))}Qoj(Aa){var jb=Date.now();this.sa.raiseEvent("UN",
Aa);jb=Date.now()-jb;500<=jb&&(this.aPd++,l.ULS.sendTraceTag(42563487,302,15,"Update Notification Heuristics: UpdateNotification Type {0} took {1} ms",Aa.type,jb),this.n$l(Aa));this.ibf++}n$l(Aa){0>Aa.type||21<=Aa.type?l.ULS.sendTraceTag(42541602,302,15,"Update Notification Heuristics: UpdateNotification Type out of range {0}",Aa.type):this.mbc[Aa.type]++}NHn(){if(!this.Noh){var Aa={};Aa.TC=this.ibf;Aa.HRC=this.aPd;this.mbc&&0<this.aPd&&(Aa.TBC=this.mbc);this.aPd=this.ibf=0;this.mbc=null;l.ULS.sendTraceTag(42541603,
302,50,"UpdateNotificationHeuristics: {0}",Aa);this.Noh=!0}}dispose(){this.Bhb=new Sj.a;this.Zk.qDa(Object(Wa.a)(this,this.bK,"onConnectionStateChanged"));this.Zk.GZa(Object(Wa.a)(this,this.SU,"onPresenceUpdated"));this.Zk.mxb(Object(Wa.a)(this,this.xga,"onPersistentStateUpdated"));this.Zk.lxb(Object(Wa.a)(this,this.wYa,"onPersistentStateCleared"));this.Zk.sDa(Object(Wa.a)(this,this.dS,"onUpdateNotificationReceived"));this.fda&&this.fda.continueWith(()=>{this.fda.Zo||this.fda.Yi||this.fda.result.IBo(Object(Wa.a)(this,
this.Oij,"onAmIAloneChanged"))});this.Zk.disconnect();l.ULS.sendTraceTag(4564935,302,50,"Disposing of rtcProxyCompleted")}Oij(){this.O5h()}O5h(){let Aa=!1;this.fda?this.fda.continueWith(()=>{this.fda.Zo||this.fda.Yi||(Aa=!this.fda.result.yq);this.Zk.connectionState||!Aa&&!this.nwk()?2!==this.Zk.connectionState||Aa||(this.disconnect(),l.ULS.sendTraceTag(4564937,302,50,"Disconnecting because there are no other users in the doc")):(this.connect(),l.ULS.sendTraceTag(4564936,302,15,"Connecting because there are other authors in the doc"));
!this.Dth&&Aa&&(l.ULS.sendTraceTag(4203466,302,50,"There are other real-time authors in this session"),this.Dth=!0)}):(this.connect(),l.ULS.sendTraceTag(589321547,302,50,"Connecting to rtc because Rtc Always On is enabled"))}vgc(){this.vYe=!0;this.disconnect();l.ULS.sendTraceTag(4564938,302,50,"DisconnectForever")}}Object(f.a)(Ll,"RtcProxy",null,[1554,10,1555,1556]);class fn extends Ll{constructor(Aa,jb,lc,Nc,qd,Rd,Me,df,Cf,sg,lg,Ia,Zb){super(Aa,jb,lc,Nc,qd,Rd,Zb);this.wja=null;this.nO=Me;this.Ad=
df;this.NRa=Cf;this.XMc=sg;this.Y8e=lg;this.WJb=Ia}get yH(){return this.wja||(this.wja=this.Y8e())}bK(Aa,jb){2===jb.newState&&l.ULS.sendTraceTag(4315102,302,50,"RTC Connected");this.CAp();super.bK(Aa,jb)}CAp(){this.yH&&this.yH.aV("RtcConnectionStatusLabel")}Fei(Aa){return Vd.jsf(ah(Aa),this.nO,this.Ad,this.NRa,this.WJb)}$wg(Aa,jb){return Object(Wh.a)($i,jb)?(Aa=new Vd(this.XMc.iCi(),Aa,jb),Bf(Aa.PMf())):super.$wg(Aa,jb)}}Object(f.a)(fn,"WordRtcProxy",Ll,[]);class Yn{constructor(Aa,jb,lc,Nc,qd,Rd,
Me,df,Cf,sg,lg,Ia,Zb){this.Mq=new w.a;this.WEh=!0;this.ee=jb;this.Jb=lc;this.Dda=Nc;this.HRa=qd;this.nO=Rd;this.iya=Me;this.NRa=df;this.XMc=Cf;this.Y8e=sg;this.K1=lg;this.WJb=Ia;this.Aa=Zb}gD(){this.Zpp();return this.Mq.task}dQb(){return Hf.a.then(this.gD(),Aa=>Aa)}Zpp(){if(this.WEh)if(this.WEh=!1,La.a.T_f()&&La.a.RYf()){var Aa=m.AFrameworkApplication.Fe;if(Aa){var jb="{"+m.AFrameworkApplication.userSessionId+"}",lc=m.AFrameworkApplication.userSessionId,Nc=m.AFrameworkApplication.Vug,qd=this.Aa.$("RtcAlwaysOnEnabled"),
Rd=df=>{const Cf=new fn(df,qd?null:mb.a.OAa(),this.Jb,this.Dda,Yn.Gcm,this.HRa,this.nO,this.iya,this.NRa,this.XMc,this.Y8e,this.WJb,m.AFrameworkApplication.J);bk.a.LYo(Cf);this.vwo(Cf);Cf.init();Kj.a.vNa=Cf;this.K1.execute(sg=>{sg.$lb(()=>{Cf.vgc()})});this.Mq.gg(Cf)};if(m.AFrameworkApplication.J.getBooleanFeatureGate("Microsoft.Office.WordOnline.LoadRtcFrom1JS",!1))Promise.all([d.e(4),d.e(2),d.e(10)]).then(d.bind(null,2160)).then(df=>{Me=df.RealtimeChannelNetCore.createInstance(jb,lc,Nc,Aa,this.K1,
1,this.ee,this.Aa.jb("RtcEndpointUrl"),void 0,void 0,null,this.Aa.$("FindSessionOnBootIsEnabled")?Pa.a.instance.resolve("Common.IFindSessionUtils"):null,this.Aa.jb("RtcBootToken"));Rd(Me)});else{var Me=Pg.RealtimeChannel.createInstance(jb,lc,Nc,Aa,this.K1,1,this.ee,this.Aa.jb("RtcEndpointUrl"),void 0,void 0,null,this.Aa.$("FindSessionOnBootIsEnabled")?Pa.a.instance.resolve("Common.IFindSessionUtils"):null,this.Aa.jb("RtcBootToken"));Rd(Me)}}else l.ULS.sendTraceTag(8206365,302,15,"Can't initialize the RtcProxy because ClientRequestManager is null")}else l.ULS.sendTraceTag(8206362,
302,10,"Can't initialize the RtcProxy because dependent scripts are not loaded")}vwo(Aa){const jb=Pa.a.instance;jb.ia("WordEditor.Presence.WordRtcProxy",()=>Aa).as("Box4.Presence.IRtcProxy").as("Common.IRealtimeChannelBasic").ha();jb.resolve("Common.IRealtimeChannelBasic")}static Gcm(){return!1}}Object(f.a)(Yn,"WordRtcProxyProvider",null,[200,201]);class Tl{constructor(){this.Z=null;this.fm=!1}get name(){return"WordEditor.Presence"}init(){l.ULS.sendTraceTag(50995799,302,50,"PresencePackage Init");
La.a.Tbk&&(this.Z.resolve("WordEditor.Presence.WordRtcProxyProvider").gD(),Mf.init(),this.Z.resolve("WordEditor.Presence.WordPresenceUpdateMonitor"));La.a.DWc&&Ch.init();this.Z.resolve("Common.App.Presence.AwayManager");this.Z.resolve("Common.IPeopleInfoProvider");if(Tl.Aoh){const Aa=this.Z.resolve("WordEditor.IMainViewModeManager");Aa.jRd(this.Rsc);Tl.cXe=1===Aa.Gv||2===Aa.Gv}}dispose(){if(!this.fm){this.fm=!0;Mf.gD().continueWith(()=>{Gc.a.AD(Mf.gD().result)});var Aa=this.Z.resolve("Box4.Presence.MyPresenceUser");
Aa&&Aa.auc&&Aa.auc.HCo(Mf.Emj)}}wc(Aa){this.Z=Aa;this.Z.ia("Box4.Presence.MyPresenceUser",()=>new fb).as("Box4.Presence.IMyPresenceUser").as("Common.IPresenceUser").as("Common.IPresenceConverter").ha();Aa.ia("WordEditor.Presence.IWordPresenceCpFactory",()=>new Rj(Aa.resolve("Box4.CpConversionManagerImpl"),Aa.resolve("Box4.IContentControlReader"))).ha();Aa.ia("WordEditor.Presence.WordPresenceUpdateMonitor",()=>new Ag(new U.a(()=>mb.a.xd()),fj.a.instance,Aa.resolve("WordEditor.Presence.WordRtcProxyProvider").dQb(),
Aa.resolve("Box4.Presence.IMyPresenceUser"))).ha();Aa.ia("WordEditor.Presence.WordRtcProxyProvider",()=>new Yn(m.AFrameworkApplication.buildVersion,qb.StaticActiveAppFrame.za().Vr,nb.a.instance,()=>m.AFrameworkApplication.Yl,Pa.a.instance.resolve("Box4.Presence.IMyPresenceUser"),Pa.a.instance.Oa("WordEditor.ParagraphWordIdMapping"),Pa.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),()=>m.AFrameworkApplication.ua&&qb.StaticActiveAppFrame.za().kb&&qb.StaticActiveAppFrame.za().kb.hd?
qb.StaticActiveAppFrame.za().kb.hd.ud:null,Vi.instance,()=>Pa.a.instance.Oa("WordEditor.IStatusBarUser"),Pa.a.instance.Ta("Common.ISessionExpirationManager"),Pa.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),m.AFrameworkApplication.J)).ha().as("Box4.Presence.IRtcProxyProvider").as("Common.Interface.IRtcBasicProvider");Aa.ia("Box4.Presence.PresenceControlProvider",()=>new Eh(Tl.qLl(),Wd.a.instance,Pa.a.instance.Ta("Common.IZoomManager"),Pa.a.instance.resolve("Box4.ICoauthCashTelemetry"),
Ja.a.sq(Pa.a.instance.Ta("Common.ISystemInitiatedFeedbackWithTimeLapse")),m.AFrameworkApplication.J,Aa.resolve("Common.IPeopleInfoProvider"))).ha();Aa.ia("Common.App.Presence.AwayManager",()=>new Ye(Pa.a.instance.resolve("Common.IPresenceUser"),Pa.a.instance.resolve("WordEditor.Presence.WordRtcProxyProvider").dQb(),Mf.AGm(),Pa.a.instance.resolve("Common.IPresenceConverter"),nb.a.instance,m.AFrameworkApplication.J.$("AwayStatusOneMinuteTimeoutIsEnabled")?6E4:m.AFrameworkApplication.J.jc("AwayCoauthorThresholdMs",
9E5),Object(Wa.a)(m.AFrameworkApplication.va,m.AFrameworkApplication.va.Ob,"processAction"),qb.StaticActiveAppFrame.za().$J,m.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled"))).ha();Aa.ia("WordEditor.Presence.WordPresenceStatusProvider",()=>new mi(Pa.a.instance.resolve("WordEditor.IClientPaginationPageNumberFinder"),Pa.a.instance.resolve("WordEditor.ClientPagination.IClientPaginationSettings").Lab)).as("Common.IPresenceStatusProvider").ha();Aa.ia("Common.App.Presence.PeopleInfoProvider",
()=>new Xe(Aa.resolve("WordEditor.Presence.WordRtcProxyProvider").dQb(),mb.a.OAa().CWR(()=>mb.a.OAa().result.hA),Aa.resolve("Common.App.People.IPeopleColorUtils"),Aa.resolve("Common.IPresenceConverter"),Ja.a.sq(Aa.Ta("Common.App.Presence.AwayManager")))).as("Common.IPeopleInfoProvider").ha();Aa.ia("Box4.Presence.WordPresenceDataManager",()=>new Km(qb.StaticActiveAppFrame.za().kb.hd.ud)).as("Box4.IPresenceDataManager").ha()}Rsc(Aa,jb){qb.StaticActiveAppFrame.za()&&qb.StaticActiveAppFrame.za().kG&&
(Tl.rId=null,Tl.cXe=1===jb.ybb||2===jb.ybb)}static get Xpj(){!Tl.rId&&qb.StaticActiveAppFrame.za()&&qb.StaticActiveAppFrame.za().kG&&(Tl.rId=Kj.a.hm.kG.getElementsByClassName(Tl.cXe&&Tl.Aoh?"PaginatedContentContainerDisplayWrapper":"OutlineContainerDisplayWrapper")[0]);return Tl.rId}static qLl(){const Aa=m.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled"),jb=m.AFrameworkApplication.J.$("PresenceIgnoreEventOnExpandedTooltip"),lc=m.AFrameworkApplication.J.$("PresenceIpWidthAdjustForFlyout"),
Nc=new Ac;Nc.add(dc.JQn,Bg.getImageClassWithCluster(m.AFrameworkApplication.Bfa,"MoreUsersGlyph16"));Nc.add(dc.IQn,m.AFrameworkApplication.Lr);Nc.add(dc.qbo,Bg.getImageClassWithCluster(m.AFrameworkApplication.Bfa,Aa?"DoughboyWhiteGlyph_20x20x32":"SingleCollabUserGlyph16"));Nc.add(dc.rbo,m.AFrameworkApplication.Lr);Nc.add(dc.zIndex,1);Nc.add(dc.rtl,m.AFrameworkApplication.isRtl);Nc.add(dc.VFp,Tl.xRm);Nc.add(dc.b4m,jb);Nc.add(dc.ven,lc);return Aa?new Gf(Nc):new xg(Nc)}static xRm(){return Tl.Xpj?xh.a.getElementBounds(Tl.Xpj):
null}}Tl.cXe=!0;Tl.Aoh=m.AFrameworkApplication.J.$("FlippedFlyoutForPaginationViewIsEnabled");Tl.rId=null;Object(f.a)(Tl,"WordPresencePackage",null,[0,1]);var jm=d(1048),Kk=d(1302),gn=d(1058),io=d(195);class rl{constructor(Aa,jb){this.gef=Aa;this.paragraphId=jb}get opType(){return 2}get operation(){return this.gef}}Object(f.a)(rl,"RttAppliedAddParagraphOp",null,[206]);class vm{constructor(Aa,jb){this.TEo=Aa;this.paragraphId=jb}get opType(){return 6}get operation(){return this.TEo}}Object(f.a)(vm,
"RttAppliedReplaceSymbolRangeOp",null,[206]);class Lj{constructor(Aa,jb){this.XEo=Aa;this.paragraphId=jb}get opType(){return 1}get operation(){return this.XEo}}Object(f.a)(Lj,"RttAppliedReplaceTextRangeOp",null,[206]);class wm{constructor(Aa,jb,lc){this.WWj=Aa;this.Vze=jb;this.UXc=lc}get opType(){return 4}get operation(){return this.WWj}get wTk(){return this.WWj.vfc()?this.UXc:this.Vze}}Object(f.a)(wm,"RttAppliedSplitParagraphOp",null,[206]);class aj{constructor(){this.xgb=new vc.a}C1f(Aa){return Aa.toString()}bSc(Aa,
jb){Aa=this.C1f(Aa);this.xgb.tb(Aa)||this.xgb.W(Aa,new R.a);this.xgb.K(Aa).add(jb)}gfg(Aa){switch(Aa.opType){case 1:var jb=Object(z.a)(Lj,Aa);this.bSc(jb.paragraphId,Aa);break;case 6:jb=Object(z.a)(vm,Aa);this.bSc(jb.paragraphId,Aa);break;case 4:jb=Object(z.a)(wm,Aa);this.bSc(jb.Vze,Aa);this.bSc(jb.UXc,Aa);break;case 2:jb=Object(z.a)(rl,Aa),this.bSc(jb.paragraphId,Aa)}}a_n(Aa){return this.Svb(Aa)}Svb(Aa){Aa=this.C1f(Aa);if(!this.xgb.tb(Aa))return new R.a;const jb=this.xgb.K(Aa);this.xgb.remove(Aa);
for(const lc of jb)lc.operation&&(lc.operation.M$=null);return jb}iDm(Aa){let jb;return({value:jb}=this.xgb.Ec(this.C1f(Aa),jb)).returnValue?jb:new R.a}Igm(Aa){for(const jb of this.xgb.values){if(!jb.count)continue;if(2!==jb.K(0).opType)continue;const lc=jb.K(0);if(lc.gef.Pag===Aa)return lc}return null}}Object(f.a)(aj,"RttAppliedOpTracker",null,[181]);var sl=d(255),yi;(function(Aa){Aa[Aa.K4l=0]="expired";Aa[Aa.b_p=1]="dried"})(yi||(yi={}));Object(f.b)("RemoveChangeReason",yi);class Dk{constructor(){this.KEa=
new sl.a}tVk(Aa){if(!Aa)return l.ULS.sendTraceTag(7685333,355,15,"Cannot add a null change to RTTStore"),!1;const jb=Aa.ed,lc=Aa.Vj;this.KEa.tb(jb)||this.KEa.add(jb,new sl.a);this.KEa.K(jb).W(lc,Aa);return this.sNl(jb,lc)?(l.ULS.sendTraceTag(7619921,355,15,"Detected an infinite loop in paragraph {0}, dropping the last packet!",jb),this.KEa.K(jb).remove(lc),!1):!0}SKf(Aa,jb){if(!this.KEa.tb(Aa))return null;Aa=this.KEa.K(Aa);return Aa.tb(jb)?Aa.K(jb):null}t7d(Aa){const jb=new R.a;for(const lc of this.KEa.keys){const Nc=
this.KEa.K(lc);for(const qd of Nc.keys){const Rd=Nc.K(qd);Aa(Rd)&&jb.add(Rd)}}return jb}GCj(Aa,jb){let lc=null;({value:lc}=this.KEa.Ec(Aa.ed,lc)).returnValue?(Aa.activity.jdg(yi[jb]),lc.remove(Aa.Vj),lc.count||this.KEa.remove(Aa.ed)):l.ULS.sendTraceTag(50938848,355,15,"Cannot remove an op that not exist in _changes. WordId: {0}; Reason: {1}",Aa.ed,jb)}Lqg(Aa){this.GCj(Aa,1)}Oqg(Aa){this.GCj(Aa,0)}sNl(Aa,jb){if(!this.KEa.tb(Aa))return!1;Aa=this.KEa.K(Aa);if(!Aa.tb(jb))return!1;for(var lc=Aa.K(jb);lc;){lc=
lc.y4;if(lc===jb)return!0;if(!Aa.tb(lc))break;lc=Aa.K(lc)}return!1}}Object(f.a)(Dk,"RttDataStore",null,[175,176]);var fi=d(286),Dg=d(42),yk=d(275),Ym=d(198),we=d(13),ri=d(59);class Tj{constructor(Aa,jb){this.hme=(lc,Nc)=>{4===this.xo.opType?l.ULS.shipAssertTag(9204866,355,12===Nc.node.type||11===Nc.node.type,"Unexpected graph modification detected during RTT edit"):l.ULS.shipAssertTag(9204867,355,!1,"Unexpected graph modification detected during RTT edit")};this.Svb=()=>{l.ULS.shipAssertTag(9204868,
355,!1,"Unexpected graph modification detected during RTT edit")};this.Pkj=()=>{l.ULS.shipAssertTag(9204869,355,!1,"Unexpected graph modification detected during RTT edit")};this.xo=Aa;if(this.Gm=jb)Aa=this.Gm.qf(12),Aa.ut(this.hme),Aa.ly(this.Svb),Aa.Qo(this.Pkj)}dispose(){if(this.Gm){const Aa=this.Gm.qf(12);Aa.kS(this.hme);Aa.Hua(this.Svb);Aa.LP(this.Pkj)}}}Object(f.a)(Tj,"GraphChangeValidator",null,[10]);class vf{constructor(Aa,jb,lc,Nc){this.id=Aa;this.cpBegin=jb;this.cpEnd=lc;this.kol=Nc}zEp(Aa){var jb=
this.id===Aa.id;jb&&(jb=this.kol.replace("\u00a0"," "),Aa=Aa.characterData.substr(this.cpBegin,this.cpEnd-this.cpBegin).replace("\u00a0"," "),jb=jb===Aa);return jb}}Object(f.a)(vf,"RttOpValidator",null,[221]);class ff{constructor(Aa,jb){this.M$=this.jBc=this.activity=null;this.opType=Aa;this.metadata=jb}NNf(){return""}serialize(){return null}}Object(f.a)(ff,"RttOp",null,[199]);class Kf extends ff{constructor(Aa,jb,lc,Nc,qd,Rd,Me,df,Cf){super(Cf,df);this.ed=Aa;this.Vj=jb;this.RU=lc;this.X7=Nc;this.y4=
qd;this.Wzb=Rd;this.LJ=Me}Eai(){return this.RU.isEqual(this.X7,!0)?new jf.a(0,this.ed,this.Vj,this.RU,void 0,void 0,void 0,this.LJ):new jf.a(1,this.ed,this.Vj,this.RU,this.ed,this.Vj,this.X7,this.LJ)}static r3j(Aa){let jb,lc;var Nc=Aa.yW;if(1===Nc.Ise&&(Nc.KYa!==Nc.FMa||Nc.Neb!==Nc.qzc))return l.ULS.sendTraceTag(8914769,355,15,"We received a ReplaceRange operation spanning multiple paragraphs"),lc=jb=null,Aa=Nc=-1,{returnValue:!1,RU:lc,X7:jb,ed:Aa,Vj:Nc};if(Nc.LJ)return lc=jb=null,Aa=Nc=-1,{returnValue:!1,
RU:lc,X7:jb,ed:Aa,Vj:Nc};jb=lc=Nc.RU;1===Nc.Ise&&(jb=Nc.X7);Aa=Nc.KYa;Nc=Nc.Neb;return{returnValue:!0,RU:lc,X7:jb,ed:Aa,Vj:Nc}}}Object(f.a)(Kf,"RttReplaceRangeOp",ff,[]);var Rg=d(1301),ob=d(473),Nb=d(1014),cc=d(521),Lc=d(458);class Uc extends cc.a{constructor(){super();this.RttStatusRecords=this.FileId=null}Om(){return Lc.a.DKo}static qka(Aa,jb){const lc=new Uc;lc.FileId=Aa;lc.RttStatusRecords=jb;return lc}}Object(f.a)(Uc,"RttStatusRequest",cc.a,[]);class sd{}Object(f.a)(sd,"RttStatusOp",null,[]);
class id{constructor(){this.contentState=this.contentType=this.timeToRender=this.strictlySequentialId=this.packetVersion=this.clientType=this.clientId=this.packetId=null}}Object(f.a)(id,"WireRttStatusOpRecord",null,[]);class Ld extends ob.a{constructor(){super();this.B$b=new R.a;this.r6e=new R.a;this.$l=new Rg.a(m.AFrameworkApplication.J.jc("WordEditorRttStatusReplicatorIntervalMs",6E4));this.enabled=1;Kj.a.z4.register(this)}ajk(){const Aa=Date.now();for(const jb of this.B$b)jb.WWb&&1===jb.WWb&&(jb.WWb=
2,jb.timeToRender=Aa-jb.metadata.eHg)}MGe(Aa){const jb=new sd;jb.metadata=Aa.operation.metadata;jb.opType=Aa.opType;jb.WWb=1;this.B$b.add(jb)}get Tta(){return"RttStatusReplicator"}vfa(){return this.Ce&&this.Ce.status===Nb.a.iY?!0:1===this.enabled&&this.$l.U2()?this.hH():!1}hH(){for(const Aa of this.B$b)if(Aa.WWb&&2===Aa.WWb)return!0;return!1}KZa(){if(1===this._state){this._state=3;const jb=this.B$b.toArray().filter(lc=>2===lc.WWb);var Aa=this.$El(jb);Aa=Uc.qka(m.AFrameworkApplication.rootQuerySignature,
Aa);jb.forEach(lc=>this.B$b.remove(lc));jb.forEach(lc=>this.r6e.add(lc));this.Ce.kr=Aa;this.Ce.bG="RttStatusRequest";this.Ce.status=Nb.a.MI}else 3===this._state&&this.Ce&&this.Ce.status===Nb.a.iY&&(this.$l.e9(),2!==this.Ce.statusCode&&this.B$b.SA(0,this.r6e),this.r6e.clear(),this._state=1)}$El(Aa){const jb=[];Aa.forEach(lc=>{const Nc=new id;Nc.clientId=lc.metadata.clientId;Nc.clientType=lc.metadata.clientType;Nc.packetId=lc.metadata.packetId;Nc.packetVersion=lc.metadata.packetVersion;Nc.strictlySequentialId=
lc.metadata.strictlySequentialId;Nc.contentType=lc.opType;Nc.contentState=lc.WWb;Nc.timeToRender=lc.timeToRender;jb.push(Nc)});return jb}p0b(){return!0}bD(){}nE(){}}Object(f.a)(Ld,"RttStatusReplicator",ob.a,[]);class ne{constructor(Aa,jb,lc,Nc,qd,Rd){this.packetId=Aa;this.clientId=jb;this.clientType=lc;this.eHg=Nc;this.packetVersion=qd;this.strictlySequentialId=Rd}static create(Aa){let jb=null;null!=Aa.strictlySequentialId&&(jb=Aa.strictlySequentialId);return new ne(Aa.packetId,Aa.clientId,Aa.client,
Date.now(),Aa.version,jb)}}Object(f.a)(ne,"RttOpMetadata",null,[]);class kf extends ff{constructor(Aa,jb,lc,Nc,qd,Rd,Me,df,Cf){super(4,Cf);this.y4=0;this.ed=Aa;this.Vj=jb;this.offset=lc;this.LJ=Nc;this.yNg=qd;this.LGg=Rd;this.mGe=Me;this.MGg=df;this.yNg===this.ed?this.y4=this.LGg:this.mGe===this.ed?this.y4=this.MGg:(l.ULS.sendTraceTag(8397766,355,10,"Bad data passed to RttSplitParagraphOp"),this.y4=0)}vfc(){return this.ed===this.mGe}get mkp(){return this.y4}get vIp(){return this.vfc()?this.yNg:this.mGe}get Y_j(){return this.vfc()?
this.LGg:this.MGg}serialize(){const Aa=new jf.a(3,this.ed,this.Vj,this.offset,null,null,null,this.LJ),jb=new jd(this.yNg,this.LGg,this.mGe,this.MGg);return new Jc(this.metadata.packetId,this.metadata.clientId,1,4,Aa,null,void 0,void 0,void 0,void 0,jb,void 0,void 0,this.metadata.strictlySequentialId)}static create(Aa){const jb=Aa.yW,lc=Aa.M0b;return new kf(jb.KYa,jb.Neb,jb.RU,jb.LJ,lc.Uhg,lc.KGg,lc.Vhg,lc.NGg,ne.create(Aa))}static vJm(Aa,jb,lc){if(1!==Aa.type)return null;const Nc=lc.SYa(Aa.Y7.characterData,
Aa.Y7.ra);return new kf(Aa.Y7.ed,Aa.Y7.Vj,lc.EBc(Nc,Aa.IWj),Aa.LJ,Aa.ZJb.ed,Aa.ZJb.Vj,Aa.LTc.ed,Aa.LTc.Vj,jb)}}Object(f.a)(kf,"RttSplitParagraphOp",ff,[178,199]);class vg{constructor(Aa,jb,lc,Nc){this.$Vn=()=>{this.eIb.ajk()};this.yoa=Aa;this.rMc=jb;this.ipa=lc;this.fJb=Nc;null!=m.AFrameworkApplication.J&&m.AFrameworkApplication.J.getBooleanFeatureGate("Microsoft.Office.WordOnline.WordEditorRttStatusReplicatorIsEnabled",!1)&&(this.eIb=new Ld,fi.a.instance.QOh(this.$Vn))}Z8k(Aa,jb,lc,Nc=null){if(jb.isDirty)return Nc&&
Nc.properties.W(vg.frj,"1"),!1;const qd=new Tj(Aa,jb.Fk);try{if(1===Aa.opType||6===Aa.opType){const df=Object(z.a)(Kf,Aa),Cf=this.EAl(df,jb);var Rd=Cf.node.characterData;const sg=10<=Cf.cpBegin?Cf.cpBegin-10:0;let lg=Cf.cpEnd+10<=Rd.length?Cf.cpEnd+10:Rd.length;const Ia=Rd.substr(sg,Cf.cpBegin-sg),Zb=Rd.substr(Cf.cpEnd,lg-Cf.cpEnd);lg=lg+df.Wzb.length-(Cf.cpEnd-Cf.cpBegin);var Me=new vf(Cf.node.id,sg,lg,Ia+df.Wzb+Zb);const Qc=6===df.opType;Rd="";Qc&&(Rd=df.font);if(!this.CEo(Cf,df.Wzb,Qc,Rd,Nc))return!1;
let ed;ed=1===Aa.opType?new Lj(df,jb.id):new vm(df,jb.id);jb.Nra=Aa.y4;df.jBc=Me;Aa.M$=ed;lc.gfg(ed);null!=this.eIb&&this.eIb.MGe(ed)}else return 4===Aa.opType?this.Y8k(Aa,jb,lc):!1}finally{qd&&qd.dispose()}return!0}Y8k(Aa,jb,lc){const Nc=Object(z.a)(kf,Aa);var qd=this.fJb.SYa(jb.characterData,jb.ra);qd=this.fJb.FMb(qd,Nc.offset);if(!this.p1i(zb.a.createTextRange(jb,0,Ha.ParagraphReader.textLength(jb))))return!1;var Rd=qh.a.eb(jb);Rd.zb(10);if(this.Kee(Rd))return!1;let Me;Rd=this.ipa.Lc(3);try{Rd.Ab(jb);
const df=jb.H0();try{const Cf=qh.a.eb(jb);Cf.zb(10);Cf.kd(11);let sg=Cf.currentNode;Nc.vfc()&&(Cf.UXf?sg=null:(Cf.cP(),sg=Cf.currentNode));Cf.uc();const lg=this.rMc.fob();Cf.VJ(lg,sg,89);Cf.Yj(lg);Me=jb.clone();const Ia=Me.H0();try{Me.setValue(pg.a.ed,Nc.vIp);Me.setValue(pg.a.Vj,Nc.Y_j);Me.isDirty=!1;Cf.Wf(Me,2);Cf.Yj(Me);this.wCl(jb,Me);const Zb=Nc.vfc()?Me:jb,Qc=Nc.vfc()?jb:Me;Zb.YQ=!0;Qc.YQ=!0;this.yoa.Asg(this.FIa(Zb,qd,Ha.ParagraphReader.textLength(Zb)),"",!1,"");this.yoa.Asg(this.FIa(Qc,0,qd),
"",!1,"");jb.Nra=Nc.mkp;Me.Nra=Nc.Y_j}finally{Ia&&Ia.dispose()}}finally{df&&df.dispose()}Rd.b_a()}finally{Rd&&Rd.dispose()}jb=new wm(Nc,jb.id,Me.id);Aa.M$=jb;lc.gfg(jb);null!=this.eIb&&this.eIb.MGe(jb);return!0}Kee(Aa){const jb=new qh.a;jb.nd(Aa);jb.kd(11);return Dg.ListItemReader.Fg(jb)?(l.ULS.sendTraceTag(16868566,355,50,"Blocked RTT para operation: in a list"),!0):!1}q9l(Aa,jb,lc){var Nc=jb.FQb(Aa.ed);if(Nc.equals(Of.a.nil))return null;Nc=lc.Eb(Nc);if(!Nc||!Ha.ParagraphReader.Wb(Nc)||!Nc.isConnected)return null;
const qd=qh.a.eb(Nc);if(!qd.zb(23))return null;if(Aa.xNg){Aa=jb.FQb(Aa.xNg);if(Aa.equals(Of.a.nil))return null;lc=lc.Eb(Aa);if(!lc||!Ha.ParagraphReader.Wb(lc)||!lc.isConnected)return null;lc=qh.a.eb(lc);if(!lc.zb(23))return null;lc.kd(11);lc.cP();lc.je();if(lc.currentNode!==Nc)return null}return this.Kee(qd)?null:qd}Rpp(Aa,jb,lc,Nc){const qd=jb.currentNode,Rd=this.ipa.Lc(3);try{Rd.Ab(qd);jb.kd(11);const Me=jb.currentNode;jb.uc();const df=this.rMc.fob();jb.VJ(df,Me,89);jb.Yj(df);const Cf=yk.a.instance.createInstance(ri.a.paragraphNode),
sg=Cf.H0();try{Cf.setValue(we.a.zn,""),Cf.lLa=!0,Nc.hZb(Cf),Nc=[0],Cf.setValue(pg.a.Iq,Nc),Cf.setValue(pg.a.It,Nc),Cf.lLa=!1,Cf.setValue(pg.a.ed,Aa.Pag),Cf.setValue(pg.a.Vj,Aa.Oag),Cf.isDirty=!1,jb.Wf(Cf,2),Cf.YQ=!0,Cf.Nra=Aa.Oag}finally{sg&&sg.dispose()}Rd.b_a();Aa.M$=new rl(Aa,Cf.id);lc.gfg(Aa.M$);null!=this.eIb&&this.eIb.MGe(Aa.M$)}finally{Rd&&Rd.dispose()}return!0}FIa(Aa,jb,lc){return jb===lc?zb.a.Uc(Aa,jb):zb.a.createTextRange(Aa,jb,lc)}CEo(Aa,jb,lc,Nc,qd=null){const Rd=Aa.node;if(Aa.cpBegin!==
Aa.cpEnd&&!this.p1i(Aa))return qd&&qd.properties.W(vg.s5j,"1"),!1;qd=this.ipa.Lc(3);try{qd.Ab(Rd);const Me=Rd.H0();try{Rd.YQ=!0,this.yoa.Asg(Aa,jb,lc,Nc)}finally{Me&&Me.dispose()}qd.b_a()}finally{qd&&qd.dispose()}return!0}wCl(Aa,jb){jb.lLa=!0;jb.bva(Aa.characterData);jb.Nra=Aa.Nra;jb.ra.clear();for(var lc=0;lc<Aa.ra.length;lc++){const Nc=Aa.ra.Ub(lc).Zqa(jb);jb.ra.add(Nc)}jb.Vm();if(jb.qe.length)for(Aa=0;Aa<jb.ra.length;Aa++){if((lc=jb.ra.Ub(Aa).formatting)&&-1!==lc.te)for(;jb.qe.length<=lc.te;)jb.qe.rX(jb.qe.length-
1,256)}else l.ULS.sendTraceTag(9204881,355,15,"Cannot update WordRunProperties after splitting paragraph");jb.lLa=!1}a1f(Aa){Aa=qh.a.eb(Aa);Aa.zb(23);Aa.uc();return{returnValue:89===Aa.role,iterator:Aa}}wrg(Aa){const jb=new qh.a;jb.nd(Aa);jb.uc();const lc=this.ipa.Lc(3);try{lc.Ab(jb.currentNode),Aa.Tg()}finally{lc&&lc.dispose()}}Syo(Aa){if(Aa.anchor)if(({iterator:jb}=this.a1f(Aa)).returnValue)this.wrg(jb);else{var jb=Aa.Hc.Mm;var lc=this.ipa.Lc(3);try{lc.Ab(Aa),Aa.load(Object(Ym.d)(jb).Eb(Aa.id)),
Aa.anchor.X_(4)}finally{lc&&lc.dispose()}}}lug(Aa,jb,lc){for(let Rd=jb.count-1;0<=Rd;Rd--){var Nc=jb.K(Rd);switch(Nc.opType){case 4:Nc=Object(z.a)(wm,Nc);if(!Aa.id.equals(Nc.Vze)){l.ULS.shipAssertTag(9204885,355,Aa.id.equals(Nc.UXc));continue}Nc=lc.Eb(Nc.UXc);if(!Nc)break;if(!Nc||!Ha.ParagraphReader.Wb(Nc)){l.ULS.shipAssertTag(9204886,355,!1);break}if(!Nc.isConnected)continue;var qd=({iterator:Nc}=this.a1f(Nc)).returnValue;l.ULS.shipAssertTag(9204887,355,qd);qd&&this.wrg(Nc);break;case 2:(Nc=Object(z.a)(rl,
Nc),Aa.id.equals(Nc.paragraphId))?Aa.isConnected&&(qd=({iterator:Nc}=this.a1f(Aa)).returnValue,l.ULS.shipAssertTag(16820002,355,qd),qd&&this.wrg(Nc)):l.ULS.shipAssertTag(16820001,355,!1)}}}EAl(Aa,jb){const lc=this.fJb.SYa(jb.characterData,jb.ra),Nc=this.fJb.FMb(lc,Aa.RU);Aa=this.fJb.FMb(lc,Aa.X7);return Nc===Aa?zb.a.Uc(jb,Nc):zb.a.createTextRange(jb,Nc,Aa)}p1i(Aa){const jb=Aa.node.ra,lc=Aa.cpBegin;Aa=Aa.cpEnd;for(let Nc=0;Nc<jb.length;Nc++){const qd=jb.Ub(Nc);if(qd.cp>=Aa)break;if(qd.cp>=lc){if(qd.Ue)return l.ULS.sendTraceTag(8242647,
355,15,"Rejected unsafe wet change: range contains comment"),!1;if(qd.blob)return l.ULS.sendTraceTag(8242648,355,15,"Rejected unsafe wet change: range contains blob"),!1;if(qd.lc||qd.QTb||qd.Jnc)return l.ULS.sendTraceTag(8242649,355,15,"Rejected unsafe wet change: range contains field"),!1}}return!0}}vg.frj="ParagraphAlreadyDirty";vg.s5j="UnsafeWetChange";Object(f.a)(vg,"RttEditor",null,[177]);var Sh=d(17),Ei=d(1344),pj=d(256);class Ed{constructor(){this.dwd=new R.a}add(Aa){this.dwd.add(Aa);return!0}t7d(Aa){const jb=
new R.a;for(const lc of this.dwd)Aa(lc)&&jb.add(lc);return jb}Lqg(Aa){Aa.activity.jdg("dried");this.dwd.remove(Aa)}Oqg(Aa){Aa.activity.jdg("expired");this.dwd.remove(Aa)}}Object(f.a)(Ed,"RttAddParagraphDataStore",null,[]);class ni extends ff{constructor(Aa,jb,lc,Nc,qd,Rd,Me,df){super(2,df);this.ed=Aa;this.Vj=jb;this.y4=lc;this.xNg=Nc;this.Pag=qd;this.Oag=Rd;this.LJ=Me}serialize(){const Aa=new jf.a(2,this.ed,this.Vj,null,this.xNg,null,null,this.LJ),jb=new fc(this.y4,this.Pag,this.Oag);return new Jc(this.metadata.packetId,
this.metadata.clientId,1,3,Aa,null,void 0,void 0,jb,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Aa){const jb=Aa.yW,lc=Aa.hcc;let Nc=null;null!=Aa.yW.FMa&&(Nc=Aa.yW.FMa);return new ni(jb.KYa,jb.Neb,lc.OGg,Nc,lc.Xhg,lc.y4,jb.LJ,ne.create(Aa))}static rJm(Aa,jb){return 3!==Aa.type?null:new ni(Aa.Xta.ed,Aa.Xta.Vj,Aa.uRn.Vj,Aa.mYa?Aa.mYa.ed:null,Aa.oCa.ed,Aa.oCa.Vj,Aa.LJ,jb)}}Object(f.a)(ni,"RttAddParagraphOp",ff,[]);class Ee{constructor(Aa){this.GY=Aa}lzj(){this.GY&&this.GY.properties.W(Ee.zmi,
"1")}lqo(Aa){this.GY&&(this.GY.properties.tb(Ee.d9f)||this.GY.properties.W(Ee.d9f,(Aa-this.GY.startTime).toString()))}jdg(Aa){this.GY&&(this.GY.properties.W(Ee.YDj,Aa),this.GY.end())}Kro(Aa){this.GY&&this.GY.properties.W(Ee.lqj,Aa.toString())}Iro(Aa){this.GY&&this.GY.properties.W(Ee.Hpj,Aa)}static MTf(Aa){Aa.v8(rh.a.TZb,Ee.zmi,Ei.a.cZj);Aa.v8(rh.a.TZb,Ee.Y5l,Ei.a.cZj);Aa.v8(rh.a.TZb,Ee.d9f,Ei.a.Wbl);Aa.v8(rh.a.TZb,Ee.YDj,Ei.a.mza);Aa.v8(rh.a.TZb,Ee.lqj,Ei.a.mza);Aa.v8(rh.a.TZb,Ee.Hpj,Ei.a.mza)}static create(Aa){if(!Aa)return null;
Aa=Aa.rq(rh.a.TZb,Ee.bHp);return new Ee(Aa)}}Ee.zmi="FailedToFindInitialParaID";Ee.Y5l="FailedToFindInitialTextID";Ee.d9f="MsecUntilApplied";Ee.YDj="RemovedBecause";Ee.lqj="PacketVersions";Ee.Hpj="OperationType";Ee.bHp=48E4;Object(f.a)(Ee,"RttOpActivity",null,[]);var hh;(function(Aa){Aa[Aa.unknown=0]="unknown";Aa[Aa.wjq=1]="replaceTextRangeOp";Aa[Aa.XTp=2]="addParagraphOp";Aa[Aa.WYp=3]="deleteParagraphOp";Aa[Aa.Snq=4]="splitParagraphOp";Aa[Aa.d9p=5]="mergeParagraphOp";Aa[Aa.vjq=6]="replaceSymbolRangeOp"})(hh||
(hh={}));Object(f.b)("RttOpType",hh);var Mj=d(104);class Bj extends Kf{constructor(Aa,jb,lc,Nc,qd,Rd,Me,df,Cf,sg,lg){super(Nc,qd,Rd,Me,df,Cf,sg,lg,6);this.font=Aa;this.Wzn=jb}NNf(){return"OffsetStart: "+this.RU+"OffsetEnd: "+this.X7}serialize(){const Aa=this.Eai();return new Jc(this.metadata.packetId,this.metadata.clientId,1,7,Aa,null,this.y4,this.Wzb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Aa){let jb,lc,Nc,qd;if(!({RU:jb,X7:lc,ed:Nc,Vj:qd}=Kf.r3j(Aa)).returnValue)return null;
let Rd,Me;if(1===Aa.text.length)Rd=!1,Me=Mj.AParagraphNode.RB;else if(2===Aa.text.length)if(gc.a.xYi(Aa.text,0)&&gc.a.VA(Aa.text,1))Rd=!0,Me=Aa.text;else return l.ULS.sendTraceTag(8914772,355,15,"RTT symbol packet has text length 2 but is not a valid surrogate pair",Aa.operationType),null;else return l.ULS.sendTraceTag(8914773,355,15,"RTT symbol packet text is of unsupported length (length must be 1 or 2)",Aa.operationType),null;const df=Aa.Jqd,Cf=ne.create(Aa);return new Bj(df.oFg,df.pFg,Rd,Nc,qd,
jb,lc,Aa.w1b,Me,Aa.yW.LJ,Cf)}}Object(f.a)(Bj,"RttReplaceSymbolRangeOp",Kf,[178,199]);class Zl extends Kf{constructor(Aa,jb,lc,Nc,qd,Rd,Me,df){super(Aa,jb,lc,Nc,qd,Rd,Me,df,1)}NNf(){return"OffsetStart: "+this.RU+"OffsetEnd: "+this.X7+"TextAddedLength: "+this.Wzb.length}serialize(){const Aa=this.Eai();return new Jc(this.metadata.packetId,this.metadata.clientId,1,2,Aa,null,this.y4,this.Wzb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Aa){let jb,lc,Nc,qd;if(!({RU:jb,
X7:lc,ed:Nc,Vj:qd}=Kf.r3j(Aa)).returnValue)return null;let Rd="";Aa.text&&(Rd=Aa.text);const Me=ne.create(Aa);return new Zl(Nc,qd,jb,lc,Aa.w1b,Rd,Aa.yW.LJ,Me)}static uIm(Aa,jb,lc){if(Aa.type)return null;const Nc=lc.SYa(Aa.Y7.characterData,Aa.Y7.ra);return new Zl(Aa.Y7.ed,Aa.Y7.Vj,lc.EBc(Nc,Aa.cpBegin),lc.EBc(Nc,Aa.cpEnd),Aa.oCa.Vj,Aa.Iba,Aa.LJ,jb)}}Object(f.a)(Zl,"RttReplaceTextRangeOp",Kf,[178,199]);class kj{constructor(Aa,jb,lc,Nc,qd,Rd,Me,df,Cf,sg,lg,Ia,Zb,Qc,ed,Pd,hb,Id,he,Cd,Wg){this.$z=Cd;this.$hc=
Wg;this.Zk=null;this.xXe=this.vKh=!1;this.Yzd=!0;this.pwh=0;this.NDh=this.m7e=this.PDh=this.MDh=this.ODh=!1;this.Nfg=()=>{l.ULS.sendTraceTag(7685328,355,50,"All prerequisite ready for RttManager");this.Zk=this.sO.result;l.ULS.sendTraceTag(7685330,355,50,"Subscribing to presence updates");this.Zk.AO(this.dS)};this.dS=(cd,If)=>{if(3===If.type||10===If.type)if(10===If.type)this.pwh="boolean"===typeof If.jA?If.jA?1:0:If.jA;else{if(La.a.Ana){if(La.a.Bk&&La.a.Bk.Lrb){l.ULS.sendTraceTag(508351552,355,15,
"RTT channel did not get disconnected on lock release");return}}else if(this.T8b.value&&!this.T8b.value.Lrb){l.ULS.sendTraceTag(8454939,355,15,"RTT channel did not get disconnected on lock release");return}if(!If.jA)l.ULS.sendTraceTag(7685331,355,15,"RTT packet was empty");else if(!this.$hc||2!==this.$z.Gv)if(this.Xro(),(cd=this.NRl(If.jA))&&1!==cd.metadata.clientType&&(this.Wro(),(!this.Fp||this.Fp.qba||Sh.a.Tsb||Sh.a.QR||Sh.a.Tsb||Sh.a.QR)&&2!==this.pwh))switch(this.Yzd&&(this.A$b.wzj(),this.Yzd=
!1),this.vKh||this.r7m(),cd.opType){case 1:case 6:case 4:if(!({Rg:cd}=this.uVk(cd)).returnValue)break;this.FHh?this.PJj(cd):this.u4j(cd);break;case 2:this.jDc.add(cd),this.QQi(cd),this.FHh?this.PJj(Of.a.nil):this.t4j(cd)}}};this.J4l=()=>{const cd=this.Pi.value;if(cd){var If=this.gF()-kj.dzo,Rf=this.aDb.t7d(mh=>mh.metadata.eHg<If);0<Rf.count&&this.mqo();var ih=new pj.a;for(const mh of Rf)if(this.aDb.Oqg(mh),mh.M$)switch(mh.M$.opType){case 1:ih.add(mh.M$.paragraphId.toString());break;case 6:ih.add(mh.M$.paragraphId.toString());
break;case 4:ih.add(mh.M$.Vze.toString()),ih.add(mh.M$.UXc.toString())}Rf=this.jDc.t7d(mh=>mh.metadata.eHg<If);for(const mh of Rf)this.jDc.Oqg(mh),mh.M$&&ih.add(mh.M$.paragraphId.toString());for(const mh of ih)(ih=cd.Eb(Of.a.Bf(mh)))?ih.YQ?(this.dIb.Syo(ih),ih.YQ||this.TKc.value.pDj(ih)):l.ULS.sendTraceTag(8765829,355,15,"Expiring wet change from paragraph with no applied changes"):l.ULS.sendTraceTag(8765828,355,15,"Expiring wet change with invalid object ID")}else this.Pi.IRf&&l.ULS.sendTraceTag(7685332,
355,10,"Failed to find the IObjectSpace! Wet changes will never expire")};this.dIb=Aa;this.aDb=jb;this.TKc=lc;this.T8b=Nc;this.nO=qd;this.sO=Rd;this.Pi=Me;this.Jb=df;this.gF=Cf;this.fJb=sg;this.zd=lg;this.O3e=Zb;this.Rc=Qc;this.FHh=ed;this.A$b=Pd;this.SBb=hb;this.rcf=Id;this.hNc=new F.a(G.a.vh());this.jDc=new Ed;Ia.execute(kj.MTf);this.Fp=he}r7m(){const Aa=new xa.a(3,2,kj.gBo,this.J4l);this.Jb.$b(Aa);this.vKh=!0}init(){return this.sO?this.sO.continueWith(this.Nfg):D.Task.a7(!1)}NRl(Aa){Aa=ah(Aa);
if(!Aa)return null;switch(Aa.operationType){case 2:return Zl.create(Aa);case 7:return Bj.create(Aa);case 4:return kf.create(Aa);case 3:return ni.create(Aa);default:return l.ULS.sendTraceTag(8459668,355,50,"RTT packet is of unexpected operationType {0}",Aa.operationType),null}}uVk(Aa){let jb=Of.a.nil;if(!this.aDb.tVk(Aa))return{returnValue:!1,Rg:jb};this.QQi(Aa);if(!this.nO)return{returnValue:!1,Rg:jb};const lc=this.nO.FQb(Aa.ed);if(lc.equals(Of.a.nil)||!this.Pi.value.Eb(lc))return Aa.activity.lzj(),
{returnValue:!1,Rg:jb};this.yzj();return{returnValue:!0,Rg:lc}}PJj(Aa){Aa.equals(Of.a.nil)||this.hNc.add(Aa.toString());this.xXe||(Aa=new xa.a(0,1,200,()=>{this.Qrp();this.xXe=!1},71),this.Jb.$b(Aa),this.xXe=!0)}KMo(Aa){Aa=new xa.a(0,1,0,Aa,71);this.Jb.$b(Aa)}QQi(Aa){Aa.activity=Ee.create(this.zd);Aa.activity.Kro(Aa.metadata.packetVersion);Aa.activity.Iro(hh[Aa.opType])}Qrp(){var Aa=this.jDc.t7d(lc=>!lc.M$);for(const lc of Aa)this.t4j(lc);if(this.hNc.count){Aa=null;for(var jb of this.hNc){jb=Of.a.Bf(jb);
Aa=this.Pi.value.Eb(jb);break}jb=this.Rc.Lc(3);try{jb.Ab(Aa);for(const lc of this.hNc)this.u4j(Of.a.Bf(lc))}finally{jb&&jb.dispose()}this.hNc.clear()}}u4j(Aa){Aa=this.Pi.value.Eb(Aa);let jb;const lc=this.Rc.Lc(3);try{lc.Ab(Aa);jb=this.zd.rq(rh.a.cTh);const Nc=this.hTh(Aa,jb);jb.end();Nc&&this.$Yk(Nc)}finally{lc&&lc.dispose(),this.A$b.hpg(1),this.Yzd=!0}}t4j(Aa){var jb=this.dIb.q9l(Aa,this.nO,this.Pi.value);jb&&(this.yzj(),this.dIb.Rpp(Aa,jb,this.SBb,Pa.a.instance.resolve("Box4.IParagraphEditor"))&&
(jb=this.Pi.value.Eb(Aa.M$.paragraphId),this.ATh(jb,Aa),this.A$b.hpg(1),this.Yzd=!0))}$Yk(Aa){this.O3e.continueWith(()=>{if(1===Aa.opType){var jb=this.wGm(Aa);jb&&(this.O3e.result.fef(jb),this.O3e.result.Qte(!0))}})}wGm(Aa){const jb=Aa.serialize();if(2!==jb.operationType||jb.yW.FMa&&jb.yW.KYa!==jb.yW.FMa)return null;const lc=Aa.RU.clone();0<Aa.Wzb.length&&(lc.Q2h(),lc.cp+=Aa.Wzb.length);jb.operationType=0;jb.text=null;jb.yW.Ise=0;jb.yW.RU=lc;jb.yW.Neb=jb.w1b;jb.yW.FMa=null;jb.yW.qzc=null;jb.yW.X7=
null;jb.w1b=null;return Vd.jsf(jb,this.nO,this.fJb,()=>this.Pi.value,this.rcf.instance)}ATh(Aa,jb){return this.TKc.value?this.TKc.value.bUk(Aa,jb.metadata.clientId).returnValue?!0:(l.ULS.sendTraceTag(7866379,355,15,"Unable to apply a wet change lock"),!1):(l.ULS.shipAssertTag(7866378,355,!!this.TKc.value,"Unable to apply wet changes as LockManager unavailable"),!1)}gTh(Aa,jb){this.hTh(Aa,jb)}hTh(Aa,jb){if(!Aa)return null;if(!Aa.anchor)return jb&&jb.properties.W(kj.Tgj,"1"),null;if(!Aa.hasProperty(pg.a.ed))return l.ULS.sendTraceTag(7619922,
355,15,"Paragraph is missing the WordId property"),null;if(!Aa.hasProperty(pg.a.Vj))return l.ULS.sendTraceTag(8197722,355,15,"Paragraph is missing the TextId property"),null;if(Aa.hasProperty(pg.a.Vfi)&&Aa.getValue(pg.a.Vfi))return l.ULS.sendTraceTag(16815506,355,50,"RTT edit disabled in paragraph"),null;const lc=Aa.getValue(pg.a.ed);var Nc=Aa.Nra;jb&&(jb.properties.W(kj.rSn,Nc.toString()),jb.properties.W(kj.tSn,lc.toString()));Nc=this.aDb.SKf(lc,Nc);if(!Nc)return jb&&jb.properties.W(kj.Hgj,"1"),
null;if(!this.ATh(Aa,Nc))return jb&&jb.properties.W(kj.z8h,"1"),null;let qd=0,Rd=null;for(;Nc;){if(!this.dIb.Z8k(Nc,Aa,this.SBb,jb)){jb&&jb.properties.W(kj.jbk,"1");break}qd++;Nc.activity.lqo(this.gF());Rd=Nc;Nc=Aa.Nra;Nc=this.aDb.SKf(lc,Nc)}0<qd&&this.Zyj();jb&&jb.properties.add(kj.kbk,qd.toString());return Rd}xte(Aa){if(Aa.hasProperty(pg.a.ed)&&Aa.hasProperty(pg.a.Vj)){var jb=Aa.getValue(pg.a.ed),lc=Aa.ka(pg.a.Vj,0),Nc=this.zd.rq(rh.a.vBj),qd=this.SBb.a_n(Aa.id);0<qd.count&&(this.dIb.lug(Aa,qd,
this.Pi.value),this.yzo(Aa,qd,lc));var Rd=this.SBb.Igm(jb);if(Rd&&!Aa.id.equals(Rd.paragraphId)){const Me=this.Pi.value;this.KMo(()=>{const df=this.SBb.Svb(Rd.paragraphId),Cf=Me.Eb(Rd.paragraphId);l.ULS.shipAssertTag(16820032,355,!!Cf,"Could not find added graph node");Cf&&(this.dIb.lug(Cf,df,Me),this.jDc.Lqg(Rd.gef))})}this.aDb.SKf(jb,lc)||this.TKc.value.pDj(Aa);this.gTh(Aa,Nc);Nc.end()}}yzo(Aa,jb,lc){let Nc=!1;for(let Rd=jb.count-1;0<=Rd;Rd--){var qd=jb.K(Rd);switch(qd.opType){case 1:case 6:case 4:qd=
Object(z.a)(178,qd.operation);break;default:continue}qd.y4===lc&&(Nc=!0,qd.jBc&&!qd.jBc.zEp(Aa)&&l.ULS.sendTraceTag(8765831,355,15,"Validating wet change location failed. Type {0} OffsetInfo {1} NodeId {2} ValidatorNodeId {3} ValidatorNodeCpBegin {4} ValidatorNodeCpEnd {5}",qd.opType,qd.NNf(),Aa.id,qd.jBc.id,qd.jBc.cpBegin,qd.jBc.cpEnd));Nc&&this.aDb.Lqg(qd)}Nc&&this.Zyj()}sfd(Aa){const jb=this.SBb.Svb(Aa.id);0<jb.count&&(2===jb.K(0).opType&&jb.removeAt(0),this.dIb.lug(Aa,jb,this.Pi.value))}lye(Aa){var jb=
this.SBb.iDm(Aa.id);for(const lc of jb)if(4===lc.opType&&(jb=Object(z.a)(wm,lc),Aa.id.equals(jb.wTk)))return!0;return!1}Xro(){this.ODh||(l.ULS.sendTraceTag(8704354,355,50,"Received a wet change"),this.ODh=!0)}Wro(){this.MDh||(l.ULS.sendTraceTag(8185606,355,50,"Received a wet change that we could deserialize"),this.MDh=!0)}yzj(){this.PDh||(l.ULS.sendTraceTag(17147533,355,50,"Received a usable wet change"),this.PDh=!0)}Zyj(){this.m7e||(l.ULS.sendTraceTag(8185607,355,50,"Successfully applied a wet change"),
this.m7e=!0)}mqo(){this.m7e||this.NDh||(l.ULS.sendTraceTag(8185608,355,15,"Failed to apply any wet changes so far"),this.NDh=!0)}static MTf(Aa){const jb=[rh.a.cTh,rh.a.vBj];for(const lc of jb)Aa.v8(lc,kj.kbk,Ei.a.mza),Aa.v8(lc,kj.Hgj,Ei.a.mza),Aa.v8(lc,kj.Tgj,Ei.a.mza),Aa.v8(lc,kj.z8h,Ei.a.mza),Aa.v8(lc,kj.jbk,Ei.a.mza),Aa.v8(lc,vg.frj,Ei.a.mza),Aa.v8(lc,vg.s5j,Ei.a.mza);Ee.MTf(Aa)}}kj.gBo=6E4;kj.dzo=18E4;kj.kbk="WetChangeCount";kj.Hgj="NoChangesToApply";kj.Tgj="NodeNotConnected";kj.z8h="CouldNotGetLock";
kj.jbk="WetChangeBlocked";kj.tSn="NodeWordId";kj.rSn="NodeTextId";Object(f.a)(kj,"RttManager",null,[179]);class Ci{constructor(Aa,jb){this.vIj=0;this.qk=Aa;this.CKo=jb}wzj(){this.vIj=this.qk()}hpg(Aa){const jb=this.qk()-this.vIj;0<=jb&&this.CKo.track(Math.round(jb),0===Aa?"CTB":"RTP")}}Object(f.a)(Ci,"RttPerfCounter",null,[174]);var Ek=d(2039);class zi{constructor(){this.OOc=new Ek.a}CZk(Aa,jb){this.OOc.back()&&jb&&this.OOc.back().D6a(Aa)||this.OOc.enqueue(Aa)}BBm(){return this.OOc.isEmpty?null:this.OOc.dequeue()}}
Object(f.a)(zi,"RttSendDataStore",null,[173]);class Sg extends ff{constructor(Aa,jb,lc,Nc){super(3,Nc);this.ed=Aa;this.Vj=jb;this.LJ=lc}get y4(){return 0}serialize(){const Aa=new jf.a(4,this.ed,this.Vj,null,null,null,null,this.LJ);return new Jc(this.metadata.packetId,this.metadata.clientId,1,5,Aa,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Aa){const jb=Aa.yW;return new Sg(jb.KYa,jb.Neb,jb.LJ,ne.create(Aa))}static sJm(Aa,jb){return 4!==Aa.type?
null:new Sg(Aa.kgc.ed,Aa.kgc.Vj,Aa.LJ,jb)}}Object(f.a)(Sg,"RttDeleteParagraphOp",ff,[178,199]);class km extends ff{constructor(Aa,jb,lc,Nc,qd,Rd,Me,df){super(5,df);this.wNg=Aa;this.X_j=jb;this.uIp=lc;this.nkp=Nc;this.LJ=qd;this.Xbk=Rd;this.rzc=Me}get ed(){return this.wNg}get Vj(){return this.X_j}get y4(){return this.wNg===this.Xbk?this.rzc:0}serialize(){const Aa=new jf.a(5,this.wNg,this.X_j,null,this.uIp,this.nkp,null,this.LJ),jb=new ib(this.Xbk,this.rzc);return new Jc(this.metadata.packetId,this.metadata.clientId,
1,6,Aa,null,void 0,void 0,void 0,jb,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Aa){const jb=Aa.yW,lc=Aa.qdd;return new km(jb.KYa,jb.Neb,jb.FMa,jb.qzc,jb.LJ,lc.Whg,lc.rzc,ne.create(Aa))}static tJm(Aa,jb){return 2!==Aa.type?null:new km(Aa.Xta.ed,Aa.Xta.Vj,Aa.mYa.ed,Aa.mYa.Vj,Aa.LJ,Aa.gje.ed,Aa.gje.Vj,jb)}}Object(f.a)(km,"RttMergeParagraphOp",ff,[178,199]);class Je{constructor(Aa,jb,lc,Nc,qd,Rd){this.sPc=this.ei=null;this.Sia=!1;this.faf=this.dIh=0;this.kNd=this.rJh=!1;this.q6e=
0;this.Nfg=()=>{l.ULS.sendTraceTag(8245954,355,50,"All prerequisites ready for RttSendManager");this.ei=this.sO.result;this.ei.ite(this)};this.rmj=(Me,df)=>{if(this.ei&&(m.AFrameworkApplication.$c("i100g733;fbhi3553"),!(m.AFrameworkApplication.J.getBooleanFeatureGate("StopRTTMessageWhenAlone",!1)&&this.afn()||2!==this.ei.connectionState)&&(Me=df.KF,Me.length)))if(df.n6)100>this.faf&&(this.faf++,l.ULS.sendTraceTag(8270467,355,50,"Blocking send. Reason: {0} OverallSends: {1} OverallBlocked: {2}",df.Ddl,
this.dIh,this.faf));else{for(df=0;df<Me.length;df++)if(!this.mvn(Me[df]))return;for(df=0;df<Me.length;df++){const Cf=Me[df];this.QCh.CZk(Cf,!Cf.type&&!df)}this.sPc||this.Ulj(this.sPc,this.ei)}};this.sO=Aa;this.QCh=jb;this.kjb=lc;this.Sy=Nc;this.iya=qd;this.A$b=Rd}get sn(){return this.kjb.value}init(){return this.sO?this.sO.continueWith(this.Nfg):D.Task.a7(!1)}start(){this.Sia||(this.Sy.hd?(this.Sy.hd.KF.A2k(this.rmj),this.Sia=!0):l.ULS.sendTraceTag(522740420,355,10,"No activePage, RttSendManager not started"))}stop(){this.Sia&&
(this.Sia=!1,this.Sy.hd.KF.DCo(this.rmj))}afn(){return this.sn&&this.sn.hA.FLa?!0:!1}mvn(Aa){return Aa&&-1!==Aa.LJ?Aa.type&&3!==Aa.type&&1!==Aa.type?!1:!0:!1}YGn(){this.kNd||(this.rJh||(l.ULS.sendTraceTag(8270468,355,50,"Preparing to send RTT change"),this.rJh=!0),!this.kNd&&5>=this.q6e&&this.q6e++)}lHn(){!this.kNd&&5>=this.q6e&&(l.ULS.sendTraceTag(8270469,355,50,"Sent Rtt Message"),this.kNd=!0)}Ulj(Aa,jb){this.YGn();Aa&&(Aa.Yi||Aa.Zo)&&l.ULS.sendTraceTag(8245956,355,15,"Task is faulted or cancelled with exception {0}",
Aa.wk);this.A$b.wzj();(Aa=this.uJm(this.QCh.BBm()))?(this.dIh++,this.sPc=jb.oC(3,Bf(Aa.serialize())),this.lHn(),this.A$b.hpg(0),this.sPc.continueWith(lc=>{this.Ulj(lc,jb)})):this.sPc=null}uJm(Aa){if(!Aa)return null;if(!this.sn)return l.ULS.sendTraceTag(8245957,355,15,"GetParagraphAnchoredOpFromGraphTransactionOperation: CoAuth manager is null"),null;const jb=new ne(Vi.instance.iCi(),this.sn.Bj,1,0,0,Jg.instance.SBm());let lc=null;switch(Aa.type){case 0:lc=Zl.uIm(Aa,jb,this.iya);break;case 4:lc=Sg.sJm(Aa,
jb);break;case 3:lc=ni.rJm(Aa,jb);break;case 2:lc=km.tJm(Aa,jb);break;case 1:lc=kf.vJm(Aa,jb,this.iya)}return lc}}Object(f.a)(Je,"RttSendManager",null,[169]);class Mc{constructor(){this.Z=null;this.rzm=()=>mb.a.xd()&&mb.a.xd().Bk?mb.a.xd().Bk:(l.ULS.sendTraceTag(7866377,304,15,"Unable to get the lock manager"),null)}get name(){return"WordEditor.RealTimeTyping"}wc(Aa){const jb=Ja.a.sq(Aa.Ta("Box4.IOutlineElementEditor")),lc=Ja.a.sq(Aa.Ta("Box4.IFeatureHelper")),Nc=Ja.a.sq(Aa.Ta("Common.IActivityAggregationInfo")),
qd=Ja.a.sq(Aa.Ta("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator")),Rd=Ja.a.sq(Aa.Ta("Box4.CompositionStateManager"));this.Z=Aa;const Me=new Yg.a;D.Task.WAA.call(null,jb,lc,Nc,qd,Rd).continueWith(()=>{Aa.ia("WordEditor.RealTimeTyping.IRttEditor",()=>new vg(Aa.resolve("Box4.ICharacterPropertiesEditor"),Aa.resolve("Box4.IOutlineElementEditor"),Me,Aa.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"))).ha();Aa.register(Ci,"WordEditor.RttPerfCounter").as("WordEditor.IRttPerfCounter").ha().Ud(()=>
new Ci(xh.a.Je,jm.a.dH(17,1,new Kk.a(new gn.a(.25)))));Aa.ia("WordEditor.RealTimeTyping.RttManager",()=>new kj(Aa.resolve("WordEditor.RealTimeTyping.IRttEditor"),new Dk(io.a.instance),new U.a(this.rzm),new U.a(()=>La.a.rV),Aa.resolve("WordEditor.ParagraphWordIdMapping"),Aa.resolve("Box4.Presence.IRtcProxyProvider").gD(),new U.a(()=>qb.StaticActiveAppFrame.za().kb&&qb.StaticActiveAppFrame.za().kb.hd?qb.StaticActiveAppFrame.za().kb.hd.ud:(l.ULS.sendTraceTag(522740419,304,10,"No activePage or workspace."),
null)),nb.a.instance,()=>Date.now(),Aa.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),io.a.instance,Aa.Ta("Common.IActivityAggregationInfo"),Mf.gD(),Me,m.AFrameworkApplication.J.$("WordEditorThrottleAndBatchRTTRendering"),Aa.resolve("WordEditor.IRttPerfCounter"),new aj,Aa.Ta("WordEditor.Presence.IWordPresenceCpFactory"),Aa.resolve("Box4.CompositionStateManager"),Aa.resolve("WordEditor.IMainViewModeManager"),Aa.resolve("WordEditor.ClientPagination.IClientPaginationSettings").$hc)).as("WordEditor.RealTimeTyping.IRttManager").ha();
Aa.ia("WordEditor.RealTimeTyping.RttSendManager",()=>new Je(Aa.resolve("Box4.Presence.IRtcProxyProvider").gD(),new zi,new U.a(()=>mb.a.xd()),qb.StaticActiveAppFrame.za().kb,Aa.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Aa.resolve("WordEditor.IRttPerfCounter"))).ha();this.NTf()})}NTf(){this.Z.resolve("WordEditor.RealTimeTyping.RttManager").init();this.Z.resolve("WordEditor.RealTimeTyping.RttSendManager").init()}init(){}dispose(){}static main(){da.a.instance.Mc(new Mc)}}
Object(f.a)(Mc,"WordEditorRealTimeTypingPackage",null,[0,1]);Type.registerNamespace("BPr");Type.registerNamespace("Box4.Presence");Type.registerNamespace("RealtimePresenceUI");Type.registerNamespace("WERTT");Type.registerNamespace("WordEditor.PeoplesWellControl");Type.registerNamespace("WordEditor.Presence");null!=m.AFrameworkApplication.J&&m.AFrameworkApplication.J.getBooleanFeatureGate("Microsoft.Office.WordOnline.LoadRtcFrom1JS",!1)?Promise.all([d.e(4),d.e(2),d.e(10)]).then(d.bind(null,2160)).then(Aa=>
(0,Aa.initRealtimechannel)()):Type.registerNamespace("AppRealtimeChannel");Type.registerNamespace("Common.App.CoauthTelemetry");Ca.main();Type.registerNamespace("Common.App.CollabControls");Ra.prototype.toString=va.a.prototype.toString;fb.prototype.toString=va.a.prototype.toString;da.a.instance.Mc(new Tl);Mc.main();Type.registerNamespace("RealtimePresenceUI");da.a.instance.Mc(new rd);Type.registerNamespace("Common.App.RtcHostNotificationSubscription");Ga.main()}}]);

//# sourceMappingURL=https://res-dev.cdn.officeppe.net/1js/build/23047711/wdjs/WordEditorDS.collab.js.map