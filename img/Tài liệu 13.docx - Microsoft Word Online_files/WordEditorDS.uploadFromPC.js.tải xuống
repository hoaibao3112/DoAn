'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[28],{2174:function(I,J,d){function m(){Type.registerNamespace("Common.App.UploadFromPC");ka.main()}d.r(J);I=d(0);var f=d(8),a=d(71),l=d(29);class w{constructor(qa,ua){this.start=qa;this.end=ua}}Object(I.a)(w,"SliceByteRange",null,[]);var z=d(2),x=d(91),u=d(179),v=d(16),D=d(95);class y{constructor(qa,ua,Pa,Ja){this.XPc=null;this.kac=0;this.KGa=1E3;this._file=qa;this.URk=ua;this.Bvk=Pa;this.LRe=Ja}Cap(){this.XPc=y.wKl(this._file);
const qa=this._file.slice(this.XPc.K(0).start,this.XPc.K(0).end);this.wLg(qa,0)}wLg(qa,ua){const Pa=y.bvm(this._file.size,this.XPc.K(ua));this.kac++;y.vtf(this.URk,qa,Ja=>{if(Ja.status===u.a.PTk)this.q4n(ua);else if(Ja.status===u.a.Gfc){f.ULS.sendTraceTag(508822418,231,50,"MSO:BlobSlicer: File created successfully");try{var Ca;let ra;if(!({av:ra}=l.d(Ja.responseText)).returnValue)throw Error.create("Unable to deserialize OneDriveItem response json");(Ca=ra)?this.Bvk(Ca):(f.ULS.sendTraceTag(508822417,
231,10,"MSO:BlobSlicer: OneDriveItem is null"),this.LRe(2))}catch(ra){f.ULS.sendTraceTag(508822416,231,10,"Exception while parsing OneDriveItemResponse {0}",ra.message),this.LRe(2)}}else this.fJo(qa,ua,Ja.status)},Pa)}q4n(qa){f.ULS.sendTraceTag(508822415,231,50,"MSO:BlobSlicer Slice uploaded successfully. SliceNumber {0}, UploadAttempts {1}",qa,this.kac);this.rGj();var ua=this.XPc.K(qa+1);ua=this._file.slice(ua.start,ua.end);this.wLg(ua,qa+1)}fJo(qa,ua,Pa){1>this.kac&&y.xrn(Pa)?(f.ULS.sendTraceTag(508822414,
231,10,"MSO:BlobSlicer: Retrying Slice upload request. Failure statusCode: {0}, attempts {1}",Pa,this.kac),z.AFrameworkApplication.pc.$b(new x.a(2,1,this.KGa,()=>{this.wLg(qa,ua)},42)),this.KGa*=2):(f.ULS.sendTraceTag(508822413,231,10,"MSO:BlobSlicer: Slice upload request failed, aborting the upload. Failure statusCode: {0}, attempts {1}",Pa,this.kac),this.rGj(),this.LRe(1,Pa))}rGj(){this.kac=0;this.KGa=1E3}static wKl(qa){const ua=new a.a;qa=qa.size;const Pa=Math.ceil(qa/5242880);let Ja=0,Ca;for(let ra=
0;ra<Pa;ra++)Ca=Math.min(Ja+5242880,qa),ua.add(new w(Ja,Ca)),Ja=Ca;return ua}static bvm(qa,ua){const Pa=new D.a;Pa.W("Content-Range",String.format("bytes {0}-{1}/{2}",ua.start,ua.end-1,qa));Pa.W("Accept","application/json");return Pa}static vtf(qa,ua,Pa,Ja){const Ca=new XMLHttpRequest;Ca.open("PUT",qa,!0);if(Ja)for(const ra of Ja)Ca.setRequestHeader(ra.key,v.a.gP(ra.value));Ca.onreadystatechange=()=>{4===Ca.readyState&&Pa(Ca)};Ca.send(ua)}static xrn(qa){switch(qa){case u.a.vxb:case u.a.xTi:case u.a.GTc:case u.a.n_b:case u.a.QEf:return!0;
default:return!1}}}Object(I.a)(y,"BlobSlicer",null,[]);var H=d(134),F=d(17);const G=()=>"%3Csvg%20width%3D%2220%22%20height%3D%2220%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Cpath%20d%3D%22M12.9993%2017C12.9993%2016.4484%2012.5522%2016.0013%2012.0006%2016.0013C11.4491%2016.0013%2011.002%2016.4484%2011.002%2017C11.002%2017.5515%2011.4491%2017.9986%2012.0006%2017.9986C12.5522%2017.9986%2012.9993%2017.5515%2012.9993%2017ZM12.7401%209.1467C12.6901%208.78066%2012.3761%208.49876%2011.9964%208.49906C11.5822%208.49939%2011.2467%208.83545%2011.247%209.24966L11.2506%2013.7513L11.2575%2013.853C11.3075%2014.2191%2011.6215%2014.501%2012.0012%2014.5007C12.4154%2014.5003%2012.7509%2014.1643%2012.7506%2013.7501L12.747%209.24846L12.7401%209.1467ZM13.9693%203.65888C13.113%202.11108%2010.8878%202.1111%2010.0316%203.65893L2.28634%2017.6604C1.45678%2019.16%202.5414%2020.9995%204.25518%2020.9995H19.7462C21.46%2020.9995%2022.5446%2019.16%2021.715%2017.6603L13.9693%203.65888ZM11.3442%204.38501C11.6296%203.86907%2012.3713%203.86906%2012.6567%204.38499L20.4025%2018.3865C20.679%2018.8863%2020.3175%2019.4995%2019.7462%2019.4995H4.25518C3.68392%2019.4995%203.32238%2018.8863%203.5989%2018.3865L11.3442%204.38501Z%22%20fill%3D%22%23817400%22%2F%3E%0A%3C%2Fsvg%3E%0A",
K=(qa,ua)=>{appChrome.PRIToastManager.showToastForUploadFile("",qa,ua);qa=new x.a(2,2,8E3,R,0);z.AFrameworkApplication.pc.$b(qa)},R=()=>{appChrome.PRIToastManager.dismissToast()},E=qa=>{const ua='\\/:*?"<>|'.split(""),Pa=new Sys.StringBuilder("");if(!qa||""===qa)return f.ULS.sendTraceTag(508672207,231,10,"MSO:InsertFileUploaderUtils: Empty File Name"),K(CommonUIStrings.l_UploadFileWithEmptyFileName,G()),!1;if(250<qa.length)return f.ULS.sendTraceTag(508672206,231,10,"MSO:InsertFileUploaderUtils: File Name larger than limit"),
qa=String.format(CommonUIStrings.l_UploadFileWithLargerFileName,250),K(qa,G()),!1;let Ja=!1;for(let Ca=0;Ca<ua.length;Ca++)Pa.append(ua[Ca]),Pa.append(" "),H.a(qa,ua[Ca])&&(Ja=!0);return Ja?(f.ULS.sendTraceTag(508672205,231,10,"MSO:InsertFileUploaderUtils: Invalid character in File Name"),qa=String.format(CommonUIStrings.l_UploadFileWithInvalidCharacterInFileName,Pa.toString()),K(qa,G()),!1):!0};var N=d(251),O=d(46),U=d(43);class X{constructor(){this.X9g=this.hId=this._file=null;this.n5b=0;this.ALk=
1E3}Kmo(qa){this.Zfe()?f.ULS.sendTraceTag(508822472,231,10,"MSO:CloudFileUploadManager:QueueFileUpload There is already an upload in progress"):qa?(f.ULS.sendTraceTag(508822470,231,50,"MSO:CloudFileUploadManager: File Queued of size: {0} and type: {1}",qa.size.toString(),qa.type),this._file=qa,appChrome.PRIToastManager.showToastForUploadFile("",CommonUIStrings.l_UploadFileProcessStartedMessage,null,!0),this.hbi()):f.ULS.sendTraceTag(508822471,231,10,"MSO:CloudFileUploadManager:QueueFileUpload Invalid upload context")}Zfe(){return!!this._file}hbi(){let qa=
String.format("UploadFileToHostHandler.ashx?action=uploadFile&{0}",z.AFrameworkApplication.rm);qa=O.a.yHa(qa,"filename",this._file.name);const ua=["request-id"];this.n5b++;const Pa={};Pa.ismsa=z.AFrameworkApplication.J.$("IsO365ConsumerHost");try{z.AFrameworkApplication.Fe.Xj(qa,1,null,Pa,!1,2,Ja=>{this.zLl(Ja)},Ja=>{this.XIo(Ja)},null,void 0,void 0,void 0,3E4,void 0,void 0,void 0,void 0,ua)}catch(Ja){f.ULS.sendTraceTag(508822469,231,10,"MSO:CloudFileUploadManager: Exception when creating uploadSession {0}",
Ja.message),this.$ed(0)}}XIo(qa){2>this.n5b?(f.ULS.sendTraceTag(508822468,231,10,"MSO:CloudFileUploadManager: CreateUploadSession request failed with code: {0}, with correlation and request id {1} and attempts {2}",qa.data.He,qa.data.wi,this.n5b),this.hbi()):(f.ULS.sendTraceTag(508822467,231,10,"MSO:CloudFileUploadManager: CreateUploadSession request failed with code: {0}, with correlation and request id {1} and attempts {2}",qa.data.He,qa.data.wi,this.n5b),this.$ed(0,qa.data.He))}zLl(qa){f.ULS.sendTraceTag(508822466,
231,50,"MSO:CreateUploadSessionRequestSucceeded:CloudFileUploadManager CloudAttachment request succeeded with code: {0}, with correlation and request id {1} and message {2} and attempts {3}",qa.data.He,qa.data.wi,qa.data.Pe,this.n5b);try{var ua;let Pa;if(!({av:Pa}=l.d(qa.data.Pe)).returnValue)throw Error.create("Unable to deserialize uploadSession response json");(ua=Pa)&&ua.uploadUrl&&""!==ua.uploadUrl?this.jCp(ua.uploadUrl):this.$ed(0)}catch(Pa){f.ULS.sendTraceTag(508822465,231,10,"MSO:CreateUploadSessionRequestSucceeded:CloudFileUploadManager Exception while parsing OneDriveItemResponse {0}",
Pa.message),this.$ed(0)}}jCp(qa){this.X9g=new y(this._file,qa,ua=>{this.Sxl(ua)},(ua,Pa)=>{this.$ed(ua,Pa)});z.AFrameworkApplication.pc.$b(new x.a(2,1,this.ALk,()=>{this.X9g.Cap()},42))}Sxl(qa){this.Zfe()?(this.hId=qa,this.vDa(!0)):f.ULS.sendTraceTag(508822464,231,15,"MSO:CloudFileUploadManager:CompleteUpload There is no upload in progress")}$ed(qa,ua=0){this.Zfe()?(K(this.kfa(ua),G()),this.vDa(!1)):f.ULS.sendTraceTag(508822435,231,15,"MSO:CloudFileUploadManager:OnFileUploadFailed There is no upload in progress, failureType {0}",
qa)}kfa(qa=0){switch(qa){case 507:return CommonUIStrings.l_UploadFileInsufficientStorageError;default:return CommonUIStrings.l_UploadFileInternalServerError}}vDa(qa){this.Zfe()?(qa&&(f.ULS.sendTraceTag(508703698,231,50,"MSO:CloudFileUploadManager: File successfully uploaded"),this._file.name!==this.hId.name&&f.ULS.sendTraceTag(508672208,231,50,"MSO:CloudFileUploadManager: Renamed file name"),appChrome.PRIToastManager.dismissToast(),U.a.Tpb(this.hId.webUrl),N.a.dispatch("fileUploadedSuccessfully")),
this._file=null,this.n5b=0,this.hId=null):f.ULS.sendTraceTag(508822434,231,15,"MSO:CloudFileUploadManager: There is no upload in progress")}}Object(I.a)(X,"CloudFileUploadManager",null,[1423]);var V=d(109),Q=d(1706),T=d(2038),ba=d(118);class W extends T.a{constructor(qa,ua,Pa,Ja,Ca,ra,Ea=null,xa,Ma=!1){super(qa,ua,Pa,Ja,Ca,"WACUploadFrame",z.AFrameworkApplication.userSessionId,ra,void 0,Ea,Ma,"false");this.qUf()}iD(){return ba.a.create().toString()}uMj(){}xXc(){}y8d(){return null}rlc(){}TWb(){}}Object(I.a)(W,
"FileUploadFrame",T.a,[]);var aa=d(19);class Y extends Q.a{constructor(qa,ua,Pa){super(qa,ua,Pa);this.Qp=this.rbh=null;this.nZn=Ja=>{Ja?(Ja=Ja.split("/"),Ja=Ja[Ja.length-1].split("\\"),Ja=Ja[Ja.length-1]):Ja=null;this.iMg(Ja,this.Vq)&&this.kul.Kmo(this.Vq.pR.files[0])};this.Qcd=0;this.NSc=new a.a}get Iw(){return this.Qp||(this.Qp=aa.a.instance.resolve("Common.Utils.IAriaNotifier"))}get kul(){return this.rbh||(this.rbh=aa.a.instance.resolve("Common.App.UploadFromPC.ICloudFileUploadManager"))}bXo(qa){this.Qcd=
qa}eSo(qa){this.NSc=qa}get T9j(){return"InsertFile"}showDialog(){var qa;if((qa=this.NSc)&&qa.count){var ua=new Sys.StringBuilder(""),Pa=qa.count;for(let Ja=0;Ja<Pa-1;Ja++)ua.append("."),ua.append(qa.K(Ja)),ua.append(", ");ua.append(".");ua.append(qa.K(Pa-1));qa=ua.toString()}else qa="";""===qa?K(CommonUIStrings.l_UnableToOpenFilePickerDialog,G()):void 0!==window.self.FormData&&null!==window.self.FormData?(this.Iob=!1,this.Vq=new W(document.body,Object(V.a)(this,this.jwb,"onUploadFrameInitialized"),
Object(V.a)(this,this.aoa,"uploadResponseReceived"),this.J,!1,qa,void 0,void 0,!0)):F.a.As||F.a.au||this.mvb&&F.a.OF?f.ULS.sendTraceTag(508699840,231,50,"MSO:InsertFileUploader: Dialog not rendered for OpenFilePickerDirectly: {0}",F.a.As||F.a.au):f.ULS.sendTraceTag(508822474,231,50,"MSO:InsertFileUploader: Dialog not rendered")}jwb(qa){this.Vq=qa;this.Iob||(this.rtd?(f.ULS.sendTraceTag(508703702,231,50,"MSO:InsertFileUploader: Insert file uploader frame opened"),qa.qZc(this.nZn)):this.dAa(qa,null))}iMg(qa,
ua){if(!this.coa(qa,ua))return!1;if(!this.HEp(qa))return f.ULS.sendTraceTag(508703700,231,10,"MSO:InsertFileUploader: Invalid File Extension"),K(CommonUIStrings.l_UploadFileWithInvalidExtension,G()),!1;qa=this.v5l(this.Vq);ua=this.Qcd;f.ULS.sendTraceTag(508822419,231,50,"{0}:Size:{1}",this.T9j,qa);if(!(0<qa&&qa<=1048576*ua))return f.ULS.sendTraceTag(508703699,231,10,"MSO:InsertFileUploader: Invalid File Size"),qa=String.format(CommonUIStrings.l_UploadFileLargerThanMaxSize,this.Qcd),K(qa,G()),!1;f.ULS.sendTraceTag(508822473,
231,50,"MSO:InsertFileUploader: Cloud File Upload of size: {0}",qa);return!0}HEp(qa){qa=RegExp("\\.([a-zA-Z0-9]{1,5})$").exec(qa);return this.NSc.contains(qa&&2===qa.length?qa[1]:null)}coa(qa){return E(qa)}Ykd(){}dAa(){this.uLg()}v5l(qa){return qa.pR.files[0].size}aoa(){}uLg(){this.Qsc();this.Iw.sendNotification(CommonUIStrings.l_UploadCompletedText,!0)}}Object(I.a)(Y,"InsertFileUploader",Q.a,[1424]);var da=d(178);class ka{constructor(){this.Z=null}get name(){return"Common.App.UploadFromPC"}init(){}dispose(){}wc(qa){this.Z=
qa;this.Z.register(1423,"Common.App.UploadFromPC.ICloudFileUploadManager").ha().Ud(()=>new X);this.Z.register(1424,"Common.IInsertFileUploader").ha().Ud(()=>new Y(null,z.AFrameworkApplication.pc,z.AFrameworkApplication.J))}static main(){da.a.instance.Mc(new ka,7)}}Object(I.a)(ka,"FileUploaderPackage",null,[0,1]);d.d(J,"initializeOnDemandPackage",function(){return m})}}]);

//# sourceMappingURL=https://res-dev.cdn.officeppe.net/1js/build/23047711/wdjs/WordEditorDS.uploadFromPC.js.map